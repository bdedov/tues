"use strict";!function(){function e(a,n,e,i,t,c,o){var s,r=this,l=[];function u(e){var t=_.cloneDeep(s.c8y_RelayArray),n=y(t[e])?"OPEN":"CLOSED";!function(e,t){l=_(l).push({relayIndex:e,targetRelayState:t}).uniqBy("relayIndex").value()}(e,n);var r=function(e,t,n){var r={deviceId:s.id,c8y_RelayArray:e},a=y(r.c8y_RelayArray[n]=t)?c("Close relay {{relayNo}}"):c("Open relay {{relayNo}}");return r.description=o.getString(a,{relayNo:n+1}),r}(t,n,e);(function(e){return _.isEqual(_.head(l).relayIndex,e)})(e)&&function(t){i.createWithNotifications(t).then(function(e){e.created.then(function(){!function(e){d(o.getString('"{{description | translate}}" will be executed.',e))}(t)}),e.completed.then(function(e){!function(e){l=_.drop(l),e.status===i.status.SUCCESSFUL?function(e){d(o.getString('"{{description | translate}}" completed.',e)),a.onSuccess&&a.onSuccess({operationResult:e})}(e):e.status===i.status.FAILED&&function(e){e.failureReason?f(o.getString('"{{description | translate}}" failed due to: "{{failureReason | translate}}".',e)):f(o.getString('"{{description | translate}}" failed.',e));a.onFailure&&a.onFailure({operationResult:e})}(e);if(l.length){var t=_.head(l).relayIndex;u(t)}}(e)})})}(r)}function y(e){return"CLOSED"===e}function d(e){p(t.success,e)}function f(e){p(t.danger,e)}function p(e,t){a.suppressAlerts&&a.suppressAlerts()||e(t)}function g(e){return _.find(l,{relayIndex:e})}_.assign(r,{toggle:u,isSupported:function(){return e.supportsOperation(s,"c8y_RelayArray")},isClosed:y,iconClass:function(e,t){var n;n=g(e)?"fa-circle-o-notch fa-spin":y(t)?"fa-check text-success":"fa-ban text-danger";return n},isOperationInQueue:g}),a.$watch("device()",function(e){var t=e&&(e.id||e);t&&n.detailRealtime(t,a).then(function(e){s=e,r.deviceRealtime=e})})}e.$inject=["$scope","c8yInventory","c8yDevices","c8yDeviceControl","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.deviceControl.relayArray").controller("c8yRelayArrayControlCtrl",e)}();