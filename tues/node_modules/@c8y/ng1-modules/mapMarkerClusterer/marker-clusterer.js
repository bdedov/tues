"use strict";!function(){function t(t,u,c,s,a,e){return{applyClustering:function(t){var a=t.mapInternalScope,e=a.map.leafletMap,n=a.deviceId(),r=L.markerClusterGroup({chunkedLoading:!0,spiderfyOnMaxZoom:!1}),o=function(){var a=L.control.attribution({position:"topright",prefix:""}),e=c("Last clusters calculation time: {{lastCalculation | absoluteDate}}"),n="";return(a.updateAttribution=t)(),a;function t(t){a.removeAttribution(n),n=s.getString(e,{lastCalculation:t}),a.addAttribution(n)}}(),i=new(L.Control.extend({options:{position:"topright"},onAdd:function(){var t=angular.element("<button>"),a=angular.element("<i>");return t.addClass("leaflet-bar leaflet-control leaflet-control-custom btn btn-default").on("click",l).append(a.addClass("fa fa-refresh")),t[0]}}));function l(){return function(t){return u.getClusters(t).then(function(t){var a=t.clusterInfo,e=_.flatMap(a,function(t){var a=t.lat,e=t.lng,n=t.devices;return _.times(n,function(){return L.marker(new L.LatLng(a,e))})});return{calculationTime:t.calculationTime,markers:e}})}(n).then(function(t){o.updateAttribution(t.calculationTime),a.map.markers=t.markers})}e.addLayer(r),e.addControl(o),e.addControl(i),a.noDataFetch=_.constant(!0),l(),a.$watchCollection("map.markers",function(){!function(){r.clearLayers(),r.addLayers(a.map.markers);var t=r.getBounds();t.isValid()&&e.fitBounds(t)}()})}}}t.$inject=["$q","clusterDataService","gettext","gettextCatalog","addressPoints","testData"],angular.module("c8y.mapMarkerClusterer").factory("mapMarkerClusterer",t)}();