"use strict";angular.module("c8y.core.measurements2").factory("c8yHoverInfo",function(){function e(e){var a=this;a._id=String(Math.random()).substr(2),e.addItem(a),a.chart=e,a.init()}function n(e,a){var t=moment(a);return"HOURLY"===e._aggregation?"".concat(t.format("ll")," ").concat(t.format("HH[:00]"),"-").concat(t.add(1,"hour").format("HH[:00]")):"MINUTELY"===e._aggregation?"".concat(t.format("ll")," ").concat(t.format("LT"),"-").concat(t.add(1,"minute").format("LT")):"DAILY"===e._aggregation?t.format("ll"):t.format("ll LTS")}return e.prototype={tplMain:$('<div class="c8y-chart-hover-box"></div>'),tplTime:$('<div class="clock"><i class="fa fw fa-clock-o"></i><span class="time"></span></div>'),tplRow:$('\n        <div class="series">\n          <div class="value-holder"><i class="fa fw fa-circle"></i><span class="label"></span><span class="value"></span></div>\n          <div class="time-holder"><i class="fa fw fa-clock-o"></i><span class="time"></span></div>\n        </div>\n      '),init:function(){var a=this,e=$("body");a.el=$("<div>").append(a.tplMain.clone()).find(".c8y-chart-hover-box");var t=a.el;a.el.append(a.tplTime.clone()),a.clock=t.find(".clock .time"),a.el.hide(),e.append(t),a.mouseMove=function(e){a._mx=e.pageX,a._my=e.pageY},a.chart.el.on("mousemove",a.mouseMove)},destroy:function(){this.el.remove()},render:function(e){var o=this,a=o.chart.series,i=o.el;if(!i.is(":hidden")){if(e){var t=n(o.chart,e);o.clock.text(t)}_.forEach(a,function(e){var a=e._hoverRow;if(!a){var t=o.tplRow.clone();e._hoverRow={el:t,circle:t.find(".fa-circle"),label:t.find(".label"),value:t.find(".value"),time:t.find(".time")},a=e._hoverRow,t.data("seriedata",e),i.append(t)}a.circle.css({color:e.dataPoint.color}),a.label.text(e.dataPoint.label),a.value.text(e.hoverValue()),"--"!==e.hoverTime()?a.time.text(n(o.chart,e.hoverTime())):a.time.text(e.hoverTime())}),i.find(".series").filter(function(){return!_.includes(a,$(this).data("seriedata"))}).remove()}},onMove:function(e,a){var t=this,o=t.chart;if(_.get(o,"selectedPoint.date")&&!o.mouseIn){var i=$(o.el).offset();t._mx=i.left+a+10,t._my=i.top}var n=t.el.width(),r=o.box().width<a+o.margins.l+n,c=window.scrollY+window.innerHeight,l=this.el.outerHeight(),s="auto",d=r?-($("body").width()-t._mx):t._mx+1,f=t._my+20;c<f+l&&(f=c-l);var m={left:r?s:0,right:r?0:s,transform:"translate(".concat(d,"px,").concat(f,"px)")};t.render(e),t.el.css(m)}},e});