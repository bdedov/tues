<div>
  <c8y-ui-title-set>
    <c8y-event-processing-rule-title
      rule="vm.module"
      on-save-name="vm.saveName(name)"
      ng-disabled="!vm.permissions.canAdmin"
    >
    </c8y-event-processing-rule-title>
  </c8y-ui-title-set>

  <form name="vm.moduleForm" novalidate>
    <div class="row">
      <div ng-class="vm.panelClasses.left">
        <div class="card">
          <div class="card-header">

            <div class="card-actions">
              <button
                title="{{ 'Examples' | translate }}…" 
                type="button"
                class="btn btn-link"
                ng-click="vm.browseExamples()"
                ng-disabled="!vm.permissions.canAdmin || vm.isSmartRuleModule(vm.module)"
              >
                <i c8y-icon="code"></i>
                {{'Examples' | translate}}…
              </button>
              <button
                type="button"
                class="btn btn-link visible-lg-inline-block"
                ng-click="vm.expand('left')"
                ng-if="!vm.isExpanded('left')"
                title="{{'Expand' | translate}}"
              >
                <i c8y-icon="expand" class="text-muted"></i>
              </button>
              <button
                type="button"
                class="btn btn-link visible-lg-inline-block"
                ng-click="vm.collapse()"
                ng-if="vm.isExpanded('left')"
                title="{{'Collapse' | translate}}"
              >
                <i c8y-icon="compress" class="text-muted"></i>
              </button>
            </div>
            <h4 class="card-title">
              <span>{{'Source code' | translate}}</span>
              <br>
              <small
                ng-if="vm.module.lastModified"
                translate
              >
                Last edited: {{vm.module.lastModified | absoluteDate}}
              </small>
            </h4>
          </div>
          <hr>
          <div
            name="aceEditor"
            ui-ace="vm.aceEditorOptions"
            ng-model="vm.module.body"
            ng-style="vm.aceEditorStyles"
            class="form-control"
            ng-readonly="!vm.permissions.canAdmin || vm.isSmartRuleModule(vm.module)"
            required>
          </div>
        </div>
      </div>

      <div ng-class="vm.panelClasses.right" ng-if="vm.module.id">
        <div class="card" style="min-height: 750px;">
          <div class="card-header">
            <h4 class="card-title">{{'Debugging and monitoring' | translate}}</h4>
            <div class="card-actions" >
              <button
                type="button"
                class="btn btn-link visible-lg-inline-block"
                ng-click="vm.expand('right')"
                ng-if="!vm.isExpanded('right')"
                title="{{'Expand' | translate}}"
              >
                <i c8y-icon="expand" class="text-muted"></i>
              </button>
              <button
                type="button"
                class="btn btn-link visible-lg-inline-block"
                title="{{'Collapse' | translate}}"
                ng-click="vm.collapse()"
                ng-if="vm.isExpanded('right')"
              >
                <i c8y-icon="compress" class="text-muted"></i>
              </button>
            </div>
          </div>
          <hr>
          <div>
            <uib-tabset justified="true">
              <uib-tab>
                <uib-tab-heading>
                  <i c8y-icon="bell"></i>
                  <span translate>Alarms</span>
                </uib-tab-heading>
                <div class="card-inner-scroll" style="max-height: 658px;">
                  <div class="card-block">
                    <c8y-event-processing-rule-alarms
                      rule="vm.module"
                    >
                    </c8y-event-processing-rule-alarms>
                  </div>
                </div>
              </uib-tab>
              <uib-tab>
                <uib-tab-heading>
                  <i c8y-icon="rss"></i>
                  <span translate>Notifications</span>
                </uib-tab-heading>
                <div class="card-inner-scroll" style="max-height: 658px;">
                  <div class="card-block">
                    <c8y-event-processing-rule-notifications
                      rule="vm.module"
                    >
                    </c8y-event-processing-rule-notifications>
                  </div>
                </div>
              </uib-tab>
              <uib-tab>
                <uib-tab-heading>
                  <i c8y-icon="line-chart"></i>
                  <span translate>Metrics</span>
                </uib-tab-heading>
                <div class="card-inner-scroll" style="max-height: 658px;">
                    <c8y-event-processing-rule-metrics
                      rule="vm.module"
                    >
                    </c8y-event-processing-rule-metrics>
                </div>
              </uib-tab>
            </uib-tabset>
          </div>
        </div>
      </div>
    </div>
    <div class="form-inline">
      <label translate>Status</label>
      <div class="form-control-static">
        <button
          type="button"
          class="btn btn-default"
          ng-model="vm.moduleDeployed"
          ng-disabled="!vm.permissions.canAdmin || vm.isSmartRuleModule(vm.module)"
          ng-change="vm.onModuleDeployedChanged(vm.moduleDeployed)"
          uib-btn-checkbox
        >
          <span title="{{ 'Deployed' | translate }}" ng-if="vm.moduleDeployed">
            <i c8y-icon="check-circle" class="text-success"></i>
            <translate>Deployed</translate>
          </span>
          <span title="{{ 'Not deployed' | translate }}" ng-if="!vm.moduleDeployed">
            <i c8y-icon="minus-circle" class="text-warning"></i>
            <translate>Not deployed</translate>
          </span>
        </button>
      </div>
    </div>
    <div class="text-center page-footer">
      <c8y-ui-button-footer changed="!vm.isSmartRuleModule(vm.module) && vm.moduleForm.$dirty">
        <button
          title="{{ 'Save' | translate }}" 
          type="submit"
          class="btn btn-primary"
          ng-click="vm.save(vm.module, vm.moduleForm)"
          ng-disabled="!vm.permissions.canAdmin || vm.isSmartRuleModule(vm.module) || vm.moduleForm.$invalid || vm.moduleForm.$pristine"
          translate
        >
          Save
        </button>
      </c8y-ui-button-footer>
    </div>
  </form>
</div>
