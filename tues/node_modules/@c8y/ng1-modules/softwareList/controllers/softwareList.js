"use strict";!function(){function e(t,n,i,o,r,e,a,s,l,c){var u,f,g=this,d="c8y_Software",w=[];function h(e){t.softwares&&!t.refreshLoading||(t.softwares=[],g.softwares=t.softwares),t.paging=e.paging,e.forEach(function(e){t.softwares.push(e)})}function y(){t.refreshLoading=!0,t.paging.refresh().then(h).finally(function(){t.refreshLoading=!1})}function p(e){return w.indexOf(e)}function m(e){return-1<p(e)}function S(e){var t=s.getIdFromUrl(e.selectedFile.url);return(t?s.setGlobalFlag(t,!0):n.when()).then(_.constant(e))}function v(e){return e.url=e.selectedFile.url,delete e.selectedFile,e}function b(e){return _.unset(e,"edited"),e}function F(){t.newSw={type:d},g.newSw=t.newSw}function L(){t.newSw=null,g.newSw=t.newSw}t.loadNext=function(){t.paging.loading=!0,t.paging.next().then(h).finally(function(){t.paging.loading=!1})},t.refresh=y,t.toggle=function(e){m(e)?w.splice(p(e),1):(w.push(e),e.edited={name:e.name,version:e.version})},t.isOpen=m,t.onClickDelete=function(e){o({title:l("Delete software item"),body:c.getString('You are about to delete software item "{{name}}". Do you want to proceed?',e),labels:{ok:l("Delete")},status:"danger",size:"sm"}).then(angular.bind(i,i.remove,e)).then(angular.bind(r,r.removeFromList,t.softwares,e)).then(function(){a.success(l("Software item deleted."))})},t.save=function(e){return e.type=d,_.merge(e,e.edited),n.when(e).then(_.partialRight(i.addGlobalFlag,!0)).then(S).then(v).then(b).then(i.save).then(function(){a.success(l("Software item saved.")),y(),$("body").trigger("click"),t.newSw=null})},t.add=F,t.cancelAdd=L,t.toggled=function(e,t){e?F():L(),t.$setPristine(),t.$setUntouched()},f=function(e){return _.assign({type:d},e||{})}(u),i.list(f).then(h),e.changeTitle({title:l("Software repository")})}e.$inject=["$scope","$q","c8yInventory","c8yModal","c8yBase","c8yTitle","c8yAlert","c8yBinary","gettext","gettextCatalog"],angular.module("c8y.parts.softwareList").controller("softwareListCtrl",e)}();