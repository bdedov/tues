<div ng-controller="knxWidgetConfigCtrl">
  <div class="form-group">
    <label style="display: block; clear: both;">
      <translate>Fields</translate>
      <a class="btn btn-link pull-right" style="padding: 0;" ng-click="addField()">
        <i c8y-icon="plus"></i> <translate>Add field</translate>
      </a>
    </label>
    <div ng-repeat="field in config.fields">
      <div class="form-group" style="margin-bottom: 10px;">
        <label class="text-muted" style="display: block; clear: both;">
          <span ng-hide="field.name" translate>Unnamed field</span>
          <span ng-show="field.name"
            >{{ field.name }}
            <span ng-show="field.address" translate>at {{ field.address }}</span></span
          >
          <a
            title="{{ 'Remove field' | translate }}"
            class="btn btn-link pull-right"
            style="padding: 0;"
            ng-click="removeField(field)"
          >
            <i c8y-icon="minus"></i> <translate>Remove field</translate>
          </a>
        </label>
        <div class="form-inline" style="clear: both;">
          <ng-form name="nestedFieldNameForm">
            <div
              class="form-group col-lg-4"
              ng-class="{'has-error': nestedFieldNameForm.$dirty && nestedFieldNameForm.$invalid}"
            >
              <input
                type="text"
                class="form-control"
                ng-model="field.name"
                placeholder="{{ 'Name' | translate }}"
                uib-tooltip="{{ 'Name' | translate }}"
                required
              />
            </div>
          </ng-form>
          <ng-form name="nestedFieldAddressForm">
            <div
              class="form-group col-lg-4"
              ng-class="{'has-error': nestedFieldAddressForm.$dirty && nestedFieldAddressForm.$invalid}"
            >
              <input
                type="text"
                class="form-control"
                ng-model="field.address"
                placeholder="{{ 'KNX address' | translate }}"
                uib-tooltip="{{ 'KNX address' | translate }}"
                required
              />
            </div>
          </ng-form>
          <ng-form name="nestedFieldTypeForm">
            <div
              class="form-group col-lg-4"
              ng-class="{'has-error': nestedFieldTypeForm.$dirty && nestedFieldTypeForm.$invalid}"
            >
              <select
                class="form-control"
                ng-model="field.type"
                ng-options="fieldType.value as fieldType.label for fieldType in fieldTypes"
                uib-tooltip="{{ 'Type' | translate }}"
                required
              ></select>
            </div>
          </ng-form>
        </div>
        <div style="clear: both;">
          <div ng-if="field.type === 'buttons'">
            <div ng-repeat="button in field.buttons" class="form-inline" style="clear: both;">
              <div class="form-group" style="margin-top: 10px;">
                <ng-form name="nestedButtonLabelForm">
                  <div
                    class="form-group col-lg-4"
                    ng-class="{'has-error': nestedButtonLabelForm.$dirty && nestedButtonLabelForm.$invalid}"
                  >
                    <input
                      type="text"
                      class="form-control"
                      ng-model="button.label"
                      placeholder="{{ 'Label' | translate }}"
                      uib-tooltip="{{ 'Label' | translate }}"
                      required
                    />
                  </div>
                </ng-form>
                <ng-form name="nestedButtonValueForm">
                  <div
                    class="form-group col-lg-4"
                    ng-class="{'has-error': nestedButtonValueForm.$dirty && nestedButtonValueForm.$invalid}"
                  >
                    <input
                      type="text"
                      class="form-control"
                      ng-model="button.value"
                      placeholder="{{ 'Value' | translate }}"
                      uib-tooltip="{{ 'Value' | translate }}"
                      required
                    />
                  </div>
                </ng-form>
                <a
                  title="{{ 'Remove button' | translate }}"
                  class="btn btn-link pull-right"
                  ng-click="removeButton(field, button)"
                >
                  <i c8y-icon="minus"></i> <translate>Remove button</translate>
                </a>
              </div>
            </div>
            <a
              title="{{ 'Add button' | translate }}"
              class="btn btn-link"
              ng-click="addButton(field)"
            >
              <i c8y-icon="plus"></i> <translate>Add button</translate>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
