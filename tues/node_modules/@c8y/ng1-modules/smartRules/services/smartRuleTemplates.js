"use strict";!function(){function e(e,t,n,r,a,u,i,l){var s=a.url("service/smartrule/smartrules/configurations"),c=e("smartRuleTemplates"),o="list";return 0<_.get(window,"c8y.collections.smartrules",[]).length&&n.warn("In-memory definitions of smart rules are not supported right now."),{list:m,getTemplateForRule:function(t){return m().then(function(e){return _.find(e,{name:t.ruleTemplateName})})},getTemplateByName:function(t){return m().then(function(e){return _.find(e,{name:t})}).then(h)},mustBeAvailable:function(e){return g(e).then(function(e){return e?r.when():r.reject()})},isAvailable:g};function m(){var e=c.get(o);return e?r.when(e):t.get(s).then(a.getResData).then(function(e){return _.filter(e,function(e){return!_.includes(i.smartRules.exclude,e.name)})}).then(f).then(function(e){return c.put(o,e),e})}function f(e){var t=[];return e.forEach(function(e){t.push(h(e))}),r.all(t)}function h(t){return g(t.name).then(function(e){return t._active=e,r.when(t)})}function g(e){switch(e){case"sendDashboardsViaEmail":return r.all({systemOption:u.getSystemOptionValue({category:"reportMailer",key:"available"},!1),featureActive:l.isAvailable({name:"feature-dashboard-mailer"})}).then(_.every);case"onAlarmSendSms":return r.all([u.getSystemOptionValue({category:"messaging",key:"provider"},!1)]).then(function(e){return!_.isEmpty(e[0])});case"onAlarmEscalateAlarm":return g("onAlarmSendSms");default:return r.when(!0)}}}e.$inject=["$cacheFactory","$http","$log","$q","c8yBase","c8ySettings","c8yConfig","c8yApplication"],angular.module("c8y.smartRules").factory("smartRuleTemplatesSvc",e)}();