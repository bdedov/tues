"use strict";!function(){function e(t,r,i,n,a,o,e,l,c,u){var s=this,f="c8y_Firmware",g=[];function d(e){t.firmwares&&!t.refreshLoading||(t.firmwares=[],s.firmwares=t.firmwares),t.paging=e.paging,e.forEach(function(e){t.firmwares.push(e)})}function w(e){t.refreshLoading=!0;var n=function(e){return _.assign({type:f},_.mapValues(e,function(e){return"*".concat(e,"*")}))}(e);return i.listQuery(n,null,!0).then(d).finally(function(){t.refreshLoading=!1})}function h(){t.refreshLoading=!0,t.paging.refresh().then(d).finally(function(){t.refreshLoading=!1})}function m(e){return g.indexOf(e)}function y(e){return-1<m(e)}function p(e){var n=o.getIdFromUrl(e.selectedFile.url);return(n?o.setGlobalFlag(n,!0):r.when()).then(_.constant(e))}function F(e){return e.url=e.selectedFile.url,delete e.selectedFile,e}function v(e){return _.unset(e,"edited"),e}function b(){t.newFw={type:f},s.newFw=t.newFw}function L(){t.newFw=null,s.newFw=t.newFw}t.loadNext=function(){t.paging.loading=!0,t.paging.next().then(d).finally(function(){t.paging.loading=!1})},t.refresh=h,t.toggle=function(e){y(e)?g.splice(m(e),1):(g.push(e),e.edited={name:e.name,version:e.version})},t.isOpen=y,t.onClickDelete=function(e){n({title:c("Delete firmware"),body:u.getString('You are about to delete firmware item "{{name}}". Do you want to proceed?',e),labels:{ok:c("Delete")},status:"danger",size:"sm"}).then(angular.bind(i,i.remove,e)).then(angular.bind(a,a.removeFromList,t.firmwares,e)).then(function(){l.success(c("Firmware item deleted."))})},t.save=function(e){return _.merge(e,e.edited),e.type=f,r.when(e).then(_.partialRight(i.addGlobalFlag,!0)).then(p).then(F).then(v).then(i.save).then(function(){l.success(c("Firmware item saved.")),h(),$("body").trigger("click"),t.newFw=null})},t.add=b,t.cancelAdd=L,t.toggled=function(e,n){e?b():L(),n.$setPristine(),n.$setUntouched()},(t.getFirmware=w)(),e.changeTitle({title:c("Firmware repository")})}e.$inject=["$scope","$q","c8yInventory","c8yModal","c8yBase","c8yBinary","c8yTitle","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.parts.firmwareList").controller("firmwareListCtrl",e)}();