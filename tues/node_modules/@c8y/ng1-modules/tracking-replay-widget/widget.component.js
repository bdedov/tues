"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?Object(arguments[e]):{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(){function e(e,t,n,r,o){var i,a,c,u,l,s,p=r.DEFAULT_ANIMATION_STEP_DELAY,f=this,y=_.debounce(function(){var t,n,r,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=i).source,r=t.dateFrom,a=t.dateTo,n&&r&&a)return f.trackingEvents=[],e.next=5,regeneratorRuntime.awrap(o.getTrackingEventsFor(i));e.next=7;break;case 5:d(e.sent);case 7:case"end":return e.stop()}},null,null,null,Promise)},250);function g(){f.playing&&(f.step<u.length-1?(f.step+=1,v()):m())}function d(e){f.trackingEvents=[].concat(_toConsumableArray(f.trackingEvents),_toConsumableArray(e)),n.paging=e.paging,u=o.getPointsFor(f.trackingEvents),m(),n.$apply()}function m(e){t.cancel(s),s=void 0,l=p,f.step=-1,b(),f.step=e?0:u.length-1,v(),f.step=e?0:-1}function b(){f.playing=!1,f.paused=!0}function v(){o.renderPathSnapshot({map:a,layers:c,points:u,step:f.step})}_.assign(f,{$onInit:function(){a=o.createMap(e.find(".tracking-map")[0]),c={marker:o.createDeviceMarker(),path:o.createTrackingPath()}},$onChanges:function(e){e.config&&function(e){var t=_.get(e,"device.id");t&&(f.filter=_objectSpread({},f.filter,{source:t}))}(f.config)},$doCheck:function(){_.isEqual(i,f.filter)||(i=_.cloneDeep(f.filter),y())},$onDestroy:function(){t.cancel(s)},slower:function(){t.cancel(s),s=t(g,l*=2)},faster:function(){t.cancel(s),s=t(g,l/=2)},play:function(){f.paused=!1,f.playing=!0,s||(s=t(g,l))},pause:b,reset:m,stepTo:function(e){b(),f.step=e,v()},step:-1,paused:!0,playing:!1,interval:"days",filter:{dateFrom:moment().subtract(1,"day").format(),dateTo:moment().format()}}),n.paging={},n.loadNext=function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n.paging.loading=!0,e.next=3,regeneratorRuntime.awrap(n.paging.next());case 3:d(e.sent);case 5:case"end":return e.stop()}},null,null,null,Promise)}}e.$inject=["$element","$interval","$scope","trackingReplayConstants","trackingReplayService"],angular.module("c8y.pocs.trackingReplayWidget").component("c8yTrackingReplayWidget",{templateUrl:":::PLUGIN_PATH:::/widget.html",bindings:{config:"<"},controllerAs:"vm",controller:e})}();