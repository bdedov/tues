"use strict";function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(r))return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,e){if(r){if("string"==typeof r)return _arrayLikeToArray(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,e):void 0}}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function _iterableToArrayLimit(r,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(r)){var t=[],n=!0,o=!1,a=void 0;try{for(var i,u=r[Symbol.iterator]();!(n=(i=u.next()).done)&&(t.push(i.value),!e||t.length!==e);n=!0);}catch(r){o=!0,a=r}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}return t}}function _arrayWithHoles(r){if(Array.isArray(r))return r}!function(){function r(r,e,t,n,o,a,l){f.$inject=["$routeParams","$injector"];var s,y,d,p,i="/group",u="".concat(i,"/:groupId"),c="/group/:groupId",h={};return{init:function(){e.when(i,{templateUrl:":::PLUGIN_PATH:::/views/groupsList.html",controller:"groupsListCtrl",controllerAs:"vm"}),e.when(u,{name:l("Subassets"),icon:"c8y-group-open",templateUrl:":::PLUGIN_PATH:::/views/groupsList.html",controller:"groupsListCtrl",controllerAs:"vm",priority:990}),e.when("/assetsearch",{name:l("Search controller"),icon:"c8y-group-open",templateUrl:":::PLUGIN_PATH:::/views/search.html",controller:"assetSearchCtrl"}),e.when(u,{template:"<div></div>",showIf:function(){return!1}}),r.when("/groups",{redirectTo:"/group"}),r.when("/groups/:path*",{redirectTo:"/group/:path"}),n.addTitle(u,{data:["$routeParams","c8yBase","c8yInventory",function(r,e,t){var n=r.groupId;return n?t.detailCached(n,{withChildren:!1}).then(e.getResData).then(function(r){return{title:r.name}}):{}}]}),t.addBreadcrumbs(u,{data:f}),t.addBreadcrumbs(c,{data:f}),o.addGlobalAction({text:l("Add group"),action:["groupsHierarchySvc",function(r){r.addAssetUI()}],showIfPermissions:{anyRole:["ROLE_INVENTORY_ADMIN","ROLE_INVENTORY_CREATE"]}}),a.add({name:l("Search all"),path:function(r){return r&&"/assetsearch?s=".concat(window.encodeURIComponent(r))}})},$get:function(){}};function f(r,e){var t=s=e.get("$q"),n=y=e.get("c8yBase"),o=d=e.get("c8yInventory");p=e.get("c8yGroups");var a,i=t.when([]),u=r.groupId;t.when(null);return u&&(a=o.detail(u,{withParents:!0}).then(n.getResData).then(function(r){return function i(u,c,r){if(!r)return s.when(u);c.unshift((e=r,{icon:p.getIconSpecs(e).iconOpen,groupType:e.type,label:e.name||"".concat(l("Group")," ").concat(e.id),path:"#/group/".concat(e.id)}));var e;return s.all([d.directParentDevices(r),d.directParentAssets(r)]).then(function(r){var e=_slicedToArray(r,2),t=e[0],n=e[1],o=[].concat(_toConsumableArray(t),_toConsumableArray(n)).filter(function(r){var t=r.id;return!c.some(function(r){var e=r.path;return e.includes(t)})}),a=[];return 0===o.length?(u.push(c),s.when(u)):(_.forEach(o,function(r){var e=d.detail(r.id,{withParents:!0}).then(y.getResData).then(function(r){return s.when(i(u,_.cloneDeep(c),r))});a.push(e)}),s.all(a).then(function(){return u}))})}([],[],r)}).then(function(r){var e=r;return _.forEach(e,function(r){r.unshift({label:l("Groups"),icon:"c8y-group-open",path:"#/group",translate:!0})}),e=function(r){return _.sortBy(r,function(r){return-1*r.length})}(e=function(r){return _.forEach(r,function(r){return r.pop()})}(e)),h[u]=e}),i=t.when(_.get(h,u,a))),i}}r.$inject=["$routeProvider","c8yViewsProvider","c8yBreadcrumbsProvider","c8yTitleProvider","c8yActionsProvider","c8ySearchProvider","gettext"],angular.module("c8y.groupsHierarchy").provider("c8yGroupsHierarchyUi",r)}();