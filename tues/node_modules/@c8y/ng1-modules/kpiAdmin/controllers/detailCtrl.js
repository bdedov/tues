"use strict";!function(){function e(t,i,e,n,a,l,r,s,u,d){var E,o,c,m={IS_REQUIRED:"required",PATTERN:"pattern",SHOULD_CONTAIN_NUMBER:"number",SHOULD_BE_DEFINED:"should-be-defined",GREATER_THAN_SCALE_MAX:"greater-than-scale-max",LESS_THAN_SCALE_MIN:"less-than-scale-min",GREATER_THAN_RANGE_MAX:"greater-than-range-max",LESS_THAN_RANGE_MIN:"less-than-range-min"},A={};function N(e){E=e,t.kpiMO=E,function(){var e=E.c8y_Kpi,i=d.getString("New data point");r.changeTitle({title:E.id?e.label:i,subtitle:e.fragment&&e.series?"".concat(e.fragment," / ").concat(e.series):""})}()}function f(){var e=i.history;1<e.length?e.back():n.path("/kpi")}function R(e,i,n,t){var a=e.$modelValue,l=i.$modelValue,r=[n,t];!_.isUndefined(a)&&null!==a&&!_.isUndefined(l)&&null!==l&&_.forEach(r,function(e){var i=e.$modelValue;!_.isUndefined(i)&&null!==i&&(e.$setValidity(m.GREATER_THAN_SCALE_MAX,i<=l),e.$setValidity(m.LESS_THAN_SCALE_MIN,a<=i))})}A[m.IS_REQUIRED]=u("This field is required."),A[m.PATTERN]=u("Dots not allowed."),A[m.SHOULD_CONTAIN_NUMBER]=u("This field must contain a number."),A[m.SHOULD_BE_DEFINED]=u("Value must be defined."),A[m.GREATER_THAN_SCALE_MAX]=u("Value must be less than scale maximum."),A[m.LESS_THAN_SCALE_MIN]=u("Value must be greater than scale minimum."),A[m.GREATER_THAN_RANGE_MAX]=u("Value must be less than respective maximum."),A[m.LESS_THAN_RANGE_MIN]=u("Value must be greater than respective minimum."),_.assign(t,{PATTERN_VALIDATE_FRAGMENT_SERIES:"^[^.]*$",save:function(){l.save(E).then(f)},cancel:f,invalidTxt:function(e){var i=t.editKpi[e];return _.filter(_.map(i&&i.$error,function(e,i){return e&&A[i]}),_.identity).join(" ")},invalid:function(e){var i=t.editKpi[e];return i&&i.$invalid&&i.$dirty},formValid:function(){var n=t.editKpi;return _.forEach([[n.min,n.max],[n.yellowRangeMin,n.yellowRangeMax],[n.redRangeMin,n.redRangeMax]],function(e,i){(function(e,i){var n=e.$modelValue,t=i.$modelValue,a=!_.isUndefined(n)&&null!==n,l=!_.isUndefined(t)&&null!==t;e.$setValidity(m.SHOULD_BE_DEFINED,!(l&&!a)),i.$setValidity(m.SHOULD_BE_DEFINED,!(a&&!l))}).apply(this,e),function(e,i){var n=e.$modelValue,t=i.$modelValue,a=!_.isUndefined(n)&&null!==n,l=!_.isUndefined(t)&&null!==t,r=a&&l;e.$setValidity(m.GREATER_THAN_RANGE_MAX,!r||n<t),i.$setValidity(m.LESS_THAN_RANGE_MIN,!r||n<t)}.apply(this,e),i&&_.partial(R,n.min,n.max).apply(this,e)}),n.$valid}}),(c=e.kpiId)?l.detail(c).then(a.getResData).then(N):(o=d.getString("New data point"),N({c8y_Kpi:{label:e.fragment&&e.series?a.humanizeFragment("".concat(e.fragment," => ").concat(e.series)):o,fragment:e.fragment,series:e.series,color:s.generateColor()}}))}e.$inject=["$scope","$window","$routeParams","$location","c8yBase","c8yKpi","c8yTitle","c8yUiUtil","gettext","gettextCatalog"],angular.module("c8y.parts.kpiAdmin").controller("KpiDetailCtrl",e)}();