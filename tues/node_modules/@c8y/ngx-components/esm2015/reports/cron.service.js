import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { Base } from './export-schedules.interface';
import { TranslateService } from '@ngx-translate/core';
import { formatDate } from '@angular/common';
import { gettext } from '@c8y/ngx-components';
let CronService = class CronService {
    constructor(translateService) {
        this.translateService = translateService;
        this.daysOfWeekPosix = [];
        this.daysOfMonth = [
            { value: '1', label: '1.' },
            { value: '2', label: '2.' },
            { value: '3', label: '3.' },
            { value: '4', label: '4.' },
            { value: '5', label: '5.' },
            { value: '6', label: '6.' },
            { value: '7', label: '7.' },
            { value: '8', label: '8.' },
            { value: '9', label: '9.' },
            { value: '10', label: '10.' },
            { value: '11', label: '11.' },
            { value: '12', label: '12.' },
            { value: '13', label: '13.' },
            { value: '14', label: '14.' },
            { value: '15', label: '15.' },
            { value: '16', label: '16.' },
            { value: '17', label: '17.' },
            { value: '18', label: '18.' },
            { value: '19', label: '19.' },
            { value: '20', label: '20.' },
            { value: '21', label: '21.' },
            { value: '22', label: '22.' },
            { value: '23', label: '23.' },
            { value: '24', label: '24.' },
            { value: '25', label: '25.' },
            { value: '26', label: '26.' },
            { value: '27', label: '27.' },
            { value: '28', label: '28.' },
            { value: '29', label: '29.' },
            { value: '30', label: '30.' },
            { value: '31', label: '31.' }
        ];
        this.months = [];
        this.hours = [];
        this.minutes = [];
        this.intervals = [
            { value: 2, label: gettext('Hour') },
            { value: 3, label: gettext('Day') },
            { value: 4, label: gettext('Week') },
            { value: 5, label: gettext('Month') },
            { value: 6, label: gettext('Year') }
        ];
        for (let x = 0; x < 24; x++) {
            this.hours.push({ value: x.toString(), label: `${x}` });
        }
        for (let x = 0; x < 60; x = x + 5) {
            this.minutes.push({ value: x.toString(), label: `${x}` });
        }
        for (let x = 0; x < 7; x++) {
            this.daysOfWeekPosix.push({
                value: x.toString(),
                label: this.getWeekDayName({ weekday: x })
            });
        }
        for (let x = 1; x < 13; x++) {
            this.months.push({
                value: x.toString(),
                label: this.getMonthName({ month: x })
            });
        }
    }
    generateCron(cronConfig) {
        let cron = '';
        cron = cronConfig.minute ? `${cronConfig.minute}` : '*';
        cron += cronConfig.hour ? ` ${cronConfig.hour}` : ' *';
        cron += cronConfig.day ? ` ${cronConfig.day}` : ' *';
        cron += cronConfig.month ? ` ${cronConfig.month}` : ' *';
        cron += cronConfig.weekday ? ` ${cronConfig.weekday}` : ' *';
        return cron;
    }
    generateCronConfig(cron) {
        const parts = cron.split(/\s+/);
        const cronConfig = {
            minute: parts[0],
            hour: parts[1],
            day: parts[2],
            month: parts[3],
            weekday: parts[4]
        };
        return cronConfig;
    }
    getBase(cronConfig) {
        let base = Base.Initial;
        if (cronConfig.minute !== '*' &&
            cronConfig.hour === '*' &&
            cronConfig.day === '*' &&
            cronConfig.month === '*' &&
            cronConfig.weekday === '*') {
            base = Base.Hour;
        }
        else if (cronConfig.minute !== '*' &&
            cronConfig.hour !== '*' &&
            cronConfig.day === '*' &&
            cronConfig.month === '*' &&
            cronConfig.weekday === '*') {
            base = Base.Day;
        }
        else if (cronConfig.minute !== '*' &&
            cronConfig.hour !== '*' &&
            cronConfig.day === '*' &&
            cronConfig.month === '*' &&
            cronConfig.weekday !== '*') {
            base = Base.Week;
        }
        else if (cronConfig.minute !== '*' &&
            cronConfig.hour !== '*' &&
            cronConfig.day !== '*' &&
            cronConfig.month === '*' &&
            cronConfig.weekday === '*') {
            base = Base.Month;
        }
        else if (cronConfig.minute !== '*' &&
            cronConfig.hour !== '*' &&
            cronConfig.day !== '*' &&
            cronConfig.month !== '*' &&
            cronConfig.weekday === '*') {
            base = Base.Year;
        }
        else {
            // cronConfig invalid
        }
        return base;
    }
    validateModels(base, cronConfig) {
        let valid;
        switch (base) {
            case Base.Initial: // Please select
                valid = false;
                break;
            case Base.Hour:
                if (cronConfig.minute !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            case Base.Day:
                if (cronConfig.minute !== '*' && cronConfig.hour !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            case Base.Week:
                if (cronConfig.minute !== '*' && cronConfig.hour !== '*' && cronConfig.weekday !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            case Base.Month:
                if (cronConfig.minute !== '*' && cronConfig.hour !== '*' && cronConfig.day !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            case Base.Year:
                if (cronConfig.minute !== '*' &&
                    cronConfig.hour !== '*' &&
                    cronConfig.day !== '*' &&
                    cronConfig.month !== '*') {
                    valid = true;
                }
                else {
                    valid = false;
                }
                break;
            default:
                valid = false;
        }
        return valid;
    }
    clearNextModels(base, cronConfig) {
        if (base === Base.Initial) {
            // please select, delete all
            // cron expression: every minute at second 0
            cronConfig.minute = '*';
            cronConfig.hour = '*';
            cronConfig.day = '*';
            cronConfig.month = '*';
            cronConfig.weekday = '*';
        }
        else if (base === Base.Hour) {
            // hour, don't delete minutes
            // cron expression: every hour, at whatever minute, at second 0
            cronConfig.minute = cronConfig.minute === '*' ? this.minutes[0].value : cronConfig.minute;
            cronConfig.hour = '*';
            cronConfig.day = '*';
            cronConfig.month = '*';
            cronConfig.weekday = '*';
        }
        else if (base === Base.Day) {
            // day, don't delete minutes and hours
            // cron expression: every day of every month, at whatever hour and minute, at second 0
            cronConfig.minute = cronConfig.minute === '*' ? this.minutes[0].value : cronConfig.minute;
            cronConfig.hour = cronConfig.hour === '*' ? this.hours[0].value : cronConfig.hour;
            cronConfig.day = '*';
            cronConfig.month = '*';
            cronConfig.weekday = '*';
        }
        else if (base === Base.Week) {
            // week, delete month and day
            // cron expression: every month, at whatever weekday, hour and minute, at second 0
            cronConfig.minute = cronConfig.minute === '*' ? this.minutes[0].value : cronConfig.minute;
            cronConfig.hour = cronConfig.hour === '*' ? this.hours[0].value : cronConfig.hour;
            cronConfig.day = '*';
            cronConfig.month = '*';
            cronConfig.weekday = cronConfig.weekday === '*' || cronConfig.weekday === '?' ? this.daysOfWeekPosix[0].value : cronConfig.weekday;
        }
        else if (base === Base.Month) {
            // month, delete month and weekday
            // cron expression: every month, at whatever day of month, hour and minute, at second 0
            cronConfig.minute = cronConfig.minute === '*' ? this.minutes[0].value : cronConfig.minute;
            cronConfig.hour = cronConfig.hour === '*' ? this.hours[0].value : cronConfig.hour;
            cronConfig.day = cronConfig.day === '*' ? this.daysOfMonth[0].value : cronConfig.day;
            cronConfig.month = '*';
            cronConfig.weekday = '*';
        }
        else if (base === Base.Year) {
            // year, delete weekday
            // cron expression: every year, at whatever month, day of month, hour and minute, at second 0
            cronConfig.minute = cronConfig.minute === '*' ? this.minutes[0].value : cronConfig.minute;
            cronConfig.hour = cronConfig.hour === '*' ? this.hours[0].value : cronConfig.hour;
            cronConfig.day = cronConfig.day === '*' ? this.daysOfMonth[0].value : cronConfig.day;
            cronConfig.month = cronConfig.month === '*' ? this.months[0].value : cronConfig.month;
            cronConfig.weekday = '*';
        }
    }
    getWeekDayName(cronConfig) {
        const date = new Date(0);
        const firstSundayDate = date.getDate() + 3; // because we know date 0 was on Thursday...
        date.setDate(firstSundayDate + parseInt(cronConfig.weekday, 10));
        return formatDate(date, 'EEEE', this.translateService.currentLang);
    }
    getMonthDayName(cronConfig) {
        let name = '';
        this.daysOfMonth.forEach(item => {
            if (item.value === cronConfig.day) {
                name = item.label;
            }
        });
        return name;
    }
    getMonthName(cronConfig) {
        const date = new Date(0);
        date.setMonth(parseInt(cronConfig.month, 10) - 1);
        return formatDate(date, 'LLLL', this.translateService.currentLang);
    }
};
CronService.ctorParameters = () => [
    { type: TranslateService }
];
CronService = tslib_1.__decorate([
    Injectable()
], CronService);
export { CronService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3Jvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGM4eS9uZ3gtY29tcG9uZW50cy9yZXBvcnRzLyIsInNvdXJjZXMiOlsiY3Jvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBYyxJQUFJLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDN0MsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRzlDLElBQWEsV0FBVyxHQUF4QixNQUFhLFdBQVc7SUE2Q3RCLFlBQW9CLGdCQUFrQztRQUFsQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBNUN0RCxvQkFBZSxHQUFVLEVBQUUsQ0FBQztRQUM1QixnQkFBVyxHQUFHO1lBQ1osRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7WUFDM0IsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7WUFDM0IsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7WUFDM0IsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7WUFDM0IsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7WUFDM0IsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7WUFDM0IsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7WUFDM0IsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7WUFDM0IsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7WUFDM0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7WUFDN0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxL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QUFJLElBQUksR0FBRyxFQUFFLENBQUM7UUFDZCxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUM5QixJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssVUFBVSxDQUFDLEdBQUcsRUFBRTtnQkFDakMsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7YUFDbkI7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELFlBQVksQ0FBQyxVQUFzQjtRQUNqQyxNQUFNLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2xELE9BQU8sVUFBVSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3JFLENBQUM7Q0FDRixDQUFBOztZQWpPdUMsZ0JBQWdCOztBQTdDM0MsV0FBVztJQUR2QixVQUFVLEVBQUU7R0FDQSxXQUFXLENBOFF2QjtTQTlRWSxXQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ3JvbkNvbmZpZywgQmFzZSB9IGZyb20gJy4vZXhwb3J0LXNjaGVkdWxlcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuaW1wb3J0IHsgZm9ybWF0RGF0ZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBnZXR0ZXh0IH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBDcm9uU2VydmljZSB7XG4gIGRheXNPZldlZWtQb3NpeDogYW55W10gPSBbXTtcbiAgZGF5c09mTW9udGggPSBbXG4gICAgeyB2YWx1ZTogJzEnLCBsYWJlbDogJzEuJyB9LFxuICAgIHsgdmFsdWU6ICcyJywgbGFiZWw6ICcyLicgfSxcbiAgICB7IHZhbHVlOiAnMycsIGxhYmVsOiAnMy4nIH0sXG4gICAgeyB2YWx1ZTogJzQnLCBsYWJlbDogJzQuJyB9LFxuICAgIHsgdmFsdWU6ICc1JywgbGFiZWw6ICc1LicgfSxcbiAgICB7IHZhbHVlOiAnNicsIGxhYmVsOiAnNi4nIH0sXG4gICAgeyB2YWx1ZTogJzcnLCBsYWJlbDogJzcuJyB9LFxuICAgIHsgdmFsdWU6ICc4JywgbGFiZWw6ICc4LicgfSxcbiAgICB7IHZhbHVlOiAnOScsIGxhYmVsOiAnOS4nIH0sXG4gICAgeyB2YWx1ZTogJzEwJywgbGFiZWw6ICcxMC4nIH0sXG4gICAgeyB2YWx1ZTogJzExJywgbGFiZWw6ICcxMS4nIH0sXG4gICAgeyB2YWx1ZTogJzEyJywgbGFiZWw6ICcxMi4nIH0sXG4gICAgeyB2YWx1ZTogJzEzJywgbGFiZWw6ICcxMy4nIH0sXG4gICAgeyB2YWx1ZTogJzE0JywgbGFiZWw6ICcxNC4nIH0sXG4gICAgeyB2YWx1ZTogJzE1JywgbGFiZWw6ICcxNS4nIH0sXG4gICAgeyB2YWx1ZTogJzE2JywgbGFiZWw6ICcxNi4nIH0sXG4gICAgeyB2YWx1ZTogJzE3JywgbGFiZWw6ICcxNy4nIH0sXG4gICAgeyB2YWx1ZTogJzE4JywgbGFiZWw6ICcxOC4nIH0sXG4gICAgeyB2YWx1ZTogJzE5JywgbGFiZWw6ICcxOS4nIH0sXG4gICAgeyB2YWx1ZTogJzIwJywgbGFiZWw6ICcyMC4nIH0sXG4gICAgeyB2YWx1ZTogJzIxJywgbGFiZWw6ICcyMS4nIH0sXG4gICAgeyB2YWx1ZTogJzIyJywgbGFiZWw6ICcyMi4nIH0sXG4gICAgeyB2YWx1ZTogJzIzJywgbGFiZWw6ICcyMy4nIH0sXG4gICAgeyB2YWx1ZTogJzI0JywgbGFiZWw6ICcyNC4nIH0sXG4gICAgeyB2YWx1ZTogJzI1JywgbGFiZWw6ICcyNS4nIH0sXG4gICAgeyB2YWx1ZTogJzI2JywgbGFiZWw6ICcyNi4nIH0sXG4gICAgeyB2YWx1ZTogJzI3JywgbGFiZWw6ICcyNy4nIH0sXG4gICAgeyB2YWx1ZTogJzI4JywgbGFiZWw6ICcyOC4nIH0sXG4gICAgeyB2YWx1ZTogJzI5JywgbGFiZWw6ICcyOS4nIH0sXG4gICAgeyB2YWx1ZTogJzMwJywgbGFiZWw6ICczMC4nIH0sXG4gICAgeyB2YWx1ZTogJzMxJywgbGFiZWw6ICczMS4nIH1cbiAgXTtcbiAgbW9udGhzOiBhbnlbXSA9IFtdO1xuICBob3VyczogYW55W10gPSBbXTtcbiAgbWludXRlczogYW55W10gPSBbXTtcbiAgaW50ZXJ2YWxzID0gW1xuICAgIHsgdmFsdWU6IDIsIGxhYmVsOiBnZXR0ZXh0KCdIb3VyJykgfSxcbiAgICB7IHZhbHVlOiAzLCBsYWJlbDogZ2V0dGV4dCgnRGF5JykgfSxcbiAgICB7IHZhbHVlOiA0LCBsYWJlbDogZ2V0dGV4dCgnV2VlaycpIH0sXG4gICAgeyB2YWx1ZTogNSwgbGFiZWw6IGdldHRleHQoJ01vbnRoJykgfSxcbiAgICB7IHZhbHVlOiA2LCBsYWJlbDogZ2V0dGV4dCgnWWVhcicpIH1cbiAgXTtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSB0cmFuc2xhdGVTZXJ2aWNlOiBUcmFuc2xhdGVTZXJ2aWNlKSB7XG4gICAgZm9yIChsZXQgeCA9IDA7IHggPCAyNDsgeCsrKSB7XG4gICAgICB0aGlzLmhvdXJzLnB1c2goeyB2YWx1ZTogeC50b1N0cmluZygpLCBsYWJlbDogYCR7eH1gIH0pO1xuICAgIH1cbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IDYwOyB4ID0geCArIDUpIHtcbiAgICAgIHRoaXMubWludXRlcy5wdXNoKHsgdmFsdWU6IHgudG9TdHJpbmcoKSwgbGFiZWw6IGAke3h9YCB9KTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IDc7IHgrKykge1xuICAgICAgdGhpcy5kYXlzT2ZXZWVrUG9zaXgucHVzaCh7XG4gICAgICAgIHZhbHVlOiB4LnRvU3RyaW5nKCksXG4gICAgICAgIGxhYmVsOiB0aGlzLmdldFdlZWtEYXlOYW1lKCh7IHdlZWtkYXk6IHggfSBhcyB1bmtub3duKSBhcyBDcm9uQ29uZmlnKVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgZm9yIChsZXQgeCA9IDE7IHggPCAxMzsgeCsrKSB7XG4gICAgICB0aGlzLm1vbnRocy5wdXNoKHtcbiAgICAgICAgdmFsdWU6IHgudG9TdHJpbmcoKSxcbiAgICAgICAgbGFiZWw6IHRoaXMuZ2V0TW9udGhOYW1lKCh7IG1vbnRoOiB4IH0gYXMgdW5rbm93bikgYXMgQ3JvbkNvbmZpZylcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGdlbmVyYXRlQ3Jvbihjcm9uQ29uZmlnOiBDcm9uQ29uZmlnKSB7XG4gICAgbGV0IGNyb246IHN0cmluZyA9ICcnO1xuICAgIGNyb24gPSBjcm9uQ29uZmlnLm1pbnV0ZSA/IGAke2Nyb25Db25maWcubWludXRlfWAgOiAnKic7XG4gICAgY3JvbiArPSBjcm9uQ29uZmlnLmhvdXIgPyBgICR7Y3JvbkNvbmZpZy5ob3VyfWAgOiAnIConO1xuICAgIGNyb24gKz0gY3JvbkNvbmZpZy5kYXkgPyBgICR7Y3JvbkNvbmZpZy5kYXl9YCA6ICcgKic7XG4gICAgY3JvbiArPSBjcm9uQ29uZmlnLm1vbnRoID8gYCAke2Nyb25Db25maWcubW9udGh9YCA6ICcgKic7XG4gICAgY3JvbiArPSBjcm9uQ29uZmlnLndlZWtkYXkgPyBgICR7Y3JvbkNvbmZpZy53ZWVrZGF5fWAgOiAnIConO1xuXG4gICAgcmV0dXJuIGNyb247XG4gIH1cblxuICBnZW5lcmF0ZUNyb25Db25maWcoY3Jvbjogc3RyaW5nKSB7XG4gICAgY29uc3QgcGFydHMgPSBjcm9uLnNwbGl0KC9cXHMrLyk7XG4gICAgY29uc3QgY3JvbkNvbmZpZzogQ3JvbkNvbmZpZyA9IHtcbiAgICAgIG1pbnV0ZTogcGFydHNbMF0sXG4gICAgICBob3VyOiBwYXJ0c1sxXSxcbiAgICAgIGRheTogcGFydHNbMl0sXG4gICAgICBtb250aDogcGFydHNbM10sXG4gICAgICB3ZWVrZGF5OiBwYXJ0c1s0XVxuICAgIH07XG5cbiAgICByZXR1cm4gY3JvbkNvbmZpZztcbiAgfVxuXG4gIGdldEJhc2UoY3JvbkNvbmZpZzogQ3JvbkNvbmZpZykge1xuICAgIGxldCBiYXNlOiBCYXNlID0gQmFzZS5Jbml0aWFsO1xuXG4gICAgaWYgKFxuICAgICAgY3JvbkNvbmZpZy5taW51dGUgIT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5ob3VyID09PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcuZGF5ID09PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcubW9udGggPT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy53ZWVrZGF5ID09PSAnKidcbiAgICApIHtcbiAgICAgIGJhc2UgPSBCYXNlLkhvdXI7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIGNyb25Db25maWcubWludXRlICE9PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcuaG91ciAhPT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLmRheSA9PT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLm1vbnRoID09PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcud2Vla2RheSA9PT0gJyonXG4gICAgKSB7XG4gICAgICBiYXNlID0gQmFzZS5EYXk7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIGNyb25Db25maWcubWludXRlICE9PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcuaG91ciAhPT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLmRheSA9PT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLm1vbnRoID09PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcud2Vla2RheSAhPT0gJyonXG4gICAgKSB7XG4gICAgICBiYXNlID0gQmFzZS5XZWVrO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBjcm9uQ29uZmlnLm1pbnV0ZSAhPT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLmhvdXIgIT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5kYXkgIT09ICcqJyAmJlxuICAgICAgY3JvbkNvbmZpZy5tb250aCA9PT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLndlZWtkYXkgPT09ICcqJ1xuICAgICkge1xuICAgICAgYmFzZSA9IEJhc2UuTW9udGg7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIGNyb25Db25maWcubWludXRlICE9PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcuaG91ciAhPT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLmRheSAhPT0gJyonICYmXG4gICAgICBjcm9uQ29uZmlnLm1vbnRoICE9PSAnKicgJiZcbiAgICAgIGNyb25Db25maWcud2Vla2RheSA9PT0gJyonXG4gICAgKSB7XG4gICAgICBiYXNlID0gQmFzZS5ZZWFyO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBjcm9uQ29uZmlnIGludmFsaWRcbiAgICB9XG5cbiAgICByZXR1cm4gYmFzZTtcbiAgfVxuXG4gIHZhbGlkYXRlTW9kZWxzKGJhc2U6IEJhc2UsIGNyb25Db25maWc6IENyb25Db25maWcpIHtcbiAgICBsZXQgdmFsaWQ6IGJvb2xlYW47XG4gICAgc3dpdGNoIChiYXNlKSB7XG4gICAgICBjYXNlIEJhc2UuSW5pdGlhbDogLy8gUGxlYXNlIHNlbGVjdFxuICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQmFzZS5Ib3VyOlxuICAgICAgICBpZiAoY3JvbkNvbmZpZy5taW51dGUgIT09ICcqJykge1xuICAgICAgICAgIHZhbGlkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBCYXNlLkRheTpcbiAgICAgICAgaWYgKGNyb25Db25maWcubWludXRlICE9PSAnKicgJiYgY3JvbkNvbmZpZy5ob3VyICE9PSAnKicpIHtcbiAgICAgICAgICB2YWxpZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQmFzZS5XZWVrOlxuICAgICAgICBpZiAoY3JvbkNvbmZpZy5taW51dGUgIT09ICcqJyAmJiBjcm9uQ29uZmlnLmhvdXIgIT09ICcqJyAmJiBjcm9uQ29uZmlnLndlZWtkYXkgIT09ICcqJykge1xuICAgICAgICAgIHZhbGlkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBCYXNlLk1vbnRoOlxuICAgICAgICBpZiAoY3JvbkNvbmZpZy5taW51dGUgIT09ICcqJyAmJiBjcm9uQ29uZmlnLmhvdXIgIT09ICcqJyAmJiBjcm9uQ29uZmlnLmRheSAhPT0gJyonKSB7XG4gICAgICAgICAgdmFsaWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEJhc2UuWWVhcjpcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNyb25Db25maWcubWludXRlICE9PSAnKicgJiZcbiAgICAgICAgICBjcm9uQ29uZmlnLmhvdXIgIT09ICcqJyAmJlxuICAgICAgICAgIGNyb25Db25maWcuZGF5ICE9PSAnKicgJiZcbiAgICAgICAgICBjcm9uQ29uZmlnLm1vbnRoICE9PSAnKidcbiAgICAgICAgKSB7XG4gICAgICAgICAgdmFsaWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB2YWxpZDtcbiAgfVxuXG4gIGNsZWFyTmV4dE1vZGVscyhiYXNlOiBCYXNlLCBjcm9uQ29uZmlnOiBDcm9uQ29uZmlnKSB7XG4gICAgaWYgKGJhc2UgPT09IEJhc2UuSW5pdGlhbCkge1xuICAgICAgLy8gcGxlYXNlIHNlbGVjdCwgZGVsZXRlIGFsbFxuICAgICAgLy8gY3JvbiBleHByZXNzaW9uOiBldmVyeSBtaW51dGUgYXQgc2Vjb25kIDBcbiAgICAgIGNyb25Db25maWcubWludXRlID0gJyonO1xuICAgICAgY3JvbkNvbmZpZy5ob3VyID0gJyonO1xuICAgICAgY3JvbkNvbmZpZy5kYXkgPSAnKic7XG4gICAgICBjcm9uQ29uZmlnLm1vbnRoID0gJyonO1xuICAgICAgY3JvbkNvbmZpZy53ZWVrZGF5ID0gJyonO1xuICAgIH0gZWxzZSBpZiAoYmFzZSA9PT0gQmFzZS5Ib3VyKSB7XG4gICAgICAvLyBob3VyLCBkb24ndCBkZWxldGUgbWludXRlc1xuICAgICAgLy8gY3JvbiBleHByZXNzaW9uOiBldmVyeSBob3VyLCBhdCB3aGF0ZXZlciBtaW51dGUsIGF0IHNlY29uZCAwXG4gICAgICBjcm9uQ29uZmlnLm1pbnV0ZSA9IGNyb25Db25maWcubWludXRlID09PSAnKicgPyB0aGlzLm1pbnV0ZXNbMF0udmFsdWUgOiBjcm9uQ29uZmlnLm1pbnV0ZTtcbiAgICAgIGNyb25Db25maWcuaG91ciA9ICcqJztcbiAgICAgIGNyb25Db25maWcuZGF5ID0gJyonO1xuICAgICAgY3JvbkNvbmZpZy5tb250aCA9ICcqJztcbiAgICAgIGNyb25Db25maWcud2Vla2RheSA9ICcqJztcbiAgICB9IGVsc2UgaWYgKGJhc2UgPT09IEJhc2UuRGF5KSB7XG4gICAgICAvLyBkYXksIGRvbid0IGRlbGV0ZSBtaW51dGVzIGFuZCBob3Vyc1xuICAgICAgLy8gY3JvbiBleHByZXNzaW9uOiBldmVyeSBkYXkgb2YgZXZlcnkgbW9udGgsIGF0IHdoYXRldmVyIGhvdXIgYW5kIG1pbnV0ZSwgYXQgc2Vjb25kIDBcbiAgICAgIGNyb25Db25maWcubWludXRlID0gY3JvbkNvbmZpZy5taW51dGUgPT09ICcqJyA/IHRoaXMubWludXRlc1swXS52YWx1ZSA6IGNyb25Db25maWcubWludXRlO1xuICAgICAgY3JvbkNvbmZpZy5ob3VyID0gY3JvbkNvbmZpZy5ob3VyID09PSAnKicgPyB0aGlzLmhvdXJzWzBdLnZhbHVlIDogY3JvbkNvbmZpZy5ob3VyO1xuICAgICAgY3JvbkNvbmZpZy5kYXkgPSAnKic7XG4gICAgICBjcm9uQ29uZmlnLm1vbnRoID0gJyonO1xuICAgICAgY3JvbkNvbmZpZy53ZWVrZGF5ID0gJyonO1xuICAgIH0gZWxzZSBpZiAoYmFzZSA9PT0gQmFzZS5XZWVrKSB7XG4gICAgICAvLyB3ZWVrLCBkZWxldGUgbW9udGggYW5kIGRheVxuICAgICAgLy8gY3JvbiBleHByZXNzaW9uOiBldmVyeSBtb250aCwgYXQgd2hhdGV2ZXIgd2Vla2RheSwgaG91ciBhbmQgbWludXRlLCBhdCBzZWNvbmQgMFxuICAgICAgY3JvbkNvbmZpZy5taW51dGUgPSBjcm9uQ29uZmlnLm1pbnV0ZSA9PT0gJyonID8gdGhpcy5taW51dGVzWzBdLnZhbHVlIDogY3JvbkNvbmZpZy5taW51dGU7XG4gICAgICBjcm9uQ29uZmlnLmhvdXIgPSBjcm9uQ29uZmlnLmhvdXIgPT09ICcqJyA/IHRoaXMuaG91cnNbMF0udmFsdWUgOiBjcm9uQ29uZmlnLmhvdXI7XG4gICAgICBjcm9uQ29uZmlnLmRheSA9ICcqJztcbiAgICAgIGNyb25Db25maWcubW9udGggPSAnKic7XG4gICAgICBjcm9uQ29uZmlnLndlZWtkYXkgPSBjcm9uQ29uZmlnLndlZWtkYXkgPT09ICcqJyB8fCBjcm9uQ29uZmlnLndlZWtkYXkgPT09ICc/JyA/IHRoaXMuZGF5c09mV2Vla1Bvc2l4WzBdLnZhbHVlIDogY3JvbkNvbmZpZy53ZWVrZGF5IDtcbiAgICB9IGVsc2UgaWYgKGJhc2UgPT09IEJhc2UuTW9udGgpIHtcbiAgICAgIC8vIG1vbnRoLCBkZWxldGUgbW9udGggYW5kIHdlZWtkYXlcbiAgICAgIC8vIGNyb24gZXhwcmVzc2lvbjogZXZlcnkgbW9udGgsIGF0IHdoYXRldmVyIGRheSBvZiBtb250aCwgaG91ciBhbmQgbWludXRlLCBhdCBzZWNvbmQgMFxuICAgICAgY3JvbkNvbmZpZy5taW51dGUgPSBjcm9uQ29uZmlnLm1pbnV0ZSA9PT0gJyonID8gdGhpcy5taW51dGVzWzBdLnZhbHVlIDogY3JvbkNvbmZpZy5taW51dGU7XG4gICAgICBjcm9uQ29uZmlnLmhvdXIgPSBjcm9uQ29uZmlnLmhvdXIgPT09ICcqJyA/IHRoaXMuaG91cnNbMF0udmFsdWUgOiBjcm9uQ29uZmlnLmhvdXI7XG4gICAgICBjcm9uQ29uZmlnLmRheSA9IGNyb25Db25maWcuZGF5ID09PSAnKicgPyB0aGlzLmRheXNPZk1vbnRoWzBdLnZhbHVlIDogY3JvbkNvbmZpZy5kYXk7XG4gICAgICBjcm9uQ29uZmlnLm1vbnRoID0gJyonO1xuICAgICAgY3JvbkNvbmZpZy53ZWVrZGF5ID0gJyonO1xuICAgIH0gZWxzZSBpZiAoYmFzZSA9PT0gQmFzZS5ZZWFyKSB7XG4gICAgICAvLyB5ZWFyLCBkZWxldGUgd2Vla2RheVxuICAgICAgLy8gY3JvbiBleHByZXNzaW9uOiBldmVyeSB5ZWFyLCBhdCB3aGF0ZXZlciBtb250aCwgZGF5IG9mIG1vbnRoLCBob3VyIGFuZCBtaW51dGUsIGF0IHNlY29uZCAwXG4gICAgICBjcm9uQ29uZmlnLm1pbnV0ZSA9IGNyb25Db25maWcubWludXRlID09PSAnKicgPyB0aGlzLm1pbnV0ZXNbMF0udmFsdWUgOiBjcm9uQ29uZmlnLm1pbnV0ZTtcbiAgICAgIGNyb25Db25maWcuaG91ciA9IGNyb25Db25maWcuaG91ciA9PT0gJyonID8gdGhpcy5ob3Vyc1swXS52YWx1ZSA6IGNyb25Db25maWcuaG91cjtcbiAgICAgIGNyb25Db25maWcuZGF5ID0gY3JvbkNvbmZpZy5kYXkgPT09ICcqJyA/IHRoaXMuZGF5c09mTW9udGhbMF0udmFsdWUgOiBjcm9uQ29uZmlnLmRheTtcbiAgICAgIGNyb25Db25maWcubW9udGggPSBjcm9uQ29uZmlnLm1vbnRoID09PSAnKicgPyB0aGlzLm1vbnRoc1swXS52YWx1ZSA6IGNyb25Db25maWcubW9udGg7XG4gICAgICBjcm9uQ29uZmlnLndlZWtkYXkgPSAnKic7XG4gICAgfVxuICB9XG5cbiAgZ2V0V2Vla0RheU5hbWUoY3JvbkNvbmZpZzogQ3JvbkNvbmZpZykge1xuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgwKTtcbiAgICBjb25zdCBmaXJzdFN1bmRheURhdGUgPSBkYXRlLmdldERhdGUoKSArIDM7IC8vIGJlY2F1c2Ugd2Uga25vdyBkYXRlIDAgd2FzIG9uIFRodXJzZGF5Li4uXG4gICAgZGF0ZS5zZXREYXRlKGZpcnN0U3VuZGF5RGF0ZSArIHBhcnNlSW50KGNyb25Db25maWcud2Vla2RheSwgMTApKTtcbiAgICByZXR1cm4gZm9ybWF0RGF0ZShkYXRlLCAnRUVFRScsIHRoaXMudHJhbnNsYXRlU2VydmljZS5jdXJyZW50TGFuZyk7XG4gIH1cblxuICBnZXRNb250aERheU5hbWUoY3JvbkNvbmZpZzogQ3JvbkNvbmZpZykge1xuICAgIGxldCBuYW1lID0gJyc7XG4gICAgdGhpcy5kYXlzT2ZNb250aC5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgaWYgKGl0ZW0udmFsdWUgPT09IGNyb25Db25maWcuZGF5KSB7XG4gICAgICAgIG5hbWUgPSBpdGVtLmxhYmVsO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5hbWU7XG4gIH1cblxuICBnZXRNb250aE5hbWUoY3JvbkNvbmZpZzogQ3JvbkNvbmZpZykge1xuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgwKTtcbiAgICBkYXRlLnNldE1vbnRoKHBhcnNlSW50KGNyb25Db25maWcubW9udGgsIDEwKSAtIDEpO1xuICAgIHJldHVybiBmb3JtYXREYXRlKGRhdGUsICdMTExMJywgdGhpcy50cmFuc2xhdGVTZXJ2aWNlLmN1cnJlbnRMYW5nKTtcbiAgfVxufVxuIl19