import * as tslib_1 from "tslib";
import { Component, ContentChildren, ElementRef, HostBinding, Input, AfterContentInit, QueryList, forwardRef, Output, EventEmitter, HostListener, ChangeDetectionStrategy } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { DashboardChildComponent } from './dashboard-child.component';
/**
 * Displays a CSS grid which is customizable by the customer. You can set
 * `c8y-dashboard-child`-components on it or position any element on it by
 * setting the grid CSS properties. On change (resize, or rearrange) the
 * component emits an change event.
 *
 * ## Example:
 *
 * ```html
 * <c8y-title>Hello from outlet</c8y-title>
 *
 * <c8y-action-bar-item [placement]="'right'">
 *   <button class="btn btn-link" (click)="addRandom()"><i class="fa fa-plus"></i> Add random</button>
 * </c8y-action-bar-item>
 * <c8y-action-bar-item [placement]="'right'">
 *   <button class="btn btn-link" (click)="isFrozen = !isFrozen">
 *     <i [c8yIcon]="isFrozen ? 'lock' : 'unlock'"></i> Toggle freeze
 *   </button>
 * </c8y-action-bar-item>
 *
 * <c8y-dashboard (dashboardChange)="dashboardChange($event)">
 *   <c8y-dashboard-child
 *     [isFrozen]="isFrozen"
 *     title="dynamic"
 *     *ngFor="let widget of widgets"
 *     #current
 *   >
 *     x: {{ current.x }}<br />
 *     y: {{ current.y }}<br />
 *     width: {{ current.width }}<br />
 *     height: {{ current.height }}<br />
 *   </c8y-dashboard-child>
 *   <c8y-dashboard-child
 *     #cpWidget
 *     [isFrozen]="isFrozen"
 *     [x]="0"
 *     [y]="1"
 *     [width]="3"
 *     [height]="2"
 *     [data]="widget"
 *     [class]="'card card-dashboard panel-title-regular panel-content-branded panel-title-overlay'"
 *   >
 *     <c8y-dashboard-child-title>
 *       <span>World!</span>
 *     </c8y-dashboard-child-title>
 *     x: {{ cpWidget.x }}<br />
 *     y: {{ cpWidget.y }}<br />
 *     width: {{ cpWidget.width }}<br />
 *     height: {{ cpWidget.height }}<br />
 *   </c8y-dashboard-child>
 *   <c8y-dashboard-child
 *     #cpWidget2
 *     [isFrozen]="isFrozen"
 *     [x]="8"
 *     [y]="1"
 *     [width]="4"
 *     [height]="4"
 *     [class]="'card card-dashboard panel-content-dark'"
 *   >
 *     <c8y-dashboard-child-title>
 *       <span>Hello!</span>
 *     </c8y-dashboard-child-title>
 *     <c8y-dashboard-child-action>
 *       <a href="" (click)="cpWidget2.isFrozen = !cpWidget2.isFrozen; (false)">
 *         <i [c8yIcon]="cpWidget2.isFrozen ? 'lock' : 'unlock'"></i> Toggle freeze
 *       </a>
 *     </c8y-dashboard-child-action>
 *     x: {{ cpWidget2.x }}<br />
 *     y: {{ cpWidget2.y }}<br />
 *     width: {{ cpWidget2.width }}<br />
 *     height: {{ cpWidget2.height }}<br />
 *   </c8y-dashboard-child>
 *
 *   <c8y-dashboard-child
 *     #cpWidget3
 *     [isFrozen]="isFrozen"
 *     [x]="0"
 *     [y]="3"
 *     [width]="4"
 *     [height]="4"
 *     [class]="'card-dashboard panel-content-transparent'"
 *   >
 *     <c8y-dashboard-child-title *ngIf="showTitle">
 *       <span>Transparent!</span>
 *     </c8y-dashboard-child-title>
 *     <c8y-dashboard-child-action>
 *       <a href="" (click)="showTitle = !showTitle; (false)">
 *         <i [c8yIcon]="'heading'"></i> Hide/show title
 *       </a>
 *     </c8y-dashboard-child-action>
 *     <c8y-dashboard-child-action>
 *       <a href="" (click)="cpWidget3.isFrozen = !cpWidget3.isFrozen; (false)">
 *         <i [c8yIcon]="cpWidget3.isFrozen ? 'lock' : 'unlock'"></i> Toggle freeze
 *       </a>
 *     </c8y-dashboard-child-action>
 *     x: {{ cpWidget3.x }}<br />
 *     y: {{ cpWidget3.y }}<br />
 *     width: {{ cpWidget3.width }}<br />
 *     height: {{ cpWidget3.height }}<br />
 *   </c8y-dashboard-child>
 * </c8y-dashboard>
 * ```
 */
let DashboardComponent = class DashboardComponent {
    constructor(element, sanitizer) {
        this.element = element;
        this.sanitizer = sanitizer;
        /**
         * The amount of columns on that dashboard.
         */
        this.columns = 12;
        /**
         * The spacing between each children in pixel.
         */
        this.gap = 12;
        /**
         * The amount of rows to dusplay. Set to auto to
         * auto extend the rows.
         */
        this.rows = 'auto';
        /**
         * An event fired if the dashboard was changed.
         */
        this.dashboardChange = new EventEmitter();
        this.lastRow = 1;
        this.DEFAULT_ROW_SIZE = 68;
    }
    /**
     * The current column size.
     */
    get columnSize() {
        return this.dashboardRect.width / this.columns;
    }
    /**
     * The current row size.
     */
    get rowSize() {
        return this.rows === 'auto' ? this.DEFAULT_ROW_SIZE : this.calculateRowSize();
    }
    /**
     * Returns all positioning styles. Nasty workaround for that issue:
     * https://github.com/angular/angular/issues/9343
     */
    get inlineStyle() {
        return this.sanitizer.bypassSecurityTrustStyle(`
        -ms-grid-columns: (1fr)[${this.columns}];
        grid-template-columns: repeat(${this.columns}, 1fr);
        ${this.rows !== 'auto' ? `grid-template-rows: repeat(${this.rows}, 1fr);` : ''}
        grid-auto-rows: ${this.rowSize + this.gap}px;
        -ms-grid-rows: (${this.rowSize + this.gap}px)[${this.rows === 'auto' ? this.lastRow : this.rows}];
        margin: -${this.gap}px;
      `);
    }
    ngAfterContentInit() {
        this.onResize();
        this.getLastRow();
    }
    onResize() {
        this.updateRectSize();
    }
    /**
     * Gets the last row
     * (mainly for IE11 which doesn't support grid-auto-rows CSS property)
     */
    getLastRow() {
        let lastRow = 1;
        this.children.forEach(widget => {
            if (lastRow < widget.y + widget.width) {
                lastRow = widget.y + widget.width;
            }
        });
        this.lastRow = lastRow + 1;
    }
    /**
     * Updates the current rect size of the dashboard.
     */
    updateRectSize() {
        const ele = this.element.nativeElement;
        this.dashboardRect = ele.getBoundingClientRect();
    }
    emitChange(widget) {
        this.dashboardChange.emit({ source: widget, children: this.children.toArray() });
    }
    calculateRowSize() {
        return this.dashboardRect.height / this.rows;
    }
};
DashboardComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: DomSanitizer }
];
tslib_1.__decorate([
    ContentChildren(forwardRef(() => DashboardChildComponent))
], DashboardComponent.prototype, "children", void 0);
tslib_1.__decorate([
    Input()
], DashboardComponent.prototype, "columns", void 0);
tslib_1.__decorate([
    Input()
], DashboardComponent.prototype, "gap", void 0);
tslib_1.__decorate([
    Input()
], DashboardComponent.prototype, "rows", void 0);
tslib_1.__decorate([
    Output()
], DashboardComponent.prototype, "dashboardChange", void 0);
tslib_1.__decorate([
    HostBinding('attr.style')
], DashboardComponent.prototype, "inlineStyle", null);
tslib_1.__decorate([
    HostListener('window:resize')
], DashboardComponent.prototype, "onResize", null);
DashboardComponent = tslib_1.__decorate([
    Component({
        selector: 'c8y-dashboard',
        template: "<ng-content></ng-content>\n",
        host: {
            class: 'c8y-grid-dashboard dashboard-grid'
        },
        changeDetection: ChangeDetectionStrategy.OnPush
    })
], DashboardComponent);
export { DashboardComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGFzaGJvYXJkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJjb3JlL2Rhc2hib2FyZC9kYXNoYm9hcmQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULGVBQWUsRUFDZixVQUFVLEVBQ1YsV0FBVyxFQUNYLEtBQUssRUFDTCxnQkFBZ0IsRUFDaEIsU0FBUyxFQUNULFVBQVUsRUFDVixNQUFNLEVBQ04sWUFBWSxFQUNaLFlBQVksRUFDWix1QkFBdUIsRUFDeEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3pELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBR3RFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FzR0c7QUFTSCxJQUFhLGtCQUFrQixHQUEvQixNQUFhLGtCQUFrQjtJQW1FN0IsWUFBb0IsT0FBbUIsRUFBVSxTQUF1QjtRQUFwRCxZQUFPLEdBQVAsT0FBTyxDQUFZO1FBQVUsY0FBUyxHQUFULFNBQVMsQ0FBYztRQTNEeEU7O1dBRUc7UUFDTSxZQUFPLEdBQUcsRUFBRSxDQUFDO1FBRXRCOztXQUVHO1FBQ00sUUFBRyxHQUFHLEVBQUUsQ0FBQztRQUVsQjs7O1dBR0c7UUFDTSxTQUFJLEdBQW9CLE1BQU0sQ0FBQztRQUV4Qzs7V0FFRztRQUNPLG9CQUFlLEdBQUcsSUFBSSxZQUFZLEVBQW1CLENBQUM7UUFHeEQsWUFBTyxHQUFHLENBQUMsQ0FBQztRQUNILHFCQUFnQixHQUFHLEVBQUUsQ0FBQztJQW9Db0MsQ0FBQztJQWxDNUU7O09BRUc7SUFDSCxJQUFJLFVBQVU7UUFDWixPQUFP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LElBQUksRUFBRTtZQUNKLEtBQUssRUFBRSxtQ0FBbUM7U0FDM0M7UUFDRCxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtLQUNoRCxDQUFDO0dBQ1csa0JBQWtCLENBNEc5QjtTQTVHWSxrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgRWxlbWVudFJlZixcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LFxuICBBZnRlckNvbnRlbnRJbml0LFxuICBRdWVyeUxpc3QsXG4gIGZvcndhcmRSZWYsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0TGlzdGVuZXIsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRG9tU2FuaXRpemVyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG5pbXBvcnQgeyBEYXNoYm9hcmRDaGlsZENvbXBvbmVudCB9IGZyb20gJy4vZGFzaGJvYXJkLWNoaWxkLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBEYXNoYm9hcmRDaGFuZ2UgfSBmcm9tICcuL2Rhc2hib2FyZC5tb2RlbCc7XG5cbi8qKlxuICogRGlzcGxheXMgYSBDU1MgZ3JpZCB3aGljaCBpcyBjdXN0b21pemFibGUgYnkgdGhlIGN1c3RvbWVyLiBZb3UgY2FuIHNldFxuICogYGM4eS1kYXNoYm9hcmQtY2hpbGRgLWNvbXBvbmVudHMgb24gaXQgb3IgcG9zaXRpb24gYW55IGVsZW1lbnQgb24gaXQgYnlcbiAqIHNldHRpbmcgdGhlIGdyaWQgQ1NTIHByb3BlcnRpZXMuIE9uIGNoYW5nZSAocmVzaXplLCBvciByZWFycmFuZ2UpIHRoZVxuICogY29tcG9uZW50IGVtaXRzIGFuIGNoYW5nZSBldmVudC5cbiAqXG4gKiAjIyBFeGFtcGxlOlxuICpcbiAqIGBgYGh0bWxcbiAqIDxjOHktdGl0bGU+SGVsbG8gZnJvbSBvdXRsZXQ8L2M4eS10aXRsZT5cbiAqXG4gKiA8Yzh5LWFjdGlvbi1iYXItaXRlbSBbcGxhY2VtZW50XT1cIidyaWdodCdcIj5cbiAqICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tbGlua1wiIChjbGljayk9XCJhZGRSYW5kb20oKVwiPjxpIGNsYXNzPVwiZmEgZmEtcGx1c1wiPjwvaT4gQWRkIHJhbmRvbTwvYnV0dG9uPlxuICogPC9jOHktYWN0aW9uLWJhci1pdGVtPlxuICogPGM4eS1hY3Rpb24tYmFyLWl0ZW0gW3BsYWNlbWVudF09XCIncmlnaHQnXCI+XG4gKiAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLWxpbmtcIiAoY2xpY2spPVwiaXNGcm96ZW4gPSAhaXNGcm96ZW5cIj5cbiAqICAgICA8aSBbYzh5SWNvbl09XCJpc0Zyb3plbiA/ICdsb2NrJyA6ICd1bmxvY2snXCI+PC9pPiBUb2dnbGUgZnJlZXplXG4gKiAgIDwvYnV0dG9uPlxuICogPC9jOHktYWN0aW9uLWJhci1pdGVtPlxuICpcbiAqIDxjOHktZGFzaGJvYXJkIChkYXNoYm9hcmRDaGFuZ2UpPVwiZGFzaGJvYXJkQ2hhbmdlKCRldmVudClcIj5cbiAqICAgPGM4eS1kYXNoYm9hcmQtY2hpbGRcbiAqICAgICBbaXNGcm96ZW5dPVwiaXNGcm96ZW5cIlxuICogICAgIHRpdGxlPVwiZHluYW1pY1wiXG4gKiAgICAgKm5nRm9yPVwibGV0IHdpZGdldCBvZiB3aWRnZXRzXCJcbiAqICAgICAjY3VycmVudFxuICogICA+XG4gKiAgICAgeDoge3sgY3VycmVudC54IH19PGJyIC8+XG4gKiAgICAgeToge3sgY3VycmVudC55IH19PGJyIC8+XG4gKiAgICAgd2lkdGg6IHt7IGN1cnJlbnQud2lkdGggfX08YnIgLz5cbiAqICAgICBoZWlnaHQ6IHt7IGN1cnJlbnQuaGVpZ2h0IH19PGJyIC8+XG4gKiAgIDwvYzh5LWRhc2hib2FyZC1jaGlsZD5cbiAqICAgPGM4eS1kYXNoYm9hcmQtY2hpbGRcbiAqICAgICAjY3BXaWRnZXRcbiAqICAgICBbaXNGcm96ZW5dPVwiaXNGcm96ZW5cIlxuICogICAgIFt4XT1cIjBcIlxuICogICAgIFt5XT1cIjFcIlxuICogICAgIFt3aWR0aF09XCIzXCJcbiAqICAgICBbaGVpZ2h0XT1cIjJcIlxuICogICAgIFtkYXRhXT1cIndpZGdldFwiXG4gKiAgICAgW2NsYXNzXT1cIidjYXJkIGNhcmQtZGFzaGJvYXJkIHBhbmVsLXRpdGxlLXJlZ3VsYXIgcGFuZWwtY29udGVudC1icmFuZGVkIHBhbmVsLXRpdGxlLW92ZXJsYXknXCJcbiAqICAgPlxuICogICAgIDxjOHktZGFzaGJvYXJkLWNoaWxkLXRpdGxlPlxuICogICAgICAgPHNwYW4+V29ybGQhPC9zcGFuPlxuICogICAgIDwvYzh5LWRhc2hib2FyZC1jaGlsZC10aXRsZT5cbiAqICAgICB4OiB7eyBjcFdpZGdldC54IH19PGJyIC8+XG4gKiAgICAgeToge3sgY3BXaWRnZXQueSB9fTxiciAvPlxuICogICAgIHdpZHRoOiB7eyBjcFdpZGdldC53aWR0aCB9fTxiciAvPlxuICogICAgIGhlaWdodDoge3sgY3BXaWRnZXQuaGVpZ2h0IH19PGJyIC8+XG4gKiAgIDwvYzh5LWRhc2hib2FyZC1jaGlsZD5cbiAqICAgPGM4eS1kYXNoYm9hcmQtY2hpbGRcbiAqICAgICAjY3BXaWRnZXQyXG4gKiAgICAgW2lzRnJvemVuXT1cImlzRnJvemVuXCJcbiAqICAgICBbeF09XCI4XCJcbiAqICAgICBbeV09XCIxXCJcbiAqICAgICBbd2lkdGhdPVwiNFwiXG4gKiAgICAgW2hlaWdodF09XCI0XCJcbiAqICAgICBbY2xhc3NdPVwiJ2NhcmQgY2FyZC1kYXNoYm9hcmQgcGFuZWwtY29udGVudC1kYXJrJ1wiXG4gKiAgID5cbiAqICAgICA8Yzh5LWRhc2hib2FyZC1jaGlsZC10aXRsZT5cbiAqICAgICAgIDxzcGFuPkhlbGxvITwvc3Bhbj5cbiAqICAgICA8L2M4eS1kYXNoYm9hcmQtY2hpbGQtdGl0bGU+XG4gKiAgICAgPGM4eS1kYXNoYm9hcmQtY2hpbGQtYWN0aW9uPlxuICogICAgICAgPGEgaHJlZj1cIlwiIChjbGljayk9XCJjcFdpZGdldDIuaXNGcm96ZW4gPSAhY3BXaWRnZXQyLmlzRnJvemVuOyAoZmFsc2UpXCI+XG4gKiAgICAgICAgIDxpIFtjOHlJY29uXT1cImNwV2lkZ2V0Mi5pc0Zyb3plbiA/ICdsb2NrJyA6ICd1bmxvY2snXCI+PC9pPiBUb2dnbGUgZnJlZXplXG4gKiAgICAgICA8L2E+XG4gKiAgICAgPC9jOHktZGFzaGJvYXJkLWNoaWxkLWFjdGlvbj5cbiAqICAgICB4OiB7eyBjcFdpZGdldDIueCB9fTxiciAvPlxuICogICAgIHk6IHt7IGNwV2lkZ2V0Mi55IH19PGJyIC8+XG4gKiAgICAgd2lkdGg6IHt7IGNwV2lkZ2V0Mi53aWR0aCB9fTxiciAvPlxuICogICAgIGhlaWdodDoge3sgY3BXaWRnZXQyLmhlaWdodCB9fTxiciAvPlxuICogICA8L2M4eS1kYXNoYm9hcmQtY2hpbGQ+XG4gKlxuICogICA8Yzh5LWRhc2hib2FyZC1jaGlsZFxuICogICAgICNjcFdpZGdldDNcbiAqICAgICBbaXNGcm96ZW5dPVwiaXNGcm96ZW5cIlxuICogICAgIFt4XT1cIjBcIlxuICogICAgIFt5XT1cIjNcIlxuICogICAgIFt3aWR0aF09XCI0XCJcbiAqICAgICBbaGVpZ2h0XT1cIjRcIlxuICogICAgIFtjbGFzc109XCInY2FyZC1kYXNoYm9hcmQgcGFuZWwtY29udGVudC10cmFuc3BhcmVudCdcIlxuICogICA+XG4gKiAgICAgPGM4eS1kYXNoYm9hcmQtY2hpbGQtdGl0bGUgKm5nSWY9XCJzaG93VGl0bGVcIj5cbiAqICAgICAgIDxzcGFuPlRyYW5zcGFyZW50ITwvc3Bhbj5cbiAqICAgICA8L2M4eS1kYXNoYm9hcmQtY2hpbGQtdGl0bGU+XG4gKiAgICAgPGM4eS1kYXNoYm9hcmQtY2hpbGQtYWN0aW9uPlxuICogICAgICAgPGEgaHJlZj1cIlwiIChjbGljayk9XCJzaG93VGl0bGUgPSAhc2hvd1RpdGxlOyAoZmFsc2UpXCI+XG4gKiAgICAgICAgIDxpIFtjOHlJY29uXT1cIidoZWFkaW5nJ1wiPjwvaT4gSGlkZS9zaG93IHRpdGxlXG4gKiAgICAgICA8L2E+XG4gKiAgICAgPC9jOHktZGFzaGJvYXJkLWNoaWxkLWFjdGlvbj5cbiAqICAgICA8Yzh5LWRhc2hib2FyZC1jaGlsZC1hY3Rpb24+XG4gKiAgICAgICA8YSBocmVmPVwiXCIgKGNsaWNrKT1cImNwV2lkZ2V0My5pc0Zyb3plbiA9ICFjcFdpZGdldDMuaXNGcm96ZW47IChmYWxzZSlcIj5cbiAqICAgICAgICAgPGkgW2M4eUljb25dPVwiY3BXaWRnZXQzLmlzRnJvemVuID8gJ2xvY2snIDogJ3VubG9jaydcIj48L2k+IFRvZ2dsZSBmcmVlemVcbiAqICAgICAgIDwvYT5cbiAqICAgICA8L2M4eS1kYXNoYm9hcmQtY2hpbGQtYWN0aW9uPlxuICogICAgIHg6IHt7IGNwV2lkZ2V0My54IH19PGJyIC8+XG4gKiAgICAgeToge3sgY3BXaWRnZXQzLnkgfX08YnIgLz5cbiAqICAgICB3aWR0aDoge3sgY3BXaWRnZXQzLndpZHRoIH19PGJyIC8+XG4gKiAgICAgaGVpZ2h0OiB7eyBjcFdpZGdldDMuaGVpZ2h0IH19PGJyIC8+XG4gKiAgIDwvYzh5LWRhc2hib2FyZC1jaGlsZD5cbiAqIDwvYzh5LWRhc2hib2FyZD5cbiAqIGBgYFxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktZGFzaGJvYXJkJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2Rhc2hib2FyZC5jb21wb25lbnQuaHRtbCcsXG4gIGhvc3Q6IHtcbiAgICBjbGFzczogJ2M4eS1ncmlkLWRhc2hib2FyZCBkYXNoYm9hcmQtZ3JpZCdcbiAgfSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgRGFzaGJvYXJkQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJDb250ZW50SW5pdCB7XG4gIC8qKlxuICAgKiBBbGwgY2hpbGRyZW4gaW4gdGhhdCBkYXNoYm9hcmQuXG4gICAqL1xuICBAQ29udGVudENoaWxkcmVuKGZvcndhcmRSZWYoKCkgPT4gRGFzaGJvYXJkQ2hpbGRDb21wb25lbnQpKSBjaGlsZHJlbjogUXVlcnlMaXN0PFxuICAgIERhc2hib2FyZENoaWxkQ29tcG9uZW50XG4gID47XG5cbiAgLyoqXG4gICAqIFRoZSBhbW91bnQgb2YgY29sdW1ucyBvbiB0aGF0IGRhc2hib2FyZC5cbiAgICovXG4gIEBJbnB1dCgpIGNvbHVtbnMgPSAxMjtcblxuICAvKipcbiAgICogVGhlIHNwYWNpbmcgYmV0d2VlbiBlYWNoIGNoaWxkcmVuIGluIHBpeGVsLlxuICAgKi9cbiAgQElucHV0KCkgZ2FwID0gMTI7XG5cbiAgLyoqXG4gICAqIFRoZSBhbW91bnQgb2Ygcm93cyB0byBkdXNwbGF5LiBTZXQgdG8gYXV0byB0b1xuICAgKiBhdXRvIGV4dGVuZCB0aGUgcm93cy5cbiAgICovXG4gIEBJbnB1dCgpIHJvd3M6IG51bWJlciB8ICdhdXRvJyA9ICdhdXRvJztcblxuICAvKipcbiAgICogQW4gZXZlbnQgZmlyZWQgaWYgdGhlIGRhc2hib2FyZCB3YXMgY2hhbmdlZC5cbiAgICovXG4gIEBPdXRwdXQoKSBkYXNoYm9hcmRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPERhc2hib2FyZENoYW5nZT4oKTtcblxuICBkYXNoYm9hcmRSZWN0O1xuICBwcml2YXRlIGxhc3RSb3cgPSAxO1xuICBwcml2YXRlIHJlYWRvbmx5IERFRkFVTFRfUk9XX1NJWkUgPSA2ODtcblxuICAvKipcbiAgICogVGhlIGN1cnJlbnQgY29sdW1uIHNpemUuXG4gICAqL1xuICBnZXQgY29sdW1uU2l6ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5kYXNoYm9hcmRSZWN0LndpZHRoIC8gdGhpcy5jb2x1bW5zO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBjdXJyZW50IHJvdyBzaXplLlxuICAgKi9cbiAgZ2V0IHJvd1NpemUoKSB7XG4gICAgcmV0dXJuIHRoaXMucm93cyA9PT0gJ2F1dG8nID8gdGhpcy5ERUZBVUxUX1JPV19TSVpFIDogdGhpcy5jYWxjdWxhdGVSb3dTaXplKCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhbGwgcG9zaXRpb25pbmcgc3R5bGVzLiBOYXN0eSB3b3JrYXJvdW5kIGZvciB0aGF0IGlzc3VlOlxuICAgKiBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9hbmd1bGFyL2lzc3Vlcy85MzQzXG4gICAqL1xuICBASG9zdEJpbmRpbmcoJ2F0dHIuc3R5bGUnKVxuICBnZXQgaW5saW5lU3R5bGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2FuaXRpemVyLmJ5cGFzc1NlY3VyaXR5VHJ1c3RTdHlsZShcbiAgICAgIGBcbiAgICAgICAgLW1zLWdyaWQtY29sdW1uczogKDFmcilbJHt0aGlzLmNvbHVtbnN9XTtcbiAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoJHt0aGlzLmNvbHVtbnN9LCAxZnIpO1xuICAgICAgICAke3RoaXMucm93cyAhPT0gJ2F1dG8nID8gYGdyaWQtdGVtcGxhdGUtcm93czogcmVwZWF0KCR7dGhpcy5yb3dzfSwgMWZyKTtgIDogJyd9XG4gICAgICAgIGdyaWQtYXV0by1yb3dzOiAke3RoaXMucm93U2l6ZSArIHRoaXMuZ2FwfXB4O1xuICAgICAgICAtbXMtZ3JpZC1yb3dzOiAoJHt0aGlzLnJvd1NpemUgKyB0aGlzLmdhcH1weClbJHtcbiAgICAgICAgdGhpcy5yb3dzID09PSAnYXV0bycgPyB0aGlzLmxhc3RSb3cgOiB0aGlzLnJvd3NcbiAgICAgIH1dO1xuICAgICAgICBtYXJnaW46IC0ke3RoaXMuZ2FwfXB4O1xuICAgICAgYFxuICAgICk7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnQ6IEVsZW1lbnRSZWYsIHByaXZhdGUgc2FuaXRpemVyOiBEb21TYW5pdGl6ZXIpIHt9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xuICAgIHRoaXMub25SZXNpemUoKTtcbiAgICB0aGlzLmdldExhc3RSb3coKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpyZXNpemUnKVxuICBvblJlc2l6ZSgpIHtcbiAgICB0aGlzLnVwZGF0ZVJlY3RTaXplKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgbGFzdCByb3dcbiAgICogKG1haW5seSBmb3IgSUUxMSB3aGljaCBkb2Vzbid0IHN1cHBvcnQgZ3JpZC1hdXRvLXJvd3MgQ1NTIHByb3BlcnR5KVxuICAgKi9cbiAgZ2V0TGFzdFJvdygpIHtcbiAgICBsZXQgbGFzdFJvdyA9IDE7XG4gICAgdGhpcy5jaGlsZHJlbi5mb3JFYWNoKHdpZGdldCA9PiB7XG4gICAgICBpZiAobGFzdFJvdyA8IHdpZGdldC55ICsgd2lkZ2V0LndpZHRoKSB7XG4gICAgICAgIGxhc3RSb3cgPSB3aWRnZXQueSArIHdpZGdldC53aWR0aDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLmxhc3RSb3cgPSBsYXN0Um93ICsgMTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHRoZSBjdXJyZW50IHJlY3Qgc2l6ZSBvZiB0aGUgZGFzaGJvYXJkLlxuICAgKi9cbiAgdXBkYXRlUmVjdFNpemUoKSB7XG4gICAgY29uc3QgZWxlID0gdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgdGhpcy5kYXNoYm9hcmRSZWN0ID0gIGVsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgfVxuXG4gIGVtaXRDaGFuZ2Uod2lkZ2V0OiBEYXNoYm9hcmRDaGlsZENvbXBvbmVudCkge1xuICAgIHRoaXMuZGFzaGJvYXJkQ2hhbmdlLmVtaXQoeyBzb3VyY2U6IHdpZGdldCwgY2hpbGRyZW46IHRoaXMuY2hpbGRyZW4udG9BcnJheSgpIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVSb3dTaXplKCkge1xuICAgIHJldHVybiB0aGlzLmRhc2hib2FyZFJlY3QuaGVpZ2h0IC8gKHRoaXMucm93cyBhcyBudW1iZXIpO1xuICB9XG59XG4iXX0=