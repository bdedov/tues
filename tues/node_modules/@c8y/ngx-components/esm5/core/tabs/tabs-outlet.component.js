import * as tslib_1 from "tslib";
import { Component, Input, HostBinding, Renderer2, ElementRef, OnChanges, ViewChild, OnDestroy, AfterContentInit, AfterContentChecked } from '@angular/core';
import { debounceTime } from 'rxjs/operators';
import { fromEventPattern, fromEvent, merge } from 'rxjs';
import { Router } from '@angular/router';
var TabsOutletComponent = /** @class */ (function () {
    function TabsOutletComponent(router, renderer, el) {
        this.router = router;
        this.renderer = renderer;
        this.el = el;
        this.tabs = [];
        this.orientation = 'vertical';
        this.navigatorOpen = false;
        this.showLeft = false;
        this.showRight = false;
    }
    Object.defineProperty(TabsOutletComponent.prototype, "isNavigatorOpen", {
        get: function () {
            return this.navigatorOpen;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TabsOutletComponent.prototype, "hasTabs", {
        get: function () {
            var visibleTabs = [];
            if (this.tabs) {
                visibleTabs = this.tabs.filter(function (tab) { return tab.hide !== true; });
            }
            return visibleTabs.length;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TabsOutletComponent.prototype, "isHorizontal", {
        get: function () {
            return this.orientation === 'horizontal';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TabsOutletComponent.prototype, "isVertical", {
        get: function () {
            return this.orientation !== 'horizontal';
        },
        enumerable: true,
        configurable: true
    });
    TabsOutletComponent.prototype.ngOnDestroy = function () {
        if (this.scrollSubscription) {
            this.scrollSubscription.unsubscribe();
        }
    };
    TabsOutletComponent.prototype.ngAfterContentInit = function () {
        if (this.orientation === 'horizontal') {
            this.scrollSubscribe();
        }
    };
    TabsOutletComponent.prototype.isActive = function (tab) {
        if (tab && tab.path) {
            return this.router.isActive(tab.path, false);
        }
        else {
            return false;
        }
    };
    TabsOutletComponent.prototype.navigateTo = function (path) {
        this.router.navigate([path]);
    };
    TabsOutletComponent.prototype.scroll = function (direction) {
        if (direction === void 0) { direction = 'right'; }
        var _a = this.getDimensions(), widthScroll = _a.widthScroll, width = _a.width, scrollLeft = _a.scrollLeft;
        var multiplier = direction === 'left' ? -1 : 1;
        var targetScroll = scrollLeft + width * multiplier;
        if (targetScroll < 0) {
            targetScroll = 0;
        }
        if (targetScroll > widthScroll - width) {
            targetScroll = widthScroll - width;
        }
        // TODO: we should animate this
        this.container.nativeElement.scrollLeft = targetScroll;
    };
    TabsOutletComponent.prototype.scrollSubscribe = function () {
        var _this = this;
        var unlisten;
        this.scrollSubscription = merge(fromEvent(this.container.nativeElement, 'scroll'), fromEventPattern(function (handler) {
            unlisten = _this.renderer.listen('window', 'resize', handler);
        }, function () { return unlisten(); })).pipe(debounceTime(250)).subscribe(function () { return _this.updateScroll(); });
    };
    TabsOutletComponent.prototype.updateScroll = function () {
        var _a = this.getDimensions(), widthScroll = _a.widthScroll, width = _a.width, scrollLeft = _a.scrollLeft;
        this.showLeft = !!scrollLeft;
        this.showRight = widthScroll > width + scrollLeft;
    };
    TabsOutletComponent.prototype.getDimensions = function () {
        var elTabs = this.tabsContainer.nativeElement;
        var el = this.container.nativeElement;
        var widthScroll = elTabs.scrollWidth;
        var width = el.clientWidth;
        var scrollLeft = el.scrollLeft;
        return { widthScroll: widthScroll, width: width, scrollLeft: scrollLeft };
    };
    TabsOutletComponent.ctorParameters = function () { return [
        { type: Router },
        { type: Renderer2 },
        { type: ElementRef }
    ]; };
    tslib_1.__decorate([
        Input()
    ], TabsOutletComponent.prototype, "tabs", void 0);
    tslib_1.__decorate([
        Input()
    ], TabsOutletComponent.prototype, "orientation", void 0);
    tslib_1.__decorate([
        Input()
    ], TabsOutletComponent.prototype, "navigatorOpen", void 0);
    tslib_1.__decorate([
        HostBinding('class.navigator-open')
    ], TabsOutletComponent.prototype, "isNavigatorOpen", null);
    tslib_1.__decorate([
        HostBinding('class.page-tabs')
    ], TabsOutletComponent.prototype, "hasTabs", null);
    tslib_1.__decorate([
        HostBinding('class.page-tabs-horizontal')
    ], TabsOutletComponent.prototype, "isHorizontal", null);
    tslib_1.__decorate([
        HostBinding('class.page-tabs-vertical')
    ], TabsOutletComponent.prototype, "isVertical", null);
    tslib_1.__decorate([
        ViewChild('container', { read: ElementRef, static: true })
    ], TabsOutletComponent.prototype, "container", void 0);
    tslib_1.__decorate([
        ViewChild('left', { read: ElementRef, static: false })
    ], TabsOutletComponent.prototype, "leftBtn", void 0);
    tslib_1.__decorate([
        ViewChild('right', { read: ElementRef, static: false })
    ], TabsOutletComponent.prototype, "rightBtn", void 0);
    tslib_1.__decorate([
        ViewChild('tabsContainer', { read: ElementRef, static: false })
    ], TabsOutletComponent.prototype, "tabsContainer", void 0);
    TabsOutletComponent = tslib_1.__decorate([
        Component({
            selector: 'c8y-tabs-outlet,c8y-ui-tabs',
            template: "<div #container class=\"tabContainer hidden-xs\">\n  <button class=\"tabs-slider tabs-slider-left\" #left *ngIf=\"showLeft\" (click)=\"scroll('left')\">\n    <i [c8yIcon]=\"'chevron-left'\"></i>\n  </button>\n  <button class=\"tabs-slider tabs-slider-right\" #right *ngIf=\"showRight\" (click)=\"scroll('right')\">\n    <i [c8yIcon]=\"'chevron-right'\"></i>\n  </button>\n  <ul class=\"nav nav-tabs nav-tabsc8y\" #tabsContainer>\n    <li [ngClass]=\"{'active': rla.isActive}\" *ngFor=\"let tab of tabs\">\n      <a [routerLink]=\"tab.path\" routerLinkActive #rla=\"routerLinkActive\" title=\"{{tab?.label | translate}}\">\n        <i [c8yIcon]=\"tab?.icon\" *ngIf=\"!tab.template && tab?.icon\"></i>\n        <span class=\"txt\" *ngIf=\"!tab.template\">{{tab?.label | translate}}</span>\n        <ng-container *ngTemplateOutlet=\"tab.template\"></ng-container>\n      </a>\n    </li>\n  </ul>\n</div>\n\n<div class=\"visible-xs mobile-tabs\">\n  <div class=\"c8y-select-wrapper\">\n    <select (change)=\"navigateTo($event.target.value)\" #select>\n      <option *ngFor=\"let tab of tabs\" [value]=\"tab.path\" [selected]=\"isActive(tab)\">\n        {{tab?.label | translate}}\n      </option>\n    </select>\n  </div>\n</div>\n"
        })
    ], TabsOutletComponent);
    return TabsOutletComponent;
}());
export { TabsOutletComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFicy1vdXRsZXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGM4eS9uZ3gtY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImNvcmUvdGFicy90YWJzLW91dGxldC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLFdBQVcsRUFDWCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFNBQVMsRUFDVCxTQUFTLEVBQ1QsU0FBUyxFQUNULGdCQUFnQixFQUNoQixtQkFBbUIsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUM1QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQU96QztJQTRCRSw2QkFDVSxNQUFjLEVBQ2QsUUFBbUIsRUFDbkIsRUFBYztRQUZkLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ25CLE9BQUUsR0FBRixFQUFFLENBQVk7UUE5QmYsU0FBSSxHQUFVLEVBQUUsQ0FBQztRQUNqQixnQkFBVyxHQUE4QixVQUFVLENBQUM7UUFDcEQsa0JBQWEsR0FBRyxLQUFLLENBQUM7UUFDL0IsYUFBUSxHQUFZLEtBQUssQ0FBQztRQUMxQixjQUFTLEdBQVksS0FBSyxDQUFDO0lBMkJ4QixDQUFDO0lBMUJpQyxzQkFBSSxnREFBZTthQUFuQjtZQUNuQyxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUM7UUFDNUIsQ0FBQzs7O09BQUE7SUFDK0Isc0JBQUksd0NBQU87YUFBWDtZQUM5QixJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7WUFDckIsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO2dCQUNiLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFB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QUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFDLENBQUM7eURBQThCO0lBQ3JCO1FBQTlELFNBQVMsQ0FBQyxlQUFlLEVBQUUsRUFBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUMsQ0FBQzs4REFBbUM7SUF6QnRGLG1CQUFtQjtRQUovQixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsNkJBQTZCO1lBQ3ZDLHd0Q0FBMkM7U0FDNUMsQ0FBQztPQUNXLG1CQUFtQixDQXVHL0I7SUFBRCwwQkFBQztDQUFBLEFBdkdELElBdUdDO1NBdkdZLG1CQUFtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIEhvc3RCaW5kaW5nLFxuICBSZW5kZXJlcjIsXG4gIEVsZW1lbnRSZWYsXG4gIE9uQ2hhbmdlcyxcbiAgVmlld0NoaWxkLFxuICBPbkRlc3Ryb3ksXG4gIEFmdGVyQ29udGVudEluaXQsXG4gIEFmdGVyQ29udGVudENoZWNrZWR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgZGVib3VuY2VUaW1lIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgZnJvbUV2ZW50UGF0dGVybiwgZnJvbUV2ZW50LCBtZXJnZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgVGFiIH0gZnJvbSAnLi90YWIubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktdGFicy1vdXRsZXQsYzh5LXVpLXRhYnMnLFxuICB0ZW1wbGF0ZVVybDogJy4vdGFicy1vdXRsZXQuY29tcG9uZW50Lmh0bWwnLFxufSlcbmV4cG9ydCBjbGFzcyBUYWJzT3V0bGV0Q29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95LCBBZnRlckNvbnRlbnRJbml0IHtcbiAgQElucHV0KCkgdGFiczogYW55W10gPSBbXTtcbiAgQElucHV0KCkgb3JpZW50YXRpb246ICd2ZXJ0aWNhbCcgfCAnaG9yaXpvbnRhbCcgPSAndmVydGljYWwnO1xuICBASW5wdXQoKSBuYXZpZ2F0b3JPcGVuID0gZmFsc2U7XG4gIHNob3dMZWZ0OiBib29sZWFuID0gZmFsc2U7XG4gIHNob3dSaWdodDogYm9vbGVhbiA9IGZhbHNlO1xuICBASG9zdEJpbmRpbmcoJ2NsYXNzLm5hdmlnYXRvci1vcGVuJykgZ2V0IGlzTmF2aWdhdG9yT3BlbigpIHtcbiAgICByZXR1cm4gdGhpcy5uYXZpZ2F0b3JPcGVuO1xuICB9XG4gIEBIb3N0QmluZGluZygnY2xhc3MucGFnZS10YWJzJykgZ2V0IGhhc1RhYnMoKSB7XG4gICAgbGV0IHZpc2libGVUYWJzID0gW107XG4gICAgaWYgKHRoaXMudGFicykge1xuICAgICAgdmlzaWJsZVRhYnMgPSB0aGlzLnRhYnMuZmlsdGVyKHRhYiA9PiB0YWIuaGlkZSAhPT0gdHJ1ZSk7XG4gICAgfVxuICAgIHJldHVybiB2aXNpYmxlVGFicy5sZW5ndGg7XG4gIH1cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5wYWdlLXRhYnMtaG9yaXpvbnRhbCcpIGdldCBpc0hvcml6b250YWwoKSB7XG4gICAgcmV0dXJuIHRoaXMub3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJztcbiAgfVxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLnBhZ2UtdGFicy12ZXJ0aWNhbCcpIGdldCBpc1ZlcnRpY2FsKCkge1xuICAgIHJldHVybiB0aGlzLm9yaWVudGF0aW9uICE9PSAnaG9yaXpvbnRhbCc7XG4gIH1cbiAgQFZpZXdDaGlsZCgnY29udGFpbmVyJywge3JlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogdHJ1ZX0pIHByaXZhdGUgY29udGFpbmVyOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdsZWZ0Jywge3JlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogZmFsc2V9KSBwcml2YXRlIGxlZnRCdG46IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ3JpZ2h0Jywge3JlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogZmFsc2V9KSBwcml2YXRlIHJpZ2h0QnRuOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCd0YWJzQ29udGFpbmVyJywge3JlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogZmFsc2V9KSBwcml2YXRlIHRhYnNDb250YWluZXI6IEVsZW1lbnRSZWY7XG4gIHByaXZhdGUgc2Nyb2xsU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgcHJpdmF0ZSBlbDogRWxlbWVudFJlZlxuICApIHt9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuc2Nyb2xsU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLnNjcm9sbFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICBpZiAodGhpcy5vcmllbnRhdGlvbiA9PT0gJ2hvcml6b250YWwnKSB7XG4gICAgICB0aGlzLnNjcm9sbFN1YnNjcmliZSgpO1xuICAgIH1cblxuICB9XG5cbiAgaXNBY3RpdmUodGFiOiBUYWIpIHtcbiAgICBpZiAodGFiICYmIHRhYi5wYXRoKSB7XG4gICAgICByZXR1cm4gdGhpcy5yb3V0ZXIuaXNBY3RpdmUodGFiLnBhdGgsIGZhbHNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIG5hdmlnYXRlVG8ocGF0aCkge1xuICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFtwYXRoXSk7XG4gIH1cblxuICBzY3JvbGwoZGlyZWN0aW9uOiAncmlnaHQnIHwgJ2xlZnQnID0gJ3JpZ2h0Jykge1xuICAgIGNvbnN0IHsgd2lkdGhTY3JvbGwsIHdpZHRoLCBzY3JvbGxMZWZ0IH0gPSB0aGlzLmdldERpbWVuc2lvbnMoKTtcbiAgICBjb25zdCBtdWx0aXBsaWVyID0gZGlyZWN0aW9uID09PSAnbGVmdCcgPyAtMSA6IDE7XG5cbiAgICBsZXQgdGFyZ2V0U2Nyb2xsID0gc2Nyb2xsTGVmdCArIHdpZHRoICogbXVsdGlwbGllcjtcbiAgICBpZiAodGFyZ2V0U2Nyb2xsIDwgMCkge1xuICAgICAgdGFyZ2V0U2Nyb2xsID0gMDtcbiAgICB9XG4gICAgaWYgKHRhcmdldFNjcm9sbCA+IHdpZHRoU2Nyb2xsIC0gd2lkdGgpIHtcbiAgICAgIHRhcmdldFNjcm9sbCA9IHdpZHRoU2Nyb2xsIC0gd2lkdGg7XG4gICAgfVxuICAgIC8vIFRPRE86IHdlIHNob3VsZCBhbmltYXRlIHRoaXNcbiAgICB0aGlzLmNvbnRhaW5lci5uYXRpdmVFbGVtZW50LnNjcm9sbExlZnQgPSB0YXJnZXRTY3JvbGw7XG4gIH1cblxuICBwcml2YXRlIHNjcm9sbFN1YnNjcmliZSgpIHtcbiAgICBsZXQgdW5saXN0ZW47XG4gICAgdGhpcy5zY3JvbGxTdWJzY3JpcHRpb24gPSBtZXJnZShcbiAgICAgIGZyb21FdmVudCh0aGlzLmNvbnRhaW5lci5uYXRpdmVFbGVtZW50LCAnc2Nyb2xsJyksXG4gICAgICBmcm9tRXZlbnRQYXR0ZXJuKFxuICAgICAgICAoaGFuZGxlcjogYW55KSA9PiB7XG4gICAgICAgICAgdW5saXN0ZW4gPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbignd2luZG93JywgJ3Jlc2l6ZScsIGhhbmRsZXIpO1xuICAgICAgICB9LFxuICAgICAgICAoKSA9PiB1bmxpc3RlbigpXG4gICAgICApXG4gICAgKS5waXBlKFxuICAgICAgZGVib3VuY2VUaW1lKDI1MClcbiAgICApLnN1YnNjcmliZSgoKSA9PiB0aGlzLnVwZGF0ZVNjcm9sbCgpKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlU2Nyb2xsKCkge1xuICAgIGNvbnN0IHsgd2lkdGhTY3JvbGwsIHdpZHRoLCBzY3JvbGxMZWZ0IH0gPSB0aGlzLmdldERpbWVuc2lvbnMoKTtcbiAgICB0aGlzLnNob3dMZWZ0ID0gISFzY3JvbGxMZWZ0O1xuICAgIHRoaXMuc2hvd1JpZ2h0ID0gd2lkdGhTY3JvbGwgPiB3aWR0aCArIHNjcm9sbExlZnQ7XG4gIH1cblxuICBwcml2YXRlIGdldERpbWVuc2lvbnMoKSB7XG4gICAgY29uc3QgZWxUYWJzID0gdGhpcy50YWJzQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQ7XG4gICAgY29uc3QgZWwgPSB0aGlzLmNvbnRhaW5lci5uYXRpdmVFbGVtZW50O1xuICAgIGNvbnN0IHdpZHRoU2Nyb2xsID0gICBlbFRhYnMuc2Nyb2xsV2lkdGg7XG4gICAgY29uc3Qgd2lkdGggPSBlbC5jbGllbnRXaWR0aDtcbiAgICBjb25zdCBzY3JvbGxMZWZ0ID0gZWwuc2Nyb2xsTGVmdDtcbiAgICByZXR1cm4geyB3aWR0aFNjcm9sbCwgd2lkdGgsIHNjcm9sbExlZnQgfTtcbiAgfVxufVxuIl19