import * as tslib_1 from "tslib";
import { CdkStep } from '@angular/cdk/stepper';
import { Component, EventEmitter, Host, Input, Output } from '@angular/core';
import { C8yStepper } from './stepper.component';
/**
 * C8yStepperButtons provides a convinient way to have, according to
 * the C8yStepper and each cdk-step, buttons to navigate between steps or to cancel the whole
 * step-process. Buttons rendered with the help of this component will use the branding css.
 *
 * By default all steps with this component in use will render a next button, expect the last step.
 * The other way around, every step using this component will render a back button, expect the first step.
 * To get a cancel button rendered you need to handle the onCancel event.
 * For next and back button you don't need to handle the available events onNext and onBack because default behavior
 * is implemented. The default will just call, according to the button, the stepper.next() or stepper.previous()
 * methods and moves the stepper forth or back. Using the EventEmitter onNext and onBack will emit for you the following
 * object: {stepper: C8yStepper, step: CdkStep}. This is useful if you need to implement custom logic before moving
 * to the next step or sending data to a backend. In this case you need to tell the stepper to move forward or back
 * on your own.
 *
 * With the component input [labels] you can change the label of each button in each step. It takes an object like this:
 * {next?: string, back?: string, cancel?: string}
 *
 * The [pending] input is of type boolean and will enable css animation for the next button when true.
 *
 * If the cdk-step provides a stepControl the component will set the next button disabled when the formGroup
 * behind it is invalid. As long as the [pending] input is true the back and next button is also disabled.
 * This will prevent multiple clicks while running a request or stepping back while a request is ongoing.
 *
 * @example
 * ```
 * <c8y-stepper>
 *  <cdk-step>
 *    <!--
 *      your html code
 *          ...
 *          ...    -->
 *    <c8y-stepper-buttons
 *     (onNext)="save()"
 *     [labels]="{ next: 'Save' }"
 *     [pending]="pendingStatus"
 *     ></c8y-stepper-buttons>
 *  </cdk-step>
 * </c8y-stepper>
 *
 * // in your component:
 * async save() {
 *   this.pendingStatus = true;
 *   // your async request goes here ...
 *   // await something();
 *   this.pendingStatus = false;
 *   this.stepper.next();
 * }
 * ```
 */
var C8yStepperButtons = /** @class */ (function () {
    function C8yStepperButtons(stepper, step) {
        this.stepper = stepper;
        this.step = step;
        /**
         * Optional
         * Indicates if a request is pending and sets the next button
         * to disabled when true
         */
        this.pending = false;
        /**
         * Disabled state of a button
         */
        this.disabled = false;
        /**
         * EventEmitter which emits when cancel button is clicked
         */
        this.onCancel = new EventEmitter();
        /**
         * EventEmitter which emits {stepper: C8yStepper; step: CdkStep} when next button is clicked.
         */
        this.onNext = new EventEmitter();
        /**
         * EventEmitter which emits {stepper: C8yStepper; step: CdkStep} when back button is clicked.
         */
        this.onBack = new EventEmitter();
        /**
         * EventEmitter which emits when the optional custom button is clicked
         */
        this.onCustom = new EventEmitter();
        /**
         * Indicator which button should be shown.
         * Based on the cdk-steps within the c8y-stepper
         * next and back buttons are rendered.
         */
        this.showBtns = {
            cancel: false,
            back: false,
            next: false,
            custom: false
        };
    }
    C8yStepperButtons.prototype.ngAfterContentInit = function () {
        var _this = this;
        this.showBtns.cancel = this.onCancel.observers.length > 0;
        this.showBtns.custom = this.onCustom.observers.length > 0;
        if (this.stepper && this.stepper.steps && this.step) {
            this.showBtns.back = this.stepper.steps.first !== this.step;
            this.showBtns.next = this.stepper.steps.last !== this.step;
        }
        if (this.step && this.step.stepControl) {
            this.disabled = this.step.stepControl.invalid;
            this.statusChangeSubscription = this.step.stepControl.statusChanges.subscribe(function (status) {
                _this.disabled = _this.step.stepControl.invalid;
            });
        }
    };
    C8yStepperButtons.prototype.ngOnChanges = function (changes) {
        /**
         * Disable save/next button while the status is pending
         * This will prevent multiple clicks and therefore multiple requests
         */
        if (changes && changes.pending) {
            this.disabled = changes.pending.currentValue;
        }
    };
    C8yStepperButtons.prototype.ngOnDestroy = function () {
        if (this.statusChangeSubscription && !this.statusChangeSubscription.closed) {
            this.statusChangeSubscription.unsubscribe();
        }
    };
    /**
     * Gets called when cancel button is clicked.
     * It will emit immediate.
     */
    C8yStepperButtons.prototype.cancel = function () {
        this.onCancel.emit();
    };
    /**
     * Gets called when next button is clicked. When onNext EventEmitter has an observer registered
     * it will emit the following object {stepper: C8yStepper; step: CdkStep}.
     * Otherwise it will call stepper.next() as default.
     */
    C8yStepperButtons.prototype.next = function () {
        if (this.onNext.observers.length > 0) {
            this.onNext.emit({ stepper: this.stepper, step: this.step });
        }
        else {
            this.stepper.next();
        }
    };
    /**
     * Gets called when back button is clicked. When onBack EventEmitter has an observer registered
     * it will emit the following object {stepper: C8yStepper; step: CdkStep}.
     * Otherwise it will call stepper.previous() as default.
     */
    C8yStepperButtons.prototype.back = function () {
        this.stepper.selected.completed = false;
        if (this.onBack.observers.length > 0) {
            this.onBack.emit({ stepper: this.stepper, step: this.step });
        }
        else {
            this.stepper.previous();
        }
    };
    /**
     * Gets called when the custom button is clicked.
     * It will emit immediately.
     */
    C8yStepperButtons.prototype.custom = function () {
        this.onCustom.emit();
    };
    C8yStepperButtons.ctorParameters = function () { return [
        { type: C8yStepper, decorators: [{ type: Host }] },
        { type: CdkStep, decorators: [{ type: Host }] }
    ]; };
    tslib_1.__decorate([
        Input()
    ], C8yStepperButtons.prototype, "labels", void 0);
    tslib_1.__decorate([
        Input()
    ], C8yStepperButtons.prototype, "pending", void 0);
    tslib_1.__decorate([
        Input()
    ], C8yStepperButtons.prototype, "disabled", void 0);
    tslib_1.__decorate([
        Output()
    ], C8yStepperButtons.prototype, "onCancel", void 0);
    tslib_1.__decorate([
        Output()
    ], C8yStepperButtons.prototype, "onNext", void 0);
    tslib_1.__decorate([
        Output()
    ], C8yStepperButtons.prototype, "onBack", void 0);
    tslib_1.__decorate([
        Output()
    ], C8yStepperButtons.prototype, "onCustom", void 0);
    C8yStepperButtons = tslib_1.__decorate([
        Component({
            selector: 'c8y-stepper-buttons',
            template: "<div class=\"text-center\">\n  <button *ngIf=\"showBtns.cancel\" (click)=\"cancel()\" type=\"button\" class=\"btn btn-default\">\n    <span *ngIf=\"labels?.cancel; else cancelLabel\">{{ labels?.cancel | translate }}</span>\n    <ng-template #cancelLabel>\n      <span>{{ 'Cancel' | translate }}</span>\n    </ng-template>\n  </button>\n  <button\n    *ngIf=\"showBtns.back\"\n    type=\"button\"\n    (click)=\"back()\"\n    class=\"btn btn-default\"\n    [disabled]=\"pending\"\n  >\n    <span *ngIf=\"labels?.back; else backLabel\">{{ labels?.back | translate }}</span>\n    <ng-template #backLabel>\n      <span>{{ 'Back' | translate }}</span>\n    </ng-template>\n  </button>\n  <button\n    *ngIf=\"showBtns.custom\"\n    (click)=\"custom()\"\n    type=\"button\"\n    class=\"btn\"\n    [ngClass]=\"{\n      'btn-default': showBtns.next,\n      'btn-primary': !showBtns.next,\n      'btn-pending': pending\n    }\"\n    [disabled]=\"pending || disabled\"\n  >\n    <span *ngIf=\"labels?.custom; else customLabel\">{{ labels?.custom | translate }}</span>\n    <ng-template #customLabel>\n      <span>{{ 'Complete' | translate }}</span>\n    </ng-template>\n  </button>\n  <button\n    (click)=\"next()\"\n    *ngIf=\"showBtns.next\"\n    type=\"button\"\n    class=\"btn btn-primary\"\n    [ngClass]=\"{ 'btn-pending': pending }\"\n    [disabled]=\"disabled\"\n  >\n    <span *ngIf=\"labels?.next; else nextLabel\">{{ labels?.next | translate }}</span>\n    <ng-template #nextLabel>\n      <span>{{ 'Next' | translate }}</span>\n    </ng-template>\n  </button>\n</div>\n"
        }),
        tslib_1.__param(0, Host()), tslib_1.__param(1, Host())
    ], C8yStepperButtons);
    return C8yStepperButtons;
}());
export { C8yStepperButtons };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RlcHBlci1idXR0b25zLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJjb3JlL3N0ZXBwZXIvc3RlcHBlci1idXR0b25zLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQy9DLE9BQU8sRUFFTCxTQUFTLEVBQ1QsWUFBWSxFQUNaLElBQUksRUFDSixLQUFLLEVBR0wsTUFBTSxFQUVQLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUVqRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQWlERztBQUtIO0lBbURFLDJCQUE0QixPQUFtQixFQUFrQixJQUFhO1FBQWxELFlBQU8sR0FBUCxPQUFPLENBQVk7UUFBa0IsU0FBSSxHQUFKLElBQUksQ0FBUztRQTdDOUU7Ozs7V0FJRztRQUNNLFlBQU8sR0FBYSxLQUFLLENBQUM7UUFFbkM7O1dBRUc7UUFDTSxhQUFRLEdBQWEsS0FBSyxDQUFDO1FBRXBDOztXQUVHO1FBQ08sYUFBUSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDeEM7O1dBRUc7UUFDTyxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQTBDLENBQUM7UUFFOUU7O1dBRUc7UUFDTyxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQTBDLENBQUM7UUFFOUU7O1dBRUc7UUFDTyxhQUFRLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUV4Qzs7OztXQUlHO1FBQ0gsYUFBUSxHQUFHO1lBQ1QsTUFBTSxFQUFFLEtBQUs7WUFDYixJQUFJLEVBQUUsS0FBSztZQUNYLElBQUksRUFBRSxLQUFLO1lBQ1gsTUFBTSxFQUFFLEtBQUs7U0FDZCxDQUFDO0lBSStFLENBQUM7SUFFbEYsOENBQWtCLEdBQWxC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QUksRUFBRSxDQUFDO0lBQ3ZCLENBQUM7O2dCQTdFb0MsVUFBVSx1QkFBbEMsSUFBSTtnQkFBc0QsT0FBTyx1QkFBNUIsSUFBSTs7SUE5QzdDO1FBQVIsS0FBSyxFQUFFO3FEQUE2RTtJQU01RTtRQUFSLEtBQUssRUFBRTtzREFBMkI7SUFLMUI7UUFBUixLQUFLLEVBQUU7dURBQTRCO0lBSzFCO1FBQVQsTUFBTSxFQUFFO3VEQUErQjtJQUk5QjtRQUFULE1BQU0sRUFBRTtxREFBcUU7SUFLcEU7UUFBVCxNQUFNLEVBQUU7cURBQXFFO0lBS3BFO1FBQVQsTUFBTSxFQUFFO3VEQUErQjtJQW5DN0IsaUJBQWlCO1FBSjdCLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxxQkFBcUI7WUFDL0IsbWpEQUErQztTQUNoRCxDQUFDO1FBb0RhLG1CQUFBLElBQUksRUFBRSxDQUFBLEVBQStCLG1CQUFBLElBQUksRUFBRSxDQUFBO09BbkQ3QyxpQkFBaUIsQ0FpSTdCO0lBQUQsd0JBQUM7Q0FBQSxBQWpJRCxJQWlJQztTQWpJWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDZGtTdGVwIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3N0ZXBwZXInO1xuaW1wb3J0IHtcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgQ29tcG9uZW50LFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3QsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgT3V0cHV0LFxuICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBDOHlTdGVwcGVyIH0gZnJvbSAnLi9zdGVwcGVyLmNvbXBvbmVudCc7XG5cbi8qKlxuICogQzh5U3RlcHBlckJ1dHRvbnMgcHJvdmlkZXMgYSBjb252aW5pZW50IHdheSB0byBoYXZlLCBhY2NvcmRpbmcgdG9cbiAqIHRoZSBDOHlTdGVwcGVyIGFuZCBlYWNoIGNkay1zdGVwLCBidXR0b25zIHRvIG5hdmlnYXRlIGJldHdlZW4gc3RlcHMgb3IgdG8gY2FuY2VsIHRoZSB3aG9sZVxuICogc3RlcC1wcm9jZXNzLiBCdXR0b25zIHJlbmRlcmVkIHdpdGggdGhlIGhlbHAgb2YgdGhpcyBjb21wb25lbnQgd2lsbCB1c2UgdGhlIGJyYW5kaW5nIGNzcy5cbiAqXG4gKiBCeSBkZWZhdWx0IGFsbCBzdGVwcyB3aXRoIHRoaXMgY29tcG9uZW50IGluIHVzZSB3aWxsIHJlbmRlciBhIG5leHQgYnV0dG9uLCBleHBlY3QgdGhlIGxhc3Qgc3RlcC5cbiAqIFRoZSBvdGhlciB3YXkgYXJvdW5kLCBldmVyeSBzdGVwIHVzaW5nIHRoaXMgY29tcG9uZW50IHdpbGwgcmVuZGVyIGEgYmFjayBidXR0b24sIGV4cGVjdCB0aGUgZmlyc3Qgc3RlcC5cbiAqIFRvIGdldCBhIGNhbmNlbCBidXR0b24gcmVuZGVyZWQgeW91IG5lZWQgdG8gaGFuZGxlIHRoZSBvbkNhbmNlbCBldmVudC5cbiAqIEZvciBuZXh0IGFuZCBiYWNrIGJ1dHRvbiB5b3UgZG9uJ3QgbmVlZCB0byBoYW5kbGUgdGhlIGF2YWlsYWJsZSBldmVudHMgb25OZXh0IGFuZCBvbkJhY2sgYmVjYXVzZSBkZWZhdWx0IGJlaGF2aW9yXG4gKiBpcyBpbXBsZW1lbnRlZC4gVGhlIGRlZmF1bHQgd2lsbCBqdXN0IGNhbGwsIGFjY29yZGluZyB0byB0aGUgYnV0dG9uLCB0aGUgc3RlcHBlci5uZXh0KCkgb3Igc3RlcHBlci5wcmV2aW91cygpXG4gKiBtZXRob2RzIGFuZCBtb3ZlcyB0aGUgc3RlcHBlciBmb3J0aCBvciBiYWNrLiBVc2luZyB0aGUgRXZlbnRFbWl0dGVyIG9uTmV4dCBhbmQgb25CYWNrIHdpbGwgZW1pdCBmb3IgeW91IHRoZSBmb2xsb3dpbmdcbiAqIG9iamVjdDoge3N0ZXBwZXI6IEM4eVN0ZXBwZXIsIHN0ZXA6IENka1N0ZXB9LiBUaGlzIGlzIHVzZWZ1bCBpZiB5b3UgbmVlZCB0byBpbXBsZW1lbnQgY3VzdG9tIGxvZ2ljIGJlZm9yZSBtb3ZpbmdcbiAqIHRvIHRoZSBuZXh0IHN0ZXAgb3Igc2VuZGluZyBkYXRhIHRvIGEgYmFja2VuZC4gSW4gdGhpcyBjYXNlIHlvdSBuZWVkIHRvIHRlbGwgdGhlIHN0ZXBwZXIgdG8gbW92ZSBmb3J3YXJkIG9yIGJhY2tcbiAqIG9uIHlvdXIgb3duLlxuICpcbiAqIFdpdGggdGhlIGNvbXBvbmVudCBpbnB1dCBbbGFiZWxzXSB5b3UgY2FuIGNoYW5nZSB0aGUgbGFiZWwgb2YgZWFjaCBidXR0b24gaW4gZWFjaCBzdGVwLiBJdCB0YWtlcyBhbiBvYmplY3QgbGlrZSB0aGlzOlxuICoge25leHQ/OiBzdHJpbmcsIGJhY2s/OiBzdHJpbmcsIGNhbmNlbD86IHN0cmluZ31cbiAqXG4gKiBUaGUgW3BlbmRpbmddIGlucHV0IGlzIG9mIHR5cGUgYm9vbGVhbiBhbmQgd2lsbCBlbmFibGUgY3NzIGFuaW1hdGlvbiBmb3IgdGhlIG5leHQgYnV0dG9uIHdoZW4gdHJ1ZS5cbiAqXG4gKiBJZiB0aGUgY2RrLXN0ZXAgcHJvdmlkZXMgYSBzdGVwQ29udHJvbCB0aGUgY29tcG9uZW50IHdpbGwgc2V0IHRoZSBuZXh0IGJ1dHRvbiBkaXNhYmxlZCB3aGVuIHRoZSBmb3JtR3JvdXBcbiAqIGJlaGluZCBpdCBpcyBpbnZhbGlkLiBBcyBsb25nIGFzIHRoZSBbcGVuZGluZ10gaW5wdXQgaXMgdHJ1ZSB0aGUgYmFjayBhbmQgbmV4dCBidXR0b24gaXMgYWxzbyBkaXNhYmxlZC5cbiAqIFRoaXMgd2lsbCBwcmV2ZW50IG11bHRpcGxlIGNsaWNrcyB3aGlsZSBydW5uaW5nIGEgcmVxdWVzdCBvciBzdGVwcGluZyBiYWNrIHdoaWxlIGEgcmVxdWVzdCBpcyBvbmdvaW5nLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBcbiAqIDxjOHktc3RlcHBlcj5cbiAqICA8Y2RrLXN0ZXA+XG4gKiAgICA8IS0tXG4gKiAgICAgIHlvdXIgaHRtbCBjb2RlXG4gKiAgICAgICAgICAuLi5cbiAqICAgICAgICAgIC4uLiAgICAtLT5cbiAqICAgIDxjOHktc3RlcHBlci1idXR0b25zXG4gKiAgICAgKG9uTmV4dCk9XCJzYXZlKClcIlxuICogICAgIFtsYWJlbHNdPVwieyBuZXh0OiAnU2F2ZScgfVwiXG4gKiAgICAgW3BlbmRpbmddPVwicGVuZGluZ1N0YXR1c1wiXG4gKiAgICAgPjwvYzh5LXN0ZXBwZXItYnV0dG9ucz5cbiAqICA8L2Nkay1zdGVwPlxuICogPC9jOHktc3RlcHBlcj5cbiAqXG4gKiAvLyBpbiB5b3VyIGNvbXBvbmVudDpcbiAqIGFzeW5jIHNhdmUoKSB7XG4gKiAgIHRoaXMucGVuZGluZ1N0YXR1cyA9IHRydWU7XG4gKiAgIC8vIHlvdXIgYXN5bmMgcmVxdWVzdCBnb2VzIGhlcmUgLi4uXG4gKiAgIC8vIGF3YWl0IHNvbWV0aGluZygpO1xuICogICB0aGlzLnBlbmRpbmdTdGF0dXMgPSBmYWxzZTtcbiAqICAgdGhpcy5zdGVwcGVyLm5leHQoKTtcbiAqIH1cbiAqIGBgYFxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktc3RlcHBlci1idXR0b25zJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3N0ZXBwZXItYnV0dG9ucy5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgQzh5U3RlcHBlckJ1dHRvbnMgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcyB7XG4gIC8qKlxuICAgKiBPcHRpb25hbFxuICAgKiBTcGVjaWZ5IGN1c3RvbSBsYWJlbHMgZm9yIGVhY2ggYnV0dG9uIChjYW5jZWwsIGJhY2sgb3IgbmV4dClcbiAgICovXG4gIEBJbnB1dCgpIGxhYmVscz86IHsgY2FuY2VsPzogc3RyaW5nOyBiYWNrPzogc3RyaW5nOyBuZXh0Pzogc3RyaW5nOyBjdXN0b20/OiBzdHJpbmcgfTtcbiAgLyoqXG4gICAqIE9wdGlvbmFsXG4gICAqIEluZGljYXRlcyBpZiBhIHJlcXVlc3QgaXMgcGVuZGluZyBhbmQgc2V0cyB0aGUgbmV4dCBidXR0b25cbiAgICogdG8gZGlzYWJsZWQgd2hlbiB0cnVlXG4gICAqL1xuICBASW5wdXQoKSBwZW5kaW5nPzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBEaXNhYmxlZCBzdGF0ZSBvZiBhIGJ1dHRvblxuICAgKi9cbiAgQElucHV0KCkgZGlzYWJsZWQ/OiBib29sZWFuID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEV2ZW50RW1pdHRlciB3aGljaCBlbWl0cyB3aGVuIGNhbmNlbCBidXR0b24gaXMgY2xpY2tlZFxuICAgKi9cbiAgQE91dHB1dCgpIG9uQ2FuY2VsID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAvKipcbiAgICogRXZlbnRFbWl0dGVyIHdoaWNoIGVtaXRzIHtzdGVwcGVyOiBDOHlTdGVwcGVyOyBzdGVwOiBDZGtTdGVwfSB3aGVuIG5leHQgYnV0dG9uIGlzIGNsaWNrZWQuXG4gICAqL1xuICBAT3V0cHV0KCkgb25OZXh0ID0gbmV3IEV2ZW50RW1pdHRlcjx7IHN0ZXBwZXI6IEM4eVN0ZXBwZXI7IHN0ZXA6IENka1N0ZXAgfT4oKTtcblxuICAvKipcbiAgICogRXZlbnRFbWl0dGVyIHdoaWNoIGVtaXRzIHtzdGVwcGVyOiBDOHlTdGVwcGVyOyBzdGVwOiBDZGtTdGVwfSB3aGVuIGJhY2sgYnV0dG9uIGlzIGNsaWNrZWQuXG4gICAqL1xuICBAT3V0cHV0KCkgb25CYWNrID0gbmV3IEV2ZW50RW1pdHRlcjx7IHN0ZXBwZXI6IEM4eVN0ZXBwZXI7IHN0ZXA6IENka1N0ZXAgfT4oKTtcblxuICAvKipcbiAgICogRXZlbnRFbWl0dGVyIHdoaWNoIGVtaXRzIHdoZW4gdGhlIG9wdGlvbmFsIGN1c3RvbSBidXR0b24gaXMgY2xpY2tlZFxuICAgKi9cbiAgQE91dHB1dCgpIG9uQ3VzdG9tID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qKlxuICAgKiBJbmRpY2F0b3Igd2hpY2ggYnV0dG9uIHNob3VsZCBiZSBzaG93bi5cbiAgICogQmFzZWQgb24gdGhlIGNkay1zdGVwcyB3aXRoaW4gdGhlIGM4eS1zdGVwcGVyXG4gICAqIG5leHQgYW5kIGJhY2sgYnV0dG9ucyBhcmUgcmVuZGVyZWQuXG4gICAqL1xuICBzaG93QnRucyA9IHtcbiAgICBjYW5jZWw6IGZhbHNlLFxuICAgIGJhY2s6IGZhbHNlLFxuICAgIG5leHQ6IGZhbHNlLFxuICAgIGN1c3RvbTogZmFsc2VcbiAgfTtcblxuICBwcml2YXRlIHN0YXR1c0NoYW5nZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gIGNvbnN0cnVjdG9yKEBIb3N0KCkgcHJpdmF0ZSBzdGVwcGVyOiBDOHlTdGVwcGVyLCBASG9zdCgpIHByaXZhdGUgc3RlcDogQ2RrU3RlcCkge31cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgdGhpcy5zaG93QnRucy5jYW5jZWwgPSB0aGlzLm9uQ2FuY2VsLm9ic2VydmVycy5sZW5ndGggPiAwO1xuICAgIHRoaXMuc2hvd0J0bnMuY3VzdG9tID0gdGhpcy5vbkN1c3RvbS5vYnNlcnZlcnMubGVuZ3RoID4gMDtcblxuICAgIGlmICh0aGlzLnN0ZXBwZXIgJiYgdGhpcy5zdGVwcGVyLnN0ZXBzICYmIHRoaXMuc3RlcCkge1xuICAgICAgdGhpcy5zaG93QnRucy5iYWNrID0gdGhpcy5zdGVwcGVyLnN0ZXBzLmZpcnN0ICE9PSB0aGlzLnN0ZXA7XG4gICAgICB0aGlzLnNob3dCdG5zLm5leHQgPSB0aGlzLnN0ZXBwZXIuc3RlcHMubGFzdCAhPT0gdGhpcy5zdGVwO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnN0ZXAgJiYgdGhpcy5zdGVwLnN0ZXBDb250cm9sKSB7XG4gICAgICB0aGlzLmRpc2FibGVkID0gdGhpcy5zdGVwLnN0ZXBDb250cm9sLmludmFsaWQ7XG5cbiAgICAgIHRoaXMuc3RhdHVzQ2hhbmdlU3Vic2NyaXB0aW9uID0gdGhpcy5zdGVwLnN0ZXBDb250cm9sLnN0YXR1c0NoYW5nZXMuc3Vic2NyaWJlKHN0YXR1cyA9PiB7XG4gICAgICAgIHRoaXMuZGlzYWJsZWQgPSB0aGlzLnN0ZXAuc3RlcENvbnRyb2wuaW52YWxpZDtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAvKipcbiAgICAgKiBEaXNhYmxlIHNhdmUvbmV4dCBidXR0b24gd2hpbGUgdGhlIHN0YXR1cyBpcyBwZW5kaW5nXG4gICAgICogVGhpcyB3aWxsIHByZXZlbnQgbXVsdGlwbGUgY2xpY2tzIGFuZCB0aGVyZWZvcmUgbXVsdGlwbGUgcmVxdWVzdHNcbiAgICAgKi9cbiAgICBpZiAoY2hhbmdlcyAmJiBjaGFuZ2VzLnBlbmRpbmcpIHtcbiAgICAgIHRoaXMuZGlzYWJsZWQgPSBjaGFuZ2VzLnBlbmRpbmcuY3VycmVudFZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLnN0YXR1c0NoYW5nZVN1YnNjcmlwdGlvbiAmJiAhdGhpcy5zdGF0dXNDaGFuZ2VTdWJzY3JpcHRpb24uY2xvc2VkKSB7XG4gICAgICB0aGlzLnN0YXR1c0NoYW5nZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGNhbGxlZCB3aGVuIGNhbmNlbCBidXR0b24gaXMgY2xpY2tlZC5cbiAgICogSXQgd2lsbCBlbWl0IGltbWVkaWF0ZS5cbiAgICovXG4gIGNhbmNlbCgpIHtcbiAgICB0aGlzLm9uQ2FuY2VsLmVtaXQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGNhbGxlZCB3aGVuIG5leHQgYnV0dG9uIGlzIGNsaWNrZWQuIFdoZW4gb25OZXh0IEV2ZW50RW1pdHRlciBoYXMgYW4gb2JzZXJ2ZXIgcmVnaXN0ZXJlZFxuICAgKiBpdCB3aWxsIGVtaXQgdGhlIGZvbGxvd2luZyBvYmplY3Qge3N0ZXBwZXI6IEM4eVN0ZXBwZXI7IHN0ZXA6IENka1N0ZXB9LlxuICAgKiBPdGhlcndpc2UgaXQgd2lsbCBjYWxsIHN0ZXBwZXIubmV4dCgpIGFzIGRlZmF1bHQuXG4gICAqL1xuICBuZXh0KCkge1xuICAgIGlmICh0aGlzLm9uTmV4dC5vYnNlcnZlcnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5vbk5leHQuZW1pdCh7IHN0ZXBwZXI6IHRoaXMuc3RlcHBlciwgc3RlcDogdGhpcy5zdGVwIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN0ZXBwZXIubmV4dCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGNhbGxlZCB3aGVuIGJhY2sgYnV0dG9uIGlzIGNsaWNrZWQuIFdoZW4gb25CYWNrIEV2ZW50RW1pdHRlciBoYXMgYW4gb2JzZXJ2ZXIgcmVnaXN0ZXJlZFxuICAgKiBpdCB3aWxsIGVtaXQgdGhlIGZvbGxvd2luZyBvYmplY3Qge3N0ZXBwZXI6IEM4eVN0ZXBwZXI7IHN0ZXA6IENka1N0ZXB9LlxuICAgKiBPdGhlcndpc2UgaXQgd2lsbCBjYWxsIHN0ZXBwZXIucHJldmlvdXMoKSBhcyBkZWZhdWx0LlxuICAgKi9cbiAgYmFjaygpIHtcbiAgICB0aGlzLnN0ZXBwZXIuc2VsZWN0ZWQuY29tcGxldGVkID0gZmFsc2U7XG4gICAgaWYgKHRoaXMub25CYWNrLm9ic2VydmVycy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLm9uQmFjay5lbWl0KHsgc3RlcHBlcjogdGhpcy5zdGVwcGVyLCBzdGVwOiB0aGlzLnN0ZXAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3RlcHBlci5wcmV2aW91cygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGNhbGxlZCB3aGVuIHRoZSBjdXN0b20gYnV0dG9uIGlzIGNsaWNrZWQuXG4gICAqIEl0IHdpbGwgZW1pdCBpbW1lZGlhdGVseS5cbiAgICovXG4gIGN1c3RvbSgpIHtcbiAgICB0aGlzLm9uQ3VzdG9tLmVtaXQoKTtcbiAgfVxufVxuIl19