import * as tslib_1 from "tslib";
import { Component, ContentChild, HostBinding, Input } from '@angular/core';
import { NgModel } from '@angular/forms';
import { timer, merge } from 'rxjs';
import { debounce, filter } from 'rxjs/operators';
import { MessagesComponent } from './messages.component';
/**
 * A form group helps to validate an input of a form element.
 *
 * ## Example:
 *
 * ```html
 *  <c8y-form-group [hasWarning]="user.email.length === 0">
 *   <label translate for="userEmail">Email</label>
 *   <input
 *     id="userEmail"
 *     class="form-control"
 *     type="email"
 *     name="email"
 *     [maxlength]="254"
 *     autocomplete="off"
 *     placeholder="{{'e.g. joe.doe@example.com' | translate}}"
 *     [(ngModel)]="user.email"
 *     email
 *     required
 *   >
 *   <c8y-messages>
 *     <c8y-message *ngIf="user.email.length === 0" translate></c8y-message>
 *     <c8y-message name="required" text="The E-Mail is SUPER required"></c8y-message>
 *   </c8y-messages>
 *  </c8y-form-group>
 * ```
 *
 * @param status The current status could be error, warning or success.
 * @param hasError Set this to true to display a error.
 * @param hasWarning Set this to true to display a warning.
 * @param hasSuccess Set this to true to display a success.
 * @param novalidation Set this to true to disable automatic validation by this component.
 */
var FormGroupComponent = /** @class */ (function () {
    function FormGroupComponent() {
        this.hasError = false;
        this.hasWarning = false;
        this.hasSuccess = false;
        this.novalidation = false;
        this.VALIDATION_DEBOUNCE_MS = 1000;
    }
    Object.defineProperty(FormGroupComponent.prototype, "error", {
        get: function () {
            return this.status === 'error' || this.hasError;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FormGroupComponent.prototype, "warning", {
        get: function () {
            return this.status === 'warning' || this.hasWarning;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FormGroupComponent.prototype, "success", {
        get: function () {
            return this.status === 'success' || this.hasSuccess;
        },
        enumerable: true,
        configurable: true
    });
    FormGroupComponent.prototype.ngAfterContentInit = function () {
        this.initNgModel();
    };
    FormGroupComponent.prototype.initNgModel = function () {
        var _this = this;
        if (this.model) {
            this.model.valueAccessor.registerOnTouched(function () {
                if (_this.model.control && !_this.model.control.dirty) {
                    _this.model.control.markAsDirty();
                    _this.model.control.updateValueAndValidity({ onlySelf: true });
                }
            });
            this.subscription = merge(this.model.valueChanges, this.model.statusChanges)
                .pipe(filter(function () { return _this.model.dirty && !_this.novalidation; }), debounce(function () { return (_this.hasError ? timer(10) : timer(_this.VALIDATION_DEBOUNCE_MS)); }))
                .subscribe(function () { return _this.update(); });
        }
    };
    FormGroupComponent.prototype.update = function () {
        this.hasError = this.model.status === 'INVALID';
        if (this.customErrorMessage) {
            this.customErrorMessage.changVisibility(this.model.errors);
        }
        else {
            this.errors = this.model.errors;
        }
    };
    FormGroupComponent.prototype.ngOnDestroy = function () {
        if (this.subscription) {
            this.subscription.unsubscribe();
        }
    };
    tslib_1.__decorate([
        Input()
    ], FormGroupComponent.prototype, "hasError", void 0);
    tslib_1.__decorate([
        Input()
    ], FormGroupComponent.prototype, "hasWarning", void 0);
    tslib_1.__decorate([
        Input()
    ], FormGroupComponent.prototype, "hasSuccess", void 0);
    tslib_1.__decorate([
        Input()
    ], FormGroupComponent.prototype, "novalidation", void 0);
    tslib_1.__decorate([
        Input()
    ], FormGroupComponent.prototype, "status", void 0);
    tslib_1.__decorate([
        HostBinding('class.has-error')
    ], FormGroupComponent.prototype, "error", null);
    tslib_1.__decorate([
        HostBinding('class.has-warning')
    ], FormGroupComponent.prototype, "warning", null);
    tslib_1.__decorate([
        HostBinding('class.has-success')
    ], FormGroupComponent.prototype, "success", null);
    tslib_1.__decorate([
        ContentChild(MessagesComponent, { static: false })
    ], FormGroupComponent.prototype, "customErrorMessage", void 0);
    tslib_1.__decorate([
        ContentChild(NgModel, { static: true })
    ], FormGroupComponent.prototype, "model", void 0);
    FormGroupComponent = tslib_1.__decorate([
        Component({
            selector: 'c8y-form-group',
            template: "<ng-content></ng-content>\n<c8y-messages *ngIf=\"!customErrorMessage\" [show]=\"errors\"></c8y-messages>\n",
            host: {
                class: 'form-group'
            }
        })
    ], FormGroupComponent);
    return FormGroupComponent;
}());
export { FormGroupComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1ncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYzh5L25neC1jb21wb25lbnRzLyIsInNvdXJjZXMiOlsiY29yZS9mb3Jtcy9mb3JtLWdyb3VwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1RSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekMsT0FBTyxFQUFnQixLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2xELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDekQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBZ0NHO0FBUUg7SUFQQTtRQVFXLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUNuQixlQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ25CLGlCQUFZLEdBQUcsS0FBSyxDQUFDO1FBZ0JiLDJCQUFzQixHQUFHLElBQUksQ0FBQztJQXFDakQsQ0FBQztJQW5EaUMsc0JBQUkscUNBQUs7YUFBVDtZQUM5QixPQUFPLElBQUksQ0FBQyxNQUFNLEtBQUssT0FBTyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDbEQsQ0FBQzs7O09BQUE7SUFDaUMsc0JBQUksdUNBQU87YUFBWDtZQUNoQyxPQUFPLElBQUksQ0FBQyxNQUFNLEtBQUssU0FBUyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDdEQsQ0FBQzs7O09BQUE7SUFDaUMsc0JBQUksdUNBQU87YUFBWDtZQUNoQyxPQUFPLElBQUksQ0FBQyxNQUFNLEtBQUssU0FBUyxJQUFJLElBQUksQ0FBQyxV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QUFBLEFBekRELElBeURDO1NBekRZLGtCQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ29udGVudENoaWxkLCBIb3N0QmluZGluZywgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5nTW9kZWwgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24sIHRpbWVyLCBtZXJnZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZGVib3VuY2UsIGZpbHRlciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE1lc3NhZ2VzQ29tcG9uZW50IH0gZnJvbSAnLi9tZXNzYWdlcy5jb21wb25lbnQnO1xuLyoqXG4gKiBBIGZvcm0gZ3JvdXAgaGVscHMgdG8gdmFsaWRhdGUgYW4gaW5wdXQgb2YgYSBmb3JtIGVsZW1lbnQuXG4gKlxuICogIyMgRXhhbXBsZTpcbiAqXG4gKiBgYGBodG1sXG4gKiAgPGM4eS1mb3JtLWdyb3VwIFtoYXNXYXJuaW5nXT1cInVzZXIuZW1haWwubGVuZ3RoID09PSAwXCI+XG4gKiAgIDxsYWJlbCB0cmFuc2xhdGUgZm9yPVwidXNlckVtYWlsXCI+RW1haWw8L2xhYmVsPlxuICogICA8aW5wdXRcbiAqICAgICBpZD1cInVzZXJFbWFpbFwiXG4gKiAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIlxuICogICAgIHR5cGU9XCJlbWFpbFwiXG4gKiAgICAgbmFtZT1cImVtYWlsXCJcbiAqICAgICBbbWF4bGVuZ3RoXT1cIjI1NFwiXG4gKiAgICAgYXV0b2NvbXBsZXRlPVwib2ZmXCJcbiAqICAgICBwbGFjZWhvbGRlcj1cInt7J2UuZy4gam9lLmRvZUBleGFtcGxlLmNvbScgfCB0cmFuc2xhdGV9fVwiXG4gKiAgICAgWyhuZ01vZGVsKV09XCJ1c2VyLmVtYWlsXCJcbiAqICAgICBlbWFpbFxuICogICAgIHJlcXVpcmVkXG4gKiAgID5cbiAqICAgPGM4eS1tZXNzYWdlcz5cbiAqICAgICA8Yzh5LW1lc3NhZ2UgKm5nSWY9XCJ1c2VyLmVtYWlsLmxlbmd0aCA9PT0gMFwiIHRyYW5zbGF0ZT48L2M4eS1tZXNzYWdlPlxuICogICAgIDxjOHktbWVzc2FnZSBuYW1lPVwicmVxdWlyZWRcIiB0ZXh0PVwiVGhlIEUtTWFpbCBpcyBTVVBFUiByZXF1aXJlZFwiPjwvYzh5LW1lc3NhZ2U+XG4gKiAgIDwvYzh5LW1lc3NhZ2VzPlxuICogIDwvYzh5LWZvcm0tZ3JvdXA+XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gc3RhdHVzIFRoZSBjdXJyZW50IHN0YXR1cyBjb3VsZCBiZSBlcnJvciwgd2FybmluZyBvciBzdWNjZXNzLlxuICogQHBhcmFtIGhhc0Vycm9yIFNldCB0aGlzIHRvIHRydWUgdG8gZGlzcGxheSBhIGVycm9yLlxuICogQHBhcmFtIGhhc1dhcm5pbmcgU2V0IHRoaXMgdG8gdHJ1ZSB0byBkaXNwbGF5IGEgd2FybmluZy5cbiAqIEBwYXJhbSBoYXNTdWNjZXNzIFNldCB0aGlzIHRvIHRydWUgdG8gZGlzcGxheSBhIHN1Y2Nlc3MuXG4gKiBAcGFyYW0gbm92YWxpZGF0aW9uIFNldCB0aGlzIHRvIHRydWUgdG8gZGlzYWJsZSBhdXRvbWF0aWMgdmFsaWRhdGlvbiBieSB0aGlzIGNvbXBvbmVudC5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LWZvcm0tZ3JvdXAnLFxuICB0ZW1wbGF0ZVVybDogJy4vZm9ybS1ncm91cC5jb21wb25lbnQuaHRtbCcsXG4gIGhvc3Q6IHtcbiAgICBjbGFzczogJ2Zvcm0tZ3JvdXAnXG4gIH1cbn0pXG5leHBvcnQgY2xhc3MgRm9ybUdyb3VwQ29tcG9uZW50IHtcbiAgQElucHV0KCkgaGFzRXJyb3IgPSBmYWxzZTtcbiAgQElucHV0KCkgaGFzV2FybmluZyA9IGZhbHNlO1xuICBASW5wdXQoKSBoYXNTdWNjZXNzID0gZmFsc2U7XG4gIEBJbnB1dCgpIG5vdmFsaWRhdGlvbiA9IGZhbHNlO1xuICBASW5wdXQoKSBzdGF0dXM6IHN0cmluZztcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5oYXMtZXJyb3InKSBnZXQgZXJyb3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdHVzID09PSAnZXJyb3InIHx8IHRoaXMuaGFzRXJyb3I7XG4gIH1cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5oYXMtd2FybmluZycpIGdldCB3YXJuaW5nKCkge1xuICAgIHJldHVybiB0aGlzLnN0YXR1cyA9PT0gJ3dhcm5pbmcnIHx8IHRoaXMuaGFzV2FybmluZztcbiAgfVxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmhhcy1zdWNjZXNzJykgZ2V0IHN1Y2Nlc3MoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdHVzID09PSAnc3VjY2VzcycgfHwgdGhpcy5oYXNTdWNjZXNzO1xuICB9XG4gIEBDb250ZW50Q2hpbGQoTWVzc2FnZXNDb21wb25lbnQsIHsgc3RhdGljOiBmYWxzZSB9KSBjdXN0b21FcnJvck1lc3NhZ2U6IE1lc3NhZ2VzQ29tcG9uZW50O1xuICBAQ29udGVudENoaWxkKE5nTW9kZWwsIHsgc3RhdGljOiB0cnVlIH0pIG1vZGVsOiBOZ01vZGVsO1xuXG4gIGVycm9yczoge307XG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIHByaXZhdGUgcmVhZG9ubHkgVkFMSURBVElPTl9ERUJPVU5DRV9NUyA9IDEwMDA7XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuaW5pdE5nTW9kZWwoKTtcbiAgfVxuXG4gIGluaXROZ01vZGVsKCkge1xuICAgIGlmICh0aGlzLm1vZGVsKSB7XG4gICAgICB0aGlzLm1vZGVsLnZhbHVlQWNjZXNzb3IucmVnaXN0ZXJPblRvdWNoZWQoKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5tb2RlbC5jb250cm9sICYmICF0aGlzLm1vZGVsLmNvbnRyb2wuZGlydHkpIHtcbiAgICAgICAgICB0aGlzLm1vZGVsLmNvbnRyb2wubWFya0FzRGlydHkoKTtcbiAgICAgICAgICB0aGlzLm1vZGVsLmNvbnRyb2wudXBkYXRlVmFsdWVBbmRWYWxpZGl0eSh7b25seVNlbGY6IHRydWV9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbiA9IG1lcmdlKHRoaXMubW9kZWwudmFsdWVDaGFuZ2VzLCB0aGlzLm1vZGVsLnN0YXR1c0NoYW5nZXMpXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIGZpbHRlcigoKSA9PiB0aGlzLm1vZGVsLmRpcnR5ICYmICF0aGlzLm5vdmFsaWRhdGlvbiksXG4gICAgICAgICAgZGVib3VuY2UoKCkgPT4gKHRoaXMuaGFzRXJyb3IgPyB0aW1lcigxMCkgOiB0aW1lcih0aGlzLlZBTElEQVRJT05fREVCT1VOQ0VfTVMpKSlcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMudXBkYXRlKCkpO1xuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZSgpIHtcbiAgICB0aGlzLmhhc0Vycm9yID0gdGhpcy5tb2RlbC5zdGF0dXMgPT09ICdJTlZBTElEJztcbiAgICBpZiAodGhpcy5jdXN0b21FcnJvck1lc3NhZ2UpIHtcbiAgICAgIHRoaXMuY3VzdG9tRXJyb3JNZXNzYWdlLmNoYW5nVmlzaWJpbGl0eSh0aGlzLm1vZGVsLmVycm9ycyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZXJyb3JzID0gdGhpcy5tb2RlbC5lcnJvcnM7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxufVxuIl19