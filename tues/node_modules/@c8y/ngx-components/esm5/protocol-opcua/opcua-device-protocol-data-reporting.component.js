import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { set, unset, toInteger } from 'lodash';
import { gettext } from '@c8y/ngx-components';
import { ControlContainer, NgModelGroup } from '@angular/forms';
var OpcuaDeviceProtocolDataReportingComponent = /** @class */ (function () {
    function OpcuaDeviceProtocolDataReportingComponent() {
        this.onSubscriptionChange = new EventEmitter();
        this.subscription = {
            type: 'None'
        };
        this.subscriptionParameters = {
            samplingRate: undefined,
            deadbandType: 'None',
            deadbandValue: undefined,
            ranges: '',
            queueSize: undefined,
            dataChangeTrigger: 'Status',
            discardOldest: true
        };
        this.cyclicReadParameters = {
            rate: undefined
        };
        this.types = [
            { value: 'None', label: gettext('None') },
            { value: 'CyclicRead', label: gettext('Cyclic read') },
            { value: 'Subscription', label: gettext('Subscription') }
        ];
        this.filters = [
            { value: 'None', label: gettext('None') },
            { value: 'absolute', label: gettext('Absolute') },
            { value: 'percent', label: gettext('Percent') }
        ];
        this.triggers = [
            { value: 'Status', label: gettext('Status') },
            { value: 'StatusValue', label: gettext('Status/Value') },
            { value: 'StatusValueTimestamp', label: gettext('Status/Value/Timestamp') }
        ];
        this.discard = [
            { value: true, label: gettext('oldest`data`') },
            { value: false, label: gettext('newest`data`') }
        ];
        this.requireCyclic = false;
        this.requireSubscription = false;
        this.subscriptionTypeName = 'subscriptionType';
        this.parseReadingInterval = function ($event) { return toInteger($event.target.value); };
    }
    Object.defineProperty(OpcuaDeviceProtocolDataReportingComponent.prototype, "model", {
        set: function (_model) {
            if (_model.subscriptionType) {
                this.subscription = _model.subscriptionType;
                if (this.subscription.type === 'CyclicRead') {
                    this.cyclicReadParameters = _model.subscriptionType.cyclicReadParameters;
                    this.requireCyclic = true;
                    this.requireSubscription = false;
                }
                if (this.subscription.type === 'Subscription') {
                    this.subscriptionParameters = _model.subscriptionType.subscriptionParameters;
                    this.requireCyclic = false;
                    this.requireSubscription = true;
                }
                if (this.subscription.type === 'None') {
                    this.requireCyclic = false;
                    this.requireSubscription = false;
                }
            }
            this._model = _model;
            this.subscriptionTypeName = 'subscriptionType' + _model.id;
        },
        enumerable: true,
        configurable: true
    });
    OpcuaDeviceProtocolDataReportingComponent.prototype.updateModel = function () {
        var _this = this;
        setTimeout(function () {
            unset(_this.subscription, 'subscriptionParameters');
            unset(_this.subscription, 'cyclicReadParameters');
            if (_this.subscription.type === 'CyclicRead') {
                _this.requireCyclic = true;
                _this.requireSubscription = false;
                set(_this.subscription, 'cyclicReadParameters', _this.cyclicReadParameters);
            }
            else if (_this.subscription.type === 'Subscription') {
                _this.requireCyclic = false;
                _this.requireSubscription = true;
                set(_this.subscription, 'subscriptionParameters', _this.subscriptionParameters);
            }
            else if (_this.subscription.type === 'None') {
                _this.requireCyclic = false;
                _this.requireSubscription = false;
            }
        });
    };
    tslib_1.__decorate([
        Input()
    ], OpcuaDeviceProtocolDataReportingComponent.prototype, "model", null);
    tslib_1.__decorate([
        Input()
    ], OpcuaDeviceProtocolDataReportingComponent.prototype, "groupName", void 0);
    tslib_1.__decorate([
        Output()
    ], OpcuaDeviceProtocolDataReportingComponent.prototype, "onSubscriptionChange", void 0);
    OpcuaDeviceProtocolDataReportingComponent = tslib_1.__decorate([
        Component({
            selector: 'opcua-device-protocol-data-reporting',
            template: "<c8y-form-group>\n  <label translate>Mechanism</label>\n  <label\n    title=\"{{ mechanism.label | translate }}\"\n    class=\"c8y-radio radio-inline\"\n    *ngFor=\"let mechanism of types\"\n  >\n    <input\n      type=\"radio\"\n      name=\"{{subscriptionTypeName}}\"\n      [value]=\"mechanism.value\"\n      [(ngModel)]=\"subscription.type\"\n      (change)=\"updateModel()\"\n      required\n    />\n    <span></span>\n    <span>{{ mechanism.label | translate }}</span>\n  </label>\n</c8y-form-group>\n\n<div class=\"row collapse\" [collapse]=\"subscription.type != 'CyclicRead'\" [isAnimated]=\"true\">\n  <div class=\"col-sm-6 col-md-4 col-lg-3\">\n    <c8y-form-group>\n      <label translate>Reading interval</label>\n      <div class=\"input-group\">\n        <input\n          class=\"form-control\"\n          type=\"number\"\n          name=\"rate\"\n          [(ngModel)]=\"cyclicReadParameters.rate\"\n          placeholder=\"{{ 'e.g.' | translate }} 50\"\n          [required]=\"requireCyclic\"\n          min=\"50\"\n        />\n        <span class=\"input-group-addon units\" title=\"{{ 'Milliseconds' | translate }}\">\n          {{ 'msec' | translate }}\n        </span>\n      </div>\n    </c8y-form-group>\n  </div>\n</div>\n\n<div class=\"row collapse\" [collapse]=\"subscription.type != 'Subscription'\" [isAnimated]=\"true\">\n  <div class=\"col-sm-6 col-lg-4\">\n    <c8y-form-group>\n      <label translate>Sampling interval</label>\n      <div class=\"input-group\">\n        <input\n          class=\"form-control\"\n          type=\"number\"\n          name=\"samplingRate\"\n          [(ngModel)]=\"subscriptionParameters.samplingRate\"\n          placeholder=\"{{ 'e.g.' | translate }} 500\"\n          [required]=\"requireSubscription\"\n          min=\"0\"\n        />\n        <span class=\"input-group-addon units\" title=\"{{ 'Milliseconds' | translate }}\" translate>\n          msec\n        </span>\n      </div>\n    </c8y-form-group>\n  </div>\n  <div class=\"col-sm-6 col-lg-4\">\n    <c8y-form-group>\n      <label translate>Queue size</label>\n      <div class=\"input-group\">\n        <input\n          class=\"form-control\"\n          type=\"number\"\n          name=\"queueSize\"\n          [(ngModel)]=\"subscriptionParameters.queueSize\"\n          placeholder=\"{{ 'e.g.' | translate }} 10\"\n          min=\"1\"\n        />\n        <span class=\"input-group-addon\">\n          <strong translate>Discard</strong>&nbsp;\n          <label\n            *ngFor=\"let discardOption of discard\"\n            title=\"{{ discardOption.label | translate }}\"\n            class=\"c8y-radio radio-inline\"\n          >\n            <input\n              type=\"radio\"\n              name=\"discard\"\n              [value]=\"discardOption.value\"\n              [(ngModel)]=\"subscriptionParameters.discardOldest\"\n              [required]=\"requireSubscription\"\n            />\n            <span></span>\n            <span>{{ discardOption.label | translate }}</span>\n          </label>\n        </span>\n      </div>\n    </c8y-form-group>\n  </div>\n  <div class=\"clearfix\"></div>\n  <div class=\"col-sm-6 col-lg-4\">\n    <c8y-form-group>\n      <label translate>Data change trigger</label>\n      <label\n        *ngFor=\"let trigger of triggers\"\n        title=\"{{ trigger.label | translate }}\"\n        class=\"c8y-radio radio-inline\"\n      >\n        <input\n          type=\"radio\"\n          name=\"dataChangeTrigger\"\n          [value]=\"trigger.value\"\n          [(ngModel)]=\"subscriptionParameters.dataChangeTrigger\"\n          [required]=\"requireSubscription\"\n        />\n        <span></span>\n        <span>{{ trigger.label | translate }}</span>\n      </label>\n    </c8y-form-group>\n  </div>\n  <div class=\"col-sm-6 col-lg-4\">\n    <c8y-form-group>\n      <label translate>Deadband filter</label>\n      <label\n        *ngFor=\"let deadbandFilter of filters\"\n        title=\"{{ deadbandFilter.label | translate }}\"\n        class=\"c8y-radio radio-inline\"\n      >\n        <input\n          type=\"radio\"\n          name=\"deadbandType\"\n          [value]=\"deadbandFilter.value\"\n          [(ngModel)]=\"subscriptionParameters.deadbandType\"\n          [required]=\"requireSubscription\"\n        />\n        <span></span>\n        <span>{{ deadbandFilter.label | translate }}</span>\n      </label>\n    </c8y-form-group>\n    <div [collapse]=\"subscriptionParameters.deadbandType == 'None'\" [isAnimated]=\"true\">\n      <c8y-form-group>\n        <label translate>Deadband value</label>\n        <input\n          class=\"form-control\"\n          type=\"number\"\n          name=\"deadbandValue\"\n          [(ngModel)]=\"subscriptionParameters.deadbandValue\"\n          placeholder=\"{{ 'e.g.' | translate }} 10\"\n          [required]=\"subscriptionParameters.deadbandType != 'None'\"\n          min=\"0\"\n        />\n      </c8y-form-group>\n    </div>\n  </div>\n</div>\n",
            viewProviders: [{ provide: ControlContainer, useExisting: NgModelGroup }]
        })
    ], OpcuaDeviceProtocolDataReportingComponent);
    return OpcuaDeviceProtocolDataReportingComponent;
}());
export { OpcuaDeviceProtocolDataReportingComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BjdWEtZGV2aWNlLXByb3RvY29sLWRhdGEtcmVwb3J0aW5nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvcHJvdG9jb2wtb3BjdWEvIiwic291cmNlcyI6WyJvcGN1YS1kZXZpY2UtcHJvdG9jb2wtZGF0YS1yZXBvcnRpbmcuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUMvQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDOUMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBT2hFO0lBTEE7UUFnQ1kseUJBQW9CLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFFNUUsaUJBQVksR0FBRztZQUNiLElBQUksRUFBRSxNQUFNO1NBQ2IsQ0FBQztRQUNGLDJCQUFzQixHQUFHO1lBQ3ZCLFlBQVksRUFBRSxTQUFTO1lBQ3ZCLFlBQVksRUFBRSxNQUFNO1lBQ3BCLGFBQWEsRUFBRSxTQUFTO1lBQ3hCLE1BQU0sRUFBRSxFQUFFO1lBQ1YsU0FBUyxFQUFFLFNBQVM7WUFDcEIsaUJBQWlCLEVBQUUsUUFBUTtZQUMzQixhQUFhLEVBQUUsSUFBSTtTQUNwQixDQUFDO1FBRUYseUJBQW9CLEdBQUc7WUFDckIsSUFBSSxFQUFFLFNBQVM7U0FDaEIsQ0FBQztRQUVGLFVBQUssR0FBVTtZQUNiLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ3pDLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLGFB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eyBDb21wb25lbnQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgc2V0LCB1bnNldCwgdG9JbnRlZ2VyIH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGdldHRleHQgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IENvbnRyb2xDb250YWluZXIsIE5nTW9kZWxHcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnb3BjdWEtZGV2aWNlLXByb3RvY29sLWRhdGEtcmVwb3J0aW5nJyxcbiAgdGVtcGxhdGVVcmw6ICcuL29wY3VhLWRldmljZS1wcm90b2NvbC1kYXRhLXJlcG9ydGluZy5odG1sJyxcbiAgdmlld1Byb3ZpZGVyczogW3sgcHJvdmlkZTogQ29udHJvbENvbnRhaW5lciwgdXNlRXhpc3Rpbmc6IE5nTW9kZWxHcm91cCB9XVxufSlcbmV4cG9ydCBjbGFzcyBPcGN1YURldmljZVByb3RvY29sRGF0YVJlcG9ydGluZ0NvbXBvbmVudCB7XG4gIEBJbnB1dCgpIHNldCBtb2RlbChfbW9kZWwpIHtcbiAgICBpZiAoX21vZGVsLnN1YnNjcmlwdGlvblR5cGUpIHtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gX21vZGVsLnN1YnNjcmlwdGlvblR5cGU7XG4gICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb24udHlwZSA9PT0gJ0N5Y2xpY1JlYWQnKSB7XG4gICAgICAgIHRoaXMuY3ljbGljUmVhZFBhcmFtZXRlcnMgPSBfbW9kZWwuc3Vic2NyaXB0aW9uVHlwZS5jeWNsaWNSZWFkUGFyYW1ldGVycztcbiAgICAgICAgdGhpcy5yZXF1aXJlQ3ljbGljID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5yZXF1aXJlU3Vic2NyaXB0aW9uID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbi50eXBlID09PSAnU3Vic2NyaXB0aW9uJykge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvblBhcmFtZXRlcnMgPSBfbW9kZWwuc3Vic2NyaXB0aW9uVHlwZS5zdWJzY3JpcHRpb25QYXJhbWV0ZXJzO1xuICAgICAgICB0aGlzLnJlcXVpcmVDeWNsaWMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZXF1aXJlU3Vic2NyaXB0aW9uID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uLnR5cGUgPT09ICdOb25lJykge1xuICAgICAgICB0aGlzLnJlcXVpcmVDeWNsaWMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZXF1aXJlU3Vic2NyaXB0aW9uID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuX21vZGVsID0gX21vZGVsO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uVHlwZU5hbWUgPSAnc3Vic2NyaXB0aW9uVHlwZScgKyBfbW9kZWwuaWQ7XG4gIH1cbiAgQElucHV0KCkgZ3JvdXBOYW1lO1xuXG4gIF9tb2RlbDogb2JqZWN0O1xuICBAT3V0cHV0KCkgb25TdWJzY3JpcHRpb25DaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgc3Vic2NyaXB0aW9uID0ge1xuICAgIHR5cGU6ICdOb25lJ1xuICB9O1xuICBzdWJzY3JpcHRpb25QYXJhbWV0ZXJzID0ge1xuICAgIHNhbXBsaW5nUmF0ZTogdW5kZWZpbmVkLFxuICAgIGRlYWRiYW5kVHlwZTogJ05vbmUnLFxuICAgIGRlYWRiYW5kVmFsdWU6IHVuZGVmaW5lZCxcbiAgICByYW5nZXM6ICcnLFxuICAgIHF1ZXVlU2l6ZTogdW5kZWZpbmVkLFxuICAgIGRhdGFDaGFuZ2VUcmlnZ2VyOiAnU3RhdHVzJyxcbiAgICBkaXNjYXJkT2xkZXN0OiB0cnVlXG4gIH07XG5cbiAgY3ljbGljUmVhZFBhcmFtZXRlcnMgPSB7XG4gICAgcmF0ZTogdW5kZWZpbmVkXG4gIH07XG5cbiAgdHlwZXM6IGFueVtdID0gW1xuICAgIHsgdmFsdWU6ICdOb25lJywgbGFiZWw6IGdldHRleHQoJ05vbmUnKSB9LFxuICAgIHsgdmFsdWU6ICdDeWNsaWNSZWFkJywgbGFiZWw6IGdldHRleHQoJ0N5Y2xpYyByZWFkJykgfSxcbiAgICB7IHZhbHVlOiAnU3Vic2NyaXB0aW9uJywgbGFiZWw6IGdldHRleHQoJ1N1YnNjcmlwdGlvbicpIH1cbiAgXTtcblxuICBmaWx0ZXJzOiBhbnlbXSA9IFtcbiAgICB7IHZhbHVlOiAnTm9uZScsIGxhYmVsOiBnZXR0ZXh0KCdOb25lJykgfSxcbiAgICB7IHZhbHVlOiAnYWJzb2x1dGUnLCBsYWJlbDogZ2V0dGV4dCgnQWJzb2x1dGUnKSB9LFxuICAgIHsgdmFsdWU6ICdwZXJjZW50JywgbGFiZWw6IGdldHRleHQoJ1BlcmNlbnQnKSB9XG4gIF07XG5cbiAgdHJpZ2dlcnM6IGFueVtdID0gW1xuICAgIHsgdmFsdWU6ICdTdGF0dXMnLCBsYWJlbDogZ2V0dGV4dCgnU3RhdHVzJykgfSxcbiAgICB7IHZhbHVlOiAnU3RhdHVzVmFsdWUnLCBsYWJlbDogZ2V0dGV4dCgnU3RhdHVzL1ZhbHVlJykgfSxcbiAgICB7IHZhbHVlOiAnU3RhdHVzVmFsdWVUaW1lc3RhbXAnLCBsYWJlbDogZ2V0dGV4dCgnU3RhdHVzL1ZhbHVlL1RpbWVzdGFtcCcpIH1cbiAgXTtcblxuICBkaXNjYXJkOiBhbnlbXSA9IFtcbiAgICB7IHZhbHVlOiB0cnVlLCBsYWJlbDogZ2V0dGV4dCgnb2xkZXN0YGRhdGFgJykgfSxcbiAgICB7IHZhbHVlOiBmYWxzZSwgbGFiZWw6IGdldHRleHQoJ25ld2VzdGBkYXRhYCcpIH1cbiAgXTtcblxuICByZXF1aXJlQ3ljbGljOiBib29sZWFuID0gZmFsc2U7XG4gIHJlcXVpcmVTdWJzY3JpcHRpb246IGJvb2xlYW4gPSBmYWxzZTtcbiAgc3Vic2NyaXB0aW9uVHlwZU5hbWUgPSAnc3Vic2NyaXB0aW9uVHlwZSc7XG5cbiAgcGFyc2VSZWFkaW5nSW50ZXJ2YWwgPSAkZXZlbnQgPT4gdG9JbnRlZ2VyKCRldmVudC50YXJnZXQudmFsdWUpO1xuXG4gIHVwZGF0ZU1vZGVsKCkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdW5zZXQodGhpcy5zdWJzY3JpcHRpb24sICdzdWJzY3JpcHRpb25QYXJhbWV0ZXJzJyk7XG4gICAgICB1bnNldCh0aGlzLnN1YnNjcmlwdGlvbiwgJ2N5Y2xpY1JlYWRQYXJhbWV0ZXJzJyk7XG4gICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb24udHlwZSA9PT0gJ0N5Y2xpY1JlYWQnKSB7XG4gICAgICAgIHRoaXMucmVxdWlyZUN5Y2xpYyA9IHRydWU7XG4gICAgICAgIHRoaXMucmVxdWlyZVN1YnNjcmlwdGlvbiA9IGZhbHNlO1xuICAgICAgICBzZXQodGhpcy5zdWJzY3JpcHRpb24sICdjeWNsaWNSZWFkUGFyYW1ldGVycycsIHRoaXMuY3ljbGljUmVhZFBhcmFtZXRlcnMpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLnN1YnNjcmlwdGlvbi50eXBlID09PSAnU3Vic2NyaXB0aW9uJykge1xuICAgICAgICB0aGlzLnJlcXVpcmVDeWNsaWMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZXF1aXJlU3Vic2NyaXB0aW9uID0gdHJ1ZTtcbiAgICAgICAgc2V0KHRoaXMuc3Vic2NyaXB0aW9uLCAnc3Vic2NyaXB0aW9uUGFyYW1ldGVycycsIHRoaXMuc3Vic2NyaXB0aW9uUGFyYW1ldGVycyk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuc3Vic2NyaXB0aW9uLnR5cGUgPT09ICdOb25lJykge1xuICAgICAgICB0aGlzLnJlcXVpcmVDeWNsaWMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZXF1aXJlU3Vic2NyaXB0aW9uID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==