import * as tslib_1 from "tslib";
import { Component, Optional } from '@angular/core';
import { AlertService, ContextRouteComponent, gettext } from '@c8y/ngx-components';
import { TranslateService } from '@ngx-translate/core';
import { OpcuaService } from './opcuaService';
var OpcuaServersComponent = /** @class */ (function () {
    function OpcuaServersComponent(opcuaService, alertService, translateService, context) {
        this.opcuaService = opcuaService;
        this.alertService = alertService;
        this.translateService = translateService;
        this.context = context;
        this.serverObjectList = [];
        this.initialServerObject = {
            id: '',
            name: 'New Server',
            config: {
                securityMode: 'NONE',
                keystorePass: null,
                keystoreBinaryId: null,
                keystoreFilename: '',
                certificatePass: null,
                serverUrl: '',
                userName: '',
                userPassword: '',
                rescanCron: null,
                timeout: null,
                autoReconnect: true,
                statusCheckInterval: null,
                valid: true
            },
            quickInfo: {
                padlock: 'unlock',
                padlockMsg: ''
            },
            active: true
        };
        this.active = false;
        this.moId = '';
        this.NEW_SERVER_ID = 'new';
        this.initialServerObject.id = this.NEW_SERVER_ID;
    }
    OpcuaServersComponent.prototype.ngOnInit = function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var res, data, _a, _b;
            var _this = this;
            return tslib_1.__generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        this.moId = this.opcuaService.getMoId();
                        if (!(this.moId && this.moId.length > 0)) return [3 /*break*/, 7];
                        return [4 /*yield*/, this.opcuaService.getServers(this.moId)];
                    case 1:
                        res = _c.sent();
                        if (!(res && res.status !== 200)) return [3 /*break*/, 5];
                        if (!res.json) return [3 /*break*/, 3];
                        return [4 /*yield*/, res.json()];
                    case 2:
                        _a = _c.sent();
                        return [3 /*break*/, 4];
                    case 3:
                        _a = undefined;
                        _c.label = 4;
                    case 4:
                        data = _a;
                        this.alertService.addServerFailure({ data: data, res: res });
                        return [3 /*break*/, 7];
                    case 5:
                        _b = this;
                        return [4 /*yield*/, res.json()];
                    case 6:
                        _b.serverObjectList = (_c.sent());
                        this.serverObjectList.map(function (server) { return _this.setQuickInfo(server); });
                        _c.label = 7;
                    case 7: return [2 /*return*/];
                }
            });
        });
    };
    OpcuaServersComponent.prototype.localServerObjectExist = function () {
        var _this = this;
        return !!this.serverObjectList.find(function (server) { return server.id === _this.NEW_SERVER_ID; });
    };
    OpcuaServersComponent.prototype.addServer = function () {
        var server = this.initialServerObject;
        this.serverObjectList.push(server);
        this.onPresent(server);
    };
    OpcuaServersComponent.prototype.onSaved = function (server) {
        if (server && server.id) {
            server.gatewayId = this.moId;
            if (server.id === this.NEW_SERVER_ID) {
                this.createServer(server);
            }
            else {
                this.updateServer(server);
            }
        }
    };
    OpcuaServersComponent.prototype.reloadTabs = function () {
        if (this.context) {
            this.context.refreshTabs();
        }
    };
    OpcuaServersComponent.prototype.onCanceled = function (server) {
        if (server && server.id && server.id === this.NEW_SERVER_ID) {
            this.removeServerObjectListById(server.id);
        }
        else {
            // update activity status for UI
            this.serverObjectList.forEach(function (item) {
                if (item.id === server.id) {
                    item.active = false;
                }
            });
            // When server id is not 'new' we just close the details
            delete this.server;
        }
    };
    OpcuaServersComponent.prototype.onRemoved = function (server) {
        if (server.id === this.NEW_SERVER_ID) {
            this.onCanceled(server);
        }
        else {
            this.removeServer(server);
        }
    };
    OpcuaServersComponent.prototype.getKeystore = function (binaryId) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var data;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.opcuaService.getKeystore(binaryId)];
                    case 1:
                        data = (_a.sent()).data;
                        return [2 /*return*/, data];
                }
            });
        });
    };
    OpcuaServersComponent.prototype.onPresent = function (server) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var mo, ex_1;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!(server &&
                            server.id !== this.NEW_SERVER_ID &&
                            server.config &&
                            server.config.keystoreBinaryId)) return [3 /*break*/, 4];
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.getKeystore(server.config.keystoreBinaryId)];
                    case 2:
                        mo = _a.sent();
                        server.config.keystoreFilename = mo.name;
                        return [3 /*break*/, 4];
                    case 3:
                        ex_1 = _a.sent();
                        this.server = Object.assign({}, server);
                        console.log('Could not get existing keystore:', ex_1);
                        return [3 /*break*/, 4];
                    case 4:
                        if (this.serverObjectList.length > 0) {
                            this.serverObjectList.forEach(function (item) {
                                item.active = false;
                                if (item.id === server.id) {
                                    item.active = true;
                                    server.active = item.active;
                                }
                            });
                            this.setQuickInfo(server);
                            this.server = Object.assign({}, server);
                        }
                        return [2 /*return*/];
                }
            });
        });
    };
    OpcuaServersComponent.prototype.createServer = function (server) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var response, svr;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.opcuaService.createServer(server)];
                    case 1:
                        response = _a.sent();
                        return [4 /*yield*/, response.json()];
                    case 2:
                        svr = (_a.sent());
                        this.updateServerObjectListById(this.NEW_SERVER_ID, svr);
                        this.reloadTabs();
                        return [2 /*return*/];
                }
            });
        });
    };
    OpcuaServersComponent.prototype.updateServer = function (server) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var updatedServer;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.opcuaService.updateServer(server)];
                    case 1:
                        updatedServer = (_a.sent());
                        if (updatedServer) {
                            this.updateServerObjectListById(updatedServer.id, updatedServer);
                        }
                        return [2 /*return*/];
                }
            });
        });
    };
    OpcuaServersComponent.prototype.removeServer = function (server) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var ex_2;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4 /*yield*/, this.opcuaService.removeServer(server)];
                    case 1:
                        _a.sent();
                        this.removeServerObjectListById(server.id);
                        this.reloadTabs();
                        return [3 /*break*/, 3];
                    case 2:
                        ex_2 = _a.sent();
                        console.log('Could not remove OPC UA server:', ex_2);
                        return [3 /*break*/, 3];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    OpcuaServersComponent.prototype.removeServerObjectListById = function (id) {
        var _this = this;
        this.serverObjectList.forEach(function (item, index) {
            if (item.id === id) {
                _this.serverObjectList.splice(index, 1);
                delete _this.server;
            }
        });
    };
    OpcuaServersComponent.prototype.updateServerObjectListById = function (id, server) {
        var idx = this.serverObjectList.findIndex(function (item) { return item.id === id; });
        if (idx > -1) {
            this.setQuickInfo(server);
            this.serverObjectList[idx] = server;
        }
        delete this.server;
    };
    OpcuaServersComponent.prototype.setQuickInfo = function (server) {
        server.quickInfo = {
            padlock: 'unlock',
            padlockMsg: ''
        };
        if (server && server.config) {
            if (server.config.securityMode) {
                server.quickInfo.padlock = server.config.securityMode !== 'NONE' ? 'lock' : 'unlock';
                server.quickInfo.padlockMsg = this.translateService.instant(gettext('The security policy is set to {{param}}.'), { param: server.config.securityMode });
            }
        }
    };
    OpcuaServersComponent.ctorParameters = function () { return [
        { type: OpcuaService },
        { type: AlertService },
        { type: TranslateService },
        { type: ContextRouteComponent, decorators: [{ type: Optional }] }
    ]; };
    OpcuaServersComponent = tslib_1.__decorate([
        Component({
            selector: 'opcua-servers',
            template: "<div class=\"row split-scroll\">\n  <div class=\"col-md-6 scroll-column has-footer\">\n    <div class=\"c8y-nav-stacked inner-scroll\">\n      <h4 class=\"bottom-m-sm\" translate>OPC UA servers</h4>\n      <p class=\"bottom-m-lg\" translate>\n        Below you can configure one or more OPC UA servers. The OPC UA agent will connect to these servers if they are enabled and the connection state is set to \"connected\".\n      </p>\n      <opcua-server-list [serverList]=\"serverObjectList\" (present)=\"onPresent($event)\">\n      </opcua-server-list>\n    </div>\n    <div class=\"scroll-column-footer\">\n      <button\n        title=\"{{ 'Add server' | translate }}\"\n        class=\"btn btn-add-block\"\n        [disabled]=\"localServerObjectExist()\"\n        (click)=\"addServer()\"\n      >\n        <i [c8yIcon]=\"'plus-circle'\"></i>\n        {{ 'Add server' | translate }}\n      </button>\n    </div>\n  </div>\n\n  <opcua-server-config\n    class=\"col-md-6 scroll-column fast animated\"\n    [ngClass]=\"{ slideInRight: server, slideOutRight: !server }\"\n    (canceled)=\"onCanceled($event)\"\n    (removed)=\"onRemoved($event)\"\n    (saved)=\"onSaved($event)\"\n    [server]=\"server\"\n  >\n  </opcua-server-config>\n</div>\n"
        }),
        tslib_1.__param(3, Optional())
    ], OpcuaServersComponent);
    return OpcuaServersComponent;
}());
export { OpcuaServersComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BjdWEtc2VydmVycy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYzh5L25neC1jb21wb25lbnRzL3Byb3RvY29sLW9wY3VhLyIsInNvdXJjZXMiOlsib3BjdWEtc2VydmVycy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVELE9BQU8sRUFBRSxZQUFZLEVBQUUscUJBQXFCLEVBQUUsT0FBTyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbkYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFdkQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBTTlDO0lBK0JFLCtCQUNVLFlBQTBCLEVBQzFCLFlBQTBCLEVBQzFCLGdCQUFrQyxFQUN0QixPQUE4QjtRQUgxQyxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ3RCLFlBQU8sR0FBUCxPQUFPLENBQXVCO1FBbENwRCxxQkFBZ0IsR0FBa0IsRUFBRSxDQUFDO1FBQ3JDLHdCQUFtQixHQUFnQjtZQUNqQyxFQUFFLEVBQUUsRUFBRTtZQUNOLElBQUksRUFBRSxZQUFZO1lBQ2xCLE1BQU0sRUFBRTtnQkFDTixZQUFZLEVBQUUsTUFBTTtnQkFDcEIsWUFBWSxFQUFFLElBQUk7Z0JBQ2xCLGdCQUFnQixFQUFFLElBQUk7Z0JBQ3RCLGdCQUFnQixFQUFFLEVBQUU7Z0JBQ3BCLGVBQWUsRUFBRSxJQUFJO2dCQUNyQixTQUFTLEVBQUUsRUFBRTtnQkFDYixRQUFRLEVBQUUsRUFBRTtnQkFDWixZQUFZLEVBQUUsRUFBRTtnQkFDaEIsVUFBVSxFQUFFLElBQUk7Z0JBQ2hCLE9BQU8sRUFBRSxJQUFJO2dCQUNiLGFBQWEsRUFBRSxJQUFJO2dCQUNu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QUNULFFBQVEsRUFBRSxlQUFlO1lBQ3pCLHd1Q0FBNkM7U0FDOUMsQ0FBQztRQW9DRyxtQkFBQSxRQUFRLEVBQUUsQ0FBQTtPQW5DRixxQkFBcUIsQ0FzTWpDO0lBQUQsNEJBQUM7Q0FBQSxBQXRNRCxJQXNNQztTQXRNWSxxQkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFsZXJ0U2VydmljZSwgQ29udGV4dFJvdXRlQ29tcG9uZW50LCBnZXR0ZXh0IH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgeyBPcGN1YVNlcnZlciB9IGZyb20gJy4vb3BjdWEtc2VydmVyLmludGVyZmFjZSc7XG5pbXBvcnQgeyBPcGN1YVNlcnZpY2UgfSBmcm9tICcuL29wY3VhU2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ29wY3VhLXNlcnZlcnMnLFxuICB0ZW1wbGF0ZVVybDogJy4vb3BjdWEtc2VydmVycy5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgT3BjdWFTZXJ2ZXJzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgc2VydmVyT2JqZWN0TGlzdDogT3BjdWFTZXJ2ZXJbXSA9IFtdO1xuICBpbml0aWFsU2VydmVyT2JqZWN0OiBPcGN1YVNlcnZlciA9IHtcbiAgICBpZDogJycsXG4gICAgbmFtZTogJ05ldyBTZXJ2ZXInLFxuICAgIGNvbmZpZzoge1xuICAgICAgc2VjdXJpdHlNb2RlOiAnTk9ORScsXG4gICAgICBrZXlzdG9yZVBhc3M6IG51bGwsXG4gICAgICBrZXlzdG9yZUJpbmFyeUlkOiBudWxsLFxuICAgICAga2V5c3RvcmVGaWxlbmFtZTogJycsXG4gICAgICBjZXJ0aWZpY2F0ZVBhc3M6IG51bGwsXG4gICAgICBzZXJ2ZXJVcmw6ICcnLFxuICAgICAgdXNlck5hbWU6ICcnLFxuICAgICAgdXNlclBhc3N3b3JkOiAnJyxcbiAgICAgIHJlc2NhbkNyb246IG51bGwsXG4gICAgICB0aW1lb3V0OiBudWxsLFxuICAgICAgYXV0b1JlY29ubmVjdDogdHJ1ZSxcbiAgICAgIHN0YXR1c0NoZWNrSW50ZXJ2YWw6IG51bGwsXG4gICAgICB2YWxpZDogdHJ1ZVxuICAgIH0sXG4gICAgcXVpY2tJbmZvOiB7XG4gICAgICBwYWRsb2NrOiAndW5sb2NrJyxcbiAgICAgIHBhZGxvY2tNc2c6ICcnXG4gICAgfSxcbiAgICBhY3RpdmU6IHRydWVcbiAgfTtcbiAgc2VydmVyOiBPcGN1YVNlcnZlcjtcbiAgYWN0aXZlOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgbW9JZDogc3RyaW5nO1xuICBwcml2YXRlIE5FV19TRVJWRVJfSUQ6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIG9wY3VhU2VydmljZTogT3BjdWFTZXJ2aWNlLFxuICAgIHByaXZhdGUgYWxlcnRTZXJ2aWNlOiBBbGVydFNlcnZpY2UsXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGVTZXJ2aWNlOiBUcmFuc2xhdGVTZXJ2aWNlLFxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgY29udGV4dDogQ29udGV4dFJvdXRlQ29tcG9uZW50XG4gICkge1xuICAgIHRoaXMubW9JZCA9ICcnO1xuICAgIHRoaXMuTkVXX1NFUlZFUl9JRCA9ICduZXcnO1xuICAgIHRoaXMuaW5pdGlhbFNlcnZlck9iamVjdC5pZCA9IHRoaXMuTkVXX1NFUlZFUl9JRDtcbiAgfVxuXG4gIGFzeW5jIG5nT25Jbml0KCkge1xuICAgIHRoaXMubW9JZCA9IHRoaXMub3BjdWFTZXJ2aWNlLmdldE1vSWQoKTtcbiAgICBpZiAodGhpcy5tb0lkICYmIHRoaXMubW9JZC5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLm9wY3VhU2VydmljZS5nZXRTZXJ2ZXJzKHRoaXMubW9JZCk7XG4gICAgICBpZiAocmVzICYmIHJlcy5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICBjb25zdCBkYXRhID0gcmVzLmpzb24gPyBhd2FpdCByZXMuanNvbigpIDogdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFsZXJ0U2VydmljZS5hZGRTZXJ2ZXJGYWlsdXJlKHsgZGF0YSwgcmVzIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zZXJ2ZXJPYmplY3RMaXN0ID0gKGF3YWl0IHJlcy5qc29uKCkpIGFzIE9wY3VhU2VydmVyW107XG4gICAgICAgIHRoaXMuc2VydmVyT2JqZWN0TGlzdC5tYXAoc2VydmVyID0+IHRoaXMuc2V0UXVpY2tJbmZvKHNlcnZlcikpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGxvY2FsU2VydmVyT2JqZWN0RXhpc3QoKSB7XG4gICAgcmV0dXJuICEhdGhpcy5zZXJ2ZXJPYmplY3RMaXN0LmZpbmQoc2VydmVyID0+IHNlcnZlci5pZCA9PT0gdGhpcy5ORVdfU0VSVkVSX0lEKTtcbiAgfVxuXG4gIGFkZFNlcnZlcigpIHtcbiAgICBjb25zdCBzZXJ2ZXI6IE9wY3VhU2VydmVyID0gdGhpcy5pbml0aWFsU2VydmVyT2JqZWN0O1xuICAgIHRoaXMuc2VydmVyT2JqZWN0TGlzdC5wdXNoKHNlcnZlcik7XG4gICAgdGhpcy5vblByZXNlbnQoc2VydmVyKTtcbiAgfVxuXG4gIG9uU2F2ZWQoc2VydmVyOiBPcGN1YVNlcnZlcikge1xuICAgIGlmIChzZXJ2ZXIgJiYgc2VydmVyLmlkKSB7XG4gICAgICBzZXJ2ZXIuZ2F0ZXdheUlkID0gdGhpcy5tb0lkO1xuICAgICAgaWYgKHNlcnZlci5pZCA9PT0gdGhpcy5ORVdfU0VSVkVSX0lEKSB7XG4gICAgICAgIHRoaXMuY3JlYXRlU2VydmVyKHNlcnZlcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnVwZGF0ZVNlcnZlcihzZXJ2ZXIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJlbG9hZFRhYnMoKSB7XG4gICAgaWYgKHRoaXMuY29udGV4dCkge1xuICAgICAgdGhpcy5jb250ZXh0LnJlZnJlc2hUYWJzKCk7XG4gICAgfVxuICB9XG5cbiAgb25DYW5jZWxlZChzZXJ2ZXI6IE9wY3VhU2VydmVyKSB7XG4gICAgaWYgKHNlcnZlciAmJiBzZXJ2ZXIuaWQgJiYgc2VydmVyLmlkID09PSB0aGlzLk5FV19TRVJWRVJfSUQpIHtcbiAgICAgIHRoaXMucmVtb3ZlU2VydmVyT2JqZWN0TGlzdEJ5SWQoc2VydmVyLmlkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gdXBkYXRlIGFjdGl2aXR5IHN0YXR1cyBmb3IgVUlcbiAgICAgIHRoaXMuc2VydmVyT2JqZWN0TGlzdC5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICBpZiAoaXRlbS5pZCA9PT0gc2VydmVyLmlkKSB7XG4gICAgICAgICAgaXRlbS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICAvLyBXaGVuIHNlcnZlciBpZCBpcyBub3QgJ25ldycgd2UganVzdCBjbG9zZSB0aGUgZGV0YWlsc1xuICAgICAgZGVsZXRlIHRoaXMuc2VydmVyO1xuICAgIH1cbiAgfVxuXG4gIG9uUmVtb3ZlZChzZXJ2ZXI6IE9wY3VhU2VydmVyKSB7XG4gICAgaWYgKHNlcnZlci5pZCA9PT0gdGhpcy5ORVdfU0VSVkVSX0lEKSB7XG4gICAgICB0aGlzLm9uQ2FuY2VsZWQoc2VydmVyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZW1vdmVTZXJ2ZXIoc2VydmVyKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRLZXlzdG9yZShiaW5hcnlJZDogc3RyaW5nKSB7XG4gICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCB0aGlzLm9wY3VhU2VydmljZS5nZXRLZXlzdG9yZShiaW5hcnlJZCk7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cblxuICBhc3luYyBvblByZXNlbnQoc2VydmVyOiBPcGN1YVNlcnZlcikge1xuICAgIGlmIChcbiAgICAgIHNlcnZlciAmJlxuICAgICAgc2VydmVyLmlkICE9PSB0aGlzLk5FV19TRVJWRVJfSUQgJiZcbiAgICAgIHNlcnZlci5jb25maWcgJiZcbiAgICAgIHNlcnZlci5jb25maWcua2V5c3RvcmVCaW5hcnlJZFxuICAgICkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbW8gPSBhd2FpdCB0aGlzLmdldEtleXN0b3JlKHNlcnZlci5jb25maWcua2V5c3RvcmVCaW5hcnlJZCk7XG4gICAgICAgIHNlcnZlci5jb25maWcua2V5c3RvcmVGaWxlbmFtZSA9IG1vLm5hbWU7XG4gICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICB0aGlzLnNlcnZlciA9IE9iamVjdC5hc3NpZ24oe30sIHNlcnZlcik7XG4gICAgICAgIGNvbnNvbGUubG9nKCdDb3VsZCBub3QgZ2V0IGV4aXN0aW5nIGtleXN0b3JlOicsIGV4KTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMuc2VydmVyT2JqZWN0TGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLnNlcnZlck9iamVjdExpc3QuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgaXRlbS5hY3RpdmUgPSBmYWxzZTtcblxuICAgICAgICBpZiAoaXRlbS5pZCA9PT0gc2VydmVyLmlkKSB7XG4gICAgICAgICAgaXRlbS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgIHNlcnZlci5hY3RpdmUgPSBpdGVtLmFjdGl2ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLnNldFF1aWNrSW5mbyhzZXJ2ZXIpO1xuICAgICAgdGhpcy5zZXJ2ZXIgPSBPYmplY3QuYXNzaWduKHt9LCBzZXJ2ZXIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlU2VydmVyKHNlcnZlcjogT3BjdWFTZXJ2ZXIpIHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMub3BjdWFTZXJ2aWNlLmNyZWF0ZVNlcnZlcihzZXJ2ZXIpO1xuICAgIGNvbnN0IHN2ciA9IChhd2FpdCByZXNwb25zZS5qc29uKCkpIGFzIE9wY3VhU2VydmVyO1xuICAgIHRoaXMudXBkYXRlU2VydmVyT2JqZWN0TGlzdEJ5SWQodGhpcy5ORVdfU0VSVkVSX0lELCBzdnIpO1xuICAgIHRoaXMucmVsb2FkVGFicygpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB1cGRhdGVTZXJ2ZXIoc2VydmVyOiBPcGN1YVNlcnZlcikge1xuICAgIGNvbnN0IHVwZGF0ZWRTZXJ2ZXIgPSAoYXdhaXQgdGhpcy5vcGN1YVNlcnZpY2UudXBkYXRlU2VydmVyKHNlcnZlcikpIGFzIE9wY3VhU2VydmVyO1xuICAgIGlmICh1cGRhdGVkU2VydmVyKSB7XG4gICAgICB0aGlzLnVwZGF0ZVNlcnZlck9iamVjdExpc3RCeUlkKHVwZGF0ZWRTZXJ2ZXIuaWQsIHVwZGF0ZWRTZXJ2ZXIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcmVtb3ZlU2VydmVyKHNlcnZlcjogT3BjdWFTZXJ2ZXIpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5vcGN1YVNlcnZpY2UucmVtb3ZlU2VydmVyKHNlcnZlcik7XG4gICAgICB0aGlzLnJlbW92ZVNlcnZlck9iamVjdExpc3RCeUlkKHNlcnZlci5pZCk7XG4gICAgICB0aGlzLnJlbG9hZFRhYnMoKTtcbiAgICB9IGNhdGNoIChleCkge1xuICAgICAgY29uc29sZS5sb2coJ0NvdWxkIG5vdCByZW1vdmUgT1BDIFVBIHNlcnZlcjonLCBleCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVTZXJ2ZXJPYmplY3RMaXN0QnlJZChpZDogc3RyaW5nKSB7XG4gICAgdGhpcy5zZXJ2ZXJPYmplY3RMaXN0LmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICBpZiAoaXRlbS5pZCA9PT0gaWQpIHtcbiAgICAgICAgdGhpcy5zZXJ2ZXJPYmplY3RMaXN0LnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIGRlbGV0ZSB0aGlzLnNlcnZlcjtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlU2VydmVyT2JqZWN0TGlzdEJ5SWQoaWQ6IHN0cmluZywgc2VydmVyOiBPcGN1YVNlcnZlcikge1xuICAgIGNvbnN0IGlkeCA9IHRoaXMuc2VydmVyT2JqZWN0TGlzdC5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmlkID09PSBpZCk7XG4gICAgaWYgKGlkeCA+IC0xKSB7XG4gICAgICB0aGlzLnNldFF1aWNrSW5mbyhzZXJ2ZXIpO1xuICAgICAgdGhpcy5zZXJ2ZXJPYmplY3RMaXN0W2lkeF0gPSBzZXJ2ZXI7XG4gICAgfVxuICAgIGRlbGV0ZSB0aGlzLnNlcnZlcjtcbiAgfVxuXG4gIHByaXZhdGUgc2V0UXVpY2tJbmZvKHNlcnZlcjogT3BjdWFTZXJ2ZXIpIHtcbiAgICBzZXJ2ZXIucXVpY2tJbmZvID0ge1xuICAgICAgcGFkbG9jazogJ3VubG9jaycsXG4gICAgICBwYWRsb2NrTXNnOiAnJ1xuICAgIH07XG5cbiAgICBpZiAoc2VydmVyICYmIHNlcnZlci5jb25maWcpIHtcbiAgICAgIGlmIChzZXJ2ZXIuY29uZmlnLnNlY3VyaXR5TW9kZSkge1xuICAgICAgICBzZXJ2ZXIucXVpY2tJbmZvLnBhZGxvY2sgPSBzZXJ2ZXIuY29uZmlnLnNlY3VyaXR5TW9kZSAhPT0gJ05PTkUnID8gJ2xvY2snIDogJ3VubG9jayc7XG4gICAgICAgIHNlcnZlci5xdWlja0luZm8ucGFkbG9ja01zZyA9IHRoaXMudHJhbnNsYXRlU2VydmljZS5pbnN0YW50KFxuICAgICAgICAgIGdldHRleHQoJ1RoZSBzZWN1cml0eSBwb2xpY3kgaXMgc2V0IHRvIHt7cGFyYW19fS4nKSxcbiAgICAgICAgICB7IHBhcmFtOiBzZXJ2ZXIuY29uZmlnLnNlY3VyaXR5TW9kZSB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0=