import * as tslib_1 from "tslib";
import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { Component, EventEmitter, HostBinding, Input, Output } from '@angular/core';
var StatusFilterComponent = /** @class */ (function () {
    function StatusFilterComponent() {
        this.statusOptions = [];
        this.onFilterChanged = new EventEmitter();
        this.isAllButtonSelected = true;
    }
    Object.defineProperty(StatusFilterComponent.prototype, "options", {
        /** List of filter options to be displayed */
        set: function (options) {
            this.statusOptions = (options || []).map(function (option) { return ({ selected: false, option: option }); });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StatusFilterComponent.prototype, "_multiple", {
        /**
         * Allows multiple options to be active simultaneosly.
         */
        set: function (multiple) {
            this.multiple = coerceBooleanProperty(multiple);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StatusFilterComponent.prototype, "_small", {
        /** Display the filter as a small button group */
        set: function (small) {
            this.small = coerceBooleanProperty(small);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StatusFilterComponent.prototype, "displaySmall", {
        get: function () {
            return this.small;
        },
        enumerable: true,
        configurable: true
    });
    StatusFilterComponent.prototype.changeFilter = function (option) {
        this.isAllButtonSelected = false;
        var emitNeeded = false;
        if (this.multiple) {
            option.selected = !option.selected;
            emitNeeded = true;
        }
        else if (!option.selected) {
            option.selected = true;
            this.statusOptions.filter(function (op) { return op !== option; }).forEach(function (op) { return (op.selected = false); });
            emitNeeded = true;
        }
        if (emitNeeded) {
            this.emitSelectedOptions();
        }
    };
    StatusFilterComponent.prototype.removeFilter = function () {
        this.isAllButtonSelected = true;
        this.statusOptions.forEach(function (op) { return (op.selected = false); });
        this.emitSelectedOptions();
    };
    /**
     * Allows the filter to be initalliy displayed with some preset filters.
     *
     * @param filters An `IStatusOption` array defining filter options to be preset.
     * @param emit  (optional) If `true` component will emit `onFilterChanged` event.
     */
    StatusFilterComponent.prototype.preset = function (filters, emit) {
        var _this = this;
        if (emit === void 0) { emit = true; }
        var firstSelected = false;
        this.statusOptions.forEach(function (option) { return (option.selected = false); });
        this.statusOptions
            .filter(function (option) { return (filters || []).map(function (o) { return o.label; }).includes(option.option.label); })
            .filter(function () {
            // only first option passed will be set in single selection mode
            var include = _this.multiple || !firstSelected;
            if (include) {
                firstSelected = true;
            }
            return include;
        })
            .forEach(function (option) { return (option.selected = true); });
        this.isAllButtonSelected = !(filters && filters.length);
        if (emit) {
            this.emitSelectedOptions();
        }
    };
    StatusFilterComponent.prototype.reset = function () {
        this.removeFilter();
    };
    StatusFilterComponent.prototype.activeFilters = function () {
        return this.statusOptions.filter(function (option) { return option.selected; }).map(function (option) { return option.option; });
    };
    StatusFilterComponent.prototype.isFilterApplied = function () {
        return this.statusOptions.some(function (option) { return option.selected; });
    };
    StatusFilterComponent.prototype.emitSelectedOptions = function () {
        this.onFilterChanged.emit(this.statusOptions.filter(function (option) { return option.selected; }).map(function (option) { return option.option; }));
    };
    tslib_1.__decorate([
        Input()
    ], StatusFilterComponent.prototype, "options", null);
    tslib_1.__decorate([
        Input('multiple')
    ], StatusFilterComponent.prototype, "_multiple", null);
    tslib_1.__decorate([
        Input('small')
    ], StatusFilterComponent.prototype, "_small", null);
    tslib_1.__decorate([
        HostBinding('class.btn-group-sm')
    ], StatusFilterComponent.prototype, "displaySmall", null);
    tslib_1.__decorate([
        Output()
    ], StatusFilterComponent.prototype, "onFilterChanged", void 0);
    StatusFilterComponent = tslib_1.__decorate([
        Component({
            selector: 'c8y-status-filter',
            template: "<button\n  *ngFor=\"let option of statusOptions\"\n  class=\"btn btn-default\"\n  [ngClass]=\"{ active: option.selected }\"\n  tooltip=\"{{ option.option?.label | translate }}\"\n  container=\"body\"\n  (click)=\"changeFilter(option)\"\n>\n  <i [class]=\"option.option?.iconClass\"></i>\n  <span *ngIf=\"option.selected\" class=\"m-8\">{{ option.option?.label | translate }}</span>\n</button>\n<button\n  class=\"btn btn-default\"\n  title=\"{{ 'All' | translate }}\"\n  [ngClass]=\"{ active: isAllButtonSelected }\"\n  (click)=\"removeFilter()\"\n>\n  {{ 'All' | translate }}\n</button>\n",
            host: { class: 'btn-group' }
        })
    ], StatusFilterComponent);
    return StatusFilterComponent;
}());
export { StatusFilterComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLWZpbHRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYzh5L25neC1jb21wb25lbnRzL29wZXJhdGlvbnMvIiwic291cmNlcyI6WyJzdGF0dXMtZmlsdGVyL3N0YXR1cy1maWx0ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQVFwRjtJQUxBO1FBTUUsa0JBQWEsR0FBd0QsRUFBRSxDQUFDO1FBdUI5RCxvQkFBZSxHQUFrQyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRTlFLHdCQUFtQixHQUFZLElBQUksQ0FBQztJQThFdEMsQ0FBQztJQXBHVSxzQkFBSSwwQ0FBTztRQURwQiw2Q0FBNkM7YUFDcEMsVUFBWSxPQUF3QjtZQUMzQyxJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsT0FBTyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLENBQUMsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sUUFBQSxFQUFFLENBQUMsRUFBN0IsQ0FBNkIsQ0FBQyxDQUFDO1FBQ3BGLENBQUM7OztPQUFBO0lBS2tCLHNCQUFJLDRDQUFTO1FBSGhDOztXQUVHO2FBQ2dCLFVBQWMsUUFBaUI7WUFDaEQsSUFBSSxDQUFDLFFBQVEsR0FBRyxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsRCxDQUFDOzs7T0FBQTtJQUdlLHNCQUFJLHlDQUFNO1FBRDFCLGlEQUFpRDthQUNqQyxVQUFXLEtBQWM7WUFDdkMsSUFBSSxDQUFDLEtBQUssR0FBRyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM1QyxDQUFDOzs7T0FBQTtJQUVrQyxzQkFBSSwrQ0FBWTth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QUFBLE1BQU0sQ0FBQyxRQUFRLEVBQWYsQ0FBZSxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUEsTUFBTSxJQUFJLE9BQUEsTUFBTSxDQUFDLE1BQU0sRUFBYixDQUFhLENBQUMsQ0FBQztJQUMzRixDQUFDO0lBRUQsK0NBQWUsR0FBZjtRQUNFLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBQSxNQUFNLElBQUksT0FBQSxNQUFNLENBQUMsUUFBUSxFQUFmLENBQWUsQ0FBQyxDQUFDO0lBQzVELENBQUM7SUFFTyxtREFBbUIsR0FBM0I7UUFDRSxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FDdkIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsVUFBQSxNQUFNLElBQUksT0FBQSxNQUFNLENBQUMsUUFBUSxFQUFmLENBQWUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLE1BQU0sQ0FBQyxNQUFNLEVBQWIsQ0FBYSxDQUFDLENBQ2xGLENBQUM7SUFDSixDQUFDO0lBbkdRO1FBQVIsS0FBSyxFQUFFO3dEQUVQO0lBS2tCO1FBQWxCLEtBQUssQ0FBQyxVQUFVLENBQUM7MERBRWpCO0lBR2U7UUFBZixLQUFLLENBQUMsT0FBTyxDQUFDO3VEQUVkO0lBRWtDO1FBQWxDLFdBQVcsQ0FBQyxvQkFBb0IsQ0FBQzs2REFFakM7SUFFUztRQUFULE1BQU0sRUFBRTtrRUFBcUU7SUF4Qm5FLHFCQUFxQjtRQUxqQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsbUJBQW1CO1lBQzdCLHlsQkFBNkM7WUFDN0MsSUFBSSxFQUFFLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRTtTQUM3QixDQUFDO09BQ1cscUJBQXFCLENBd0dqQztJQUFELDRCQUFDO0NBQUEsQUF4R0QsSUF3R0M7U0F4R1kscUJBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29lcmNlQm9vbGVhblByb3BlcnR5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcbmltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBIb3N0QmluZGluZywgSW5wdXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSVN0YXR1c09wdGlvbiB9IGZyb20gJy4vc3RhdHVzLW9wdGlvbi5tb2RlbCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1zdGF0dXMtZmlsdGVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3N0YXR1cy1maWx0ZXIuY29tcG9uZW50Lmh0bWwnLFxuICBob3N0OiB7IGNsYXNzOiAnYnRuLWdyb3VwJyB9XG59KVxuZXhwb3J0IGNsYXNzIFN0YXR1c0ZpbHRlckNvbXBvbmVudCB7XG4gIHN0YXR1c09wdGlvbnM6IEFycmF5PHsgc2VsZWN0ZWQ6IGJvb2xlYW47IG9wdGlvbjogSVN0YXR1c09wdGlvbiB9PiA9IFtdO1xuXG4gIC8qKiBMaXN0IG9mIGZpbHRlciBvcHRpb25zIHRvIGJlIGRpc3BsYXllZCAqL1xuICBASW5wdXQoKSBzZXQgb3B0aW9ucyhvcHRpb25zOiBJU3RhdHVzT3B0aW9uW10pIHtcbiAgICB0aGlzLnN0YXR1c09wdGlvbnMgPSAob3B0aW9ucyB8fCBbXSkubWFwKG9wdGlvbiA9PiAoeyBzZWxlY3RlZDogZmFsc2UsIG9wdGlvbiB9KSk7XG4gIH1cblxuICAvKipcbiAgICogQWxsb3dzIG11bHRpcGxlIG9wdGlvbnMgdG8gYmUgYWN0aXZlIHNpbXVsdGFuZW9zbHkuXG4gICAqL1xuICBASW5wdXQoJ211bHRpcGxlJykgc2V0IF9tdWx0aXBsZShtdWx0aXBsZTogYm9vbGVhbikge1xuICAgIHRoaXMubXVsdGlwbGUgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkobXVsdGlwbGUpO1xuICB9XG5cbiAgLyoqIERpc3BsYXkgdGhlIGZpbHRlciBhcyBhIHNtYWxsIGJ1dHRvbiBncm91cCAqL1xuICBASW5wdXQoJ3NtYWxsJykgc2V0IF9zbWFsbChzbWFsbDogYm9vbGVhbikge1xuICAgIHRoaXMuc21hbGwgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkoc21hbGwpO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5idG4tZ3JvdXAtc20nKSBnZXQgZGlzcGxheVNtYWxsKCkge1xuICAgIHJldHVybiB0aGlzLnNtYWxsO1xuICB9XG5cbiAgQE91dHB1dCgpIG9uRmlsdGVyQ2hhbmdlZDogRXZlbnRFbWl0dGVyPElTdGF0dXNPcHRpb25bXT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgaXNBbGxCdXR0b25TZWxlY3RlZDogYm9vbGVhbiA9IHRydWU7XG5cbiAgcHJpdmF0ZSBtdWx0aXBsZTogYm9vbGVhbjtcbiAgcHJpdmF0ZSBzbWFsbDogYm9vbGVhbjtcblxuICBjaGFuZ2VGaWx0ZXIob3B0aW9uOiB7IHNlbGVjdGVkOiBib29sZWFuOyBvcHRpb246IElTdGF0dXNPcHRpb24gfSkge1xuICAgIHRoaXMuaXNBbGxCdXR0b25TZWxlY3RlZCA9IGZhbHNlO1xuICAgIGxldCBlbWl0TmVlZGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBpZiAodGhpcy5tdWx0aXBsZSkge1xuICAgICAgb3B0aW9uLnNlbGVjdGVkID0gIW9wdGlvbi5zZWxlY3RlZDtcbiAgICAgIGVtaXROZWVkZWQgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoIW9wdGlvbi5zZWxlY3RlZCkge1xuICAgICAgb3B0aW9uLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgIHRoaXMuc3RhdHVzT3B0aW9ucy5maWx0ZXIob3AgPT4gb3AgIT09IG9wdGlvbikuZm9yRWFjaChvcCA9PiAob3Auc2VsZWN0ZWQgPSBmYWxzZSkpO1xuICAgICAgZW1pdE5lZWRlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKGVtaXROZWVkZWQpIHtcbiAgICAgIHRoaXMuZW1pdFNlbGVjdGVkT3B0aW9ucygpO1xuICAgIH1cbiAgfVxuXG4gIHJlbW92ZUZpbHRlcigpIHtcbiAgICB0aGlzLmlzQWxsQnV0dG9uU2VsZWN0ZWQgPSB0cnVlO1xuICAgIHRoaXMuc3RhdHVzT3B0aW9ucy5mb3JFYWNoKG9wID0+IChvcC5zZWxlY3RlZCA9IGZhbHNlKSk7XG5cbiAgICB0aGlzLmVtaXRTZWxlY3RlZE9wdGlvbnMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBbGxvd3MgdGhlIGZpbHRlciB0byBiZSBpbml0YWxsaXkgZGlzcGxheWVkIHdpdGggc29tZSBwcmVzZXQgZmlsdGVycy5cbiAgICpcbiAgICogQHBhcmFtIGZpbHRlcnMgQW4gYElTdGF0dXNPcHRpb25gIGFycmF5IGRlZmluaW5nIGZpbHRlciBvcHRpb25zIHRvIGJlIHByZXNldC5cbiAgICogQHBhcmFtIGVtaXQgIChvcHRpb25hbCkgSWYgYHRydWVgIGNvbXBvbmVudCB3aWxsIGVtaXQgYG9uRmlsdGVyQ2hhbmdlZGAgZXZlbnQuXG4gICAqL1xuICBwcmVzZXQoZmlsdGVyczogSVN0YXR1c09wdGlvbltdLCBlbWl0OiBib29sZWFuID0gdHJ1ZSkge1xuICAgIGxldCBmaXJzdFNlbGVjdGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICB0aGlzLnN0YXR1c09wdGlvbnMuZm9yRWFjaChvcHRpb24gPT4gKG9wdGlvbi5zZWxlY3RlZCA9IGZhbHNlKSk7XG5cbiAgICB0aGlzLnN0YXR1c09wdGlvbnNcbiAgICAgIC5maWx0ZXIob3B0aW9uID0+IChmaWx0ZXJzIHx8IFtdKS5tYXAobyA9PiBvLmxhYmVsKS5pbmNsdWRlcyhvcHRpb24ub3B0aW9uLmxhYmVsKSlcbiAgICAgIC5maWx0ZXIoKCkgPT4ge1xuICAgICAgICAvLyBvbmx5IGZpcnN0IG9wdGlvbiBwYXNzZWQgd2lsbCBiZSBzZXQgaW4gc2luZ2xlIHNlbGVjdGlvbiBtb2RlXG4gICAgICAgIGNvbnN0IGluY2x1ZGU6IGJvb2xlYW4gPSB0aGlzLm11bHRpcGxlIHx8ICFmaXJzdFNlbGVjdGVkO1xuICAgICAgICBpZiAoaW5jbHVkZSkge1xuICAgICAgICAgIGZpcnN0U2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGluY2x1ZGU7XG4gICAgICB9KVxuICAgICAgLmZvckVhY2gob3B0aW9uID0+IChvcHRpb24uc2VsZWN0ZWQgPSB0cnVlKSk7XG5cbiAgICB0aGlzLmlzQWxsQnV0dG9uU2VsZWN0ZWQgPSAhKGZpbHRlcnMgJiYgZmlsdGVycy5sZW5ndGgpO1xuXG4gICAgaWYgKGVtaXQpIHtcbiAgICAgIHRoaXMuZW1pdFNlbGVjdGVkT3B0aW9ucygpO1xuICAgIH1cbiAgfVxuXG4gIHJlc2V0KCkge1xuICAgIHRoaXMucmVtb3ZlRmlsdGVyKCk7XG4gIH1cblxuICBhY3RpdmVGaWx0ZXJzKCk6IElTdGF0dXNPcHRpb25bXSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdHVzT3B0aW9ucy5maWx0ZXIob3B0aW9uID0+IG9wdGlvbi5zZWxlY3RlZCkubWFwKG9wdGlvbiA9PiBvcHRpb24ub3B0aW9uKTtcbiAgfVxuXG4gIGlzRmlsdGVyQXBwbGllZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0dXNPcHRpb25zLnNvbWUob3B0aW9uID0+IG9wdGlvbi5zZWxlY3RlZCk7XG4gIH1cblxuICBwcml2YXRlIGVtaXRTZWxlY3RlZE9wdGlvbnMoKSB7XG4gICAgdGhpcy5vbkZpbHRlckNoYW5nZWQuZW1pdChcbiAgICAgIHRoaXMuc3RhdHVzT3B0aW9ucy5maWx0ZXIob3B0aW9uID0+IG9wdGlvbi5zZWxlY3RlZCkubWFwKG9wdGlvbiA9PiBvcHRpb24ub3B0aW9uKVxuICAgICk7XG4gIH1cbn1cbiJdfQ==