import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { IManagedObject, InventoryService, IResultList } from '@c8y/client';
var LoraSetDeviceProtocolService = /** @class */ (function () {
    function LoraSetDeviceProtocolService(inventoryService) {
        this.inventoryService = inventoryService;
    }
    LoraSetDeviceProtocolService.prototype.getCurrentProtocol = function (device) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var protocolId, data;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        protocolId = device.c8y_LpwanDevice.type
                            ? device.c8y_LpwanDevice.type.split('/')[2]
                            : null;
                        if (!protocolId) {
                            return [2 /*return*/, null];
                        }
                        return [4 /*yield*/, this.inventoryService.detail(protocolId)];
                    case 1:
                        data = (_a.sent()).data;
                        return [2 /*return*/, data];
                }
            });
        });
    };
    LoraSetDeviceProtocolService.prototype.applyProtocol = function (device, selectedProtocol) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                device.c8y_LpwanDevice.type = 'inventory/managedObjects/' + selectedProtocol.id;
                device.type = selectedProtocol.name;
                return [2 /*return*/, this.inventoryService.update(device)];
            });
        });
    };
    LoraSetDeviceProtocolService.prototype.getAvailableProtocols = function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var query;
            return tslib_1.__generator(this, function (_a) {
                query = {
                    type: {
                        __in: ['c8y_ActilityDeviceType', 'c8y_LoraDeviceType']
                    }
                };
                return [2 /*return*/, this.inventoryService.listQuery(query)];
            });
        });
    };
    LoraSetDeviceProtocolService.ctorParameters = function () { return [
        { type: InventoryService }
    ]; };
    LoraSetDeviceProtocolService = tslib_1.__decorate([
        Injectable()
    ], LoraSetDeviceProtocolService);
    return LoraSetDeviceProtocolService;
}());
export { LoraSetDeviceProtocolService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9yYS1zZXQtZGV2aWNlLXByb3RvY29sLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYzh5L25neC1jb21wb25lbnRzL3Byb3RvY29sLWxvcmEvIiwic291cmNlcyI6WyJsb3JhLXNldC1kZXZpY2UtcHJvdG9jb2wuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsY0FBYyxFQUFFLGdCQUFnQixFQUFFLFdBQVcsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUc1RTtJQUNFLHNDQUNVLGdCQUFrQztRQUFsQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO0lBQUksQ0FBQztJQUUzQyx5REFBa0IsR0FBeEIsVUFBeUIsTUFBc0I7Ozs7Ozt3QkFDdkMsVUFBVSxHQUFHLE1BQU0sQ0FBQyxlQUFlLENBQUMsSUFBSTs0QkFDNUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7NEJBQzNDLENBQUMsQ0FBQyxJQUFJLENBQUM7d0JBQ1QsSUFBSSxDQUFDLFVBQVUsRUFBRTs0QkFDZixzQkFBTyxJQUFJLEVBQUM7eUJBQ2I7d0JBQ2dCLHFCQUFNLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUE7O3dCQUF2RCxJQUFJLEdBQUssQ0FBQSxTQUE4QyxDQUFBLEtBQW5EO3dCQUNaLHNCQUFPLElBQUksRUFBQzs7OztLQUNiO0lBRUssb0RBQWEsR0FBbkIsVUFBb0IsTUFBc0IsRUFBRSxnQkFBZ0M7OztnQkFDMUUsTUFBTSxDQUFDLGVBQWUsQ0FBQyxJQUFJLEdBQUcsMkJBQTJCLEdBQUcsZ0JBQWdCLENBQUMsRUFBRSxDQUFDO2dCQUNoRixNQUFNLENBQUMsSUFBSSxHQUFHLGdCQUFnQixDQUFDLElBQUksQ0FBQztnQkFDcEMsc0JBQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBQzs7O0tBQzdDO0lBRUssNERBQXFCLEdBQTNCOzs7O2dCQUNRLEtBQUssR0FBRztvQkFDWixJQUFJLEVBQUU7d0JBQ0osSUFBSSxFQUFFLENBQUMsd0JBQXdCLEVBQUUsb0JBQW9CLENBQUM7cUJBQ3ZEO2lCQUNGLENBQUM7Z0JBQ0Ysc0JBQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBQzs7O0tBQy9DOztnQkExQjJCLGdCQUFnQjs7SUFGakMsNEJBQTRCO1FBRHhDLFVBQVUsRUFBRTtPQUNBLDRCQUE0QixDQTZCeEM7SUFBRCxtQ0FBQztDQUFBLEFBN0JELElBNkJDO1NBN0JZLDRCQUE0QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IElNYW5hZ2VkT2JqZWN0LCBJbnZlbnRvcnlTZXJ2aWNlLCBJUmVzdWx0TGlzdCB9IGZyb20gJ0BjOHkvY2xpZW50JztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIExvcmFTZXREZXZpY2VQcm90b2NvbFNlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGludmVudG9yeVNlcnZpY2U6IEludmVudG9yeVNlcnZpY2UpIHsgfVxuXG4gIGFzeW5jIGdldEN1cnJlbnRQcm90b2NvbChkZXZpY2U6IElNYW5hZ2VkT2JqZWN0KSB7XG4gICAgY29uc3QgcHJvdG9jb2xJZCA9IGRldmljZS5jOHlfTHB3YW5EZXZpY2UudHlwZVxuICAgICAgPyBkZXZpY2UuYzh5X0xwd2FuRGV2aWNlLnR5cGUuc3BsaXQoJy8nKVsyXVxuICAgICAgOiBudWxsO1xuICAgIGlmICghcHJvdG9jb2xJZCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgdGhpcy5pbnZlbnRvcnlTZXJ2aWNlLmRldGFpbChwcm90b2NvbElkKTtcbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIGFzeW5jIGFwcGx5UHJvdG9jb2woZGV2aWNlOiBJTWFuYWdlZE9iamVjdCwgc2VsZWN0ZWRQcm90b2NvbDogSU1hbmFnZWRPYmplY3QpIHtcbiAgICBkZXZpY2UuYzh5X0xwd2FuRGV2aWNlLnR5cGUgPSAnaW52ZW50b3J5L21hbmFnZWRPYmplY3RzLycgKyBzZWxlY3RlZFByb3RvY29sLmlkO1xuICAgIGRldmljZS50eXBlID0gc2VsZWN0ZWRQcm90b2NvbC5uYW1lO1xuICAgIHJldHVybiB0aGlzLmludmVudG9yeVNlcnZpY2UudXBkYXRlKGRldmljZSk7XG4gIH1cblxuICBhc3luYyBnZXRBdmFpbGFibGVQcm90b2NvbHMoKTogUHJvbWlzZTxJUmVzdWx0TGlzdDxJTWFuYWdlZE9iamVjdD4+IHtcbiAgICBjb25zdCBxdWVyeSA9IHtcbiAgICAgIHR5cGU6IHtcbiAgICAgICAgX19pbjogWydjOHlfQWN0aWxpdHlEZXZpY2VUeXBlJywgJ2M4eV9Mb3JhRGV2aWNlVHlwZSddXG4gICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5pbnZlbnRvcnlTZXJ2aWNlLmxpc3RRdWVyeShxdWVyeSk7XG4gIH1cbn1cbiJdfQ==