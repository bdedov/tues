!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@c8y/ngx-components"),require("rxjs"),require("rxjs/operators"),require("lodash-es"),require("@angular/router"),require("@angular/core"),require("@c8y/client"),require("@angular/upgrade/static"),require("angular"),require("@c8y/ngx-components/app-logs"),require("@c8y/ngx-components/connectivity"),require("@c8y/ngx-components/api"),require("@c8y/ngx-components/operations/bulk-operations-list"),require("@ngx-translate/core"),require("@c8y/ngx-components/context-dashboard"),require("@angular/common")):"function"==typeof define&&define.amd?define("@c8y/ngx-components/upgrade",["exports","@c8y/ngx-components","rxjs","rxjs/operators","lodash-es","@angular/router","@angular/core","@c8y/client","@angular/upgrade/static","angular","@c8y/ngx-components/app-logs","@c8y/ngx-components/connectivity","@c8y/ngx-components/api","@c8y/ngx-components/operations/bulk-operations-list","@ngx-translate/core","@c8y/ngx-components/context-dashboard","@angular/common"],e):e(((t=t||self).c8y=t.c8y||{},t.c8y["ngx-components"]=t.c8y["ngx-components"]||{},t.c8y["ngx-components"].upgrade={}),t.c8y["ngx-components"],t.rxjs,t.rxjs.operators,t.lodashEs,t.ng.router,t.ng.core,t.client,t.ng.upgrade.static,t.angular,t.c8y["ngx-components"]["app-logs"],t.c8y["ngx-components"].connectivity,t.c8y["ngx-components"].api,t.c8y["ngx-components"].operations["bulk-operations-list"],t.core$1,t.c8y["ngx-components"]["context-dashboard"],t.ng.common)}(this,(function(t,e,n,o,r,i,a,c,s,u,p,d,h,l,f,g,v){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var m,b=function(){return(b=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function S(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function C(t,e){return function(n,o){e(n,o,t)}}function w(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function c(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))}function x(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}function j(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}!function(t){t.Device="deviceId",t.Group="groupId",t.User="userId",t.Application="applicationId",t.SubscribedApplications="applicationId",t.Tenant="tenantId"}(m||(m={}));var A=function(){function t(t,e,o,r,i,a){this.injector=t,this.appState=e,this.router=o,this.ngZone=r,this.routerService=i,this.actionService=a,this.$liveTabs=new n.BehaviorSubject([]),this.fixE2eIssues(),this.$ng1RouteChangeSuccess=this.fromNg1Event(this.injector.get("$rootScope"),"$routeChangeSuccess"),this.$ng1RouteChangeStart=this.fromNg1Event(this.injector.get("$rootScope"),"$routeChangeStart"),this.hookLanguage(),this.hookTabs(),this.hookNavigator(),this.hookUserMenu(),this.hookViewProvider(),this.router.initialNavigation(),this.ng1Routes()}return t.prototype.hookViewProvider=function(){var t=this,e=this.injector.get("c8yViews");e.when("/device/:id",{template:""}),e.when("/group/:id",{template:""}),e.contextViews.subscribe((function(e){return t.addRoute(e)}))},t.prototype.addRoute=function(t){var n=this;this.routerService.addRoute({label:t.label||t.name,path:t.path,icon:t.icon,context:e.ViewContext[t.contextKey],priority:t.priority,component:e.EmptyComponent,data:{showIf:t.showIf?function(e){var o,r=b({},e.params,((o={})[m[t.contextKey]]=e.params.id,o)),i=n.injector.invoke(t.showIf,void 0,{$routeParams:r});return n.injector.get("$q").when(i).then(Boolean)}:void 0}}),t.runPhase&&this.routerService.refresh()},t.prototype.ng1Routes=function(){var t=[];for(var n in e.ViewContext){var r=e.ViewContext[n].match(/(\w+)\//)[1],a=new RegExp("^/"+r+"/(?:([^/]+)).*$");t.push({keys:[{name:m[n],optional:!1}],regexp:a,template:""})}var c=this.injector.get("$route");Object.defineProperty(c.routes,"forEach",{value:function(e,n){for(var o in this)e.call(n,this[o],o,this);t.forEach((function(t){return e.call(n,t)}))}});var s=this.injector.get("c8yUiUtil"),u=s.getContext;this.router.events.pipe(o.filter((function(t){return t instanceof i.ActivationEnd}))).subscribe((function(t){"**"===t.snapshot.routeConfig.path?s.getContext=u:t.snapshot.data&&t.snapshot.data.context?s.getContext=function(){return{context:t.snapshot.data.context.replace("/:id",""),id:t.snapshot.data.contextData.id}}:s.getContext=function(){return{context:null,id:null}}}))},t.prototype.fixE2eIssues=function(){try{var t=this.ngZone,e=window.org.cometd.Utils,n=e.setTimeout;e.setTimeout=function(){for(var o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];return t.runOutsideAngular((function(){return n.apply(e,o)}))}}catch(t){}try{var o=window.ace,r=o.edit,i=this.ngZone;o.edit=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return i.runOutsideAngular((function(){return r.apply(o,t)}))}}catch(t){}},t.prototype.hookLanguage=function(){var t=this,e=!0;this.appState.map((function(t){return t.lang})).subscribe((function(n){t.injector.get("c8yLocales").switchToLanguage(n),e||t.injector.get("$rootScope").$apply(),e=!1}))},t.prototype.hookTabs=function(){var t=this;this.injector.get("c8yActions");var e=this.injector.get("$location"),r=this.injector.get("c8yTabs"),i=[];r.addTab=function(e){i.push(b({},e,{label:e.label||e.name,path:decodeURIComponent(e.path)})),t.$liveTabs.next(i)},this.$ng1RouteChangeStart.subscribe((function(e){i=[],t.$liveTabs.next(i)})),this.$ng1RouteChangeSuccess.subscribe((function(n){var o=e.path();t.router.url!==o&&t.router.navigate("/"===o?"":o.split("/"),{queryParams:e.search(),skipLocationChange:!0}),t.actionService&&t.actionService.refresh()})),this.$routeChanges=this.$ng1RouteChangeSuccess.pipe(o.merge(this.fromNg1Event(r,r.EVENT_UPDATE),n.of(1)),o.debounceTime(100))},t.prototype.hookNavigator=function(){this.navigationNodes$=this.injector.get("c8yNavigator").rootNodes$},t.prototype.getTabs=function(){var t=this,e=function(t){return t.show},r=function(t){return b({},t,{label:t.label||t.name,path:decodeURIComponent(t.path)})},i=this.$routeChanges.pipe(o.switchMap((function(){var n=t.injector.get("c8yTabs").routeTabs;return Promise.all(n.map((function(t){return t.checkingVisibility}))).then((function(){return n.filter(e).map(r)}))})),o.startWith([]));return n.combineLatest(i,this.$liveTabs).pipe(o.map((function(t){var e=j(t,2),n=e[0],o=e[1];return n.concat(o)})))},t.prototype.getQuickLinks=function(){return this.injector.get("c8yQuickLinks").list()},t.prototype.getActionBarItems=function(){var t=this.injector.get("c8yActionBar"),e=this.injector.get("$rootScope");return this.fromNg1Event(e,"c8yActionBarChanged").pipe(o.startWith(1),o.map((function(){return t.elements.map((function(t){return{priority:t.getAttribute("action-bar-priority")||0,template:t,placement:t.getAttribute("action-bar-position")||"right"}}))})))},t.prototype.getBreadcrumbs=function(){var t=this.injector.get("$location").path(),e=this.injector.get("c8yBreadcrumbs"),r=e.get(t)||{},i=this.resolveBreadcrumbsData(r.data);return n.from(i).pipe(o.map((function(t){var n=e.getLiveBreadcrumbs();return(t=t.concat(n)).map((function(t){return{items:t}}))})))},t.prototype.resolveBreadcrumbsData=function(t){try{return this.injector.invoke(t)}catch(t){}return r.isArray(t)?n.of([t]):n.of([])},t.prototype.getSearch=function(){var t=this.injector.get("c8ySearch");return t.list().map((function(e){return{icon:"search",name:e.name,term:"",onSearch:function(){this.term&&t.search(this.term)}}}))},t.prototype.getActions=function(){var t=this,e=this.injector.get("c8yActions").registeredActions;return n.of(e.filter((function(t){return!t.hidden})).map((function(e){return{priority:-1*(e.priority||0),label:e.text,icon:e.icon,disabled:e.disabled,action:function(){t.injector.invoke(e.action,e)}}})))},t.prototype.fromNg1Event=function(t,e){var o;return n.fromEventPattern((function(n){o=t.$on(e,n)}),(function(){return o()}))},t.prototype.hookUserMenu=function(){var t=this.injector.get("c8yUserMenuService"),n=this.injector.get("c8yAccessDenied");t.add({icon:"exclamation-triangle",priority:10,label:e.gettext("Access denied requests"),click:n.showAccessDeniedRequestsList})},t}();function T(t,e,n,o,r,i){return new A(t,e,n,o,r,i)}var I={provide:A,useFactory:T,deps:["$injector",e.AppStateService,i.Router,a.NgZone,e.RouterService,e.ActionService]},O=function(){function t(t){this.bridge=t,this.routeChanges$=t.$routeChanges}return t.prototype.get=function(){return this.bridge.getActionBarItems()},t.ctorParameters=function(){return[{type:A}]},t=S([a.Injectable()],t)}(),D=function(){function t(t,e){var n=this;this.bridge=t,this.tabs=e,this.routeChanges$=t.$routeChanges,this.$location=t.injector.get("$location"),this.tabs.items$.subscribe((function(t){return n.handleTabsRedirect(t)}))}return t.prototype.handleTabsRedirect=function(t){var e=t.find((function(t){return t.redirectedTo})),n=j(t,1)[0];e&&!n.redirectedTo&&(this.$location.replace(),this.$location.path(n.path),n.redirectedTo=!0,e.redirectedTo=!1)},t.prototype.get=function(){return this.bridge.getActions()},t.ctorParameters=function(){return[{type:A},{type:e.TabsService}]},t=S([a.Injectable()],t)}(),N=function(){function t(t){var e=this;this.bridge=t,this.trigger=new n.ReplaySubject(1),this.breadcrumbs=this.trigger.pipe(o.debounceTime(100),o.switchMap((function(){return e.bridge.getBreadcrumbs()})))}return t.prototype.get=function(){return this.trigger.next(),this.breadcrumbs},t.ctorParameters=function(){return[{type:A}]},t=S([a.Injectable()],t)}(),$=function(){function t(t){this.bridge=t}return t.prototype.get=function(){return this.bridge.navigationNodes$},t.ctorParameters=function(){return[{type:A}]},t=S([a.Injectable()],t)}(),R=function(){function t(t){this.bridge=t,this.search=this.bridge.getSearch()}return t.prototype.get=function(){return this.search},t.ctorParameters=function(){return[{type:A}]},t=S([a.Injectable()],t)}(),P=function(){function t(t){this.bridge=t,this.tabsObservable=t.getTabs()}return t.prototype.get=function(){return this.tabsObservable},t.ctorParameters=function(){return[{type:A}]},t=S([a.Injectable()],t)}(),k=function(){function t(t){this.bridge=t,this.links=this.bridge.getQuickLinks(),this.links.then((function(t){t.map((function(t){return t.type=t.type||"quicklink",t}))}))}return t.prototype.get=function(){return this.links},t.ctorParameters=function(){return[{type:A}]},t=S([a.Injectable()],t)}(),B=function(){function t(t,e,n,o){this.injector=t,this.basicAuth=e,this.fetchClient=n,this.appState=o,this.hookAuth()}return t.prototype.updateBasicAuth=function(t){var e=this.fetchClient.getFetchOptions({}).headers;e.Authorization&&(e.Authorization.match(/basic\s(.*)$/i)[1]&&(this.basicAuth.updateCredentials(t),this.fetchClient.setAuth(this.basicAuth)))},t.prototype.hookAuth=function(){var t=this;this.appState.currentUser.subscribe((function(e){if(e){t.injector.get("c8yAuth").headers=function(){return t.fetchClient.getFetchOptions({}).headers};var n=t.fetchClient.getFetchOptions({}).headers;if(n.Authorization){var o=n.Authorization.match(/basic\s(.*)$/i)[1];o&&t.setToken(o,n.tfatoken)}else t.setToken(void 0,n.tfatoken,"Oauth");t.injector.get("$rootScope").$emit("authStateChange",{hasAuth:!0})}else t.injector.get("$rootScope").$emit("authStateChange",{hasAuth:!1})}))},t.prototype.setToken=function(t,e,n){void 0===n&&(n="Basic");var o=this.injector.get("c8yAuth");"Basic"===n?(o.onSetToken({token:t,type:n}),e&&o.setTFAToken(e)):o.authReady()},t}();function E(t,e,n,o){return new B(t,e,n,o)}var U={provide:B,useFactory:E,deps:["$injector",c.BasicAuth,c.FetchClient,e.AppStateService]},_=function(){function t(){}return t=S([a.NgModule({imports:[e.RouterModule],exports:[],providers:[I,U,{provide:e.HOOK_NAVIGATOR_NODES,useClass:$,multi:!0},{provide:e.HOOK_TABS,useClass:P,multi:!0},{provide:e.HOOK_ACTION_BAR,useClass:O,multi:!0},{provide:e.HOOK_ACTION,useClass:D,multi:!0},{provide:e.HOOK_BREADCRUMB,useClass:N,multi:!0},{provide:e.HOOK_SEARCH,useClass:R,multi:!0},{provide:e.HOOK_DOCS,useClass:k,multi:!0}]})],t)}();var V=s.downgradeComponent({component:e.BootstrapComponent}),M=s.downgradeComponent({component:e.UserTotpRevokeComponent}),q=s.downgradeComponent({component:p.AppLogsAutoRefreshComponent}),F=s.downgradeComponent({component:e.DataGridComponent}),H=s.downgradeComponent({component:d.ImpactProviderSettingsComponent}),L=function(){function t(t,e){this.translateService=t,this.MESSAGE_PATTERNS=e}return t.prototype.translate=function(t){return this.translateService.instant(t)},t.ctorParameters=function(){return[{type:f.TranslateService},{type:void 0,decorators:[{type:a.Inject,args:[e.HOOK_PATTERN_MESSAGES]}]}]},t=S([a.Injectable(),C(1,a.Inject(e.HOOK_PATTERN_MESSAGES))],t)}(),K=s.downgradeInjectable(A),W=s.downgradeInjectable(B),z=s.downgradeInjectable(e.AppStateService),G=s.downgradeInjectable(e.HeaderService),Z=s.downgradeInjectable(e.AlertService),Q=s.downgradeInjectable(e.UserMenuService),J=s.downgradeInjectable(h.ApiService),X=s.downgradeInjectable(e.DocsService),Y=s.downgradeInjectable(e.PasswordService),tt=s.downgradeInjectable(f.TranslateService),et=s.downgradeInjectable(e.CachedLocaleDictionaryService),nt=s.downgradeInjectable(L),ot=s.downgradeInjectable(l.BulkOperationDetailsService);function rt(t,e,n){function o(t){var e=t.config,o=e.url,r=e.method;n.onFinish({url:o,method:r,response:t,options:t.config})}return{request:function(t){var e=t.url,o=t.method;return n.onStart({url:e,method:o,options:t}),t},requestError:function(e){return o(e),t.reject(e)},response:function(t){return o(t),t},responseError:function(n){return o(n),e.responseError(n),t.reject(n)}}}var it=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.addRoot=function(e){var n;return""===e.path&&(e.path="/"),e.label=e.name,"object"==typeof e.parent&&(e.parent.label=e.parent.name),e.preventDuplicates&&(n=this.find((function(t){var n=t.path,o=t.parents,r=t.label;return n===e.path&&r===e.label&&o.some((function(t){return t.label===e.parent}))})))&&(n.routerLinkExact=!1),n||t.prototype.addRoot.call(this,e)},e.prototype.createNode=function(e){var n=t.prototype.createNode.call(this,e),o=n.update.bind(n),i=this;return Object.defineProperties(r.assign(n,{realName:n.name||n.label,_parent:!0,update:function(t){void 0===this._parent&&(i.addRoot(this),this._parent=!0),o(t)},addChild:function(t){this.add(i.createNode(t))}}),{label:{get:function(){return this.realName||""},set:function(t){this.realName=t}},name:{get:function(){return this.realName||""},set:function(t){this.realName=t}},show:{get:function(){return!this.hidden},set:function(t){this.hidden=!t}}})},e}(e.NavigatorNodeRoot);var at={template:'\n  <c8y-bootstrap>\n    <div id="c8y-legacy-view">\n      <div ng-view ng-if="vm.widthSet && vm.authState.hasAuth"></div>\n    </div>\n  </c8y-bootstrap>',controller:function(t,e,n,o,r,i){var a=this;function c(t,e){a.authState=e}function s(){a.tabsHorizontal=n.appOption("tabsHorizontal")}function u(){var t=document.querySelector("#c8y-legacy-view");t&&t.clientWidth?a.widthSet=!0:e(u)}Object.assign(a,{$onInit:function(){i.map((function(t){return t.nav.open})).subscribe((function(t){a.navOpen=t})),i.configNavigator({canToggle:!0}),t.$on("authStateChange",c),a.rootNodes=o.rootNodes,r.currentAppCached().then(s),a.navHiddenOnStartup=n.appOption("hide_navigator"),u()},navOpen:!1})},controllerAs:"vm"};window.preventNg1Bootstrap=!0,u.module("c8y.upgrade",[]).config((function(t){var e=t.interceptors.indexOf("c8yLoadingIndicator");e>-1&&t.interceptors.splice(e,1),t.interceptors.push(rt)})).component("c8yUiRoot",at).directive("c8yBootstrap",V).factory("c8yBridgeService",K).factory("c8yAuthBridgeService",W).factory("c8yAppStateService",z).factory("c8yHeaderService",G).factory("c8yUserMenuService",Q).service("c8yQueriesUtil",(function(){return new c.QueriesUtil})).decorator("c8yTitle",(function(t,e,n,o,r,i,a,c){function s(e){t.when(e).then((function(t){return p(function(t){var e=t.title,n=t.subtitle,r=o.$new(!0);return r.title=e,r.subtitle=n,a(u.element('\n      <h1 class="text-truncate">{{title | translate}}\n      <small>{{ subtitle | translate }}</small></h1>\n    '))(r)[0]}(t))}))}function p(t){c.changeTitle(t)}function d(t){t.show(),p(t[0])}return e.changeTitle=s,e.setTitleElement=d,o.$on("$routeChangeStart",(function(){s({})})),o.$on("$routeChangeSuccess",(function(o){var c=e.get(r.path());c&&t.when(c.data?n.invoke(c.data):{}).then((function(t){var e=t.templateUrl;if(e){var n=i.get(e);d(a(n)(o.targetScope))}else s(t)}))})),e})).factory("c8yAlert",Z).decorator("c8yAlert",(function(t,e,n){for(var o in t.add=function(e){t.addAlert(r(e))},e.$on("alert",(function(e,n){t.addAlert(r(n))})),e.$on("message",(function(e,n){t.addAlert(r(n))})),t)"function"==typeof t[o]&&(t[o]=t[o].bind(t));function r(t){var e=b({},t);return t.onClose&&(e.onClose=function(){n.invoke(t.onClose)}),t.onDetail&&(e.onDetail=function(){n.invoke(t.onDetail)}),e}return t})).decorator("groupTypesHierarchyNavigator",(function(t,e){return t.loadAll=function(){return e.when()},t.addGroupNavigation=function(){return e.when()},t})).factory("c8yApiService",J).factory("c8yDocs",X).service("c8yPasswordConfirm",Y),u.module("c8y.ui").provider("c8yNavigator",(function(){var t=new it,e=new n.Subject,i=[],a=e.pipe(o.merge(n.defer((function(){return n.of(t.children)}))));function c(n){(Array.isArray(n)?n:[n]).forEach((function(e){(function(t){return t.showIf||t.showIfPermissions||t.showIfContainsVisibleViews})(e)&&(e.hidden=void 0,i.push(e)),e.navNode=t.addRoot(e)})),e.next(t.children)}function s(n){var o=t.find((function(t){return t===n}));o&&(o.parents.forEach((function(t){return t.remove(o)})),e.next(t.children))}function u(e){return t.find(e)}return{$get:function(e,n){function o(t){var o=n.get("c8yUiUtil"),i=[],a=t.showIf,c=t.showIfPermissions,s=t.showIfContainsVisibleViews;a&&i.push(n.invoke(a)),s&&i.push(function(t){var o=n.get("c8yUiUtil"),i=n.get("c8yViews").getByPath(t.path);return e.all(r.map(i,(function(t){return o.configureVisibility(r.pick(t,["showIf","showIfPermissions"]),"show",!1).then(r.property("show"))}))).then(r.some)}(t)),o.configureVisibility({showIf:function(){return e.all(i).then(r.every)},showIfPermissions:c},"visible").then((function(e){e.visible?t.navNode.update({hidden:!1,showIf:null,showIfPermission:null,showIfContainsVisibleViews:null}):t.navNode.update({hidden:!0})}))}return setTimeout((function(){return i.forEach(o)})),{rootNodes:function(){return t.children},findNode:u,addNavigation:c,removeNavigation:s,rootNodes$:a}},addNavigation:c,removeNavigation:s}})).provider("c8yViews",(function(t,o,i){var a={},c=new n.ReplaySubject;return{when:s,$get:function(){return{contextViews:c,when:function(t,e){return s(t,e,!0)},getByPath:u,prefixWithSlash:d}}};function s(n,s,u){var h=d(n);s.resolve=s.resolve||{},s.resolve.__c8y_locales=["c8yLocales",function(t){return t.initDone}];var l=a[h],f=h;s.name,l||(a[h]=[],l=a[h]);var g=Object.keys(e.ViewContext).map((function(t){return{key:t,isUpgrade:d(e.ViewContext[t].replace("id",m[t]))===n}})).find((function(t){return t.isUpgrade}));if(g){l.push(s),s.path=h;var v=i.appendSegment(f.replace(n,""),s.name);c.next(b({},s,{path:s.name?v.substring(1):"",contextKey:g.key,runPhase:u})),s.showIf=void 0,s.name&&(s.path=i.appendSegment(f,s.name))}else{if(1===l.length){var y=j(l,1)[0];y.path=i.appendSegment(f,y.name),y.tab=p(f,y),t.when(y.path,y)}l.push(s),s.path=h,l.length>1&&(s.path=i.appendSegment(f,s.name),p(f,s),t.when(d(f),{resolveRedirectTo:function(t,e,n,i,a){var c=o.sortTabsViews(l,a),s=t.current.pathParams;return e.all(r.map(c,r.unary(n.configureVisibility))).then((function(t){var e=r.find(t,"show").path;return r.forEach(s,(function(t,n){e=e.replace(":"+n,t)})),i.redirectedViewPath=e,e}))}}))}return t.when(d(s.path),s)}function u(t){return a[d(t)]}function p(t,e){o.addTab(t,e)}function d(t){return(r.startsWith(t,"/")?"":"/")+t}})).directive("c8yUserTotpRevoke",M).directive("c8yAppLogsAutoRefresh",q).directive("c8yImpactProviderSettings",H).directive("c8yDataGrid",F).factory("c8yTranslate",tt).factory("c8yCachedLocaleDictionaryService",et).factory("c8yBulkOperationDetailsService",ot).decorator("gettextCatalog",(function(t,e,n){var o=t,r=u.bind(o,o.getString);return o.getString=function(t,o,i){if("string"==typeof t){var a=r(t,o,i),c=o?e(t)(o):t,s=a;if(a&&a===c)s=n.instant(c);return s}return t},o})).factory("c8yServerMessages",nt).factory("ngZone",s.downgradeInjectable(a.NgZone));var ct=["app","c8y.upgrade"],st=function(){function t(){this.ng1Modules=ct}return t.prototype.ngDoBootstrap=function(){window.bootstrap(),this.upgrade.bootstrap(document.getElementById("app"),this.ng1Modules,{strictDi:!1})},t}(),ut=[{path:"**",component:e.EmptyComponent}],pt=function(){function t(t,e,n,o,r){this.ng1Injector=t,this.zone=e,this.router=n,this.contextDashboardService=o,this.actionBarService=r,this.dashboardSvc=t.get("dashboardSvc"),this.compile=t.get("$compile")}return Object.defineProperty(t.prototype,"ng1Components",{get:function(){return this.ng1Injector.get("c8yComponents")},enumerable:!0,configurable:!0}),t.prototype.instantiateComponent=function(t,e){return w(this,void 0,void 0,(function(){var n,o,r,i,a=this;return x(this,(function(c){switch(c.label){case 0:return n=t.dashboard,o=t.context,r=t.child,n?[4,this.dashboardSvc.transformChildWithContext(this.dashboardSvc.forcedContext||o,n,r)]:[3,4];case 1:return i=c.sent(),this.dashboardSvc.forcedContext||n.deviceType?[4,this.dashboardSvc.updateConfigTargetsWithContext(this.dashboardSvc.forcedContext||o,i.config)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2,this.zone.runOutsideAngular((function(){return a.loadTemplate(i,r,e,o)}))];case 4:return[2,this.loadConfigTemplate(e,t)]}}))}))},t.prototype.editDashboard=function(t){return w(this,void 0,void 0,(function(){return x(this,(function(e){return[2,this.dashboardSvc.editCurrentDashboard({dashboardId:t.id})]}))}))},t.prototype.copyDashboard=function(){var t=this.getDashboard();if(this.dashboardSvc.copyDashboard(t.c8y_Dashboard))return this.dashboardClipboard=t,this.actionBarService.refresh(),t},t.prototype.pasteDashboard=function(){return w(this,void 0,void 0,(function(){var t;return x(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.dashboardSvc.pasteDashboard()];case 1:return t=e.sent(),this.navigateToDashboard(t),this.dashboardClipboard=void 0,[3,3];case 2:return e.sent(),[3,3];case 3:return this.actionBarService.refresh(),[2]}}))}))},t.prototype.instantiateDeviceSelector=function(t,e){return this.loadConfigTemplate(t,e,!0)},t.prototype.loadTemplate=function(t,e,n,o){var r=this.ng1Injector.get("$rootScope").$new(!0);return r.child=t,r.dashboardContext=o,e.widgetComponent?n.innerHTML="<c8y-ui-component component-name=\"'"+e.widgetComponent+'\'" config="child.config" context="dashboardContext"></c8y-ui-component>':e.templateUrl&&(n.innerHTML="<ng-include src=\"'"+e.templateUrl+"'\"></ng-include>"),this.compile(n)(r),r},t.prototype.navigateToDashboard=function(t){/dashboard/.test(this.router.url)?this.router.navigate(["..",t.id],{relativeTo:e.getActivatedRoute(this.router)}):this.router.navigate(["..","dashboard",t.id],{relativeTo:e.getActivatedRoute(this.router)})},t.prototype.getDashboard=function(){return e.getActivatedRoute(this.router).snapshot.data.dashboard},t.prototype.loadConfigTemplate=function(t,n,o){var i=this;void 0===o&&(o=!1);var a=n.settings,c=this.ng1Injector.get("$rootScope").$new(!0);c.settings=b({},a,a.ng1),c.options=n.options,c.config=n,c.forms={},c.rootId=a.context.id,c.dashboard=r.get(n,"settings.dashboardMo");var s="";return o||(n.settings.configComponent?s="<c8y-ui-component component-name=\"'"+n.settings.configComponent+'\'" config="config"></c8y-ui-component>':n.settings.configTemplateUrl&&(s="<ng-include src=\"'"+n.settings.configTemplateUrl+"'\"></ng-include>")),t.innerHTML='\n    <ng-form name="forms.componentForm">\n      <div class="form-group"\n        ng-if="!settings.noDeviceTarget"\n        ng-style="{height: settings.hideTarget && \'0\', overflow: \'hidden\'}"\n      >\n        <label translate>'+e.gettext("Target assets or devices")+'</label>\n        <c8y-device-selector-combo parent="rootId"\n          selected-child-device="config.device"\n          groups-selectable="settings.groupsSelectable"\n          select-required="!settings.deviceTargetNotRequired"\n        ></c8y-device-selector-combo>\n      </div>\n      '+s+"\n    </ng-form>",c.$watch("forms.componentForm.$invalid",(function(t){i.contextDashboardService.formDisabled=t})),this.compile(t)(c),this.contextDashboardService.formDisabled=c.forms.componentForm.$invalid,c},t.ctorParameters=function(){return[{type:void 0},{type:a.NgZone},{type:i.Router},{type:g.ContextDashboardService},{type:e.ActionBarService}]},t=S([a.Injectable()],t)}(),dt=function(){function t(t,e,n){this.dashboard=t,this.dashboardBridgeService=e,this.el=n}return t.prototype.ngOnInit=function(){return w(this,void 0,void 0,(function(){var t,e=this;return x(this,(function(n){switch(n.label){case 0:return t=this,[4,this.dashboardBridgeService.instantiateComponent(this.config,this.el.nativeElement)];case 1:return t.ng1Scope=n.sent(),this.dashboard&&(this.resizeSubscription=this.dashboard.onChangeDashboard.subscribe((function(){e.ng1Scope.$broadcast("dashboardResize")}))),[2]}}))}))},t.prototype.ngOnDestroy=function(){this.ng1Scope&&this.ng1Scope.$destroy(),this.resizeSubscription&&this.resizeSubscription.unsubscribe()},t.ctorParameters=function(){return[{type:e.WidgetsDashboardComponent,decorators:[{type:a.Optional}]},{type:pt},{type:a.ElementRef}]},t=S([a.Component({selector:"c8y-widget-legacy",template:"",changeDetection:a.ChangeDetectionStrategy.OnPush}),C(0,a.Optional())],t)}(),ht=function(){function t(t,e){this.dashboardBridgeService=t,this.el=e}return t.prototype.ngOnInit=function(){return w(this,void 0,void 0,(function(){return x(this,(function(t){return this.ng1Scope=this.dashboardBridgeService.instantiateDeviceSelector(this.el.nativeElement,this.config),[2]}))}))},t.prototype.ngOnDestroy=function(){this.ng1Scope&&this.ng1Scope.$destroy()},t.ctorParameters=function(){return[{type:pt},{type:a.ElementRef}]},t=S([a.Component({selector:"c8y-device-selector-legacy",template:"",changeDetection:a.ChangeDetectionStrategy.OnPush})],t)}(),lt=function(){function t(t){this.bridge=t}return t.prototype.get=function(){return w(this,void 0,void 0,(function(){var t;return x(this,(function(e){switch(e.label){case 0:return[4,this.bridge.ng1Components.list()];case 1:return(t=e.sent().map((function(t){var e={settings:b({},t.options,{configTemplateUrl:t.configTemplateUrl,widgetComponent:t.widgetComponent,configComponent:t.configComponent,transformConfigWithContext:t.transformConfigWithContext||t.componentTransformConfigWithContext,upgrade:!0})};return e.settings.templateUrl=t.templateUrl,{id:t.name,label:t.nameDisplay||t.name,description:t.description,component:dt,configComponent:dt,previewImage:t.previewImage,data:e}}))).push({id:"device.selector.legacy",label:"Device selector",description:"",data:{settings:{noNewWidgets:!0,upgrade:!0}},component:ht}),[2,t]}}))}))},t.ctorParameters=function(){return[{type:pt}]},t=S([a.Injectable()],t)}(),ft=function(){function t(t,e){this.vcRef=t,this.dashboardBridgeService=e}return t.prototype.ngOnInit=function(){this.vcRef.createEmbeddedView(this.templateCopy)},t.prototype.copyDashboard=function(){this.dashboardBridgeService.copyDashboard()},t.ctorParameters=function(){return[{type:a.ViewContainerRef},{type:pt}]},S([a.ViewChild("templateCopy",{read:a.TemplateRef,static:!0})],t.prototype,"templateCopy",void 0),t=S([a.Component({selector:"c8y-copy-action-legacy",template:'\n    <ng-template #templateCopy>\n      <li>\n        <button title="{{\'Copy dashboard\' | translate}}" (click)="copyDashboard()">\n          <i class="fa fw fa-clone"></i>&nbsp;<span translate>Copy dashboard</span>\n        </button>\n      </li>\n    </ng-template>\n  '})],t)}(),gt=function(){function t(t,e){this.vcRef=t,this.dashboardBridgeService=e,this.dashboardName=""}return t.prototype.ngOnInit=function(){this.vcRef.createEmbeddedView(this.templatePaste),this.dashboardName=this.dashboardBridgeService.dashboardClipboard.c8y_Dashboard.name},t.prototype.pasteDashboard=function(){this.dashboardBridgeService.pasteDashboard()},t.ctorParameters=function(){return[{type:a.ViewContainerRef},{type:pt}]},S([a.ViewChild("templatePaste",{read:a.TemplateRef,static:!0})],t.prototype,"templatePaste",void 0),t=S([a.Component({selector:"c8y-paste-action-legacy",template:'\n    <ng-template #templatePaste>\n      <li>\n        <button title="{{\'Paste dashboard\' | translate}}" (click)="pasteDashboard()">\n          <i class="fa fw fa-clipboard"></i>&nbsp;<span translate>Paste dashboard</span>&nbsp;<span\n            >"{{ dashboardName }}"</span\n          >\n        </button>\n      </li>\n    </ng-template>\n  '})],t)}(),vt=function(){function t(t){this.dashboardBridgeService=t}return t.prototype.get=function(t){var n=[],o=!t.parent||t.snapshot.data.context?t.snapshot.data:t.parent.snapshot.data,r=o.contextData,i=r&&t.snapshot.data.dashboard&&[e.ViewContext.Device,e.ViewContext.Group].includes(o.context),a=r&&[e.ViewContext.Device,e.ViewContext.Group].includes(o.context)&&this.dashboardBridgeService.dashboardClipboard;return i&&n.push({priority:-20,placement:"more",template:ft}),a&&n.push({priority:-10,placement:"more",template:gt}),n},t.ctorParameters=function(){return[{type:pt}]},t=S([a.Injectable()],t)}(),yt=function(){function t(){}return t=S([a.NgModule({declarations:[ht,dt,ft,gt],entryComponents:[ht,dt,ft,gt],imports:[v.CommonModule,f.TranslateModule],providers:[{provide:pt,useFactory:mt,deps:["$injector",a.NgZone,i.Router,[new a.Optional,g.ContextDashboardService],e.ActionBarService]},{provide:e.HOOK_COMPONENTS,useClass:lt,multi:!0},{provide:e.HOOK_ACTION_BAR,useClass:vt,multi:!0}]})],t)}();function mt(t,e,n,o,r){return new pt(t,e,n,o,r)}t.AuthBridgeService=B,t.BridgeService=A,t.CopyActionComponent=ft,t.DashboardBridgeService=pt,t.DashboardUpgradeModule=yt,t.DeviceSelectorComponent=ht,t.HybridAppModule=st,t.Ng1ActionBarFactoryService=O,t.Ng1ActionFactoryService=D,t.Ng1BreadcrumbFactoryService=N,t.Ng1ComponentFactoryService=lt,t.Ng1DashboardActionFactoryService=vt,t.Ng1DocsFactoryService=k,t.Ng1NodesFactoryService=$,t.Ng1SearchFactoryService=R,t.Ng1TabsFactoryService=P,t.PasteActionComponent=gt,t.UPGRADE_ROUTES=ut,t.UpgradeModule=_,t.WidgetComponent=dt,t.authBridgeServiceFactory=E,t.authBridgeServiceProvider=U,t.bridgeServiceFactory=T,t.bridgeServiceProvider=I,t.dashboardBridgeFactory=mt,t.ng1Modules=ct,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=c8y-ngx-components-upgrade.umd.min.js.map