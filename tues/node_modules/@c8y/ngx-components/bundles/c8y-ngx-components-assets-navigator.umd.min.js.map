{"version":3,"sources":["../../../../node_modules/tslib/tslib.es6.js","ng://@c8y/ngx-components/assets-navigator/group-fragment.model.ts","ng://@c8y/ngx-components/assets-navigator/action.enum.ts","ng://@c8y/ngx-components/assets-navigator/load-more-node.ts","ng://@c8y/ngx-components/assets-navigator/asset-node.ts","ng://@c8y/ngx-components/assets-navigator/dynamic-group-node.ts","ng://@c8y/ngx-components/assets-navigator/asset-node-config.model.ts","ng://@c8y/ngx-components/assets-navigator/group.service.ts","ng://@c8y/ngx-components/assets-navigator/asset-node.service.ts","ng://@c8y/ngx-components/assets-navigator/asset-node.factory.ts","ng://@c8y/ngx-components/assets-navigator/assets-navigator.module.ts","ng://@c8y/ngx-components/assets-navigator/asset-selector/group-node.ts","ng://@c8y/ngx-components/assets-navigator/asset-selector/group-node.service.ts","ng://@c8y/ngx-components/assets-navigator/asset-selector/asset-selector.component.ts","ng://@c8y/ngx-components/assets-navigator/asset-selector/asset-selector-node.component.ts","ng://@c8y/ngx-components/assets-navigator/asset-selector/asset-selector.module.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__decorate","decorators","target","key","desc","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","__values","o","m","GroupFragment","Action","LoadMoreNode","_this","_super","priority","Infinity","gettext","icon","droppable","tslib_1.__extends","NavigatorNode","AssetNode","service","config","root","mo","path","isDeviceOrProbablyChildDevice","id","draggable","moduleConfig","disableDragAndDrop","routerLinkExact","updateIcon","onUpdateSubscription","onUpdate","subscribe","_a","data","method","refresh","name","groups","isGroup","DeviceStatusComponent","undefined","c8y_IsDevice","isDevice","isNeitherDeviceOrGroup","isDynamicGroup","openOnStart","url","test","matches","match","id_1","concat","get","some","managedObject","parents","forEach","node","events","REFRESH","click","options","preferBreadcrumb","hookEvents","open","FETCH","sort","children","a","addManagedObject","childAdditions","isChildAddition","add","createChildNode","references","destroy","unsubscribe","nodeToMove","draggedData","shouldGetChildOfItsOwn","find","child","isAlreadyChild","preventMove","dragStart","$event","rootNode","dragEnd","drop","canDrop","moveNode","draggedHover","Subject","evt","loading","handleEvent","fetch","getRootNodes","getGroupItems","addNodes","_c","NEXT","loadMoreNode","_b","paging","empty","res","currentPage","nextPage","pageSize","itemsCount","moreItemsAvailable","toggleLoadMore","map","LOADING_DONE","show","hidden","showDropConfirm","isCopy","verifyNodeAccess","addMovedNode","removeMovedNode","expand","alert","addServerFailure","ex_1","confirm","title","message","buttons","action","status","inventory","update","type","groupType","childAssetsAdd","tslib_1.__values","parent_1","dynamicGroupType","subGroupType","_d","childAssetsRemove","remove","DynamicGroupNode","c8y_DeviceQueryString","getDynamicGroupItems","query","ASSET_NAVIGATOR_CONFIG","InjectionToken","DeviceGroupService","icons","brokerSourceInactive","brokerSource","iconOpen","group","dynamicGroup","other","iconClass","dataBrokerSourceFragmentInactive","dataBrokerSourceFragment","groupFragmentType","dynamicGroupFragment","isDataBroker","isDataBrokerActive","Injectable","AssetNodeService","apiService","modal","breadcrumbService","user","appState","firstUrl","PAGE_SIZE","rootNodePriority","createRootNode","createAssetNode","createDynamicGroupNode","hasRole","currentUser","rootQueryFilter","rootNodeFilter","createFilter","withChildren","onlyRoots","list","groupFilter","fragmentType","withTotalPages","list$","hot","pagingStrategy","PagingStrategy","NONE","realtime","toPromise","moId","childAssetsList","groupQueryFilter","dynamicGroupfilter","q","rootFilter","smartGroups","join","hookResponse","includes","RegExp","pipe","filter","mergeMap","resolveData","response","c8y_Dashboard","isNewManagedObjectRoot","isRootAsset","selectPreferredByPath","extraParams","InventoryService","ApiService","ModalService","AlertService","BreadcrumbService","UserService","AppStateService","Optional","Inject","args","tslib_1.__param","AssetNodeFactory","AssetsNavigatorModule","ngModule","AssetsNavigatorModule_1","providers","provide","useValue","NgModule","declarations","imports","ModalModule","DeviceStatusModule","HOOK_NAVIGATOR_NODES","useClass","multi","entryComponents","GroupNode","GroupNodeService","createGroupNode","subassetsQueryFilter","AssetSelectorComponent","groupNodeService","selected","onChange","EventEmitter","ngOnInit","select","selectedMo","getIndexOfSelected","emit","deselect","index","splice","findIndex","tslib_1.__decorate","Input","Output","Component","selector","template","AssetSelectorNodeComponent","translateService","cd","parentNode","preselected","showPath","level","checked","unsubscribe$","breadcrumb","setupBreadcrumbsAndLevel","takeUntil","markForCheck","isPreselected","instant","updateSelection","ngOnDestroy","complete","TranslateService","ChangeDetectorRef","AssetSelectorModule","CommonModule","CollapseModule","BsDropdownModule","exports"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","export enum GroupFragment {\n  groupType = 'c8y_DeviceGroup',\n  subGroupType = 'c8y_DeviceSubgroup',\n  groupFragmentType = 'c8y_IsDeviceGroup',\n  dataBrokerSourceFragment = 'c8y_BrokerSource',\n  dynamicGroupType = 'c8y_DynamicGroup',\n  dynamicGroupFragment = 'c8y_IsDynamicGroup',\n  dynamicGroupColumnConfig = 'c8y_UIDeviceFilterConfig',\n  dynamicGroupQueryString = 'c8y_DeviceQueryString',\n}\n","export enum Action {\n  FETCH,\n  NEXT,\n  REFRESH,\n  LOADING_DONE\n}\n","import { NavigatorNode, gettext } from '@c8y/ngx-components';\n\nexport class LoadMoreNode extends NavigatorNode {\n  priority = -Infinity;\n  label = gettext('Load more');\n  icon = 'plus';\n  droppable = true;\n}\n","import { Paging } from '@c8y/client';\nimport { ClickOptions, gettext, NavigatorNode, DeviceStatusComponent } from '@c8y/ngx-components';\nimport { get, has } from 'lodash-es';\nimport { Subject, Subscription } from 'rxjs';\nimport { AssetNodeMo, AssetNodeService } from './asset-node.service';\nimport { LoadMoreNode } from './load-more-node';\nimport { GroupFragment } from './group-fragment.model';\nimport { Action } from './action.enum';\n\nexport class AssetNode extends NavigatorNode {\n  root: boolean;\n  mo: any;\n\n  get label() {\n    return (this.root && gettext('Groups')) || this.mo.name || '--';\n  }\n\n  get hasChildren() {\n    return this.root || this.service.groups.isGroup(this.mo);\n  }\n\n  get iconComponent() {\n    return this.isDeviceOrProbablyChildDevice ? DeviceStatusComponent : undefined;\n  }\n\n  get isDevice() {\n    return !!this.mo.c8y_IsDevice;\n  }\n\n  get isDeviceOrProbablyChildDevice() {\n    return this.isDevice || this.isNeitherDeviceOrGroup;\n  }\n\n  get isNeitherDeviceOrGroup() {\n    const { isGroup, isDynamicGroup } = this.service.groups;\n    return !isGroup(this.mo) && !isDynamicGroup(this.mo) && !this.isDevice && !this.root;\n  }\n\n  events: Subject<Action>;\n  protected paging: Paging<AssetNodeMo>;\n  protected loadMoreNode: LoadMoreNode;\n  private onUpdateSubscription: Subscription;\n\n  constructor(protected service: AssetNodeService, config = {}) {\n    super(config);\n    this.root = this.root || false;\n    this.mo = this.mo || {};\n    this.path = this.root\n      ? 'group'\n      : this.isDeviceOrProbablyChildDevice\n      ? `device/${this.mo.id}`\n      : `group/${this.mo.id}`;\n    this.draggable = !this.service.moduleConfig.disableDragAndDrop && !this.root;\n    this.droppable =\n      !this.service.moduleConfig.disableDragAndDrop && !this.isDeviceOrProbablyChildDevice;\n    this.routerLinkExact = this.root;\n    this.updateIcon(false);\n    this.onUpdateSubscription = this.service\n      .onUpdate(this)\n      .subscribe(({ data, method }) => this.refresh(data, method));\n  }\n\n  openOnStart(url) {\n    const urlRegex = /^\\/group\\//;\n    if (this.root) {\n      if (this.service.moduleConfig.openOnStart || urlRegex.test(url)) {\n        return true;\n      }\n    }\n    const matches = url.match(/\\/(group)\\/(\\d+)/);\n    let isMatch = false;\n    if (matches) {\n      const id = matches[2];\n      isMatch = []\n        .concat(get(this.mo, 'childAssets.references', []))\n        .some(({ managedObject }) => managedObject.id === id);\n      return isMatch;\n    }\n    return false;\n  }\n\n  refresh(mo: any = {}, method = 'GET') {\n    if (mo.id === this.mo.id) {\n      this.mo = mo;\n    } else if (method === 'DELETE') {\n      this.parents.forEach((node: AssetNode) => node.refresh());\n      return;\n    }\n    if (this.events) {\n      this.events.next(Action.REFRESH);\n    }\n  }\n\n  click(options: ClickOptions = {}) {\n    if (this.isDeviceOrProbablyChildDevice) {\n      this.service.preferBreadcrumb(this.parents);\n      return;\n    }\n    this.hookEvents();\n\n    this.updateIcon(options.open);\n    if (options.open) {\n      this.events.next(Action.FETCH);\n    }\n  }\n\n  sort() {\n    this.children.sort((a, b) => {\n      if (a.priority > b.priority) {\n        return -1;\n      } else if (a.priority < b.priority) {\n        return 1;\n      } else {\n        return 0;\n      }\n    });\n  }\n\n  addManagedObject(mo) {\n    const { childAdditions } = this.mo;\n    if (!this.isChildAddition(childAdditions, mo)) {\n      this.add(this.service.createChildNode(mo));\n    }\n  }\n\n  isChildAddition(childAdditions, mo) {\n    return (\n      childAdditions && childAdditions.references.some(({ managedObject: { id } }) => id === mo.id)\n    );\n  }\n\n  destroy() {\n    this.onUpdateSubscription.unsubscribe();\n  }\n\n  get canDrop() {\n    const nodeToMove = this.service.draggedData;\n    if (nodeToMove) {\n      const shouldGetChildOfItsOwn = !!nodeToMove.find(child => child === this);\n      const isAlreadyChild = (this.children as AssetNode[]).some(\n        child => child.mo && child.mo.id === nodeToMove.mo.id\n      );\n      const preventMove = this === nodeToMove || shouldGetChildOfItsOwn || isAlreadyChild;\n      return this.droppable && !preventMove;\n    }\n    return this.droppable;\n  }\n\n  dragStart($event) {\n    super.dragStart($event);\n    this.service.draggedData = this;\n    this.service.rootNode.droppable = !this.isDeviceOrProbablyChildDevice;\n  }\n\n  dragEnd($event) {\n    super.dragEnd($event);\n  }\n\n  async drop($event) {\n    super.drop($event);\n    const nodeToMove = this.service.draggedData;\n    if (this.canDrop) {\n      await this.moveNode(nodeToMove);\n    } else {\n      this.draggedHover = false;\n      this.service.draggedData = undefined;\n    }\n  }\n\n  hookEvents() {\n    if (!this.events) {\n      this.events = new Subject();\n      this.events.subscribe(evt => {\n        if (!this.loading) {\n          this.handleEvent(evt);\n        }\n      });\n    }\n  }\n\n  protected fetch() {\n    return this.root ? this.service.getRootNodes() : this.service.getGroupItems(this.mo.id);\n  }\n\n  protected async handleEvent(evt: Action) {\n    if (!this.children.length && evt === Action.FETCH) {\n      this.loading = true;\n      this.addNodes(await this.fetch());\n      this.loading = false;\n    } else if (evt === Action.NEXT) {\n      this.loadMoreNode.loading = true;\n      this.addNodes(await this.paging.next());\n      this.loadMoreNode.loading = false;\n    } else if (evt === Action.REFRESH) {\n      this.loading = false;\n      this.paging = undefined;\n      this.loadMoreNode = undefined;\n      this.empty();\n      this.events.next(Action.FETCH);\n    }\n  }\n\n  protected addNodes(res) {\n    if (res.paging) {\n      const { currentPage, nextPage, pageSize } = (this.paging = res.paging);\n      if (currentPage === 1) {\n        this.empty();\n      }\n      const itemsCount = res.data.length;\n      const moreItemsAvailable = !!nextPage && itemsCount === pageSize;\n      this.toggleLoadMore(moreItemsAvailable);\n    }\n    (res.data || res).map(mo => this.addManagedObject(mo));\n    this.events.next(Action.LOADING_DONE);\n  }\n\n  protected toggleLoadMore(show: boolean) {\n    if (!this.loadMoreNode && show) {\n      this.loadMoreNode = new LoadMoreNode();\n      this.add(this.loadMoreNode);\n      this.loadMoreNode.click = () => this.events.next(Action.NEXT);\n    }\n\n    if (this.loadMoreNode) {\n      this.loadMoreNode.hidden = !show;\n    }\n  }\n\n  private async moveNode(nodeToMove: AssetNode) {\n    try {\n      const isCopy = await this.showDropConfirm(nodeToMove);\n      await this.verifyNodeAccess(nodeToMove);\n      await this.addMovedNode(nodeToMove);\n      if (!isCopy) {\n        await this.removeMovedNode(nodeToMove);\n      }\n      this.expand();\n    } catch (ex) {\n      if (ex) {\n        this.service.alert.addServerFailure(ex);\n      }\n    } finally {\n      this.draggedHover = false;\n      this.service.draggedData = undefined;\n    }\n  }\n\n  private async showDropConfirm(nodeToMove: AssetNode) {\n    this.confirm.title = gettext('Move');\n    this.confirm.message = gettext('Do you want to move the group?');\n    const buttons: any = [\n      {\n        label: gettext('Cancel'),\n        action: () => Promise.reject()\n      },\n      {\n        label: gettext('Move'),\n        status: 'default',\n        action: () => Promise.resolve(false)\n      }\n    ];\n    if (nodeToMove.isDeviceOrProbablyChildDevice) {\n      this.confirm.title = gettext('Move or add');\n      this.confirm.message = gettext('Do you want to move or add the device?');\n      buttons.push({\n        label: gettext('Add'),\n        status: 'primary',\n        action: () => Promise.resolve(true)\n      });\n    }\n    return this.confirm.show(buttons);\n  }\n\n  private async verifyNodeAccess(nodeToMove: AssetNode) {\n    return this.service.inventory.update({ id: nodeToMove.mo.id });\n  }\n\n  private async addMovedNode(nodeToMove: AssetNode) {\n    let mo;\n    if (this.root) {\n      const { data } = await this.service.inventory.update({\n        id: nodeToMove.mo.id,\n        type: GroupFragment.groupType\n      });\n      mo = data;\n    } else {\n      const { data } = await this.service.inventory.childAssetsAdd(nodeToMove.mo, this.mo);\n      mo = data;\n    }\n    this.addManagedObject(mo);\n  }\n\n  private async removeMovedNode(nodeToMove: AssetNode) {\n    for (const parent of nodeToMove.parents as AssetNode[]) {\n      if (parent.mo && parent.mo.type === GroupFragment.dynamicGroupType) {\n        break; // smart groups don't need to be changed\n      }\n      if (parent.root) {\n        await this.service.inventory.update({\n          id: nodeToMove.mo.id,\n          type: GroupFragment.subGroupType\n        });\n      } else {\n        await this.service.inventory.childAssetsRemove(nodeToMove.mo, parent.mo);\n      }\n      parent.remove(nodeToMove);\n    }\n  }\n\n  private updateIcon(open) {\n    this.icon = this.service.groups.icon(\n      // if it's root we are going to pass a fake mo to get the same icon as groups\n      this.root ? { type: GroupFragment.groupType } : this.mo,\n      open\n    );\n  }\n}\n","\nimport { AssetNode } from './asset-node';\nimport { AssetNodeService } from './asset-node.service';\n\nexport class DynamicGroupNode extends AssetNode {\n  constructor(\n    protected service: AssetNodeService,\n    config = {}\n  ) {\n    super(service, config);\n    this.draggable = false;\n    this.droppable = false;\n  }\n\n  get hasChildren() {\n    return true;\n  }\n\n  get query() {\n    return this.mo.c8y_DeviceQueryString;\n  }\n\n  protected fetch(): any {\n    return this.service.getDynamicGroupItems(this.query);\n  }\n}\n","import { InjectionToken } from '@angular/core';\r\nexport const ASSET_NAVIGATOR_CONFIG = new InjectionToken<AssetNavigatorConfig>('AssetNodeConfig');\r\n\r\nexport interface AssetNavigatorConfig {\r\n  smartGroups?: boolean;\r\n  openOnStart?: boolean;\r\n  rootNodePriority?: number;\r\n  disableDragAndDrop?: boolean;\r\n}\r\n","import { Injectable } from '@angular/core';\nimport { GroupFragment } from './group-fragment.model';\n\n@Injectable()\nexport class DeviceGroupService {\n  icons = {\n    brokerSourceInactive: {\n      icon: 'c8y-group-remote-inactive'\n    },\n    brokerSource: {\n      icon: 'c8y-group-remote',\n      iconOpen: 'c8y-group-remote-open'\n    },\n    group: {\n      icon: 'c8y-group',\n      iconOpen: 'c8y-group-open'\n    },\n    dynamicGroup: {\n      icon: 'c8y-group-smart',\n      iconOpen: 'c8y-group-smart-open'\n    },\n    other: {\n      icon: 'circle',\n      iconClass: 'statusUnknown'\n    }\n  };\n  dataBrokerSourceFragmentInactive = `_${GroupFragment.dataBrokerSourceFragment}`;\n\n  isGroup(mo) {\n    return !!mo[GroupFragment.groupFragmentType] || mo.type === GroupFragment.groupType || mo.type === GroupFragment.subGroupType;\n  }\n\n  isDynamicGroup(mo) {\n    return !!mo[GroupFragment.dynamicGroupFragment] || mo.type === GroupFragment.dynamicGroupType;\n  }\n\n  isDataBroker(mo) {\n    return !!mo[GroupFragment.dataBrokerSourceFragment] || !!mo[this.dataBrokerSourceFragmentInactive];\n  }\n\n  isDataBrokerActive(mo) {\n    return !!mo[GroupFragment.dataBrokerSourceFragment] && !mo[this.dataBrokerSourceFragmentInactive];\n  }\n\n  icon(mo, open) {\n    let type = 'other';\n    if (this.isDynamicGroup(mo)) {\n      type = 'dynamicGroup';\n    } else if (this.isDataBrokerActive(mo)) {\n      type = 'brokerSource';\n    } else if (this.isDataBroker(mo)) {\n      type = 'brokerSourceInactive';\n    } else if (this.isGroup(mo)) {\n      type = 'group';\n    }\n    const icon = this.icons[type];\n    return (open && icon.iconOpen) || icon.icon;\n  }\n}\n","import { Inject, Injectable, Optional } from '@angular/core';\nimport { InventoryService, UserService, PagingStrategy } from '@c8y/client';\nimport {\n  AlertService,\n  BreadcrumbService,\n  ModalService,\n  NavigatorNode,\n  AppStateService\n} from '@c8y/ngx-components';\nimport { ApiService } from '@c8y/ngx-components/api';\nimport { empty } from 'rxjs';\nimport { filter, mergeMap, map, scan } from 'rxjs/operators';\nimport { AssetNode } from './asset-node';\nimport { AssetNavigatorConfig, ASSET_NAVIGATOR_CONFIG } from './asset-node-config.model';\nimport { DynamicGroupNode } from './dynamic-group-node';\nimport { GroupFragment } from './group-fragment.model';\nimport { DeviceGroupService } from './group.service';\nimport { flatMap, includes, reject, map as ldMap } from 'lodash-es';\n\nexport interface AssetNodeMo {\n  id: string;\n  type: string;\n}\n\n@Injectable()\nexport class AssetNodeService {\n  rootNode: AssetNode;\n  firstUrl = true;\n  draggedData: AssetNode;\n  protected PAGE_SIZE = 20;\n\n  constructor(\n    public inventory: InventoryService,\n    public groups: DeviceGroupService,\n    public apiService: ApiService,\n    public modal: ModalService,\n    public alert: AlertService,\n    protected breadcrumbService: BreadcrumbService,\n    protected user: UserService,\n    protected appState: AppStateService,\n    @Optional() @Inject(ASSET_NAVIGATOR_CONFIG) public moduleConfig: AssetNavigatorConfig\n  ) {\n    this.moduleConfig = {\n      rootNodePriority: 2000,\n      ...(moduleConfig || {})\n    };\n  }\n\n  createRootNode() {\n    this.rootNode = this.createAssetNode({\n      root: true,\n      priority: this.moduleConfig.rootNodePriority\n    });\n    return this.rootNode;\n  }\n\n  createDynamicGroupNode(config) {\n    return new DynamicGroupNode(this, config);\n  }\n\n  createAssetNode(config) {\n    return new AssetNode(this, config);\n  }\n\n  createChildNode(managedObject) {\n    const { type } = managedObject;\n    const config: Partial<AssetNode> = { mo: managedObject };\n    if (type === GroupFragment.dynamicGroupType) {\n      return this.createDynamicGroupNode(config);\n    }\n    return this.createAssetNode(config);\n  }\n\n  getRootNodes(): Promise<any> {\n    if (this.user.hasRole(this.appState.currentUser.value, 'ROLE_INVENTORY_READ')) {\n      const query = this.rootQueryFilter();\n      const rootNodeFilter = this.createFilter({\n        query,\n        pageSize: this.PAGE_SIZE,\n        withChildren: false,\n        onlyRoots: true\n      });\n      return this.inventory.list(rootNodeFilter);\n    } else {\n      const groupFilter = this.createFilter({\n        fragmentType: GroupFragment.groupFragmentType,\n        withTotalPages: true,\n        withChildren: false,\n        pageSize: this.PAGE_SIZE,\n        onlyRoots: true\n      });\n      return this.inventory\n        .list$(groupFilter, {\n          hot: false,\n          pagingStrategy: PagingStrategy.NONE,\n          realtime: false\n        })\n        .toPromise();\n    }\n  }\n\n  getGroupItems(moId: string): Promise<any> {\n    return this.inventory.childAssetsList(moId, { withChildren: false, pageSize: this.PAGE_SIZE, query: this.groupQueryFilter(moId) });\n  }\n\n  getDynamicGroupItems(query: string): Promise<any> {\n    const dynamicGroupfilter = this.createFilter({ q: query });\n    return this.inventory.list(dynamicGroupfilter);\n  }\n\n  groupQueryFilter(moId: string) {\n    return `$filter=(bygroupid(${moId}))$orderby=name`;\n  }\n\n  rootQueryFilter() {\n    const { moduleConfig } = this;\n    const rootFilter = [`(type eq '${GroupFragment.groupType}')`];\n    if (moduleConfig.smartGroups) {\n      rootFilter.push(\n        `(type eq '${GroupFragment.dynamicGroupType}' and has(${\n          GroupFragment.dynamicGroupFragment\n        }) and not(has(${GroupFragment.dynamicGroupFragment}.invisible)))`\n      );\n    }\n    return `$filter=(${rootFilter.join(' or ')})$orderby=name`;\n  }\n\n  onUpdate({ mo, root }) {\n    if (mo.id) {\n      return this.apiService\n        .hookResponse(\n          ({ url, method }) =>\n            ['PUT', 'DELETE', 'POST'].includes(method) &&\n            RegExp(`((inventory/managedObjects)|(service/smartgroup/smartgroups))/${mo.id}`).test(\n              url\n            )\n        )\n        .pipe(\n          filter(() => !this.draggedData),\n          mergeMap(this.apiService.resolveData),\n          filter(response => !response.data.c8y_Dashboard)\n        );\n    } else if (root) {\n      return this.apiService.hookResponse(\n        ({ url, method, options }) =>\n          RegExp('((inventory/managedObjects)|(service/smartgroup/smartgroups))/?$').test(url) &&\n          method === 'POST' &&\n          this.isNewManagedObjectRoot(options)\n      );\n    } else {\n      return empty();\n    }\n  }\n\n  isNewManagedObjectRoot(options: any = {}) {\n    const { data } = options;\n    let isRootAsset = false;\n    if (typeof data === 'object') {\n      isRootAsset = !!data[GroupFragment.groupFragmentType];\n      if (!isRootAsset && this.moduleConfig.smartGroups) {\n        isRootAsset = !!data[GroupFragment.dynamicGroupFragment];\n      }\n    }\n    return isRootAsset;\n  }\n\n  /**\n   * There could be multiple breadcrumbs for devices,\n   * so we set a preferred one on click on a device.\n   * @param parents The parent nodes of the device to select the prefered one.\n   */\n  preferBreadcrumb(parents: NavigatorNode[]) {\n    if (parents.length === 1) {\n      this.breadcrumbService.selectPreferredByPath(parents[0].path);\n    }\n  }\n\n  protected createFilter(extraParams: any = {}) {\n    const params = {\n      currentPage: 1,\n      withTotalPages: true,\n      pageSize: 10\n    };\n    return { ...params, ...extraParams };\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { AssetNodeService } from './asset-node.service';\nimport { NavigatorNode } from '@c8y/ngx-components';\n\n@Injectable()\nexport class AssetNodeFactory {\n  constructor(private service: AssetNodeService) {}\n\n  get(): NavigatorNode {\n    if (!this.service.rootNode) {\n      this.service.createRootNode();\n    }\n    return this.service.rootNode;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { HOOK_NAVIGATOR_NODES, ModalModule, ModalService, DeviceStatusComponent, DeviceStatusModule} from '@c8y/ngx-components';\nimport { ASSET_NAVIGATOR_CONFIG} from './asset-node-config.model';\nimport { AssetNodeFactory } from './asset-node.factory';\nimport { AssetNodeService } from './asset-node.service';\nimport { AssetNavigatorConfig } from './asset-node-config.model';\nimport { DeviceGroupService } from './group.service';\n\n@NgModule({\n  declarations: [],\n  imports: [\n    ModalModule,\n    DeviceStatusModule\n  ],\n  providers: [\n    ModalService,\n    AssetNodeService,\n    DeviceGroupService,\n    {\n      provide: HOOK_NAVIGATOR_NODES, useClass: AssetNodeFactory, multi: true\n    }\n  ],\n  entryComponents: [DeviceStatusComponent]\n})\nexport class AssetsNavigatorModule {\n  static config(config: AssetNavigatorConfig): ModuleWithProviders {\n    return {\n      ngModule: AssetsNavigatorModule,\n      providers: [\n        {\n          provide: ASSET_NAVIGATOR_CONFIG, useValue: config\n        }\n      ],\n    };\n  }\n\n}\n","import { GroupNodeService } from './group-node.service';\nimport { AssetNode } from '../asset-node';\n\nexport class GroupNode extends AssetNode {\n  // FIXME: Currently hasChildren returns true if it is a group,\n  //        Issue is, that we disable the children in the API\n  //        getGroupItems service call due to performance. This leads\n  //        to that the dropdown chevron is shown always. Issue is,\n  //        that even if we return the chevrons, we have no way to determine\n  //        if the childAssets contain groups or other assets (like dashboards).\n  // get hasChildren() {\n  //  return this.root || this.service.groups.isGroup(this.mo) && (this.mo as IManagedObject).childAssets.references.length > 0;\n  // }\n\n  /**\n   * Creates a new node which shows only groups.\n   *\n   * @param service The service to use.\n   * @param config  The default configuration of the node.\n   */\n  constructor(protected service: GroupNodeService, config = {}) {\n    super(service, config);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { AssetNodeService } from '../asset-node.service';\nimport { GroupFragment } from '../group-fragment.model';\nimport { GroupNode } from './group-node';\n\n@Injectable()\nexport class GroupNodeService extends AssetNodeService {\n  rootNode: GroupNode;\n  draggedData: GroupNode;\n  protected PAGE_SIZE = 5;\n\n  createGroupNode(config) {\n    return new GroupNode(this, config);\n  }\n\n  createChildNode(managedObject): GroupNode {\n    const config: Partial<GroupNode> = { mo: managedObject };\n    return this.createGroupNode(config);\n  }\n\n  subassetsQueryFilter() {\n    const { moduleConfig } = this;\n    const groupFilter = [`(type eq '${GroupFragment.groupType}')`];\n    if (moduleConfig.smartGroups) {\n      groupFilter.push(`(has(${GroupFragment.groupFragmentType}))`);\n      groupFilter.push(\n        `(type eq '${GroupFragment.dynamicGroupType}' and has(${\n          GroupFragment.dynamicGroupFragment\n        }) and not(has(${GroupFragment.dynamicGroupFragment}.invisible)))`\n      );\n    }\n    return `$filter=(${groupFilter.join(' or ')})$orderby=name`;\n  }\n\n  getGroupItems(moId: string): Promise<any> {\n    return this.inventory.childAssetsList(moId, {\n      query: this.subassetsQueryFilter(),\n      withChildren: false,\n      pageSize: this.PAGE_SIZE,\n      withTotalPages: true\n    });\n  }\n}\n","import { Component, Output, Input, EventEmitter, OnInit } from '@angular/core';\nimport { GroupNodeService } from './group-node.service';\nimport { GroupNode } from './group-node';\nimport { IManagedObject } from '@c8y/client';\n\n/**\n * Displays a hierarchical tree selector for assets.\n */\n@Component({\n  selector: 'c8y-asset-selector',\n  templateUrl: './asset-selector.component.html'\n})\nexport class AssetSelectorComponent implements OnInit {\n  /**\n   * An array of predefined nodes.\n   */\n  @Input() selected: IManagedObject[] = [];\n  /**\n   * Emits if one item was selected (all currently selected nodes).\n   */\n  @Output() onChange = new EventEmitter<IManagedObject[]>();\n  /**\n   * @ignore\n   */\n  rootNode: GroupNode;\n\n  /**\n   * @ignore only DI\n   */\n  constructor(private groupNodeService: GroupNodeService) {}\n\n  /**\n   * @ignore\n   */\n  ngOnInit(): void {\n    this.rootNode = this.groupNodeService.createGroupNode({ root: true });\n  }\n\n  /**\n   * Adds an managed object to the selected array and emits the change.\n   * @param selectedMo The selected asset.\n   */\n  select(selectedMo: IManagedObject) {\n    const index = this.getIndexOfSelected(this.selected, selectedMo);\n    if (index === -1) {\n      this.selected.push(selectedMo);\n    }\n    this.onChange.emit(this.selected);\n  }\n\n  /**\n   * Removes a managed object from the selected array and emits the change.\n   * @param selectedMo The selected asset.\n   */\n  deselect(selectedMo: IManagedObject) {\n    const index = this.getIndexOfSelected(this.selected, selectedMo);\n    if (index > -1) {\n      this.selected.splice(index, 1);\n    }\n    this.onChange.emit(this.selected);\n  }\n\n  getIndexOfSelected(selected: Array<Partial<IManagedObject>>, selectedMo: IManagedObject) {\n    return selected.findIndex(mo => mo.id === selectedMo.id);\n  }\n}\n","import { Component, Input, OnInit, ChangeDetectorRef } from '@angular/core';\nimport { gettext } from '@c8y/ngx-components';\nimport { TranslateService } from '@ngx-translate/core';\nimport { GroupNode } from './group-node';\nimport { Subject } from 'rxjs';\nimport { takeUntil, filter } from 'rxjs/operators';\nimport { Action } from '../action.enum';\nimport { AssetSelectorComponent } from './asset-selector.component';\nimport { IManagedObject } from '@c8y/client';\n\n@Component({\n  selector: 'c8y-asset-selector-node',\n  templateUrl: './asset-selector-node.component.html'\n})\nexport class AssetSelectorNodeComponent implements OnInit {\n  /**\n   * The current node.\n   */\n  @Input() node: GroupNode;\n  /**\n   * All preselected items\n   */\n  @Input() preselected: Array<Partial<IManagedObject>> = [];\n  /**\n   *  Should the path be shown\n   */\n  @Input() showPath: boolean = false;\n  /**\n   * The current path to the node\n   */\n  breadcrumb: string;\n  /**\n   * @ignore\n   */\n  level: number = 0;\n  /**\n   * The selection status of the node\n   */\n  checked: boolean = false;\n  /**\n   * @ignore\n   */\n  unsubscribe$ = new Subject<any>();\n\n  /**\n   * @ignore\n   */\n  get expandTitle() {\n    return !this.node.open ? gettext('Expand') : gettext('Collapse');\n  }\n\n  /**\n   * @ignore only di\n   */\n  constructor(\n    private translateService: TranslateService,\n    private cd: ChangeDetectorRef,\n    private parentNode: AssetSelectorComponent\n  ) {}\n\n  /**\n   * @ignore\n   */\n  async ngOnInit() {\n    this.breadcrumb = this.node.label;\n    this.setupBreadcrumbsAndLevel(this.node);\n\n    if (this.node instanceof GroupNode) {\n      this.node.hookEvents();\n    }\n\n    // open on startup\n    if (this.node.root) {\n      this.click();\n    }\n\n    if (this.node.events) {\n      this.node.events\n        .pipe(\n          takeUntil(this.unsubscribe$),\n          filter((a: Action) => a === Action.LOADING_DONE)\n        )\n        .subscribe(() => {\n          this.cd.markForCheck();\n        });\n    }\n\n    this.checked = this.isPreselected();\n  }\n\n  /**\n   * Opens a node.\n   */\n  click() {\n    this.node.open = !this.node.open;\n    this.node.click({ open: this.node.open });\n  }\n\n  /**\n   * TODO: Only level used. Breadcrumbs needs to be implemented.\n   */\n  setupBreadcrumbsAndLevel(node: GroupNode) {\n    if (node.parents && node.parents.length) {\n      const parent = node.parents[0] as GroupNode;\n      this.breadcrumb = this.translateService.instant(parent.label) + ' > ' + this.breadcrumb;\n      this.level++;\n\n      this.setupBreadcrumbsAndLevel(parent);\n    }\n  }\n\n  /**\n   * Selects the node and emits a change on the parent component.\n   * @param node The node to select.\n   */\n  selected(node: GroupNode) {\n    this.checked = !this.checked;\n    this.updateSelection(node.mo);\n  }\n\n  /**\n   * @ignore\n   */\n  ngOnDestroy(): void {\n    this.unsubscribe$.next(true);\n    this.unsubscribe$.complete();\n  }\n\n  private isPreselected() {\n    if (this.node.root || !this.node.mo) {\n      return false;\n    }\n    return this.parentNode.getIndexOfSelected(this.preselected, this.node.mo) > -1;\n  }\n\n  private updateSelection(selectedMo: IManagedObject) {\n    if (this.checked) {\n      this.parentNode.select(selectedMo);\n      return;\n    }\n    this.parentNode.deselect(selectedMo);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@c8y/ngx-components';\nimport { CollapseModule } from 'ngx-bootstrap/collapse';\nimport { BsDropdownModule } from 'ngx-bootstrap/dropdown';\nimport { GroupNodeService } from './group-node.service';\n\nimport { AssetSelectorNodeComponent } from './asset-selector-node.component';\nimport { AssetSelectorComponent } from './asset-selector.component';\n\n@NgModule({\n  imports: [CommonModule, CollapseModule, BsDropdownModule],\n  exports: [AssetSelectorNodeComponent, AssetSelectorComponent],\n  providers: [GroupNodeService],\n  declarations: [AssetSelectorNodeComponent, AssetSelectorComponent]\n})\nexport class AssetSelectorModule {}\n"]}