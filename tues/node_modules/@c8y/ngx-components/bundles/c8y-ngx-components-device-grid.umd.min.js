!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@c8y/client"),require("@ngx-translate/core"),require("lodash-es"),require("@c8y/ngx-components"),require("@angular/upgrade/static"),require("@c8y/ngx-components/assets-navigator")):"function"==typeof define&&define.amd?define("@c8y/ngx-components/device-grid",["exports","@angular/core","@c8y/client","@ngx-translate/core","lodash-es","@c8y/ngx-components","@angular/upgrade/static","@c8y/ngx-components/assets-navigator"],t):t(((e=e||self).c8y=e.c8y||{},e.c8y["ngx-components"]=e.c8y["ngx-components"]||{},e.c8y["ngx-components"]["device-grid"]={}),e.ng.core,e.client,e.core$1,e.lodashEs,e.c8y["ngx-components"],e.ng.upgrade.static,e.c8y["ngx-components"]["assets-navigator"])}(this,(function(e,t,n,r,i,o,a,s){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var c=function(e,t){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function l(e,t){function n(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function p(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}function d(e,t){return function(n,r){t(n,r,e)}}function m(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))}function f(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var g=function(e){function n(t,n){return e.call(this,"c8ySchemaForm",t,n)||this}return l(n,e),n.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Injector}]},p([t.Input()],n.prototype,"schema",void 0),p([t.Input()],n.prototype,"model",void 0),p([t.Input("form")],n.prototype,"inputForm",void 0),p([t.Input("options")],n.prototype,"inputOptions",void 0),n=p([t.Directive({selector:"c8y-schema-form"})],n)}(a.UpgradeComponent),y=function(){function e(e){this.context=e}return e.prototype.ngOnInit=function(){var e=this.context.property;this.schema=i.cloneDeep(e.filteringConfig.schema),this.form=i.cloneDeep(e.filteringConfig.form),this.model=i.cloneDeep(e.externalFilterQuery||{}),this.options={formDefaults:{ngModelOptions:{debounce:100}}}},e.prototype.canApply=function(){return i.get(this.schemaFormComponent,"$componentScope.vm.ngForm.$invalid")},e.prototype.applyFilter=function(){this.context.applyFilter({externalFilterQuery:this.model})},e.prototype.resetFilter=function(){this.context.resetFilter()},e.ctorParameters=function(){return[{type:o.FilteringFormRendererContext}]},p([t.ViewChild(t.forwardRef((function(){return g})),{static:!1})],e.prototype,"schemaFormComponent",void 0),e=p([t.Component({template:'<c8y-schema-form\n  [schema]="schema"\n  [form]="form"\n  [model]="model"\n  [options]="options"\n></c8y-schema-form>\n<div class="data-grid__dropdown__footer d-flex separator-top">\n  <button\n    class="btn btn-default btn-sm m-r-8 flex-grow"\n    (click)="resetFilter()"\n    title="{{ \'Reset\' | translate }}"\n    translate\n  >\n    Reset\n  </button>\n\n  <button\n    class="btn btn-primary btn-sm flex-grow"\n    (click)="applyFilter()"\n    [disabled]="canApply()"\n    title="{{ \'Apply\' | translate }}"\n    translate\n  >\n    Apply\n  </button>\n</div>\n'})],e)}(),h=function(){this.filteringFormRendererComponent=y},v=function(){function e(e,t){this.context=e,this.deviceGridService=t}return e.ctorParameters=function(){return[{type:o.CellRendererContext},{type:P,decorators:[{type:t.Inject,args:[t.forwardRef((function(){return P}))]}]}]},e=p([t.Component({template:'<a [href]="deviceGridService.getAlarmsHref(context.item)" class="listLink">\n  <small\n    class="status critical"\n    *ngIf="context.item.c8y_ActiveAlarmsStatus?.critical"\n    style="white-space: nowrap;"\n  >\n    {{ context.item.c8y_ActiveAlarmsStatus?.critical }} <i [c8yIcon]="\'warning\'"></i>\n  </small>\n  <small\n    class="status major"\n    *ngIf="context.item.c8y_ActiveAlarmsStatus?.major"\n    style="white-space: nowrap;"\n  >\n    {{ context.item.c8y_ActiveAlarmsStatus?.major }}\n    <i [c8yIcon]="\'exclamation-circle\'"></i>\n  </small>\n  <small\n    class="status minor"\n    *ngIf="context.item.c8y_ActiveAlarmsStatus?.minor"\n    style="white-space: nowrap;"\n  >\n    {{ context.item.c8y_ActiveAlarmsStatus?.minor }}\n    <i [c8yIcon]="\'exclamation-circle\'"></i>\n  </small>\n  <small\n    class="status warning"\n    *ngIf="context.item.c8y_ActiveAlarmsStatus?.warning"\n    style="white-space: nowrap;"\n  >\n    {{ context.item.c8y_ActiveAlarmsStatus?.warning }} <i [c8yIcon]="\'circle\'"></i>\n  </small>\n</a>\n'}),d(1,t.Inject(t.forwardRef((function(){return P}))))],e)}(),_=function(e){function t(){var t=e.call(this)||this;return t.name="alarms",t.header=o.gettext("Alarms"),t.cellRendererComponent=v,t.filterable=!0,t.filteringConfig={schema:{type:"object",properties:{critical:{type:"boolean"},major:{type:"boolean"},minor:{type:"boolean"},warning:{type:"boolean"},none:{type:"boolean"}}},form:[{type:"template",template:"<label><span translate>"+o.gettext("Show devices with active")+"</span>:</label>"},{key:"critical",title:o.gettext("Critical alarms")},{key:"major",title:o.gettext("Major alarms")},{key:"minor",title:o.gettext("Minor alarms")},{key:"warning",title:o.gettext("Warnings")},{key:"none",title:o.gettext("No alarms")}],getFilter:function(e){var t={},n=[];return e.critical&&n.push({"c8y_ActiveAlarmsStatus.critical":{__gt:0}}),e.major&&n.push({"c8y_ActiveAlarmsStatus.major":{__gt:0}}),e.minor&&n.push({"c8y_ActiveAlarmsStatus.minor":{__gt:0}}),e.warning&&n.push({"c8y_ActiveAlarmsStatus.warning":{__gt:0}}),e.none&&(n.push({__not:{__has:"c8y_ActiveAlarmsStatus"}}),n.push({__and:i.map(["critical","major","minor","warning"],(function(e){var t={},n={__not:{__has:void 0}},r="c8y_ActiveAlarmsStatus."+e;return t[r]=0,n.__not.__has=r,{__or:[t,n]}}))})),n.length&&(t.__or=n),t}},t.sortable=!0,t.sortingConfig={pathSortingConfigs:[{path:"c8y_ActiveAlarmsStatus.critical"},{path:"c8y_ActiveAlarmsStatus.major"},{path:"c8y_ActiveAlarmsStatus.minor"},{path:"c8y_ActiveAlarmsStatus.warning"}]},t}return l(t,e),t}(h),b=function(){function e(e,t){this.context=e,this.deviceGridService=t}return e.ctorParameters=function(){return[{type:o.CellRendererContext},{type:P,decorators:[{type:t.Inject,args:[t.forwardRef((function(){return P}))]}]}]},e=p([t.Component({template:'<span\n  title="{{\n    deviceGridService.getParentsNames(\n      context.item,\n      context.property.externalFilterQuery?.deviceGroupId\n    )\n  }}"\n  class="text-truncate"\n>\n  {{\n    deviceGridService.getParentsNames(\n      context.item,\n      context.property.externalFilterQuery?.deviceGroupId\n    )\n  }}\n</span>\n'}),d(1,t.Inject(t.forwardRef((function(){return P}))))],e)}(),C=function(){function e(e){this.context=e,this.preselected=[]}return e.prototype.ngOnInit=function(){var e=this.context.property;this.model=i.cloneDeep(e.externalFilterQuery||{}),this.preselected=this.model.selectedNodes||[]},e.prototype.applyFilter=function(){this.context.applyFilter({externalFilterQuery:this.model})},e.prototype.resetFilter=function(){this.context.resetFilter()},e.prototype.selectionChanged=function(e){this.model.selectedNodes=e},e.ctorParameters=function(){return[{type:o.FilteringFormRendererContext}]},e=p([t.Component({template:'<c8y-asset-selector\n  [selected]="preselected"\n  (onChange)="selectionChanged($event)"\n></c8y-asset-selector>\n\n<div class="data-grid__dropdown__footer d-flex separator-top">\n  <button\n    class="btn btn-default btn-sm m-r-8 flex-grow"\n    (click)="resetFilter()"\n    title="{{ \'Reset\' | translate }}"\n    translate\n  >\n    Reset\n  </button>\n\n  <button\n    class="btn btn-primary btn-sm flex-grow"\n    (click)="applyFilter()"\n    title="{{ \'Apply\' | translate }}"\n    translate\n  >\n    Apply\n  </button>\n</div>\n'})],e)}(),x=function(e){function t(){var t=e.call(this)||this;return t.name="group",t.header=o.gettext("Group"),t.cellRendererComponent=b,t.filteringFormRendererComponent=C,t.filterable=!0,t.filteringConfig={getFilter:function(e){var t={};return e.selectedNodes&&(t.__or=e.selectedNodes.map((function(e){return e.c8y_DeviceQueryString?{__useFilterQueryString:e.c8y_DeviceQueryString}:{__bygroupid:e.id}}))),t}},t.sortable=!1,t}return l(t,e),t}(h),S=function(e){function t(){var t=e.call(this)||this,n=t;return t.path="c8y_Mobile.imei",t.name="imei",t.header=o.gettext("IMEI"),t.filterable=!0,t.filteringConfig={schema:{type:"object",properties:{imeis:{type:"array",items:{type:"string"}}}},form:[{key:"imeis",title:o.gettext("Show devices with IMEI"),add:o.gettext("Or"),items:[{key:"imeis[]",notitle:!0,placeholder:o.gettext("e.g. 46543432321, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t={};return e.imeis.length&&(t[n.path]={__in:e.imeis}),t}},t.sortable=!0,t.sortingConfig={pathSortingConfigs:[{path:t.path}]},t}return l(t,e),t}(h),w=function(){function e(e,t){this.context=e,this.deviceGridService=t}return e.ctorParameters=function(){return[{type:o.CellRendererContext},{type:P,decorators:[{type:t.Inject,args:[t.forwardRef((function(){return P}))]}]}]},e=p([t.Component({template:"\n    {{ deviceGridService.getModel(context.item) }}\n  "}),d(1,t.Inject(t.forwardRef((function(){return P}))))],e)}(),D=function(e){function t(){var t=e.call(this)||this,n="com_nsn_startups_vendme_fragments_VendingMachineTypeInfo.model";return t.name="model",t.header=o.gettext("Model"),t.cellRendererComponent=w,t.filterable=!0,t.filteringConfig={schema:{type:"object",properties:{models:{type:"array",items:{type:"string"}}}},form:[{key:"models",title:o.gettext("Show devices with model"),add:o.gettext("Or"),items:[{key:"models[]",notitle:!0,placeholder:o.gettext("e.g. ModelName, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t,r={};return e.models.length&&(r.__or=((t={})["c8y_Hardware.model"]={__in:e.models},t[n]={__in:e.models},t)),r}},t.sortable=!0,t.sortingConfig={pathSortingConfigs:[{path:"c8y_Hardware.model"},{path:n}]},t}return l(t,e),t}(h),A=function(){function e(e,t){this.context=e,this.deviceGridService=t}return e.ctorParameters=function(){return[{type:o.CellRendererContext},{type:P,decorators:[{type:t.Inject,args:[t.forwardRef((function(){return P}))]}]}]},e=p([t.Component({template:'\n    <a\n      [href]="deviceGridService.getDeviceHref(context.item)"\n      title="{{ deviceGridService.getProperName(context.item) }}"\n      class="interact"\n    >\n      {{ deviceGridService.getProperName(context.item) }}\n    </a>\n  '}),d(1,t.Inject(t.forwardRef((function(){return P}))))],e)}(),I=function(e){function t(){var t=e.call(this)||this;return t.name="name",t.path="name",t.header=o.gettext("Name"),t.cellCSSClassName="data-record-header",t.cellRendererComponent=A,t.filterable=!0,t.filteringConfig={schema:{type:"object",properties:{names:{type:"array",items:{type:"string"}}}},form:[{key:"names",title:o.gettext("Show devices with name"),add:o.gettext("Or"),items:[{key:"names[]",notitle:!0,placeholder:o.gettext("e.g. My Device, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t={};return e.names.length&&(t.name={__in:e.names}),t}},t.sortable=!0,t.sortingConfig={pathSortingConfigs:[{path:t.path}]},t}return l(t,e),t}(h),k=function(){function e(e){this.context=e}return e.ctorParameters=function(){return[{type:o.CellRendererContext}]},e=p([t.Component({template:"\n    {{ context.value | c8yDate }}\n  "})],e)}(),F=function(e){function t(){var t=e.call(this)||this,n=t;return t.path="creationTime",t.name="registrationDate",t.header=o.gettext("Registration date"),t.cellRendererComponent=k,t.filterable=!0,t.filteringConfig={schema:{type:"object",properties:{registrationDate:{type:"object",properties:{after:{type:"string",format:"datetime"},before:{type:"string",format:"datetime"}}}}},form:[{key:"registrationDate.after",title:o.gettext("Show devices registered after"),maxDateKey:"registrationDate.before"},{key:"registrationDate.before",title:o.gettext("And before`date`"),minDateKey:"registrationDate.after"}],getFilter:function(e){var t,r,i={},o=e&&e.registrationDate;if(o&&(o.after||o.before)){if(i.__and=[],o.after){var a=n.formatDate(o.after);i.__and.push({__or:(t={},t[n.path]={__gt:a},t[n.path+".date"]={__gt:a},t)})}if(o.before){var s=n.formatDate(o.before);i.__and.push({__or:(r={},r[n.path]={__lt:s},r[n.path+".date"]={__lt:s},r)})}}return i}},t.sortable=!0,t.sortingConfig={pathSortingConfigs:[{path:t.path+".date"},{path:t.path}]},t}return l(t,e),t.prototype.formatDate=function(e){return new Date(e).toISOString()},t}(h),O=function(){function e(e,t){this.context=e,this.deviceGridService=t}return e.ctorParameters=function(){return[{type:o.CellRendererContext},{type:P,decorators:[{type:t.Inject,args:[t.forwardRef((function(){return P}))]}]}]},e=p([t.Component({template:"\n    {{ deviceGridService.getSerialNumber(context.item) }}\n  "}),d(1,t.Inject(t.forwardRef((function(){return P}))))],e)}(),G=function(e){function t(){var t=e.call(this)||this;return t.name="serialNumber",t.header=o.gettext("Serial number"),t.cellRendererComponent=O,t.filterable=!0,t.filteringConfig={schema:{type:"object",properties:{serialNumbers:{type:"array",items:{type:"string"}}}},form:[{key:"serialNumbers",title:o.gettext("Show devices with serial number"),add:o.gettext("Or"),items:[{key:"serialNumbers[]",notitle:!0,placeholder:o.gettext("e.g. 54321-123, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t,n={};return e.serialNumbers.length&&(n.__or=((t={})["c8y_Hardware.serialNumber"]={__in:e.serialNumbers},t["com_nsn_startups_vendme_fragments_VendingMachineTypeInfo.serial"]={__in:e.serialNumbers},t)),n}},t.sortable=!0,t.sortingConfig={pathSortingConfigs:[{path:"c8y_Hardware.serialNumber"},{path:"com_nsn_startups_vendme_fragments_VendingMachineTypeInfo.serial"}]},t}return l(t,e),t}(h),N=function(){function e(e){this.context=e}return e.ctorParameters=function(){return[{type:o.CellRendererContext}]},e=p([t.Component({template:'\n    <device-status [mo]="context.item"></device-status>\n  '})],e)}(),j=function(e){function t(){var t,n,r,i,a,s,c,l=e.call(this)||this,u=((t={})["c8y_RequiredAvailability.responseInterval"]={__le:0},t),p={__not:{__has:"c8y_RequiredAvailability.responseInterval"}},d=((n={})["c8y_Availability.status"]=o.SendStatus.AVAILABLE,n),m=((r={})["c8y_Availability.status"]=o.SendStatus.UNAVAILABLE,r),f=((i={})["c8y_Availability.status"]=o.SendStatus.MAINTENANCE,i),g={__not:{__has:"c8y_Availability.status"}},y=((a={})["c8y_Connection.status"]=o.PushStatus.CONNECTED,a),h=((s={})["c8y_Connection.status"]=o.PushStatus.DISCONNECTED,s),v=((c={})["c8y_Connection.status"]=o.PushStatus.MAINTENANCE,c),_={__or:[u,f,v]},b={__and:[{__not:u},{__not:f},{__not:v}]};return l.name="status",l.header=o.gettext("Status"),l.dataType="icon",l.cellRendererComponent=N,l.filterable=!0,l.filteringConfig={schema:{type:"object",properties:{sendOnline:{type:"boolean"},sendOffline:{type:"boolean"},sendUnknown:{type:"boolean"},sendNotMonitored:{type:"boolean"},pushOnline:{type:"boolean"},pushOffline:{type:"boolean"},pushNotMonitored:{type:"boolean"},maintenance:{type:"boolean"}}},form:[{type:"template",template:"<label><span translate>"+o.gettext("Show devices with send status")+"</span>:</label>"},{key:"sendOnline",title:o.gettext("Online")},{key:"sendOffline",title:o.gettext("Offline")},{key:"sendUnknown",title:o.gettext("Unknown")},{key:"sendNotMonitored",title:o.gettext("Not monitored")},{type:"template",template:"<label><span translate>"+o.gettext("Show devices with push status")+"</span>:</label>"},{key:"pushOnline",title:o.gettext("Online")},{key:"pushOffline",title:o.gettext("Offline")},{key:"pushNotMonitored",title:o.gettext("Not monitored")},{type:"template",template:"<label><span translate>"+o.gettext("Show devices with maintenance status")+"</span>:</label>"},{key:"maintenance",title:o.gettext("Device is under maintenance")}],getFilter:function(e){var t={},n=[];return e&&(e.sendOnline&&n.push({__and:[b,d]}),e.sendOffline&&n.push({__and:[b,m]}),e.sendUnknown&&n.push({__and:[b,g]}),(e.sendNotMonitored||e.pushNotMonitored)&&n.push(p),e.pushOnline&&n.push({__and:[b,y]}),e.pushOffline&&n.push({__and:[b,h]}),e.maintenance&&n.push(_),n.length&&(t.__or=n)),t}},l.sortable=!0,l.sortingConfig={pathSortingConfigs:[{path:"c8y_Availability.status"}]},l}return l(t,e),t}(h),R=function(e){function t(){var t=e.call(this)||this,n=t;return t.path="id",t.name="systemId",t.header=o.gettext("System ID"),t.filterable=!0,t.filteringConfig={schema:{type:"object",properties:{ids:{type:"array",items:{type:"string"}}}},form:[{key:"ids",title:o.gettext("Show devices with system ID"),add:o.gettext("Or"),items:[{key:"ids[]",notitle:!0,placeholder:o.gettext("e.g. 10300, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t={};return e.ids.length&&(t[n.path]={__in:e.ids}),t}},t.sortable=!0,t.sortingConfig={pathSortingConfigs:[{path:t.path}]},t}return l(t,e),t}(h),P=function(){function e(e,t){this.inventoryService=e,this.translateService=t,this.queriesUtil=new n.QueriesUtil}return e.prototype.getDefaultColumns=function(){return[new j,new I,new D,new G,new x,new F,new R,new S,new _]},e.prototype.getDefaultPagination=function(){return{pageSize:10,currentPage:1}},e.prototype.getInfiniteScrollPagination=function(){return{pageSize:50,currentPage:1}},e.prototype.getDefaultActionControls=function(){var e=this;return[{type:"DELETE",callback:function(t){return e.delete(t)}}]},e.prototype.getDefaultBulkActionControls=function(){return[]},e.prototype.getProperName=function(e){var t=e.id,n=e.name;return n||this.translateService.instant("Device {{id}}",{id:t})},e.prototype.getModel=function(e){var t=this.getHardware(e);return t&&t.model},e.prototype.getSerialNumber=function(e){var t=this.getHardware(e),n=this.isVendme(e)?"serial":"serialNumber";return t&&t[n]},e.prototype.getParentsNames=function(e,t){var n=e.assetParents.references,r=i.map(n,"managedObject"),o=i.sortBy(r,["name"]),a=i.remove(o,{id:t}).concat(o);return i.map(a,"name").join(", ")},e.prototype.getDeviceHref=function(e){return"#/device/"+e.id},e.prototype.getAlarmsHref=function(e){return this.getDeviceHref(e)+"/alarms"},e.prototype.delete=function(e){console.log("should delete",e)},e.prototype.getDevices=function(e,t){return m(this,void 0,void 0,(function(){var n;return f(this,(function(r){return n=u({},this.getDevicesFilters(e,t),{withParents:!0}),[2,this.inventoryService.list(n)]}))}))},e.prototype.getDevicesCount=function(e,t){return m(this,void 0,void 0,(function(){var n;return f(this,(function(r){switch(r.label){case 0:return n=u({},this.getDevicesFilters(e,t),{pageSize:1,currentPage:1}),[4,this.inventoryService.list(n)];case 1:return[2,r.sent().paging.totalPages]}}))}))},e.prototype.getDevicesTotal=function(){return m(this,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return e={q:"",pageSize:1,withTotalPages:!0},[4,this.inventoryService.list(e)];case 1:return[2,t.sent().paging.totalPages]}}))}))},e.prototype.getDeviceQueryString=function(e){return this.queriesUtil.buildQuery(this.getQueryObj(e))},e.prototype.getHardware=function(e){var t=this.isVendme(e)?"com_nsn_startups_vendme_fragments_VendingMachineTypeInfo":"c8y_Hardware";return e&&e[t]},e.prototype.isVendme=function(e){return"com_nsn_startups_vendme_VendingMachine"===e.type},e.prototype.getDevicesFilters=function(e,t){return{q:this.getDeviceQueryString(e),pageSize:t.pageSize,currentPage:t.currentPage,withTotalPages:!0}},e.prototype.getQueryObj=function(e){var t=this;return i.transform(e,(function(e,n){return t.extendQueryByColumn(e,n)}),{__filter:{},__orderby:[]})},e.prototype.extendQueryByColumn=function(e,t){if(t.filterable&&t.externalFilterQuery){var n=(t.filteringConfig.getFilter||i.identity)(t.externalFilterQuery);n.__or?(e.__filter.__and=e.__filter.__and||[],e.__filter.__and.push(n)):n.__and&&i.get(e,"__filter.__and")?n.__and.map((function(t){return e.__filter.__and.push(t)})):i.assign(e.__filter,n)}if(t.sortable&&t.sortOrder){var r={};i.forEach(t.sortingConfig.pathSortingConfigs,(function(e){r[e.path]=("asc"===t.sortOrder?1:-1)*(e.sortOrderModifier||1)})),e.__orderby.push(r)}return e},e.ctorParameters=function(){return[{type:n.InventoryService},{type:r.TranslateService}]},e=p([t.Injectable()],e)}(),M=function(){function e(e){this.deviceGridService=e,this.title=o.gettext("Devices"),this.loadMoreItemsLabel=o.gettext("Load more devices"),this.loadingItemsLabel=o.gettext("Loading devices…"),this.noMatchingItemsLabel=o.gettext("No matching devices."),this.selectable=!1,this.onColumnsChange=new t.EventEmitter,this.onDeviceQueryStringChange=new t.EventEmitter,this.columns=this.deviceGridService.getDefaultColumns(),this.pagination=this.deviceGridService.getDefaultPagination(),this.actionControls=this.deviceGridService.getDefaultActionControls(),this.bulkActionControls=this.deviceGridService.getDefaultBulkActionControls(),this.serverSideDataCallback=this.onDataSourceModifier.bind(this)}return Object.defineProperty(e.prototype,"_columns",{set:function(e){this.columns=e||this.deviceGridService.getDefaultColumns()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_pagination",{set:function(e){this.pagination=e||this.deviceGridService.getDefaultPagination()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_infiniteScroll",{set:function(e){this.infiniteScroll=e,this.pagination=this.deviceGridService.getInfiniteScrollPagination()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_actionControls",{set:function(e){this.actionControls=e||this.deviceGridService.getDefaultActionControls()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_bulkActionControls",{set:function(e){this.bulkActionControls=e||this.deviceGridService.getDefaultBulkActionControls()},enumerable:!0,configurable:!0}),e.prototype.trackByName=function(e,t){return t.name},e.prototype.onDataSourceModifier=function(e){return m(this,void 0,void 0,(function(){var t,n,r,i,o,a;return f(this,(function(s){switch(s.label){case 0:return[4,this.deviceGridService.getDevices(e.columns,e.pagination)];case 1:return t=s.sent(),n=t.res,r=t.data,i=t.paging,[4,this.deviceGridService.getDevicesCount(e.columns,e.pagination)];case 2:return o=s.sent(),[4,this.deviceGridService.getDevicesTotal()];case 3:return a=s.sent(),this.onColumnsChange.emit(e.columns),this.onDeviceQueryStringChange.emit(this.deviceGridService.getDeviceQueryString(e.columns)),[2,{res:n,data:r,paging:i,filteredSize:o,size:a}]}}))}))},e.prototype.updateFiltering=function(e,t){t.type===o.FilteringActionType.ResetFilter?this.dataGrid.clearFilters():this.dataGrid.updateFiltering(e,t)},e.ctorParameters=function(){return[{type:P}]},p([t.Input()],e.prototype,"title",void 0),p([t.Input()],e.prototype,"loadMoreItemsLabel",void 0),p([t.Input()],e.prototype,"loadingItemsLabel",void 0),p([t.Input()],e.prototype,"noMatchingItemsLabel",void 0),p([t.Input("columns")],e.prototype,"_columns",null),p([t.Input("pagination")],e.prototype,"_pagination",null),p([t.Input("infiniteScroll")],e.prototype,"_infiniteScroll",null),p([t.Input("actionControls")],e.prototype,"_actionControls",null),p([t.Input()],e.prototype,"selectable",void 0),p([t.Input("bulkActionControls")],e.prototype,"_bulkActionControls",null),p([t.Output()],e.prototype,"onColumnsChange",void 0),p([t.Output()],e.prototype,"onDeviceQueryStringChange",void 0),p([t.ViewChild(o.DataGridComponent,{static:!0})],e.prototype,"dataGrid",void 0),e=p([t.Component({selector:"c8y-device-grid",template:'<c8y-data-grid\n  [title]="title"\n  [loadMoreItemsLabel]="loadMoreItemsLabel"\n  [loadingItemsLabel]="loadingItemsLabel"\n  [noMatchingItemsLabel]="noMatchingItemsLabel"\n  [columns]="columns"\n  [pagination]="pagination"\n  [infiniteScroll]="infiniteScroll"\n  [actionControls]="actionControls"\n  [selectable]="selectable"\n  [bulkActionControls]="bulkActionControls"\n  [serverSideDataCallback]="serverSideDataCallback"\n>\n  <ng-container *ngFor="let column of columns; trackBy: trackByName">\n    <c8y-column [name]="column.name"></c8y-column>\n  </ng-container>\n</c8y-data-grid>\n'})],e)}(),E=function(){function e(){}return e=p([t.NgModule({imports:[o.CommonModule,o.FormsModule,o.DeviceStatusModule,o.DataGridModule,s.AssetSelectorModule],declarations:[M,y,C,N,A,w,O,b,k,v,g],exports:[M,y,C,N,A,w,O,b,k,v,g],entryComponents:[M,y,C,N,A,w,O,b,k,v],providers:[P]})],e)}(),Q=function(e){function t(){var t=e.call(this)||this,n=t;return t.name="custom",t.header=o.gettext("Custom"),t.filterable=!0,t.filteringConfig={schema:{type:"object",properties:{exists:{type:"boolean",default:!1,title:o.gettext("Only rows where value is defined")},equals:{type:"array",items:{type:"string"}}}},form:[{key:"exists"},{key:"equals",title:o.gettext("Only rows where value equals to:"),add:o.gettext("Or"),items:[{key:"equals[]",notitle:!0,placeholder:o.gettext("e.g. value, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t={};return e.exists&&(t.__has=n.path),e.equals&&(t[n.path]={__in:e.equals}),t}},t.sortable=!0,t}return l(t,e),Object.defineProperty(t.prototype,"sortingConfig",{get:function(){return{pathSortingConfigs:[{path:this.path}]}},enumerable:!0,configurable:!0}),t}(h),T=function(e){function t(){var t=e.call(this)||this;return t.name="type",t.path="type",t.header=o.gettext("Type"),t.filterable=!0,t.filteringConfig={schema:{type:"object",properties:{types:{type:"array",items:{type:"string"}}}},form:[{key:"types",title:o.gettext("Show devices with type"),add:o.gettext("Or"),items:[{key:"types[]",notitle:!0,placeholder:o.gettext("e.g. MyType, you can use an asterisk (*) as wildcard character")}]}],getFilter:function(e){var t={};return e.types.length&&(t.type={__in:e.types}),t}},t.sortable=!0,t.sortingConfig={pathSortingConfigs:[{path:"type"}]},t}return l(t,e),t}(h);e.AlarmsCellRendererComponent=v,e.AlarmsDeviceGridColumn=_,e.BaseDeviceGridColumn=h,e.BaseFilteringFormRendererComponent=y,e.CustomDeviceGridColumn=Q,e.DeviceGridComponent=M,e.DeviceGridModule=E,e.DeviceGridService=P,e.GroupCellRendererComponent=b,e.GroupDeviceGridColumn=x,e.GroupFilteringFormRendererComponent=C,e.ImeiDeviceGridColumn=S,e.ModelCellRendererComponent=w,e.ModelDeviceGridColumn=D,e.NameCellRendererComponent=A,e.NameDeviceGridColumn=I,e.RegistrationDateCellRendererComponent=k,e.RegistrationDateDeviceGridColumn=F,e.SchemaFormComponent=g,e.SerialNumberCellRendererComponent=O,e.SerialNumberDeviceGridColumn=G,e.StatusCellRendererComponent=N,e.StatusDeviceGridColumn=j,e.SystemIdDeviceGridColumn=R,e.TypeDeviceGridColumn=T,e.ɵa=y,e.ɵb=C,e.ɵc=N,e.ɵd=A,e.ɵe=w,e.ɵf=O,e.ɵg=b,e.ɵh=k,e.ɵi=v,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=c8y-ngx-components-device-grid.umd.min.js.map