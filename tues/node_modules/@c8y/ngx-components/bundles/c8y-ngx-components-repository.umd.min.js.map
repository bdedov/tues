{"version":3,"sources":["../../../../node_modules/tslib/tslib.es6.js","ng://@c8y/ngx-components/repository/repository.model.ts","ng://@c8y/ngx-components/repository/file-download/link-render-type.enum.ts","ng://@c8y/ngx-components/repository/repository.service.ts","ng://@c8y/ngx-components/repository/firmware/add-firmware-modal.component.ts","ng://@c8y/ngx-components/repository/firmware/add-firmware-patch-modal.component.ts","ng://@c8y/ngx-components/repository/firmware/firmware-list.component.ts","ng://@c8y/ngx-components/repository/firmware/firmware-details.component.ts","ng://@c8y/ngx-components/repository/software/add-software-modal.component.ts","ng://@c8y/ngx-components/repository/software/software-list.component.ts","ng://@c8y/ngx-components/repository/software/software-details.component.ts","ng://@c8y/ngx-components/repository/configuration/configuration-detail.component.ts","ng://@c8y/ngx-components/repository/configuration/configuration-list.component.ts","ng://@c8y/ngx-components/repository/repository-navigation-factory.ts","ng://@c8y/ngx-components/repository/select-modal/repository-select-modal.component.ts","ng://@c8y/ngx-components/repository/firmware-device-tab/firmware-device-tab.component.ts","ng://@c8y/ngx-components/repository/firmware-device-tab/firmware-device-tab.guard.ts","ng://@c8y/ngx-components/repository/software-device-tab/software-device-tab.component.ts","ng://@c8y/ngx-components/repository/software-device-tab/software-device-tab.guard.ts","ng://@c8y/ngx-components/repository/software-device-tab/installed-software.component.ts","ng://@c8y/ngx-components/repository/software-device-tab/device-software-list.component.ts","ng://@c8y/ngx-components/repository/software-device-tab/device-software-changes.component.ts","ng://@c8y/ngx-components/repository/configuration-device-tab/device-configuration.service.ts","ng://@c8y/ngx-components/repository/configuration-device-tab/device-configuration.component.ts","ng://@c8y/ngx-components/repository/configuration-device-tab/source-code-preview.component.ts","ng://@c8y/ngx-components/repository/configuration-device-tab/save-to-repository.component.ts","ng://@c8y/ngx-components/repository/configuration-device-tab/configuration-preview.component.ts","ng://@c8y/ngx-components/repository/configuration-device-tab/configuration-filter.pipe.ts","ng://@c8y/ngx-components/repository/configuration-device-tab/device-configuration.guard.ts","ng://@c8y/ngx-components/repository/configuration-device-tab/device-configuration-list.component.ts","ng://@c8y/ngx-components/repository/configuration-device-tab/text-based-configuration.component.ts","ng://@c8y/ngx-components/repository/file-download/file-download.component.ts","ng://@c8y/ngx-components/repository/repository.module.ts"],"names":["RepositoryType","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__decorate","decorators","target","key","desc","d","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","__values","o","m","__read","ar","error","__spread","concat","DeviceConfigurationOperation","REPOSITORY_BINARY_TYPES","_a","SOFTWARE","FIRMWARE","CONFIGURATION","LinkRenderType","RepositoryService","inventory","inventoryBinary","operation","alert","event","realtime","eventBinary","dateFrom","Date","dateTo","now","queriesUtil","QueriesUtil","listRepositoryEntries","type","options","filters","defaultFilters","fullQuery","query","addOrderbys","name","addAndFilter","partialTextFilter","partialText_1","partialText","orFilter","__or","properties","map","property","partialName","skipLegacy","__not","__has","buildQuery","pageSize","withTotalPages","params","list","save","data","mo","configurationType","selected","undefined","version","description","deviceType","c8y_Global","id","existingUrl","url","binary","file","create","response","self","updateEntry","createEntry","modal","createFirmwareOrSoftware","mos","selectedId","saveBinary","_b","binaryURL","createOrUpdateRepositoryEntry","repositoryEntry","isNil","createRepositoryBinary","repositoryBinary","linkBinary","cleanUp","errorMsg","error_1","set","update","parent","prepareRepositoryBinaryMO","childAdditionsCreate","patchVersion","dependency","c8y_Patch","c8y_Firmware","repositoryBinaryId","binaryId","childAdditionsAdd","mosToDelete","_this","forEach","c8y_IsBinary","isUndefined","delete","entity","forceCascade","msg","gettext","danger","getBaseVersionsCount$","entry","isLegacyEntry","of","from","listBaseVersions","pipe","paging","totalPages","getBaseVersionFromMO","isPatch","get","getPatchVersionsCount$","baseVersion","listPatchVersions","Boolean","listAllVersions","getBaseVersionResultListForLegacyEntry","listChildren","__filter","__orderby","creationTime.date","creationTime","PATCH_FILTER_ORDER","c8y_Patch.dependency","isString","listBaseVersionAndPatches","c8y_Firmware.version","childrenFilters","__bygroupid","listQuery","fetchAllItemsFromList","firstPage","allItems","_c","items","nextPage","getRepositoryEntryMO$","reference","lodashEs","detail","withChildren","getRepositoryBinaryMoByVersion","deviceRepositoryFragment","_d","_e","repositoryBinaryType","newModelBaseVersionQuery","legacyVersionQuery","withParents","__and","head","getBinaryName$","binaryUrl","getIdFromUrl","detail$","getDeviceTypeQuery","repositoryType","device","c8y_Filter.type","getConfigurationTypeQuery","getDeviceSoftwareList","c8y_SoftwareList","cloneDeep","c8y_Software","_map","createSoftwareUpdateOperation","changes","getSoftwareUpdateOperation","deviceId","change","action","join","c8y_SupportedOperations","includes","c8y_SoftwareUpdate","deviceSoftware","pick","remove","getDeviceSoftwareChangesFromOperation","getDeviceSoftwareChangesFromSoftwareListOperation","getDeviceSoftwareChangesFromSoftwareOperation","createFirmwareUpdateOperation","selectedOption","getFirmwareUpdateOperation","getUploadConfigurationFileOperation","isLegacy","c8y_UploadConfigFile","getDownloadConfigurationFileOperation","configSnapshot","c8y_DownloadConfigFile","c8y_ConfigurationDump","getLastFirmwareUpdateOperation","toISOString","revert","getFirstMatchingOperation","fragmentType","getLastSoftwareUpdateOperation","filtersList","matchingOperation","filtersList_1","tslib_1.__values","filtersList_1_1","operations","createObservedOperation","take","switchMap","createdOperation","observeOperation","observedOperation$","operationUpdates$","observedOperation","observable","withLatestFrom","filter","operationUpdate","status","OperationStatus","FAILED","throwError","takeWhile","SUCCESSFUL","merge","getLatestConfigurationEvent","eventFilter","source","getConfigFileOperationList","operationType","operationFilter","getConfigSnapshot","time","text","download","binaryType","getLegacyConfigSnapshot","snapshotId","getBinaryText","allowExternal","getExternalBinaryResponse","res","getInternalBinaryResponse","getBinaryFile","contentType","arrayBuffer","File","getLastConfigUpdateOperation","createTextBasedConfigurationReloadOperation","c8y_SendConfiguration","createTextBasedConfigurationUpdateOperation","config","c8y_Configuration","getBinary","getSnapshotsFromRepository","searchQuery","noAlerts","fetch","fetchRes","newMo","existingBinaryId","newBinaryId","operationSoftware","find","tslib_1.__assign","deviceSoftwareVersion","deviceSoftwareName","operationSoftwareVersion","operationSoftwareName","InventoryService","InventoryBinaryService","OperationService","AlertService","EventService","Realtime","EventBinaryService","Injectable","AddFirmwareModalComponent","repositoryService","saved","EventEmitter","onInput","BehaviorSubject","model","saving","firmwarePreselected","ngOnInit","setInitialState","loadFirmwares","inputSubscription$","tap","form","reset","debounceTime","distinctUntilChanged","searchStr","getFirmwareResult","subscribe","firmwaresResult","savedFirmware","successMsg","cancel","catch","success","hide","complete","ngOnDestroy","unsubscribe","onFile","dropped","droppedFiles","onFirmwareSelect","firmware","BsModalRef","tslib_1.__decorate","ViewChild","static","Output","Component","selector","template","AddFirmwarePatchModalComponent","repository","firmwareInput$","firmwares$","shareReplay","firmwareSelected$","patchDependencyInput$","baseVersions$","selectedFirmware","baseVersionsFilterPipe","partialVersion","toLowerCase","indexOf","FirmwareListComponent","modalService","bsModalService","translateService","alertService","router","activatedRoute","textFilter$","reload$","reloading","combineLatest","getFirmwares","canAddFirmwarePatch$","bind","DEVICE_TYPE_NOT_AVAILABLE","addFirmware","show","class","ignoreBackdropClick","content","editFirmware","addFirmwarePatch","navigate","relativeTo","deleteFirmware","title","instant","labels","ok","confirm","Status","DANGER","addServerFailure","ex_1","getDeviceTypeTitle","ModalService","BsModalService","TranslateService","Router","ActivatedRoute","memoize","FirmwareDetailsComponent","inventoryService","Subject","reloading$","updateFirmware$","firmwareUpdated$","baseVersionsUpdated$","patchVersionsUpdated$","firmware$","distinctUntilKeyChanged","isLegacy$","canAddPatchVersions$","hasBaseVersions","expanded","destroy$","firmwarePartial","takeUntil","getPatchVersions$","addBaseVersion","initialState","addPatchVersion","deleteBaseVersion","deletePatchVersion","ex_2","AddSoftwareModalComponent","softwarePreselected","loadSoftwares","getSoftwareResult","softwaresResult","savedSoftware","onSoftwareSelect","software","SoftwareListComponent","softwares$","getSoftwares","addSoftware","editSoftware","deleteSoftware","SoftwareDetailsComponent","updateSoftware$","softwareUpdated$","software$","softwarePartial","ConfigurationDetailComponent","bsModalRef","pattern","uploadChoice","_save","_cancel","configs","existingBinary","setPipe","submitButtonTitle","filterStr","filterPipe","uniqBy","configurationForm","markAsDirty","ConfigurationListComponent","inventoryBinaryService","filterTerm","DELETED_SUCCESS_MSG","loadConfigurations","configurations$","add","edit","configuration","fileBinary","isBinaryFile","getBinaryName","saveAs","confirmationText","hint","proceed","ex_3","trim","filterContainString","shouldShowEmptyState","term","FilterInputComponent","RepositoryNavigationFactory","navs","NavigatorNode","path","icon","priority","RepositorySelectModalComponent","repositoryEntriesWithVersions$","badgeTemplates","=1","other","load","searchTerm","deviceTypeQuery","showFilter","areMoreEntries","resultEmitter","mode","ModalSelectionMode","SINGLE","disableSelected","modalEntries","mergeMap","aggregate","PAGE_SIZE","Error","addOrFilter","getAndAssignRepositoryBinaries","versions","search","selectedItems","emit","all","getSelectModalOptions","getSelectModalObject","selectModalOptions","isSelected","isBinaryRepositorySelected","bodyValue","bodyClass","obj","repositoryFragment","count","groupId","additionalInformation","FirmwareDeviceTabComponent","route","bsModal","isEmpty","device$","snapshot","contextData","deviceFirmwareFragment$","firmwareBinary$","deviceFirmwareFragment","repositoryEntry$","patches$","firmwareBinary","changesOperation$","changesInProgress$","isInProgress","loadDevice","loadOperation","installFirmware","repositoryEntriesWithVersionsFn$","getRepositoryEntriesWithVersions$","subTitle","handleOperation","searchTerm$","addPatch","getRepositoryEntryWithPatches$","patches","trackOperation","PENDING","EXECUTING","FirmwareDeviceTabGuard","canActivate","supportedOperations","SoftwareDeviceTabComponent","deviceTypeQuery$","list$","changes$","addChanges","requestedChanges","stagedChanges","requestedChange","some","stagedChange","areSameChanges","dropChange","changeToBeDropped","change1","change2","clearChanges","applyChanges","displayChangesFromOperation","SoftwareDeviceTabGuard","isAnyOperationSupported","InstalledSoftwareComponent","installSoftware","displaySoftwareSelectModal","getInstallableSoftwareListWithVersions$","softwareToInstall","emitSoftwareInstall","updateSoftware","softwareToRemove","getSingleSoftwareWithVersions$","removeSoftware","emitSoftwareRemoval","installedSoftwareNames","softwareList","attachVersions","initialStateOverrides","MULTI","item","Input","DeviceSoftwareListComponent","ngAfterContentInit","showUpdate","observers","showRemove","isSoftwareGoingToBeChanged","deviceSoftwareChanges","DeviceSoftwareChangesComponent","clear","drop","installations$","removals$","ngOnChanges","currentValue","DeviceConfigurationService","configurationsUpdated","updateConfigurations","repositorySnapsOnly","hasAnySupportedOperation","supported","Array","isArray","supportedOperation","DeviceConfigurationComponent","deviceConfigurationService","supportedConfigurations","showBinaryBasedConfig","updateSnapshots","c8y_SupportedConfigurations","DOWNLOAD_CONFIG","UPLOAD_CONFIG","repositorySnapshotsEmptyState","showTextBasedConfig","CONFIG","SEND_CONFIG","onConfigTypeSelected","onRepositoryConfigSelected","repositorySnapshot","repositorySnapshots","SourceCodePreviewComponent","SaveToRepositoryComponent","configSnapshotData","close","ConfigurationPreviewComponent","user","appState","operationService","canCallAction","deviceConfigurationOperation","_configurationType","setOperation","operationsChannel","operationsSubscription","updatePreview","operationToTrigger","configType","operationList","createDeviceOperation","operationCfg","showOperation","showBinary","isCreateOperationDisabled","updateSnapshotsOnConfigUpload","blob","Blob","fileName","saveToRepository","hasPermission","hasAnyRole","currentUser","UserService","AppStateService","ConfigurationFilterPipe","transform","Pipe","DeviceConfigurationGuard","state","DeviceConfigurationListComponent","configSelected","showConfigurationTypePreview","selectedConfig","updatePipe","TextBasedConfigurationComponent","reloadingConfig","savingConfig","showTextBasedConfigReload","showTextBasedConfigSave","latestOperation","reloadConfiguration","onOperationReloadSuccess","onOperationReloadError","onOperationReloadComplete","ex","updateConfiguration","onOperationUpdateSuccess","onOperationUpdateError","onOperationUpdateComplete","FileDownloadComponent","linkRenderType","determineBehavior","DOWNLOAD","match","LINK","TEXTONLY","downloadFile","component","context","ViewContext","Device","RepositoryModule","NgModule","imports","CoreModule","FormsModule","SingleOperationDetailsModule","BsDropdownModule","forRoot","TooltipModule","PopoverModule","TabsModule","exports","declarations","entryComponents","providers","provide","HOOK_NAVIGATOR_NODES","useClass","multi","HOOK_ONCE_ROUTE","useValue","ɵ0"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { IManagedObject } from '@c8y/client';\n\nexport enum RepositoryType {\n  FIRMWARE = 'c8y_Firmware',\n  SOFTWARE = 'c8y_Software',\n  CONFIGURATION = 'c8y_ConfigurationDump'\n}\n\nexport const REPOSITORY_BINARY_TYPES = {\n  [RepositoryType.SOFTWARE]: 'c8y_SoftwareBinary',\n  [RepositoryType.FIRMWARE]: 'c8y_FirmwareBinary',\n  [RepositoryType.CONFIGURATION]: 'c8y_ConfigurationDumpBinary'\n};\n\nexport interface ModalModel {\n  selected?: { id?: string; name?: string; [key: string]: any };\n  version?: string;\n  dependency?: { c8y_Firmware: { version: string } };\n  patchVersion?: string;\n  description?: string;\n  deviceType?: string;\n  binary?: {\n    file?: File;\n    url?: string;\n  };\n}\n\nexport interface RepositoryCategory extends Partial<IManagedObject> {\n  type: string;\n  description?: string;\n  c8y_Filter?: {\n    type: string;\n  };\n}\n\nexport interface FirmwareBinary extends Partial<IManagedObject> {\n  type: 'c8y_FirmwareBinary';\n  c8y_Firmware: {\n    version: string;\n    url: string;\n  };\n}\n\nexport interface FirmwarePatchBinary extends FirmwareBinary {\n  c8y_Patch: {\n    dependency: string;\n  };\n}\n\nexport interface SoftwareBinary extends Partial<IManagedObject> {\n  type: string;\n  c8y_Software: {\n    version: string;\n    url: string;\n  };\n}\n\nexport type RepositoryBinary = FirmwareBinary | SoftwareBinary | FirmwarePatchBinary;\n\nexport interface SelectedRepositoryBinary {\n  id: string;\n  name: string;\n  version: string;\n  url: string;\n  dependency?: string;\n  c8y_Patch?: boolean;\n}\n\nexport interface DeviceFirmware {\n  version: string;\n  url: string;\n  name: string;\n}\n\nexport interface DeviceSoftware {\n  name: string;\n  version?: string;\n  url: string;\n}\n\nexport interface DeviceSoftwareChange extends DeviceSoftware {\n  action: 'install' | 'delete';\n}\n\nexport interface ConfigurationSnapshot {\n  id?: string;\n  time: string;\n  name: string;\n  binaryUrl?: string;\n  binary?: any;\n  binaryType?: any;\n  deviceType?: string;\n  configurationType?: string;\n  description?: string;\n}\n\nexport interface SupportedConfigurationItem {\n  name: string;\n  deviceType?: string;\n  configurationType?: string;\n  isLegacy?: boolean;\n}\n\nexport interface DeviceConfigurationListEmptyState {\n  icon?: string;\n  title?: string;\n  text?: string;\n}\n\nexport enum DeviceConfigurationOperation {\n  UPLOAD_CONFIG = 'c8y_UploadConfigFile',\n  DOWNLOAD_CONFIG = 'c8y_DownloadConfigFile',\n  CONFIG = 'c8y_Configuration',\n  SEND_CONFIG = 'c8y_SendConfiguration'\n}\n","export enum LinkRenderType {\n    DOWNLOAD,\n    LINK,\n    TEXTONLY\n}\n","import { Observable, of, from, throwError, merge } from 'rxjs';\nimport { map, switchMap, takeWhile, take, filter, withLatestFrom } from 'rxjs/operators';\nimport { Injectable } from '@angular/core';\nimport {\n  isNil,\n  isUndefined,\n  assign,\n  set,\n  head,\n  get,\n  isString,\n  pick,\n  cloneDeep,\n  remove,\n  find,\n  forEach,\n  map as _map\n} from 'lodash-es';\nimport { AlertService, gettext } from '@c8y/ngx-components';\nimport {\n  InventoryService,\n  InventoryBinaryService,\n  IResult,\n  IManagedObject,\n  IManagedObjectBinary,\n  IIdentified,\n  QueriesUtil,\n  IResultList,\n  IFetchResponse,\n  IOperation,\n  OperationService,\n  Realtime,\n  OperationStatus,\n  IEvent,\n  EventService,\n  EventBinaryService,\n  IdReference\n} from '@c8y/client';\nimport {\n  RepositoryCategory,\n  RepositoryBinary,\n  FirmwareBinary,\n  SoftwareBinary,\n  FirmwarePatchBinary,\n  ModalModel,\n  RepositoryType,\n  REPOSITORY_BINARY_TYPES,\n  DeviceFirmware,\n  DeviceSoftware,\n  DeviceSoftwareChange,\n  SelectedRepositoryBinary,\n  ConfigurationSnapshot\n} from './repository.model';\n\n@Injectable()\nexport class RepositoryService {\n  readonly dateFrom = new Date(0);\n  readonly dateTo = new Date(Date.now() + 86400000); // 1 day in the future\n  private queriesUtil: QueriesUtil;\n\n  constructor(\n    private inventory: InventoryService,\n    private inventoryBinary: InventoryBinaryService,\n    private operation: OperationService,\n    private alert: AlertService,\n    private event: EventService,\n    private realtime: Realtime,\n    private eventBinary: EventBinaryService\n  ) {\n    this.queriesUtil = new QueriesUtil();\n  }\n\n  /**\n   * Lists repository entries of given type.\n   * @param type The type of repository entries to list.\n   * @param options Extra listing options.\n   */\n  listRepositoryEntries(\n    type: RepositoryType,\n    options?: {\n      /** Additional query. */\n      query?: any;\n      /** (deprecated - to be removed) Only include entries with matching partial names. */\n      partialName?: string;\n      /** Include entries with matching partial text in the specified properties. */\n      partialTextFilter?: { partialText: string; properties: string[] };\n      /** Exclude legacy entries. */\n      skipLegacy?: boolean;\n      /** Other request params. */\n      params?: any;\n    }\n  ) {\n    const defaultOrder = [{ name: 1 }];\n    const defaultFilters = { type };\n    const legacyFilters = { __has: `url` };\n    let filters = {};\n\n    let fullQuery = (options && options.query) || {};\n    fullQuery = this.queriesUtil.addOrderbys(fullQuery, defaultOrder, 'prepend');\n\n    fullQuery = this.queriesUtil.addAndFilter(fullQuery, defaultFilters);\n\n    if (options && options.partialTextFilter) {\n      const { partialText, properties } = options.partialTextFilter;\n      const orFilter = { __or: properties.map(property => ({ [property]: `*${partialText}*` })) };\n      fullQuery = this.queriesUtil.addAndFilter(fullQuery, orFilter);\n    }\n\n    if (options && options.partialName) {\n      // backwards compatibility if\n      fullQuery = this.queriesUtil.addAndFilter(fullQuery, { name: `*${options.partialName}*` });\n    }\n\n    if (options && options.skipLegacy) {\n      fullQuery = this.queriesUtil.addAndFilter(fullQuery, { __not: legacyFilters });\n    }\n\n    filters = {\n      query: this.queriesUtil.buildQuery(fullQuery),\n      pageSize: 50,\n      withTotalPages: true,\n      ...((options && options.params) || {})\n    };\n    return this.inventory.list(filters);\n  }\n\n  // TODO: merge with create()\n  async save(data: ModalModel, type: RepositoryType, mo: Partial<IManagedObject> = {}) {\n    switch (type) {\n      case RepositoryType.CONFIGURATION: {\n        Object.assign(mo, {\n          type: RepositoryType.CONFIGURATION,\n          configurationType: data.selected ? data.selected.configurationType : undefined,\n          name: data.version,\n          description: data.description,\n          deviceType: data.deviceType,\n          c8y_Global: {}\n        });\n        if (!data.deviceType && mo.id) {\n          mo.deviceType = null;\n        }\n        if (!data.selected && mo.id) {\n          mo.configurationType = null;\n        }\n        break;\n      }\n    }\n\n    const existingUrl = mo.url;\n    if (data.binary.url) {\n      mo.url = data.binary.url;\n    } else if (data.binary.file) {\n      const response = await this.inventoryBinary.create(data.binary.file, {\n        c8y_Global: {}\n      } as Partial<IManagedObject>);\n      mo.url = response.data.self;\n    }\n\n    if (mo.id) {\n      return this.updateEntry(mo, existingUrl);\n    }\n    return this.createEntry(mo);\n  }\n\n  async create(modal: ModalModel, type: RepositoryType) {\n    switch (type) {\n      case RepositoryType.FIRMWARE:\n      case RepositoryType.SOFTWARE:\n        return this.createFirmwareOrSoftware(modal, type);\n    }\n  }\n\n  async createFirmwareOrSoftware(\n    modal: ModalModel,\n    type: RepositoryType\n  ): Promise<RepositoryCategory> {\n    let binary: IManagedObjectBinary;\n    let binaryURL: string;\n    let repositoryEntry: RepositoryCategory;\n    let repositoryBinary: FirmwareBinary | SoftwareBinary;\n    const mos = [];\n    const {\n      selected: { id: selectedId },\n      binary: { file, url }\n    } = modal;\n    try {\n      if (file) {\n        ({ data: binary } = await this.saveBinary(file));\n        ({ self: binaryURL } = binary);\n        mos.push(binary);\n      } else {\n        binaryURL = url;\n      }\n\n      ({ data: repositoryEntry } = await this.createOrUpdateRepositoryEntry(modal, type));\n      if (isNil(selectedId)) {\n        mos.push(repositoryEntry);\n      }\n\n      ({ data: repositoryBinary } = await this.createRepositoryBinary(\n        modal,\n        binaryURL,\n        type,\n        repositoryEntry\n      ));\n      mos.push(repositoryBinary);\n\n      if (file) {\n        await this.linkBinary(repositoryBinary, binary);\n      }\n\n      return repositoryEntry;\n    } catch (error) {\n      this.cleanUp(mos);\n      this.errorMsg();\n\n      // Propagate error\n      throw error;\n    }\n  }\n\n  saveBinary(file: File): Promise<IResult<IManagedObjectBinary>> {\n    return this.inventoryBinary.create(file, { c8y_Global: {} } as Partial<IManagedObject>);\n  }\n\n  createOrUpdateRepositoryEntry(\n    modal: ModalModel,\n    type: RepositoryType\n  ): Promise<IResult<RepositoryCategory>> {\n    const {\n      selected: { id, name },\n      description,\n      deviceType\n    } = modal;\n\n    const mo = {\n      id,\n      name: id ? undefined : name,\n      description,\n      type: id ? undefined : type,\n      c8y_Global: {}\n    };\n\n    if (deviceType) {\n      set(mo, 'c8y_Filter.type', deviceType);\n    }\n\n    return id\n      ? (this.inventory.update(mo) as Promise<IResult<RepositoryCategory>>)\n      : (this.inventory.create(mo) as Promise<IResult<RepositoryCategory>>);\n  }\n\n  createRepositoryBinary(\n    modal: ModalModel,\n    binaryURL: string,\n    type: RepositoryType,\n    parent: RepositoryCategory\n  ): Promise<IResult<FirmwareBinary | SoftwareBinary | FirmwarePatchBinary>> {\n    const mo = this.prepareRepositoryBinaryMO(modal, binaryURL, type);\n\n    return this.inventory.childAdditionsCreate(mo, parent) as Promise<\n      IResult<FirmwareBinary | SoftwareBinary | FirmwarePatchBinary>\n    >;\n  }\n\n  prepareRepositoryBinaryMO(modal: ModalModel, binaryURL: string, type: RepositoryType) {\n    const { version, patchVersion, dependency } = modal;\n    const result = {\n      type: REPOSITORY_BINARY_TYPES[type],\n      [type]: {\n        url: binaryURL\n      },\n      c8y_Global: {}\n    };\n\n    if (dependency) {\n      set(result, [type, 'version'], patchVersion);\n      assign(result, {\n        c8y_Patch: {\n          dependency: dependency.c8y_Firmware.version\n        }\n      });\n    } else {\n      set(result, [type, 'version'], version);\n    }\n    return result;\n  }\n\n  async linkBinary(\n    repositoryBinary: FirmwareBinary | SoftwareBinary,\n    binary: IManagedObjectBinary\n  ) {\n    const { id: repositoryBinaryId } = repositoryBinary;\n    if (binary) {\n      const { id: binaryId } = binary;\n      return this.inventory.childAdditionsAdd(binaryId, repositoryBinaryId);\n    }\n  }\n\n  cleanUp(mosToDelete: IIdentified[]) {\n    mosToDelete.forEach(mo => {\n      const { c8y_IsBinary } = mo;\n      isUndefined(c8y_IsBinary) ? this.delete(mo) : this.inventoryBinary.delete(mo);\n    });\n  }\n\n  delete(entity: IIdentified): Promise<IResult<null>> {\n    return this.inventory.delete(entity, { forceCascade: true });\n  }\n\n  errorMsg() {\n    const msg = gettext('Failed to save');\n    this.alert.danger(msg);\n  }\n\n  getBaseVersionsCount$(entry: IManagedObject): Observable<number> {\n    if (this.isLegacyEntry(entry)) {\n      return of(1);\n    }\n    return from(this.listBaseVersions(entry, { pageSize: 1, withTotalPages: true })).pipe(\n      map(({ paging }) => paging.totalPages)\n    );\n  }\n\n  getBaseVersionFromMO(mo: RepositoryBinary): string {\n    return this.isPatch(mo) ? get(mo, 'c8y_Patch.dependency') : get(mo, 'c8y_Firmware.version');\n  }\n\n  isPatch(mo: RepositoryBinary): boolean {\n    return !!get(mo, 'c8y_Patch.dependency');\n  }\n\n  getPatchVersionsCount$(entry: IManagedObject, baseVersion: FirmwareBinary): Observable<number> {\n    if (this.isLegacyEntry(baseVersion)) {\n      return of(0);\n    }\n    return from(\n      this.listPatchVersions(entry, baseVersion, { pageSize: 1, withTotalPages: true })\n    ).pipe(map(({ paging }) => paging.totalPages));\n  }\n\n  isLegacyEntry(entry: Partial<IManagedObject>): boolean {\n    return Boolean(entry.url);\n  }\n\n  /**\n   * Lists all versions (base and patch ones) of given top level entry.\n   * Versions are ordered by creation time (assuming the earlier created, the older the version).\n   * @param entry Top level repository entry.\n   * @param params Additional query params.\n   */\n  listAllVersions(entry: Partial<IManagedObject>, params = {}) {\n    if (this.isLegacyEntry(entry)) {\n      return this.getBaseVersionResultListForLegacyEntry(entry);\n    }\n\n    const VERSION_FILTER_ORDER = {\n      __filter: {},\n      __orderby: [{ 'creationTime.date': -1 }, { creationTime: -1 }]\n    };\n    return this.listChildren(entry, VERSION_FILTER_ORDER, params);\n  }\n\n  /**\n   * Lists base versions of given top level entry.\n   * Versions are ordered by creation time (assuming the earlier created, the older the version).\n   * @param entry Top level repository entry.\n   * @param params Additional query params.\n   */\n  listBaseVersions(entry: Partial<IManagedObject>, params = {}) {\n    if (this.isLegacyEntry(entry)) {\n      return this.getBaseVersionResultListForLegacyEntry(entry);\n    }\n\n    const NO_PATCH_FILTER_ORDER = {\n      __filter: {\n        __not: { __has: 'c8y_Patch' }\n      },\n      __orderby: [{ 'creationTime.date': -1 }, { creationTime: -1 }]\n    };\n    return this.listChildren(entry, NO_PATCH_FILTER_ORDER, params);\n  }\n\n  /**\n   * Lists patch versions of given base version under the entry.\n   * Versions are ordered by creation time (assuming the earlier created, the older the version).\n   * @param entry Top level repository entry.\n   * @param baseVersion Base version.\n   * @param params Additional query params.\n   */\n  listPatchVersions(entry: IManagedObject, baseVersion: FirmwareBinary | string, params = {}) {\n    const version = isString(baseVersion) ? baseVersion : get(baseVersion, 'c8y_Firmware.version');\n    const PATCH_FILTER_ORDER = {\n      __filter: {\n        'c8y_Patch.dependency': version\n      },\n      __orderby: [{ 'creationTime.date': -1 }, { creationTime: -1 }]\n    };\n    return this.listChildren(entry, PATCH_FILTER_ORDER, params);\n  }\n\n  /**\n   * Lists patch versions of given base version under the entry including the base version.\n   * Versions are ordered by creation time (assuming the earlier created, the older the version).\n   * In terms of legacy base version the entry gets transformed to fit the needed data model.\n   * @param entry Top level repository entry.\n   * @param baseVersion Base version.\n   * @param params Additional query params.\n   */\n  listBaseVersionAndPatches(entry: IManagedObject, baseVersion: IManagedObject, params = {}) {\n    if (this.isLegacyEntry(entry)) {\n      return Promise.resolve({\n        data: [\n          Object.assign(\n            {\n              c8y_Firmware: {\n                version: entry.version,\n                url: entry.url\n              }\n            },\n            entry\n          )\n        ]\n      });\n    }\n\n    const PATCH_FILTER_ORDER = {\n      __filter: {\n        __or: {\n          'c8y_Patch.dependency': baseVersion.c8y_Firmware.version,\n          'c8y_Firmware.version': baseVersion.c8y_Firmware.version\n        }\n      },\n      __orderby: [{ 'c8y_Patch.dependency': 1 }, { 'c8y_Firmware.version': 1 }]\n    };\n    return this.listChildren(entry, PATCH_FILTER_ORDER, params);\n  }\n\n  listChildren(entry: Partial<IManagedObject>, filters = {}, params: any = {}) {\n    const childrenFilters = { __bygroupid: entry.id };\n    const query = this.queriesUtil.addAndFilter(filters, childrenFilters);\n    // FIXME: needed because of issue in forOf directive (...)\n    params.withTotalPages = true;\n    return this.inventory.listQuery(query, params);\n  }\n\n  /**\n   * Fetches all items from the list starting with the provided page.\n   * @param firstPage The first page of the list to fetch all items for.\n   */\n  async fetchAllItemsFromList(firstPage) {\n    let allItems;\n\n    if (!firstPage.then) {\n      allItems = [...firstPage];\n    } else {\n      let { paging, data: items } = await firstPage;\n      allItems = [...items];\n\n      while (paging && paging.nextPage) {\n        ({ paging, data: items } = await paging.next());\n        allItems = [...allItems, ...items];\n      }\n    }\n\n    return allItems;\n  }\n\n  /**\n   * Gets top level repository entry managed object for base or patch version.\n   * @param mo Base or patch version managed object with parents.\n   */\n  getRepositoryEntryMO$(mo: IManagedObject): Observable<IManagedObject | undefined> {\n    if (!mo) {\n      return of(undefined);\n    }\n    const [reference] = get(mo, 'additionParents.references');\n    const id = get(reference, 'managedObject.id');\n    return id\n      ? from(this.inventory.detail(id, { withChildren: false })).pipe(map(({ data }) => data))\n      : of(undefined);\n  }\n  /**\n   * Gets base or patch version managed object.\n   * @param deviceRepositoryFragment Device repository fragment.\n   * @param type Top level repository entry type.\n   * @param configuration Configuration object with options:\n   * - **skipLegacy** - `boolean` - Exclude legacy entries.\n   * - **filters** - `object` - Filter object.\n   *\n   * @deprecated as it doesn't support 'missing url' case\n   */\n  getRepositoryBinaryMoByVersion(\n    deviceRepositoryFragment: DeviceFirmware | DeviceSoftware,\n    type: RepositoryType,\n    { skipLegacy = false, filters = {} }: { skipLegacy?: boolean; filters?: object } = {}\n  ): Promise<IManagedObject> {\n    const { version, url, name } = deviceRepositoryFragment;\n    const repositoryBinaryType = REPOSITORY_BINARY_TYPES[type];\n    let query;\n    const newModelBaseVersionQuery = {\n      [`${type}.version`]: version,\n      [`${type}.url`]: url,\n      type: repositoryBinaryType\n    };\n    const legacyVersionQuery = { url, type, name };\n    filters = { withChildren: false, withParents: true, ...filters };\n\n    if (skipLegacy) {\n      query = {\n        __and: {\n          ...newModelBaseVersionQuery\n        }\n      };\n    } else {\n      query = {\n        __or: [{ __and: { ...newModelBaseVersionQuery } }, { __and: { ...legacyVersionQuery } }]\n      };\n    }\n\n    return this.inventory.listQuery(query, filters).then(({ data }) => head(data));\n  }\n\n  getBinaryName$(binaryUrl: string): Observable<string> {\n    if (!binaryUrl) {\n      return of('---');\n    }\n\n    const binaryId = this.inventoryBinary.getIdFromUrl(binaryUrl);\n    if (!binaryId) {\n      return of(binaryUrl);\n    }\n    return this.inventory.detail$(binaryId).pipe(map(mo => mo.name));\n  }\n\n  /**\n   * Generates an inventory query object which can be used to find\n   * repository entries of specified type matching the type of provided device.\n   * @param repositoryType The type of repository entries which will be queried with the generated query.\n   * @param device The device for which matching repository entries will be queried with the generated query.\n   */\n  getDeviceTypeQuery(repositoryType: RepositoryType, device: IManagedObject): object {\n    let result = { type: repositoryType };\n    if (device.type) {\n      if (repositoryType === RepositoryType.CONFIGURATION) {\n        result = this.queriesUtil.addAndFilter(result, {\n          __or: [{ deviceType: device.type }, { __not: { __has: `deviceType` } }]\n        });\n      } else {\n        result = this.queriesUtil.addAndFilter(result, {\n          __or: [\n            { 'c8y_Filter.type': device.type },\n            { 'c8y_Filter.type': '' },\n            { __not: { __has: `c8y_Filter.type` } }\n          ]\n        });\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Generates an inventory query object which can be used to find configuration repository entries\n   * matching the type of provided device and specified configuration type.\n   * @param device The device for which matching repository entries will be queried with the generated query.\n   * @param configurationType Configuration type for which matching repository entries will be queried with the generated query.\n   */\n  getConfigurationTypeQuery(device: IManagedObject, configurationType: string): object {\n    const query = this.getDeviceTypeQuery(RepositoryType.CONFIGURATION, device);\n    return this.queriesUtil.addAndFilter(query, {\n      __or: [\n        { configurationType },\n        { configurationType: '' },\n        { __not: { __has: `configurationType` } }\n      ]\n    });\n  }\n\n  /**\n   * Gets the list of software installed in the device in the uniform format.\n   * Supports c8y_SoftwareList and c8y_Software fragments.\n   * @param device The device whose software list should be returned.\n   */\n  getDeviceSoftwareList(device: IManagedObject): DeviceSoftware[] {\n    if (device.c8y_SoftwareList) {\n      return cloneDeep(device.c8y_SoftwareList);\n    }\n    if (device.c8y_Software) {\n      return _map(device.c8y_Software, (version, name) => ({ name, version }));\n    }\n    return [];\n  }\n\n  /**\n   * Prepares a software update operation for given device and the list of changes, and sends it to the device.\n   * @param device The device which the operation should be prepared for and sent to.\n   * @param changes The list of software changes which should be applied.\n   */\n  async createSoftwareUpdateOperation(\n    device: IManagedObject,\n    changes: DeviceSoftwareChange[]\n  ): Promise<IOperation> {\n    const operation = this.getSoftwareUpdateOperation(device, changes);\n    return (await this.operation.create(operation)).data;\n  }\n\n  /**\n   * Prepares a software update operation for given device and changes.\n   * Returned operation type depends on device's supported operations.\n   * Supports c8y_SoftwareUpdate, c8y_SoftwareList, and c8y_Software operations.\n   * @param device The device for which operation should be prepared.\n   * @param changes The list of software changes which should be applied.\n   */\n  getSoftwareUpdateOperation(device: IManagedObject, changes: DeviceSoftwareChange[]): IOperation {\n    const operation: IOperation = {\n      deviceId: device.id,\n      description: `Apply software changes: ${changes\n        .map(\n          change =>\n            `${change.action} \"${change.name}\"${\n              change.version ? ` (version: ${change.version})` : ''\n            }`\n        )\n        .join(', ')}`\n    };\n    if (device.c8y_SupportedOperations.includes('c8y_SoftwareUpdate')) {\n      operation.c8y_SoftwareUpdate = cloneDeep(changes);\n    } else if (device.c8y_SupportedOperations.includes('c8y_SoftwareList')) {\n      operation.c8y_SoftwareList = cloneDeep(device.c8y_SoftwareList) || [];\n      changes.forEach(change => {\n        const deviceSoftware: DeviceSoftware = pick(change, ['name', 'version', 'url']);\n        if (change.action === 'delete') {\n          remove(operation.c8y_SoftwareList, deviceSoftware);\n        }\n        if (change.action === 'install') {\n          operation.c8y_SoftwareList.push(deviceSoftware);\n        }\n      });\n    } else if (device.c8y_SupportedOperations.includes('c8y_Software')) {\n      operation.c8y_Software = cloneDeep(device.c8y_Software) || {};\n      changes.forEach(change => {\n        if (change.action === 'delete') {\n          delete operation.c8y_Software[change.name];\n        }\n        if (change.action === 'install') {\n          operation.c8y_Software[change.name] = change.version;\n        }\n      });\n    }\n    return operation;\n  }\n\n  /**\n   * Extracts the list of device software changes from given operation in the context of given device.\n   * @param operation The operation from which the list should be extracted.\n   * @param device The target device of the operation.\n   */\n  getDeviceSoftwareChangesFromOperation(\n    operation: IOperation,\n    device: IManagedObject\n  ): DeviceSoftwareChange[] {\n    if (operation.c8y_SoftwareUpdate) {\n      return cloneDeep(operation.c8y_SoftwareUpdate);\n    }\n    if (operation.c8y_SoftwareList) {\n      return this.getDeviceSoftwareChangesFromSoftwareListOperation(operation, device);\n    }\n    if (operation.c8y_Software) {\n      return this.getDeviceSoftwareChangesFromSoftwareOperation(operation, device);\n    }\n    return [];\n  }\n\n  /**\n   * Prepares a firmware update operation for given device and the selected repository binary, and sends it to the device.\n   * @param device The device which the operation should be prepared for and sent to.\n   * @param selectedOption The selected repository binary option.\n   */\n  async createFirmwareUpdateOperation(\n    device: IManagedObject,\n    selectedOption: SelectedRepositoryBinary\n  ): Promise<IOperation> {\n    const operation = this.getFirmwareUpdateOperation(device, selectedOption);\n    return (await this.operation.create(operation)).data;\n  }\n\n  /**\n   * Prepares a firmware update operation for given device and selected version.\n   * Supports c8y_Firmware operation.\n   * @param device The device for which operation should be prepared.\n   * @param selectedOption Selected firmware version.\n   */\n  getFirmwareUpdateOperation(\n    device: IManagedObject,\n    selectedOption: SelectedRepositoryBinary\n  ): IOperation {\n    delete selectedOption.id;\n\n    const operation: IOperation = {\n      deviceId: device.id,\n      description: `Update firmware to: \"${selectedOption.name}\"${\n        selectedOption.version ? ` (version: ${selectedOption.version})` : ''\n      }`,\n      c8y_Firmware: { ...selectedOption }\n    };\n\n    return operation;\n  }\n\n  /**\n   * Prepares a configuration file upload operation for given device and configuration type.\n   * @param device The device for which operation should be prepared.\n   * @param configurationType Selected configuration type.\n   * @param isLegacy  A legacy operation is created without a configurationType.\n   */\n  getUploadConfigurationFileOperation(\n    device: IManagedObject,\n    configurationType: string,\n    isLegacy: boolean = false\n  ): IOperation {\n    if (isLegacy) {\n      return {\n        deviceId: device.id,\n        description: `Retrieve configuration snapshot from device ${device.name}`,\n        c8y_UploadConfigFile: {}\n      };\n    }\n    return {\n      deviceId: device.id,\n      description: `Retrieve ${configurationType} configuration snapshot from device ${\n        device.name\n      }`,\n      c8y_UploadConfigFile: {\n        type: configurationType\n      }\n    };\n  }\n\n  /**\n   * Prepares a configuration file download operation for given device and configuration type.\n   * @param device The device for which operation should be prepared.\n   * @param configurationType Selected configuration type.\n   * @param binaryUrl The url of a binary to be downloaded.\n   * @param isLegacy A legacy operation is created without a configurationType.\n   */\n  getDownloadConfigurationFileOperation(\n    device: IManagedObject,\n    configurationType: string,\n    configSnapshot: ConfigurationSnapshot,\n    isLegacy: boolean = false\n  ): IOperation {\n    if (isLegacy) {\n      return {\n        deviceId: device.id,\n        description: `Send configuration snapshot ${configSnapshot.name} to device ${device.name}`,\n        c8y_DownloadConfigFile: {\n          url: configSnapshot.binaryUrl,\n          c8y_ConfigurationDump: {\n            id: configSnapshot.id\n          }\n        }\n      };\n    }\n    return {\n      deviceId: device.id,\n      description: `Send configuration snapshot ${\n        configSnapshot.name\n      } of configuration type ${configurationType} to device ${device.name}`,\n      c8y_DownloadConfigFile: {\n        url: configSnapshot.binaryUrl,\n        type: configurationType\n      }\n    };\n  }\n\n  /**\n   * Gets the last firmware update operation for given device.\n   * Looks for c8y_Firmware operations.\n   * @param deviceId The ID of the device to find an operation for.\n   */\n  async getLastFirmwareUpdateOperation(deviceId: string | number): Promise<IOperation> {\n    const filters = {\n      deviceId,\n      dateFrom: new Date(0).toISOString(),\n      dateTo: new Date(Date.now()).toISOString(),\n      revert: true,\n      pageSize: 1\n    };\n    return this.getFirstMatchingOperation([{ ...filters, fragmentType: 'c8y_Firmware' }]);\n  }\n\n  /**\n   * Gets the last software update operation for given device.\n   * Looks for c8y_SoftwareUpdate, c8y_SoftwareList, or c8y_Software operations.\n   * @param deviceId The ID of the device to find an operation for.\n   */\n  async getLastSoftwareUpdateOperation(deviceId: string | number): Promise<IOperation> {\n    const filters = {\n      deviceId,\n      dateFrom: new Date(0).toISOString(),\n      dateTo: new Date(Date.now()).toISOString(),\n      revert: true,\n      pageSize: 1\n    };\n    return this.getFirstMatchingOperation([\n      { ...filters, fragmentType: 'c8y_SoftwareUpdate' },\n      { ...filters, fragmentType: 'c8y_SoftwareList' },\n      { ...filters, fragmentType: 'c8y_Software' }\n    ]);\n  }\n\n  /**\n   * Iterates over the list of filters and queries the operations.\n   * If a query returns at least one operation, the first one will be returned.\n   * Otherwise the next query will be performed.\n   * If none of the queries returns any operation, null will be returned.\n   * @param filtersList The list of filters for the queries.\n   */\n  async getFirstMatchingOperation(filtersList: any[]): Promise<IOperation> {\n    let matchingOperation = null;\n\n    for (const filters of filtersList) {\n      const operations = (await this.operation.list(filters)).data;\n      if (operations.length) {\n        matchingOperation = operations[0];\n        break;\n      }\n    }\n\n    return matchingOperation;\n  }\n\n  /**\n   * Creates the operation and returns an observable to track its progress.\n   * Fails the observable when the operation returns FAILED status.\n   * Completes the observable when the operation returns SUCCESSFUL status.\n   * @param operation The operation to create and track.\n   */\n  createObservedOperation(operation: IOperation): Observable<IOperation> {\n    return from(this.operation.create(operation)).pipe(\n      map(({ data }) => data),\n      take(1),\n      switchMap(createdOperation => this.observeOperation(createdOperation))\n    );\n  }\n\n  /**\n   * Returns an observable to track progress of given operation.\n   * Fails the observable when the operation returns FAILED status.\n   * Completes the observable when the operation returns SUCCESSFUL status.\n   * @param operation The operation to be observed.\n   */\n  observeOperation(operation: IOperation): Observable<IOperation> {\n    const observedOperation$ = of(operation);\n    const operationUpdates$ = observedOperation$.pipe(\n      switchMap(observedOperation =>\n        this.realtime.observable(`/operations/${observedOperation.deviceId}`)\n      ),\n      map(({ data }) => data),\n      withLatestFrom(observedOperation$),\n      filter(([operationUpdate, observedOperation]) => operationUpdate.id === observedOperation.id),\n      switchMap(([operationUpdate]) => {\n        if (operationUpdate.status === OperationStatus.FAILED) {\n          return throwError(operationUpdate);\n        }\n        return of(operationUpdate);\n      }),\n      takeWhile(operationUpdate => operationUpdate.status !== OperationStatus.SUCCESSFUL, true)\n    );\n    return merge(observedOperation$, operationUpdates$);\n  }\n\n  /**\n   * Gets a single event with latest creationTime for the given device Id and event type.\n   * @param deviceId The device Id for which the events should be queried.\n   * @param type Event type.\n   */\n  async getLatestConfigurationEvent(\n    deviceId: string | number,\n    type: string\n  ): Promise<IEvent | undefined> {\n    const eventFilter: object = {\n      source: deviceId,\n      type,\n      dateFrom: this.dateFrom.toISOString(),\n      dateTo: this.dateTo.toISOString(),\n      pageSize: 1\n    };\n\n    const { data } = await this.event.list(eventFilter);\n    return data[0];\n  }\n\n  /**\n   * Gets a list of operations for the given device Id, and operation type.\n   * @param deviceId The device Id for which the operation should be queried.\n   * @param operationType Operation type fragment.\n   */\n  async getConfigFileOperationList(\n    deviceId: string | number,\n    operationType: string\n  ): Promise<IOperation[]> {\n    const operationFilter: object = {\n      deviceId,\n      fragmentType: operationType,\n      dateFrom: this.dateFrom.toISOString(),\n      dateTo: this.dateTo.toISOString(),\n      revert: true,\n      pageSize: 2000\n    };\n\n    return (await this.operation.list(operationFilter)).data;\n  }\n\n  /**\n   * Gets latest uploaded configuration snapshot for the given device, and configuration type.\n   * @param device The device for which the configuration snapshot was uploaded.\n   * @param configurationType Selected configuration type.\n   */\n  async getConfigSnapshot(\n    device: IManagedObject,\n    configurationType: string\n  ): Promise<ConfigurationSnapshot | undefined> {\n    const event: IEvent = await this.getLatestConfigurationEvent(device.id, configurationType);\n    let configSnapshot: ConfigurationSnapshot;\n    if (event) {\n      configSnapshot = {\n        time: event.time,\n        name: event.text,\n        deviceType: device.type,\n        configurationType\n      };\n      try {\n        configSnapshot.binary = await (await this.eventBinary.download(event)).text();\n        if (event.c8y_IsBinary) {\n          configSnapshot.binaryType = event.c8y_IsBinary.type;\n        }\n      } catch (ex) {\n        const msg = gettext('Could not get the binary.');\n        this.alert.danger(msg);\n      }\n    }\n    return configSnapshot;\n  }\n\n  async getLegacyConfigSnapshot(deviceId) {\n    let configSnapshot: ConfigurationSnapshot;\n    let mo;\n    const device = (await this.inventory.detail(deviceId, { withChildren: false })).data;\n    const snapshotId = device.c8y_ConfigurationDump && device.c8y_ConfigurationDump.id;\n    if (!snapshotId) {\n      return;\n    }\n\n    try {\n      mo = (await this.inventory.detail(snapshotId)).data;\n    } catch (ex) {\n      // do nothing\n    }\n    if (mo) {\n      configSnapshot = {\n        time: mo.creationTime,\n        name: mo.name\n      };\n      configSnapshot.binary = await this.getBinaryText(mo.url, { allowExternal: false });\n    }\n    return configSnapshot;\n  }\n\n  /**\n   * Returns a binary object as text.\n   * @param binaryUrl The URL to find binary\n   * @param options The object with additional options:\n   * - **allowExternal** - `boolean` - allows downloading external binary file\n   * - **noAlerts** - `boolean` - do not display an alert message; defaults to `false`\n   */\n  async getBinaryText(\n    binaryUrl: string,\n    options: { allowExternal: boolean; noAlerts?: boolean }\n  ): Promise<string> {\n    const binaryId = this.inventoryBinary.getIdFromUrl(binaryUrl);\n\n    let res;\n    if (!binaryId && options.allowExternal) {\n      res = await this.getExternalBinaryResponse(binaryUrl, options);\n    } else {\n      res = await this.getInternalBinaryResponse(binaryId, options);\n    }\n    if (!res) {\n      return null;\n    }\n    return res.text();\n  }\n\n  /**\n   * Returns a binary object as File.\n   * @param binaryUrl The URL to find binary\n   * @param options The object with additional options:\n   * - **allowExternal** - `boolean` - allows downloading external binary file\n   */\n  async getBinaryFile(binaryUrl: string, options: { allowExternal: boolean }): Promise<File> {\n    const binaryId = this.inventoryBinary.getIdFromUrl(binaryUrl);\n    if (!binaryId && !options.allowExternal) {\n      return null;\n    }\n    // @TODO: note that it doesn't solve issue with external binary here, such url won't have binaryId, so we won't know the name or contentType to use in File constructor, let's add a @FIXME comment for now?\n    const { name, contentType } = (await this.inventory.detail(binaryId)).data;\n    const res = !!binaryId\n      ? await this.getInternalBinaryResponse(binaryId)\n      : await this.getExternalBinaryResponse(binaryUrl);\n    const arrayBuffer = await res.arrayBuffer();\n    return new File([arrayBuffer], name, { type: contentType });\n  }\n\n  /**\n   * Gets the last configuration update operation for given device.\n   * Looks for c8y_Configuration and c8y_SendConfiguration operations.\n   * @param deviceId The ID of the device to find an operation for.\n   */\n  async getLastConfigUpdateOperation(deviceId: string | number): Promise<IOperation> {\n    const filters = {\n      deviceId,\n      dateFrom: new Date(0).toISOString(),\n      dateTo: new Date(Date.now()).toISOString(),\n      revert: true,\n      pageSize: 1\n    };\n    return this.getFirstMatchingOperation([\n      { ...filters, fragmentType: 'c8y_Configuration' },\n      { ...filters, fragmentType: 'c8y_SendConfiguration' }\n    ]);\n  }\n\n  /**\n   * Prepares a configuration download operation for given device and its current configuration.\n   * Supports c8y_SendConfiguration operation.\n   * @param device The device for which operation should be prepared.\n   */\n  createTextBasedConfigurationReloadOperation(device: IManagedObject): IOperation {\n    return {\n      deviceId: device.id,\n      description: gettext('Requested current configuration'),\n      c8y_SendConfiguration: {}\n    };\n  }\n\n  /**\n   * Prepares a configuration update operation for the given device.\n   * Supports c8y_Configuration operation.\n   * @param device The device for which operation should be prepared.\n   * @param config The configuration which will update the existing one.\n   */\n  createTextBasedConfigurationUpdateOperation(device: IManagedObject, config: string): IOperation {\n    return {\n      deviceId: device.id,\n      description: gettext('Configuration update'),\n      c8y_Configuration: {\n        config\n      }\n    };\n  }\n\n  async getBinary(binaryId: IdReference): Promise<IFetchResponse> {\n    try {\n      return await this.inventoryBinary.download(binaryId);\n    } catch (ex) {\n      const msg = gettext('Could not get the binary.');\n      this.alert.danger(msg);\n    }\n  }\n\n  /**\n   * Gets all available snapshots from the repository for the given device.\n   * @param device The device for which the snapshots should be prepared.\n   * @param configurationType Selected configuration type.\n   */\n  async getSnapshotsFromRepository(device, configurationType) {\n    const searchQuery = this.getConfigurationTypeQuery(device, configurationType);\n    const res = await this.listRepositoryEntries(RepositoryType.CONFIGURATION, {\n      query: searchQuery,\n      params: { pageSize: 100 }\n    });\n    return res.data;\n  }\n\n  /**\n   * Returns a binary object.\n   * @param binaryId binary ID\n   * @param options The object with additional options:\n   * - **noAlerts** - `boolean` - do not display an alert message; defaults to `false`\n   */\n  private async getInternalBinaryResponse(\n    binaryId: IdReference,\n    options: { noAlerts?: boolean } = {}\n  ): Promise<IFetchResponse> {\n    let res;\n    try {\n      res = await this.inventoryBinary.download(binaryId);\n    } catch (ex) {\n      if (!options.noAlerts) {\n        const msg = gettext('Could not get the binary.');\n        this.alert.danger(msg);\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Returns a binary object.\n   * @param binaryUrl The URL to find binary\n   * @param options The object with additional options:\n   * - **noAlerts** - `boolean` - do not display an alert message; defaults to `false`\n   */\n  private async getExternalBinaryResponse(\n    binaryUrl: string,\n    options: { noAlerts?: boolean } = {}\n  ): Promise<IFetchResponse> {\n    let res;\n    try {\n      const fetchRes = await fetch(binaryUrl);\n      if (fetchRes.status >= 400) {\n        throw res;\n      }\n      res = fetchRes;\n    } catch {\n      if (!options.noAlerts) {\n        const msg = gettext('Could not get the external binary');\n        this.alert.danger(msg);\n      }\n    }\n    return res;\n  }\n\n  private async createEntry(mo: Partial<IManagedObject>) {\n    const binaryId = await this.inventoryBinary.getIdFromUrl(mo.url);\n    const newMo = await this.inventory.create(mo);\n    if (binaryId) {\n      await this.inventory.childAdditionsAdd(binaryId, newMo.data);\n    }\n    return newMo;\n  }\n\n  private async updateEntry(mo: Partial<IManagedObject>, url) {\n    const existingBinaryId = await this.inventoryBinary.getIdFromUrl(url);\n    const newBinaryId = await this.inventoryBinary.getIdFromUrl(mo.url);\n    if (existingBinaryId && existingBinaryId !== newBinaryId) {\n      const id = this.inventoryBinary.getIdFromUrl(url);\n      await this.inventoryBinary.delete(id);\n    }\n    if (newBinaryId) {\n      await this.inventory.childAdditionsAdd(newBinaryId, mo);\n    }\n    return this.inventory.update(mo);\n  }\n\n  private getBaseVersionResultListForLegacyEntry(entry) {\n    return Promise.resolve({\n      res: {} as IFetchResponse,\n      data: [\n        {\n          ...entry,\n          [entry.type]: {\n            version: entry.version,\n            url: entry.url\n          }\n        }\n      ]\n    } as IResultList<IManagedObject>);\n  }\n\n  private getDeviceSoftwareChangesFromSoftwareListOperation(\n    operation: IOperation,\n    device: IManagedObject\n  ): DeviceSoftwareChange[] {\n    const changes: DeviceSoftwareChange[] = [];\n    forEach(device.c8y_SoftwareList, deviceSoftware => {\n      const operationSoftware = find(operation.c8y_SoftwareList, { name: deviceSoftware.name });\n      if (\n        (operationSoftware && operationSoftware.version) !==\n        (deviceSoftware && deviceSoftware.version)\n      ) {\n        changes.push({\n          ...deviceSoftware,\n          action: 'delete'\n        } as DeviceSoftwareChange);\n      }\n    });\n    forEach(operation.c8y_SoftwareList, operationSoftware => {\n      const deviceSoftware = find(device.c8y_SoftwareList, { name: operationSoftware.name });\n      if (\n        (operationSoftware && operationSoftware.version) !==\n        (deviceSoftware && deviceSoftware.version)\n      ) {\n        changes.push({\n          ...operationSoftware,\n          action: 'install'\n        } as DeviceSoftwareChange);\n      }\n    });\n    return changes;\n  }\n\n  private getDeviceSoftwareChangesFromSoftwareOperation(\n    operation: IOperation,\n    device: IManagedObject\n  ): DeviceSoftwareChange[] {\n    const changes: DeviceSoftwareChange[] = [];\n    forEach(device.c8y_Software, (deviceSoftwareVersion, deviceSoftwareName) => {\n      if (operation.c8y_Software[deviceSoftwareName] !== deviceSoftwareVersion) {\n        changes.push({\n          name: deviceSoftwareName,\n          version: deviceSoftwareVersion,\n          action: 'delete'\n        } as DeviceSoftwareChange);\n      }\n    });\n    forEach(operation.c8y_Software, (operationSoftwareVersion, operationSoftwareName) => {\n      if (device.c8y_Software[operationSoftwareName] !== operationSoftwareVersion) {\n        changes.push({\n          name: operationSoftwareName,\n          version: operationSoftwareVersion,\n          action: 'install'\n        } as DeviceSoftwareChange);\n      }\n    });\n    return changes;\n  }\n}\n","import { Component, Output, EventEmitter, ViewChild } from '@angular/core';\nimport { NgForm } from '@angular/forms';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { RepositoryService } from '../repository.service';\nimport { RepositoryType, ModalModel, RepositoryCategory } from '../repository.model';\nimport { AlertService, gettext } from '@c8y/ngx-components';\nimport { isUndefined, get, assign } from 'lodash-es';\nimport { BehaviorSubject, Subscription, from } from 'rxjs';\nimport { debounceTime, distinctUntilChanged, tap, switchMap } from 'rxjs/operators';\nimport { PickedFiles } from '@c8y/ngx-components';\nimport { IManagedObject } from '@c8y/client';\n\n@Component({\n  selector: 'c8y-add-firmware-software-modal',\n  templateUrl: 'add-firmware-modal.component.html'\n})\nexport class AddFirmwareModalComponent {\n  @ViewChild('firmwareForm', { static: false }) form: NgForm;\n  @Output() saved: EventEmitter<RepositoryCategory> = new EventEmitter<RepositoryCategory>();\n  onInput: BehaviorSubject<string> = new BehaviorSubject<string>('');\n  model: ModalModel = {\n    selected: undefined,\n    version: undefined,\n    description: undefined,\n    deviceType: undefined,\n    binary: {\n      file: undefined,\n      url: undefined\n    }\n  };\n  firmwaresResult;\n  saving = false;\n  firmwarePreselected: boolean = false;\n  private inputSubscription$: Subscription;\n\n  constructor(\n    private modal: BsModalRef,\n    private repositoryService: RepositoryService,\n    private alert: AlertService\n  ) {}\n\n  ngOnInit() {\n    this.setInitialState();\n    this.loadFirmwares();\n  }\n\n  setInitialState() {\n    if (this.model.selected) {\n      this.firmwarePreselected = true;\n    }\n  }\n\n  loadFirmwares() {\n    this.inputSubscription$ = this.onInput\n      .pipe(\n        tap(() => {\n          if (!this.firmwarePreselected) {\n            this.model.description = null;\n            if (this.form) {\n              this.form.form.get('description').reset();\n            }\n          }\n        }),\n        debounceTime(300),\n        distinctUntilChanged(),\n        switchMap(searchStr => this.getFirmwareResult(searchStr))\n      )\n      .subscribe(result => {\n        this.firmwaresResult = result;\n      });\n  }\n\n  getFirmwareResult(searchStr: string) {\n    return from(\n      this.repositoryService.listRepositoryEntries(RepositoryType.FIRMWARE, {\n        partialName: searchStr,\n        skipLegacy: true\n      })\n    );\n  }\n\n  async save() {\n    this.saving = true;\n    this.repositoryService\n      .create(this.model, RepositoryType.FIRMWARE)\n      .then(savedFirmware => {\n        this.successMsg();\n        this.saving = false;\n        this.saved.next(savedFirmware);\n        this.cancel();\n      })\n      .catch(e => {\n        this.saving = false;\n        this.saved.error(e);\n        this.cancel();\n      });\n  }\n\n  successMsg() {\n    const msg = gettext('Firmware added.');\n    this.alert.success(msg);\n  }\n\n  cancel() {\n    this.modal.hide();\n    this.saved.complete();\n  }\n\n  ngOnDestroy() {\n    this.inputSubscription$.unsubscribe();\n  }\n\n  onFile(dropped: PickedFiles) {\n    if (!isUndefined(dropped.url)) {\n      this.model.binary = {\n        url: dropped.url\n      };\n      return;\n    } else if (!isUndefined(dropped.droppedFiles)) {\n      this.model.binary = {\n        file: dropped.droppedFiles[0].file\n      };\n      return;\n    } else {\n      this.model.binary = {\n        file: undefined,\n        url: undefined\n      };\n    }\n  }\n\n  onFirmwareSelect(firmware: IManagedObject) {\n    assign(this.model, {\n      selected: firmware,\n      description: firmware.description,\n      deviceType: get(firmware, 'c8y_Filter.type')\n    });\n  }\n}\n","import { Component, ViewChild, Output, EventEmitter } from '@angular/core';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { RepositoryService } from '../repository.service';\nimport { RepositoryType, ModalModel, RepositoryCategory } from '../repository.model';\nimport { AlertService, gettext } from '@c8y/ngx-components';\nimport { IManagedObject, IResultList } from '@c8y/client';\nimport { isUndefined } from 'lodash-es';\nimport { BehaviorSubject, of, from, pipe, merge, Observable } from 'rxjs';\nimport { BsDropdownDirective } from 'ngx-bootstrap/dropdown';\nimport { NgForm } from '@angular/forms';\nimport {\n  debounceTime,\n  tap,\n  switchMap,\n  distinctUntilChanged,\n  shareReplay,\n  map\n} from 'rxjs/operators';\nimport { PickedFiles } from '@c8y/ngx-components';\n\n@Component({\n  selector: 'c8y-add-firmware-patch-modal.component',\n  templateUrl: 'add-firmware-patch-modal.component.html'\n})\nexport class AddFirmwarePatchModalComponent {\n  @Output() saved: EventEmitter<RepositoryCategory> = new EventEmitter<RepositoryCategory>();\n\n  @ViewChild('dropdown', { static: false }) dropdown: BsDropdownDirective;\n  @ViewChild('firmwarePatchForm', { static: false }) form: NgForm;\n\n  model: ModalModel = {\n    selected: undefined,\n    dependency: null,\n    patchVersion: undefined,\n    binary: {\n      file: undefined,\n      url: undefined\n    }\n  };\n\n  firmwareInput$ = new BehaviorSubject<string>('');\n  firmwares$: Observable<IResultList<IManagedObject>> = this.firmwareInput$.pipe(\n    debounceTime(300),\n    distinctUntilChanged(),\n    switchMap(searchStr =>\n      from(\n        this.repository.listRepositoryEntries(RepositoryType.FIRMWARE, {\n          partialName: searchStr,\n          skipLegacy: true\n        })\n      )\n    ),\n    shareReplay(1)\n  );\n  firmwareSelected$ = new BehaviorSubject<Partial<RepositoryCategory>>(null);\n  patchDependencyInput$ = new BehaviorSubject<string>('');\n\n  saving = false;\n  firmwarePreselected: boolean = false;\n  baseVersions$: Observable<IResultList<IManagedObject>> = merge(\n    this.firmwareInput$.pipe(\n      tap(() => {\n        this.model.dependency = null;\n        if (this.form) {\n          this.form.form.get('patchDependency').reset();\n        }\n      }),\n      switchMap(() => of(null))\n    ),\n    this.firmwareSelected$\n  ).pipe(\n    switchMap(selectedFirmware =>\n      selectedFirmware ? this.repository.listBaseVersions(selectedFirmware) : of(null)\n    ),\n    shareReplay(1)\n  );\n  baseVersionsFilterPipe = pipe(\n    switchMap((data: []) =>\n      this.patchDependencyInput$.pipe(\n        map(partialVersion =>\n          data.filter((mo: any) => {\n            const version = mo.c8y_Firmware.version.toLowerCase();\n            return (\n              partialVersion.length === 0 || version.indexOf(partialVersion.toLowerCase()) > -1\n            );\n          })\n        )\n      )\n    )\n  );\n\n  constructor(\n    private modal: BsModalRef,\n    private repository: RepositoryService,\n    private alert: AlertService\n  ) {}\n\n  async ngOnInit() {\n    this.setInitialState();\n  }\n\n  setInitialState() {\n    if (this.model.selected) {\n      this.firmwarePreselected = true;\n      this.firmwareSelected$.next(this.model.selected);\n    }\n  }\n\n  async save() {\n    this.saving = true;\n    this.repository\n      .create(this.model, RepositoryType.FIRMWARE)\n      .then(savedFirmware => {\n        this.successMsg();\n        this.saving = false;\n        this.saved.next(savedFirmware);\n        this.cancel();\n      })\n      .catch(e => {\n        this.saving = false;\n        this.saved.error(e);\n        this.cancel();\n      });\n  }\n\n  successMsg() {\n    const msg = gettext('Firmware patch added.');\n    this.alert.success(msg);\n  }\n\n  cancel() {\n    this.modal.hide();\n    this.saved.complete();\n  }\n\n  onFile(dropped: PickedFiles) {\n    if (!isUndefined(dropped.url)) {\n      this.model.binary = {\n        url: dropped.url\n      };\n      return;\n    } else if (!isUndefined(dropped.droppedFiles)) {\n      this.model.binary = {\n        file: dropped.droppedFiles[0].file\n      };\n      return;\n    } else {\n      this.model.binary = {\n        file: undefined,\n        url: undefined\n      };\n    }\n  }\n}\n","import { Router, ActivatedRoute } from '@angular/router';\nimport { Component } from '@angular/core';\nimport { BsModalService, ModalOptions } from 'ngx-bootstrap/modal';\nimport { TranslateService } from '@ngx-translate/core';\nimport {\n  distinctUntilChanged,\n  tap,\n  debounceTime,\n  switchMap,\n  shareReplay,\n  map,\n  pluck\n} from 'rxjs/operators';\nimport { Observable, BehaviorSubject, combineLatest, from } from 'rxjs';\nimport { IResultList, IManagedObject } from '@c8y/client';\nimport { ModalService, gettext, Status, AlertService, memoize } from '@c8y/ngx-components';\nimport { RepositoryService } from '../repository.service';\nimport { RepositoryType } from '../repository.model';\nimport { AddFirmwareModalComponent } from './add-firmware-modal.component';\nimport { AddFirmwarePatchModalComponent } from './add-firmware-patch-modal.component';\nimport { property, get } from 'lodash-es';\n\n@Component({\n  selector: 'c8y-firmware-list',\n  templateUrl: 'firmware-list.component.html'\n})\nexport class FirmwareListComponent {\n  textFilter$: BehaviorSubject<string> = new BehaviorSubject('');\n  reload$: BehaviorSubject<void> = new BehaviorSubject(null);\n  reloading: boolean = false;\n  firmwares$: Observable<IResultList<IManagedObject>> = combineLatest(\n    this.textFilter$.pipe(\n      debounceTime(400),\n      distinctUntilChanged()\n    ),\n    this.reload$\n  ).pipe(\n    tap(() => {\n      this.reloading = true;\n    }),\n    switchMap(([text]) => this.getFirmwares(text)),\n    tap(() => {\n      this.reloading = false;\n    }),\n    shareReplay(1)\n  );\n  canAddFirmwarePatch$: Observable<boolean> = from(\n    this.repositoryService.listRepositoryEntries(RepositoryType.FIRMWARE, { skipLegacy: true })\n  ).pipe(map(({ data }) => data.length > 0));\n  isLegacy = this.repositoryService.isLegacyEntry.bind(this.repositoryService);\n  readonly DEVICE_TYPE_NOT_AVAILABLE: string = gettext('No device type available');\n\n  constructor(\n    private repositoryService: RepositoryService,\n    private modalService: ModalService,\n    private bsModalService: BsModalService,\n    private translateService: TranslateService,\n    private alertService: AlertService,\n    private router: Router,\n    private activatedRoute: ActivatedRoute\n  ) {}\n\n  getFirmwares(partialText?: string) {\n    const properties: string[] = ['name', 'description', 'c8y_Filter.type'];\n    const partialTextFilter = {partialText, properties};\n    return this.repositoryService.listRepositoryEntries(RepositoryType.FIRMWARE, {partialTextFilter} );\n  }\n\n  addFirmware() {\n    const config: ModalOptions = { class: 'modal-sm', ignoreBackdropClick: true };\n    const modalRef = this.bsModalService.show(AddFirmwareModalComponent, config);\n    modalRef.content.saved.subscribe(savedFirmware => this.editFirmware(savedFirmware));\n  }\n\n  addFirmwarePatch() {\n    const config: ModalOptions = { class: 'modal-sm', ignoreBackdropClick: true };\n    const modalRef = this.bsModalService.show(AddFirmwarePatchModalComponent, config);\n    modalRef.content.saved.subscribe(savedFirmware => this.editFirmware(savedFirmware));\n  }\n\n  editFirmware(firmware: IManagedObject) {\n    this.router.navigate([firmware.id], { relativeTo: this.activatedRoute });\n  }\n\n  async deleteFirmware(firmware: IManagedObject) {\n    try {\n      const title = gettext('Delete firmware');\n      const body = `\n        ${this.translateService.instant(\n          gettext(\n            'You are about to delete firmware \"{{ name }}\" with all its versions and patches.'\n          ),\n          { name: firmware.name }\n        )}\n        ${this.translateService.instant(gettext('This operation is irreversible.'))}\n        ${this.translateService.instant(gettext('Do you want to proceed?'))}\n      `;\n      const labels = {\n        ok: gettext('Delete')\n      };\n      await this.modalService.confirm(title, body, Status.DANGER, labels);\n      await this.repositoryService.delete(firmware);\n      this.alertService.success(gettext('Firmware deleted.'));\n      this.reload$.next();\n    } catch (ex) {\n      // only if not cancel from modal\n      if (ex) {\n        this.alertService.addServerFailure(ex);\n      }\n    }\n  }\n\n  @memoize(property('id'))\n  getBaseVersionsCount$(firmware: IManagedObject): Observable<number | string> {\n    return this.firmwares$.pipe(\n      switchMap(() => this.repositoryService.getBaseVersionsCount$(firmware)),\n      shareReplay(1)\n    );\n  }\n\n  getDeviceTypeTitle(firmware: IManagedObject): string {\n    return get(\n      firmware,\n      'c8y_Filter.type',\n      this.translateService.instant(this.DEVICE_TYPE_NOT_AVAILABLE)\n    );\n  }\n}\n","import { BsModalService, ModalOptions } from 'ngx-bootstrap/modal';\nimport { AlertService, gettext, memoize, ModalService, Status } from '@c8y/ngx-components';\nimport { Observable, Subject, merge, BehaviorSubject, combineLatest } from 'rxjs';\nimport { ActivatedRoute } from '@angular/router';\nimport { RepositoryService } from './../repository.service';\nimport { IManagedObject } from '@c8y/client';\nimport { Component, OnInit, OnDestroy } from '@angular/core';\nimport {\n  map,\n  switchMap,\n  takeUntil,\n  withLatestFrom,\n  tap,\n  take,\n  distinctUntilKeyChanged,\n  shareReplay\n} from 'rxjs/operators';\nimport { InventoryService, IResultList } from '@c8y/client';\nimport { TranslateService } from '@ngx-translate/core';\nimport { AddFirmwareModalComponent } from './add-firmware-modal.component';\nimport { AddFirmwarePatchModalComponent } from './add-firmware-patch-modal.component';\nimport { property } from 'lodash-es';\nimport { FirmwareBinary } from '../repository.model';\n\n@Component({\n  selector: 'c8y-firmware-details',\n  templateUrl: './firmware-details.component.html'\n})\nexport class FirmwareDetailsComponent implements OnInit, OnDestroy {\n  reload$: Subject<void> = new Subject();\n  reloading$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  updateFirmware$: Subject<Partial<IManagedObject>> = new Subject();\n  firmwareUpdated$: Subject<IManagedObject> = new Subject();\n  baseVersionsUpdated$: Subject<void> = new Subject();\n  patchVersionsUpdated$: Subject<void> = new Subject();\n\n  firmware$: Observable<IManagedObject> = merge(\n    this.activatedRoute.params.pipe(\n      map(params => params.id),\n      switchMap(id => this.inventoryService.detail$(id))\n    ),\n    this.reload$.pipe(\n      tap(() => this.reloading$.next(true)),\n      switchMap(() => this.activatedRoute.params),\n      map(params => params.id),\n      switchMap(id => this.inventoryService.detail$(id)),\n      tap(() => this.reloading$.next(false))\n    ),\n    this.firmwareUpdated$\n  ).pipe(shareReplay(1));\n\n  baseVersions$: Observable<IResultList<IManagedObject>> = merge(\n    this.firmware$.pipe(distinctUntilKeyChanged('id')),\n    this.baseVersionsUpdated$,\n    this.patchVersionsUpdated$,\n    this.reload$\n  ).pipe(\n    switchMap(() => this.firmware$),\n    switchMap(firmware => this.repositoryService.listBaseVersions(firmware)),\n    shareReplay(1)\n  );\n\n  isLegacy$: Observable<boolean> = this.firmware$.pipe(\n    map(firmware => this.repositoryService.isLegacyEntry(firmware)),\n    shareReplay(1)\n  );\n\n  canAddPatchVersions$: Observable<boolean> = combineLatest(\n    this.isLegacy$,\n    this.baseVersions$.pipe(map(({ data }) => data.length > 0))\n  ).pipe(map(([isLegacy, hasBaseVersions]) => !isLegacy && hasBaseVersions));\n\n  expanded: { [id: string]: boolean } = {};\n\n  destroy$: Subject<boolean> = new Subject<boolean>();\n\n  constructor(\n    private activatedRoute: ActivatedRoute,\n    private inventoryService: InventoryService,\n    private repositoryService: RepositoryService,\n    private alertService: AlertService,\n    private translateService: TranslateService,\n    private modalService: ModalService,\n    private bsModalService: BsModalService\n  ) {}\n\n  ngOnInit() {\n    this.updateFirmware$\n      .pipe(\n        withLatestFrom(this.firmware$),\n        switchMap(([firmwarePartial, firmware]) =>\n          this.inventoryService.update({\n            id: firmware.id,\n            ...firmwarePartial\n          })\n        ),\n        map(({ data }) => data),\n        tap(firmware => this.firmwareUpdated$.next(firmware)),\n        tap(() => this.alertService.success(gettext('Saved.'))),\n        takeUntil(this.destroy$)\n      )\n      .subscribe();\n  }\n\n  @memoize(property('id'))\n  getPatchVersionsCount$(baseVersion: FirmwareBinary) {\n    return merge(\n      this.firmware$.pipe(distinctUntilKeyChanged('id')),\n      this.baseVersionsUpdated$,\n      this.patchVersionsUpdated$,\n      this.reload$\n    ).pipe(\n      switchMap(() => this.firmware$),\n      switchMap(firmware => this.repositoryService.getPatchVersionsCount$(firmware, baseVersion)),\n      shareReplay(1)\n    );\n  }\n\n  @memoize()\n  getBinaryName$(binaryUrl) {\n    return this.repositoryService.getBinaryName$(binaryUrl);\n  }\n\n  @memoize(property('id'))\n  getPatchVersions$(baseVersion) {\n    return merge(\n      this.firmware$.pipe(distinctUntilKeyChanged('id')),\n      this.patchVersionsUpdated$,\n      this.reload$\n    ).pipe(\n      switchMap(() => this.firmware$),\n      switchMap(firmware => this.repositoryService.listPatchVersions(firmware, baseVersion)),\n      shareReplay(1)\n    );\n  }\n\n  addBaseVersion() {\n    this.firmware$\n      .pipe(\n        take(1),\n        switchMap(firmware => {\n          const initialState = {\n            model: {\n              selected: firmware,\n              description: firmware.description\n            }\n          };\n          const config: ModalOptions = {\n            class: 'modal-sm',\n            ignoreBackdropClick: true,\n            initialState\n          };\n          const modalRef = this.bsModalService.show(AddFirmwareModalComponent, config);\n          return modalRef.content.saved;\n        })\n      )\n      .subscribe(() => this.baseVersionsUpdated$.next());\n  }\n\n  addPatchVersion() {\n    this.firmware$\n      .pipe(\n        take(1),\n        switchMap(firmware => {\n          const initialState = {\n            model: {\n              selected: firmware\n            }\n          };\n          const config: ModalOptions = {\n            class: 'modal-sm',\n            ignoreBackdropClick: true,\n            initialState\n          };\n          const modalRef = this.bsModalService.show(AddFirmwarePatchModalComponent, config);\n          return modalRef.content.saved;\n        })\n      )\n      .subscribe(() => this.patchVersionsUpdated$.next());\n  }\n\n  async deleteBaseVersion(baseVersion: IManagedObject) {\n    try {\n      const title = gettext('Delete firmware');\n      const body = `\n        ${this.translateService.instant(\n          gettext('You are about to delete firmware {{ version }} with all its patches.'),\n          { version: baseVersion.c8y_Firmware.version }\n        )}\n        ${this.translateService.instant(gettext('This operation is irreversible.'))}\n        ${this.translateService.instant(gettext('Do you want to proceed?'))}\n      `;\n      const labels = {\n        ok: gettext('Delete')\n      };\n      await this.modalService.confirm(title, body, Status.DANGER, labels);\n      await this.repositoryService.delete(baseVersion);\n      this.alertService.success(gettext('Firmware deleted.'));\n      this.baseVersionsUpdated$.next();\n    } catch (ex) {\n      // only if not cancel from modal\n      if (ex) {\n        this.alertService.addServerFailure(ex);\n      }\n    }\n  }\n\n  async deletePatchVersion(patchVersion: IManagedObject) {\n    try {\n      const title = gettext('Delete firmware patch');\n      const body = `\n        ${this.translateService.instant(\n          gettext('You are about to delete firmware patch {{ version }}.'),\n          { version: patchVersion.c8y_Firmware.version }\n        )}\n        ${this.translateService.instant(gettext('This operation is irreversible.'))}\n        ${this.translateService.instant(gettext('Do you want to proceed?'))}\n      `;\n      const labels = {\n        ok: gettext('Delete')\n      };\n      await this.modalService.confirm(title, body, Status.DANGER, labels);\n      await this.repositoryService.delete(patchVersion);\n      this.alertService.success(gettext('Firmware patch deleted.'));\n      this.patchVersionsUpdated$.next();\n    } catch (ex) {\n      // only if not cancel from modal\n      if (ex) {\n        this.alertService.addServerFailure(ex);\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    this.destroy$.next(true);\n    this.destroy$.unsubscribe();\n  }\n}\n","import { Component, Output, EventEmitter, ViewChild } from '@angular/core';\nimport { NgForm } from '@angular/forms';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { RepositoryService } from '../repository.service';\nimport { RepositoryType, ModalModel, RepositoryCategory } from '../repository.model';\nimport { AlertService, gettext } from '@c8y/ngx-components';\nimport { isUndefined, get, assign } from 'lodash-es';\nimport { BehaviorSubject, Subscription, from } from 'rxjs';\nimport { debounceTime, distinctUntilChanged, tap, switchMap } from 'rxjs/operators';\nimport { PickedFiles } from '@c8y/ngx-components';\nimport { IManagedObject } from '@c8y/client';\n\n@Component({\n  selector: 'c8y-add-software-software-modal',\n  templateUrl: 'add-software-modal.component.html'\n})\nexport class AddSoftwareModalComponent {\n  @ViewChild('softwareForm', { static: false }) form: NgForm;\n  @Output() saved: EventEmitter<RepositoryCategory> = new EventEmitter<RepositoryCategory>();\n  onInput: BehaviorSubject<string> = new BehaviorSubject<string>('');\n  model: ModalModel = {\n    selected: undefined,\n    version: undefined,\n    description: undefined,\n    deviceType: undefined,\n    binary: {\n      file: undefined,\n      url: undefined\n    }\n  };\n  softwaresResult;\n  saving = false;\n  softwarePreselected: boolean = false;\n  private inputSubscription$: Subscription;\n\n  constructor(\n    private modal: BsModalRef,\n    private repositoryService: RepositoryService,\n    private alert: AlertService\n  ) {}\n\n  ngOnInit() {\n    this.setInitialState();\n    this.loadSoftwares();\n  }\n\n  setInitialState() {\n    if (this.model.selected) {\n      this.softwarePreselected = true;\n    }\n  }\n\n  loadSoftwares() {\n    this.inputSubscription$ = this.onInput\n      .pipe(\n        tap(() => {\n          if (!this.softwarePreselected) {\n            this.model.description = null;\n            if (this.form) {\n              this.form.form.get('description').reset();\n            }\n          }\n        }),\n        debounceTime(300),\n        distinctUntilChanged(),\n        switchMap(searchStr => this.getSoftwareResult(searchStr))\n      )\n      .subscribe(result => {\n        this.softwaresResult = result;\n      });\n  }\n\n  getSoftwareResult(searchStr: string) {\n    return from(\n      this.repositoryService.listRepositoryEntries(RepositoryType.SOFTWARE, {\n        partialName: searchStr,\n        skipLegacy: true\n      })\n    );\n  }\n\n  async save() {\n    this.saving = true;\n    this.repositoryService\n      .create(this.model, RepositoryType.SOFTWARE)\n      .then(savedSoftware => {\n        this.successMsg();\n        this.saving = false;\n        this.saved.next(savedSoftware);\n        this.cancel();\n      })\n      .catch(e => {\n        this.saving = false;\n        this.saved.error(e);\n        this.cancel();\n      });\n  }\n\n  successMsg() {\n    const msg = gettext('Software added.');\n    this.alert.success(msg);\n  }\n\n  cancel() {\n    this.modal.hide();\n    this.saved.complete();\n  }\n\n  ngOnDestroy() {\n    this.inputSubscription$.unsubscribe();\n  }\n\n  onFile(dropped: PickedFiles) {\n    if (!isUndefined(dropped.url)) {\n      this.model.binary = {\n        url: dropped.url\n      };\n      return;\n    } else if (!isUndefined(dropped.droppedFiles)) {\n      this.model.binary = {\n        file: dropped.droppedFiles[0].file\n      };\n      return;\n    } else {\n      this.model.binary = {\n        file: undefined,\n        url: undefined\n      };\n    }\n  }\n\n  onSoftwareSelect(software: IManagedObject) {\n    assign(this.model, {\n      selected: software,\n      description: software.description,\n      deviceType: get(software, 'c8y_Filter.type')\n    });\n  }\n}\n","import { Router, ActivatedRoute } from '@angular/router';\nimport { Component } from '@angular/core';\nimport { BsModalService, ModalOptions } from 'ngx-bootstrap/modal';\nimport { TranslateService } from '@ngx-translate/core';\nimport {\n  distinctUntilChanged,\n  tap,\n  debounceTime,\n  switchMap,\n  shareReplay,\n} from 'rxjs/operators';\nimport { Observable, BehaviorSubject, combineLatest } from 'rxjs';\nimport { IResultList, IManagedObject } from '@c8y/client';\nimport { ModalService, gettext, Status, AlertService, memoize } from '@c8y/ngx-components';\nimport { RepositoryService } from '../repository.service';\nimport { RepositoryType } from '../repository.model';\nimport { AddSoftwareModalComponent } from './add-software-modal.component';\nimport { property, get } from 'lodash-es';\n\n@Component({\n  selector: 'c8y-software-list',\n  templateUrl: 'software-list.component.html'\n})\nexport class SoftwareListComponent {\n  textFilter$: BehaviorSubject<string> = new BehaviorSubject('');\n  reload$: BehaviorSubject<void> = new BehaviorSubject(null);\n  reloading: boolean = false;\n  softwares$: Observable<IResultList<IManagedObject>> = combineLatest(\n    this.textFilter$.pipe(\n      debounceTime(400),\n      distinctUntilChanged()\n    ),\n    this.reload$\n  ).pipe(\n    tap(() => {\n      this.reloading = true;\n    }),\n    switchMap(([text]) => this.getSoftwares(text)),\n    tap(() => {\n      this.reloading = false;\n    }),\n    shareReplay(1)\n  );\n  isLegacy = this.repositoryService.isLegacyEntry.bind(this.repositoryService);\n  readonly DEVICE_TYPE_NOT_AVAILABLE: string = gettext('No device type available');\n\n  constructor(\n    private repositoryService: RepositoryService,\n    private modalService: ModalService,\n    private bsModalService: BsModalService,\n    private translateService: TranslateService,\n    private alertService: AlertService,\n    private router: Router,\n    private activatedRoute: ActivatedRoute\n  ) {}\n\n  getSoftwares(partialText?: string) {\n    const properties: string[] = ['name', 'description', 'c8y_Filter.type'];\n    const partialTextFilter = {partialText, properties};\n    return this.repositoryService.listRepositoryEntries(RepositoryType.SOFTWARE, { partialTextFilter });\n  }\n\n  addSoftware() {\n    const config: ModalOptions = { class: 'modal-sm', ignoreBackdropClick: true };\n    const modalRef = this.bsModalService.show(AddSoftwareModalComponent, config);\n    modalRef.content.saved.subscribe(savedSoftware => this.editSoftware(savedSoftware));\n  }\n\n  editSoftware(software: IManagedObject) {\n    this.router.navigate([software.id], { relativeTo: this.activatedRoute });\n  }\n\n  async deleteSoftware(software: IManagedObject) {\n    try {\n      const title = gettext('Delete software');\n      const body = `\n        ${this.translateService.instant(\n          gettext('You are about to delete software \"{{ name }}\" with all its versions.'),\n          { name: software.name }\n        )}\n        ${this.translateService.instant(gettext('This operation is irreversible.'))}\n        ${this.translateService.instant(gettext('Do you want to proceed?'))}\n      `;\n      const labels = {\n        ok: gettext('Delete')\n      };\n      await this.modalService.confirm(title, body, Status.DANGER, labels);\n      await this.repositoryService.delete(software);\n      this.alertService.success(gettext('Software deleted.'));\n      this.reload$.next();\n    } catch (ex) {\n      // only if not cancel from modal\n      if (ex) {\n        this.alertService.addServerFailure(ex);\n      }\n    }\n  }\n\n  @memoize(property('id'))\n  getBaseVersionsCount$(software: IManagedObject): Observable<number | string> {\n    return this.softwares$.pipe(\n      switchMap(() => this.repositoryService.getBaseVersionsCount$(software)),\n      shareReplay(1)\n    );\n  }\n\n  getDeviceTypeTitle(software: IManagedObject): string {\n    return get(\n      software,\n      'c8y_Filter.type',\n      this.translateService.instant(this.DEVICE_TYPE_NOT_AVAILABLE));\n  }\n}\n","import { BsModalService, ModalOptions } from 'ngx-bootstrap/modal';\nimport { AlertService, gettext, memoize, ModalService, Status } from '@c8y/ngx-components';\nimport { Observable, Subject, merge, BehaviorSubject } from 'rxjs';\nimport { ActivatedRoute } from '@angular/router';\nimport { RepositoryService } from '../repository.service';\nimport { IManagedObject } from '@c8y/client';\nimport { Component, OnInit, OnDestroy } from '@angular/core';\nimport {\n  map,\n  switchMap,\n  takeUntil,\n  withLatestFrom,\n  tap,\n  take,\n  distinctUntilKeyChanged,\n  shareReplay\n} from 'rxjs/operators';\nimport { InventoryService, IResultList } from '@c8y/client';\nimport { TranslateService } from '@ngx-translate/core';\nimport { AddSoftwareModalComponent } from './add-software-modal.component';\n\n@Component({\n  selector: 'c8y-software-details',\n  templateUrl: './software-details.component.html'\n})\nexport class SoftwareDetailsComponent implements OnInit, OnDestroy {\n  reload$: Subject<void> = new Subject();\n  reloading$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  updateSoftware$: Subject<Partial<IManagedObject>> = new Subject();\n  softwareUpdated$: Subject<IManagedObject> = new Subject();\n  baseVersionsUpdated$: Subject<void> = new Subject();\n\n  software$: Observable<IManagedObject> = merge(\n    this.activatedRoute.params.pipe(\n      map(params => params.id),\n      switchMap(id => this.inventoryService.detail$(id))\n    ),\n    this.reload$.pipe(\n      tap(() => this.reloading$.next(true)),\n      switchMap(() => this.activatedRoute.params),\n      map(params => params.id),\n      switchMap(id => this.inventoryService.detail$(id)),\n      tap(() => this.reloading$.next(false))\n    ),\n    this.softwareUpdated$\n  ).pipe(shareReplay(1));\n\n  baseVersions$: Observable<IResultList<IManagedObject>> = merge(\n    this.software$.pipe(distinctUntilKeyChanged('id')),\n    this.baseVersionsUpdated$,\n    this.reload$\n  ).pipe(\n    switchMap(() => this.software$),\n    switchMap(software => this.repositoryService.listBaseVersions(software)),\n    shareReplay(1)\n  );\n\n  isLegacy$: Observable<boolean> = this.software$.pipe(\n    map(software => this.repositoryService.isLegacyEntry(software)),\n    shareReplay(1)\n  );\n\n  destroy$: Subject<boolean> = new Subject<boolean>();\n\n  constructor(\n    private activatedRoute: ActivatedRoute,\n    private inventoryService: InventoryService,\n    private repositoryService: RepositoryService,\n    private alertService: AlertService,\n    private translateService: TranslateService,\n    private modalService: ModalService,\n    private bsModalService: BsModalService\n  ) {}\n\n  ngOnInit() {\n    this.updateSoftware$\n      .pipe(\n        withLatestFrom(this.software$),\n        switchMap(([softwarePartial, software]) =>\n          this.inventoryService.update({\n            id: software.id,\n            ...softwarePartial\n          })\n        ),\n        map(({ data }) => data),\n        tap(software => this.softwareUpdated$.next(software)),\n        tap(() => this.alertService.success(gettext('Saved.'))),\n        takeUntil(this.destroy$)\n      )\n      .subscribe();\n  }\n\n  @memoize()\n  getBinaryName$(binaryUrl) {\n    return this.repositoryService.getBinaryName$(binaryUrl);\n  }\n\n  addBaseVersion() {\n    this.software$\n      .pipe(\n        take(1),\n        switchMap(software => {\n          const initialState = {\n            model: {\n              selected: software,\n              description: software.description\n            }\n          };\n          const config: ModalOptions = {\n            class: 'modal-sm',\n            ignoreBackdropClick: true,\n            initialState\n          };\n          const modalRef = this.bsModalService.show(AddSoftwareModalComponent, config);\n          return modalRef.content.saved;\n        })\n      )\n      .subscribe(() => this.baseVersionsUpdated$.next());\n  }\n\n  async deleteBaseVersion(baseVersion: IManagedObject) {\n    try {\n      const title = gettext('Delete software');\n      const body = `\n        ${this.translateService.instant(\n          gettext('You are about to delete software {{ version }}.'),\n          { version: baseVersion.c8y_Software.version }\n        )}\n        ${this.translateService.instant(gettext('This operation is irreversible.'))}\n        ${this.translateService.instant(gettext('Do you want to proceed?'))}\n      `;\n      const labels = {\n        ok: gettext('Delete')\n      };\n      await this.modalService.confirm(title, body, Status.DANGER, labels);\n      await this.repositoryService.delete(baseVersion);\n      this.alertService.success(gettext('Software deleted.'));\n      this.baseVersionsUpdated$.next();\n    } catch (ex) {\n      // only if not cancel from modal\n      if (ex) {\n        this.alertService.addServerFailure(ex);\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    this.destroy$.next(true);\n    this.destroy$.unsubscribe();\n  }\n}\n","import { Component, ViewChild } from '@angular/core';\nimport { IManagedObject } from '@c8y/client';\nimport { AlertService, gettext } from '@c8y/ngx-components';\nimport { uniqBy, isUndefined } from 'lodash-es';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { pipe } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { ModalModel, RepositoryType } from '../repository.model';\nimport { RepositoryService } from '../repository.service';\nimport { PickedFiles } from '@c8y/ngx-components';\nimport { NgForm } from '@angular/forms';\n\n@Component({\n  selector: 'c8y-configuration-detail',\n  templateUrl: './configuration-detail.component.html'\n})\nexport class ConfigurationDetailComponent implements ModalModel {\n  @ViewChild('configurationForm', { static: true }) configurationForm: NgForm;\n  selected: { id: string; name: string };\n  version: string;\n  description: string;\n  binary: { file?: File; url?: string } = {\n    file: undefined,\n    url: undefined\n  };\n  deviceType: string;\n\n  pattern: string = '';\n  filterPipe;\n  configs;\n  mo: Partial<IManagedObject> = {};\n  saving = false;\n  uploadChoice: 'uploadBinary' | 'uploadUrl' = 'uploadBinary';\n  existingBinary: File;\n  submitButtonTitle: string;\n\n  result: Promise<void> = new Promise((resolve, reject) => {\n    this._save = resolve;\n    this._cancel = reject;\n  });\n\n  private _save;\n  private _cancel;\n\n  constructor(\n    private repositoryService: RepositoryService,\n    private bsModalRef: BsModalRef,\n    private alert: AlertService\n  ) {}\n\n  async ngOnInit() {\n    this.configs = await this.repositoryService.listRepositoryEntries(RepositoryType.CONFIGURATION);\n    if (this.selected) {\n      this.uploadChoice = this.binary.file ? 'uploadBinary' : 'uploadUrl';\n      this.existingBinary = this.binary.file;\n    }\n    this.setPipe('');\n    this.submitButtonTitle = this.mo.id\n      ? gettext('Update configuration')\n      : gettext('Add configuration');\n  }\n\n  cancel() {\n    this.bsModalRef.hide();\n    this._cancel();\n  }\n\n  setPipe(filterStr: string) {\n    this.pattern = filterStr;\n    this.filterPipe = pipe(\n      map((data: []) => uniqBy(data, 'configurationType')),\n      map((data: []) => {\n        return data.filter(\n          (mo: any) =>\n            mo.configurationType &&\n            mo.configurationType.toLowerCase().indexOf(filterStr.toLowerCase()) > -1\n        );\n      })\n    );\n  }\n\n  onFile(dropped: PickedFiles) {\n    this.configurationForm.form.markAsDirty();\n    if (!isUndefined(dropped.url)) {\n      this.binary = {\n        url: dropped.url\n      };\n      return;\n    } else if (!isUndefined(dropped.droppedFiles)) {\n      this.binary = {\n        file: dropped.droppedFiles[0].file\n      };\n      return;\n    } else {\n      this.binary = {\n        file: undefined,\n        url: undefined\n      };\n    }\n  }\n\n  async save() {\n    try {\n      this.saving = true;\n      const { selected, version, description, binary, deviceType } = this;\n      if (this.existingBinary === this.binary.file) {\n        binary.file = undefined;\n      }\n      await this.repositoryService.save(\n        { selected, version, description, binary, deviceType },\n        RepositoryType.CONFIGURATION,\n        this.mo\n      );\n      this.alert.success(\n        this.mo.id ? gettext('Configuration updated.') : gettext('Configuration created.')\n      );\n      this.bsModalRef.hide();\n      this._save();\n    } catch (ex) {\n      this.alert.addServerFailure(ex);\n      this._cancel();\n    } finally {\n      this.saving = false;\n    }\n  }\n}\n","import { Component, OnInit, Pipe, ViewChild } from '@angular/core';\nimport {IManagedObject, InventoryBinaryService, InventoryService, IResultList} from '@c8y/client';\nimport {\n  AlertService,\n  FilterInputComponent,\n  gettext, memoize,\n  ModalService,\n  Status\n} from '@c8y/ngx-components';\nimport { TranslateService } from '@ngx-translate/core';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { Observable, of, pipe } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { ModalModel, RepositoryType } from '../repository.model';\nimport { RepositoryService } from '../repository.service';\nimport { ConfigurationDetailComponent } from './configuration-detail.component';\nimport { property } from 'lodash-es';\nimport { saveAs } from 'file-saver';\n\n@Component({\n  selector: 'c8y-configuration-list',\n  templateUrl: './configuration-list.component.html'\n})\nexport class ConfigurationListComponent implements OnInit {\n  @ViewChild(FilterInputComponent, { static: false }) filter: FilterInputComponent;\n  configurations$: Observable<IResultList<IManagedObject>>;\n  filterPipe: Pipe;\n  filterTerm = '';\n  reloading: boolean = false;\n  data;\n  private readonly DELETED_SUCCESS_MSG = gettext('Configuration deleted.');\n\n  constructor(\n    private alert: AlertService,\n    private repositoryService: RepositoryService,\n    private bsModalService: BsModalService,\n    private modalService: ModalService,\n    private translateService: TranslateService,\n    private inventoryBinaryService: InventoryBinaryService,\n    private inventoryService: InventoryService\n  ) {}\n\n  ngOnInit() {\n    this.loadConfigurations();\n  }\n\n  async loadConfigurations() {\n    this.reloading = true;\n    this.configurations$ = of(\n      await this.repositoryService.listRepositoryEntries(RepositoryType.CONFIGURATION)\n    );\n    this.reloading = false;\n    this.reset();\n  }\n\n  async add() {\n    try {\n      await (this.bsModalService.show(ConfigurationDetailComponent, {\n        class: 'modal-sm',\n        ignoreBackdropClick: true\n      }).content as ConfigurationDetailComponent).result;\n      await this.loadConfigurations();\n    } catch (ex) {\n      // intended empty\n    }\n  }\n\n  async edit(configuration: IManagedObject) {\n    const fileBinary: File = await this.repositoryService.getBinaryFile(configuration.url, {\n      allowExternal: false\n    });\n    try {\n      const modal = this.bsModalService.show(ConfigurationDetailComponent, {\n        class: 'modal-sm',\n        ignoreBackdropClick: true,\n        initialState: {\n          selected: { id: configuration.id, configurationType: configuration.configurationType },\n          version: configuration.name,\n          deviceType: configuration.deviceType,\n          description: configuration.description,\n          binary: { file: fileBinary, url: configuration.url }\n        } as ModalModel\n      }).content as ConfigurationDetailComponent;\n      modal.mo = configuration;\n      await modal.result;\n      await this.loadConfigurations();\n    } catch (ex) {\n      // intended empty\n    }\n  }\n\n  isBinaryFile(configuration: IManagedObject) {\n    const id: string = this.inventoryBinaryService.getIdFromUrl(configuration.url);\n    return id ? true : false;\n  }\n\n  @memoize(property('id'))\n  getBinaryName(configuration: IManagedObject) {\n    return this.repositoryService.getBinaryName$(configuration.url);\n  }\n\n  async download(configuration: IManagedObject) {\n    const fileBinary: File = await this.repositoryService.getBinaryFile(configuration.url, {\n      allowExternal: false\n    });\n    saveAs(fileBinary);\n  }\n\n  async delete(configuration: IManagedObject) {\n    try {\n      const title = gettext('Delete configuration snapshot');\n      const confirmationText = gettext(\n        'You are about to delete the configuration snapshot {{ name }}.'\n      );\n      const hint = gettext('This operation is irreversible.');\n      const proceed = gettext('Do you want to proceed?');\n      const body = [\n        this.translateService.instant(confirmationText, {\n          name: configuration.name\n        }),\n        this.translateService.instant(hint),\n        this.translateService.instant(proceed)\n      ].join(' ');\n      const labels = {\n        ok: gettext('Delete')\n      };\n      await this.modalService.confirm(title, body, Status.DANGER, labels);\n      await this.repositoryService.delete(configuration);\n      this.alert.success(this.DELETED_SUCCESS_MSG);\n      await this.loadConfigurations();\n    } catch (ex) {\n      if (ex) {\n        this.alert.addServerFailure(ex);\n      }\n    }\n  }\n\n  setPipe(filterTerm: string) {\n    this.filterTerm = filterTerm;\n    this.filterPipe = pipe(\n      map((data: []) => {\n        this.data =\n          filterTerm.trim().length === 0\n            ? data\n            : data.filter(\n                (mo: IManagedObject) =>\n                  this.filterContainString(mo.name, filterTerm) ||\n                  this.filterContainString(mo.configurationType, filterTerm) ||\n                  this.filterContainString(mo.deviceType, filterTerm)\n              );\n\n        return this.data;\n      })\n    );\n  }\n\n  shouldShowEmptyState() {\n    return !(this.data && this.data.length > 0);\n  }\n\n  reset() {\n    this.filter.filterTerm = '';\n    this.setPipe('');\n  }\n\n  private filterContainString(name: string, filterTerm: string) {\n    const term = filterTerm.toLowerCase().trim();\n    return name && name.toLowerCase().indexOf(term) > -1;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { gettext, NavigatorNode, NavigatorNodeFactory } from '@c8y/ngx-components';\n\n@Injectable()\nexport class RepositoryNavigationFactory implements NavigatorNodeFactory {\n  navs: NavigatorNode[] = [];\n\n  async get() {\n    if (this.navs.length === 0) {\n      this.navs.push(\n        new NavigatorNode({\n          label: gettext('Firmware repository'),\n          path: 'firmware',\n          icon: 'c8y-firmware',\n          parent: gettext('Management'),\n          priority: 1000\n        })\n      );\n      this.navs.push(\n        new NavigatorNode({\n          label: gettext('Software repository'),\n          path: 'software',\n          icon: 'c8y-tools',\n          parent: gettext('Management'),\n          priority: 900\n        })\n      );\n      this.navs.push(\n        new NavigatorNode({\n          label: gettext('Configuration repository'),\n          path: 'configuration',\n          icon: 'gears',\n          parent: gettext('Management'),\n          priority: 800\n        })\n      );\n    }\n    return this.navs;\n  }\n}\n","import { Component, EventEmitter } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport {\n  gettext,\n  ISelectModalObject,\n  ISelectModalOption,\n  ModalLabels,\n  ModalSelectionMode\n} from '@c8y/ngx-components';\nimport { get } from 'lodash-es';\nimport { IManagedObject, QueriesUtil } from '@c8y/client';\nimport { Subject, Observable, from, BehaviorSubject } from 'rxjs';\nimport { switchMap, map, mergeMap, shareReplay, tap } from 'rxjs/operators';\nimport { RepositoryService } from '../repository.service';\nimport {\n  RepositoryType,\n  RepositoryCategory,\n  RepositoryBinary,\n  SelectedRepositoryBinary\n} from '../repository.model';\n\n// MODAL STRUCTURE\n// - selectModalObject (repository entry (repositoryCategory) -> type c8y_Firmware/c8y_Software)\n//   -- ISelectModalOption (repository binary entry (repositoryBinary) => type c8y_FirmwareBinary/c8y_SoftwareBinary)\n//   -- ISelectModalOption...\n// - selectModalObject...\n\n/**\n * RepositorySelectModalComponent displays repository entries options and allows to select them.\n *\n * @example\n * ```\n * import { take } from 'rxjs/operators';\n * import { RepositorySelectModalComponent, ModalSelectionMode, RepositoryType } from '@c8y/ngx-components/repository';\n *\n * const initialState = {\n *   repositoryType: RepositoryType.FIRMWARE,\n *   title: gettext('Install firmware'),\n *   subTitle: gettext('Available firmwares matching the device type'),\n *   icon: 'c8y-firmware',\n *   mode: ModalSelectionMode.SINGLE,\n *   labels: { ok: gettext('Install') },\n *   disableSelected: false\n * };\n *\n * const modal = this.bsModal.show(RepositorySelectModalComponent, {\n *   ignoreBackdropClick: true,\n *   initialState\n * });\n *\n * modal.content.load.next();\n * modal.content.resultEmitter.pipe(take(1)).subscribe((firmware) => {\n *   ...\n * })\n * ```\n */\n\n@Component({\n  selector: 'c8y-repository-select-modal',\n  templateUrl: './repository-select-modal.component.html'\n})\nexport class RepositorySelectModalComponent {\n  /**\n   * Optional\n   * Allows to provide custom data.\n   * @example\n   * ```\n   * import { from } from 'rxjs';\n   *\n   * const repositoryEntry = { name: 'ExampleEntry', type: 'c8y_Firmware' };\n   * const versions = [{ c8y_Firmware: { version: '1.0.0', url: 'http://example.com' } }];\n   *\n   * const initialState = {repositoryEntriesWithVersions$: from({ ...repositoryEntry, versions })};\n   * ```\n   */\n  repositoryEntriesWithVersions$: Observable<IManagedObject[]> = undefined;\n  /**\n   * Repository entry type.\n   */\n  repositoryType: RepositoryType.FIRMWARE | RepositoryType.SOFTWARE;\n  /**\n   * Optional\n   * Allows to use custom badges templates.\n   * @example\n   * ```\n   * import { gettext } from '@c8y/ngx-components';\n   *\n   * const badgeTemplates = { '=1': gettext('{{count}} version'), other: gettext('{{count}} versions') };\n   * const initialState = { badgeTemplates };\n   * ```\n   */\n  badgeTemplates = { '=1': gettext('{{count}} version'), other: gettext('{{count}} versions') };\n  /**\n   * Optional\n   * Allows to provide custom modal title.\n   */\n  title: string = gettext('Select repository entry');\n  /**\n   * Optional\n   * Allows to provide custom modal subtitle.\n   */\n  subTitle: string;\n  /**\n   * Loads the content of the modal.\n   * Must be invoked by the modal's caller.\n   */\n  load: Subject<void> = new Subject();\n  /**\n   * Optional\n   * Emits a search string currently entered in the filter input.\n   * Use it to filter the items if you use custom repositoryEntriesWithVersions$.\n   */\n  searchTerm: BehaviorSubject<string> = new BehaviorSubject('');\n  /**\n   * Optional\n   * Allows to provide device type query to restrict search criteria.\n   * Only takes effect when repositoryEntriesWithVersions$ is not provided,\n   * otherwise modal's caller have to provide already filtered data in the repositoryEntriesWithVersions$.\n   */\n  deviceTypeQuery: any = {};\n  /**\n   * Optional\n   * Allows to provide query to restrict search criteria.\n   * Only takes effect when repositoryEntriesWithVersions$ is not provided,\n   * otherwise modal's caller have to provide already filtered data in the repositoryEntriesWithVersions$.\n   */\n  searchQuery: any = {};\n  /**\n   * Optional\n   * Allows to provide custom labels for the buttons responsible for confirm/dismiss modal actions.\n   */\n  labels: ModalLabels = { ok: gettext('Save') };\n  /**\n   * Optional\n   * Allows to hide the filter input field.\n   * By default, the filter input field is displayed.\n   */\n  showFilter: boolean = true;\n  /**\n   * Optional\n   * Allows to show a warning that the search criteria should be narrowed down.\n   * By default, this warning is hidden.\n   */\n  areMoreEntries: boolean = false;\n  /**\n   * Optional\n   * Allows to pass the array of items. Each item from this array will be marked as selected in the modal.\n   */\n  selected: SelectedRepositoryBinary[];\n  /**\n   * Emits the list of selected options.\n   */\n  resultEmitter: EventEmitter<SelectedRepositoryBinary[]> = new EventEmitter<\n    SelectedRepositoryBinary[]\n  >();\n  /**\n   * Optional\n   * Allows to change selection mode.\n   * Supported options:\n   *   * single: only single option can be selected.\n   *   * multiple: multiple options can be selected.\n   */\n  mode: ModalSelectionMode = ModalSelectionMode.SINGLE;\n  /**\n   * Optional\n   * Allows to use custom icon in the modal header.\n   */\n  icon: string;\n  /**\n   * Allows to block selection of the other versions from the same repository entry.\n   */\n  disableSelected: boolean = true;\n  modalEntries: Observable<ISelectModalObject[]> = this.load.pipe(\n    switchMap(() => this.repositoryEntriesWithVersions$),\n    mergeMap(mos => this.aggregate(mos)),\n    tap(items => {\n      this.areMoreEntries = items.length >= this.PAGE_SIZE ? true : false;\n    })\n  );\n  private PAGE_SIZE = 100;\n  private queriesUtil: QueriesUtil;\n\n  constructor(\n    private repositoryService: RepositoryService,\n    private translateService: TranslateService\n  ) {\n    this.queriesUtil = new QueriesUtil();\n  }\n\n  ngOnInit() {\n    if (!this.repositoryType) {\n      throw new Error('Repository type must be defined');\n    }\n\n    if (!this.repositoryEntriesWithVersions$) {\n      this.repositoryEntriesWithVersions$ = from(\n        this.repositoryService.listRepositoryEntries(this.repositoryType, {\n          query: this.queriesUtil.addOrFilter(this.deviceTypeQuery, this.searchQuery),\n          params: { pageSize: this.PAGE_SIZE }\n        })\n      ).pipe(\n        map(({ data }) => data),\n        map(mos => this.getAndAssignRepositoryBinaries(mos)),\n        shareReplay(1)\n      );\n    }\n  }\n\n  getAndAssignRepositoryBinaries(mos: IManagedObject[]) {\n    mos.forEach(mo => {\n      mo.versions = this.repositoryService.listAllVersions(mo);\n    });\n    return mos;\n  }\n\n  search(searchTerm: string) {\n    this.searchTerm.next(searchTerm);\n    if (!searchTerm) {\n      this.searchQuery = {};\n    } else {\n      this.searchQuery = { name: `*${searchTerm}*` };\n    }\n    this.load.next();\n  }\n\n  result(selectedItems: SelectedRepositoryBinary[]) {\n    this.resultEmitter.emit(selectedItems);\n  }\n\n  async aggregate(mos: IManagedObject[]): Promise<ISelectModalObject[]> {\n    const repositoryType = this.repositoryType;\n    const selectedItems: SelectedRepositoryBinary[] = this.selected;\n\n    return Promise.all(\n      mos.map(async repositoryEntry => {\n        const options: ISelectModalOption[] = this.getSelectModalOptions(\n          await this.repositoryService.fetchAllItemsFromList(repositoryEntry.versions),\n          selectedItems,\n          repositoryEntry as RepositoryCategory,\n          repositoryType\n        );\n        const selectModalObject = this.getSelectModalObject(\n          repositoryEntry as RepositoryCategory,\n          options\n        );\n\n        return selectModalObject;\n      })\n    );\n  }\n\n  getSelectModalOptions(\n    versions: RepositoryBinary[],\n    selectedItems: SelectedRepositoryBinary[],\n    repositoryEntry: RepositoryCategory,\n    repositoryType: RepositoryType\n  ): ISelectModalOption[] {\n    const selectModalOptions: ISelectModalOption[] = [];\n    versions.forEach(repositoryBinary => {\n      const isSelected: boolean = this.isBinaryRepositorySelected(\n        selectedItems,\n        repositoryEntry,\n        repositoryBinary,\n        repositoryType\n      );\n\n      const { version } = repositoryBinary[`${repositoryType}`];\n      const bodyValue =\n        version || `(${this.translateService.instant(gettext('not specified`version`'))})`;\n      const bodyClass = version ? '' : 'text-muted';\n      selectModalOptions.push({\n        body: [\n          {\n            value: bodyValue,\n            class: bodyClass\n          }\n        ],\n        obj: {\n          id: repositoryBinary.id,\n          name: repositoryEntry.name,\n          version,\n          ...(get(repositoryBinary, 'c8y_Patch.dependency') && {\n            dependency: get(repositoryBinary, 'c8y_Patch.dependency')\n          }),\n          ...(get(repositoryBinary, 'c8y_Patch') && { c8y_Patch: true }),\n          url: repositoryBinary[`${repositoryType}`].url\n        },\n        selected: isSelected\n      });\n    });\n    return selectModalOptions;\n  }\n\n  isBinaryRepositorySelected(\n    selectedItems: SelectedRepositoryBinary[],\n    repositoryEntry: RepositoryCategory,\n    repositoryBinary: RepositoryBinary,\n    repositoryType: RepositoryType\n  ): boolean {\n    const isSelected = selectedItems\n      ? selectedItems.filter(\n          repositoryFragment =>\n            repositoryFragment.name === repositoryEntry.name &&\n            repositoryFragment.version === repositoryBinary[`${repositoryType}`].version\n        ).length > 0\n      : false;\n\n    return isSelected;\n  }\n\n  getSelectModalObject(\n    repositoryEntry: RepositoryCategory,\n    options: ISelectModalOption[]\n  ): ISelectModalObject {\n    const label =\n      options.length === 1\n        ? this.translateService.instant(this.badgeTemplates['=1'], { count: options.length })\n        : this.translateService.instant(this.badgeTemplates.other, { count: options.length });\n\n    const selectModalObject: ISelectModalObject = {\n      groupId: repositoryEntry.id,\n      body: [\n        { value: repositoryEntry.name, class: 'text-truncate' },\n        { value: repositoryEntry.description, class: 'text-truncate text-muted' }\n      ],\n      additionalInformation: { value: label, class: 'label label-info' },\n      options\n    };\n\n    return selectModalObject;\n  }\n\n}\n","import { Component } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { assign, isEmpty } from 'lodash-es';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { BehaviorSubject, Observable, combineLatest, from, of } from 'rxjs';\nimport { distinctUntilChanged, filter, map, shareReplay, switchMap, take } from 'rxjs/operators';\n\nimport { ModalSelectionMode, gettext } from '@c8y/ngx-components';\nimport { IManagedObject, IOperation, InventoryService, OperationStatus } from '@c8y/client';\n\nimport { RepositoryService } from '../repository.service';\nimport { DeviceFirmware, FirmwareBinary, RepositoryType } from '../repository.model';\nimport { RepositorySelectModalComponent } from '../select-modal/repository-select-modal.component';\n\n@Component({\n  selector: 'c8y-firmware-device-tab',\n  templateUrl: 'firmware-device-tab.component.html'\n})\nexport class FirmwareDeviceTabComponent {\n  isEmpty = isEmpty;\n  reloading: boolean = false;\n  device$: BehaviorSubject<IManagedObject> = new BehaviorSubject(\n    this.route.parent.snapshot.data.contextData\n  );\n  deviceFirmwareFragment$: Observable<DeviceFirmware> = this.device$.pipe(\n    map(device => device.c8y_Firmware)\n  );\n  firmwareBinary$: Observable<IManagedObject> = this.deviceFirmwareFragment$.pipe(\n    filter(deviceFirmwareFragment => !isEmpty(deviceFirmwareFragment)),\n    switchMap(deviceFirmwareFragment =>\n      from(\n        this.repository.getRepositoryBinaryMoByVersion(\n          deviceFirmwareFragment,\n          RepositoryType.FIRMWARE\n        )\n      )\n    ),\n    shareReplay(1)\n  );\n  repositoryEntry$: Observable<IManagedObject> = this.firmwareBinary$.pipe(\n    switchMap(mo => this.repository.getRepositoryEntryMO$(mo)),\n    shareReplay(1)\n  );\n  patches$: Observable<IManagedObject[]> = combineLatest(\n    this.firmwareBinary$,\n    this.repositoryEntry$\n  ).pipe(\n    switchMap(([firmwareBinary, repositoryEntry]) => {\n      if (repositoryEntry && firmwareBinary) {\n        const version: string = this.repository.getBaseVersionFromMO(\n          firmwareBinary as FirmwareBinary\n        );\n\n        return from(this.repository.listPatchVersions(repositoryEntry, version)).pipe(\n          map(({ data }) => data)\n        );\n      } else {\n        return of([]);\n      }\n    }),\n    shareReplay(1)\n  );\n  changesOperation$ = new BehaviorSubject<IOperation>(null);\n  changesInProgress$: Observable<boolean> = this.changesOperation$.pipe(\n    map(operation => this.isInProgress(operation))\n  );\n\n  constructor(\n    private route: ActivatedRoute,\n    private repository: RepositoryService,\n    private inventory: InventoryService,\n    private bsModal: BsModalService\n  ) {}\n\n  async ngOnInit() {\n    // TODO check route snapshot, why is not refreshing device.\n    // Scanario: missing deviceFirmwareFragment => install new version => switch tabs.\n    // Expected: device should be set.\n    await this.loadDevice();\n    await this.loadOperation();\n  }\n\n  installFirmware() {\n    const initialState = {\n      repositoryEntriesWithVersions$: of([]),\n      repositoryEntriesWithVersionsFn$: modal =>\n        this.getRepositoryEntriesWithVersions$(modal.content.searchTerm),\n      repositoryType: RepositoryType.FIRMWARE,\n      title: gettext('Install firmware'),\n      subTitle: gettext('Available firmwares matching the device type'),\n      icon: 'c8y-firmware',\n      mode: ModalSelectionMode.SINGLE,\n      labels: { ok: gettext('Install') },\n      disableSelected: false\n    };\n\n    this.deviceFirmwareFragment$\n      .pipe(\n        take(1),\n        switchMap(deviceFirmwareFragment => {\n          if (deviceFirmwareFragment) {\n            const { name, version } = deviceFirmwareFragment;\n            const selected = [{ name, version }];\n            assign(initialState, { selected });\n          }\n\n          const modal = this.bsModal.show(RepositorySelectModalComponent, {\n            ignoreBackdropClick: true,\n            initialState\n          });\n\n          if (initialState.repositoryEntriesWithVersionsFn$) {\n            modal.content.repositoryEntriesWithVersions$ = initialState.repositoryEntriesWithVersionsFn$(\n              modal\n            );\n          }\n\n          modal.content.load.next();\n\n          return modal.content.resultEmitter;\n        })\n      )\n      .subscribe(([selectedFirmware]) => {\n        this.handleOperation(selectedFirmware);\n      });\n  }\n\n  getRepositoryEntriesWithVersions$(searchTerm$: BehaviorSubject<string>) {\n    return searchTerm$.pipe(\n      distinctUntilChanged(),\n      switchMap(searchTerm =>\n        this.repository.listRepositoryEntries(RepositoryType.FIRMWARE, {\n          query: this.repository.getDeviceTypeQuery(RepositoryType.FIRMWARE, this.device$.value),\n          partialName: searchTerm,\n          params: { pageSize: 100 }\n        })\n      ),\n      map(({ data }) => data),\n      map(mos => this.getAndAssignRepositoryBinaries(mos)),\n      shareReplay(1)\n    );\n  }\n\n  getAndAssignRepositoryBinaries(mos: IManagedObject[]) {\n    mos.forEach(mo => {\n      mo.versions = this.repository.listBaseVersions(mo);\n    });\n    return mos;\n  }\n\n  addPatch() {\n    const initialState = {\n      repositoryType: RepositoryType.FIRMWARE,\n      repositoryEntriesWithVersions$: this.getRepositoryEntryWithPatches$(),\n      title: gettext('Install firmware'),\n      subTitle: gettext('Available firmwares matching the device type'),\n      icon: 'c8y-firmware',\n      mode: ModalSelectionMode.SINGLE,\n      labels: { ok: gettext('Install') },\n      disableSelected: false\n    };\n\n    this.deviceFirmwareFragment$\n      .pipe(\n        take(1),\n        switchMap(deviceFirmwareFragment => {\n          if (deviceFirmwareFragment) {\n            const { name, version } = deviceFirmwareFragment;\n            const selected = [{ name, version }];\n            assign(initialState, { selected });\n          }\n\n          const modal = this.bsModal.show(RepositorySelectModalComponent, {\n            ignoreBackdropClick: true,\n            initialState\n          });\n          modal.content.load.next();\n\n          return modal.content.resultEmitter;\n        })\n      )\n      .subscribe(selectedOption => {\n        this.handleOperation(selectedOption);\n      });\n  }\n\n  getRepositoryEntryWithPatches$() {\n    return combineLatest(this.repositoryEntry$, this.patches$).pipe(\n      map(([repositoryEntry, patches]) => {\n        return [{ ...repositoryEntry, versions: patches }];\n      })\n    );\n  }\n\n  async loadDevice() {\n    this.reloading = true;\n    const deviceId = this.device$.value.id;\n    const device = (await this.inventory.detail(deviceId, { withChildren: false })).data;\n    this.device$.next(device);\n    this.reloading = false;\n  }\n\n  private async handleOperation(selectedFirmware) {\n    const operation = await this.repository.createFirmwareUpdateOperation(\n      this.device$.value,\n      selectedFirmware\n    );\n    this.trackOperation(operation);\n  }\n\n  private async loadOperation() {\n    const deviceId = this.device$.value.id;\n    const operation = await this.repository.getLastFirmwareUpdateOperation(deviceId);\n    this.trackOperation(operation);\n  }\n\n  private trackOperation(operation: IOperation) {\n    this.changesOperation$.next(operation);\n\n    if (this.isInProgress(operation)) {\n      this.repository.observeOperation(operation).subscribe(\n        operationUpdate => {\n          this.changesOperation$.next(operationUpdate);\n          if (operationUpdate.status === OperationStatus.SUCCESSFUL) {\n            this.loadDevice();\n          }\n        },\n        operationUpdate => {\n          this.changesOperation$.next(operationUpdate);\n        }\n      );\n    }\n  }\n\n  private isInProgress(operation: IOperation) {\n    return (\n      operation && [OperationStatus.PENDING, OperationStatus.EXECUTING].includes(operation.status)\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CanActivate } from '@angular/router';\nimport { get, indexOf } from 'lodash-es';\n\nconst FIRMWARE_FRAGMENT = 'c8y_Firmware';\nconst SUPPORTED_OPERATIONS_FRAGMENT = 'c8y_SupportedOperations';\n\n@Injectable()\nexport class FirmwareDeviceTabGuard implements CanActivate {\n  canActivate(route) {\n    const contextData = get(route, 'data.contextData') || get(route, 'parent.data.contextData');\n    const supportedOperations = get(contextData, SUPPORTED_OPERATIONS_FRAGMENT);\n    return !!supportedOperations\n      ? indexOf(supportedOperations, FIRMWARE_FRAGMENT) >= 0\n      : false;\n  }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { Observable, BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { IManagedObject, InventoryService, OperationStatus, IOperation } from '@c8y/client';\nimport { DeviceSoftware, DeviceSoftwareChange, RepositoryType } from '../repository.model';\nimport { RepositoryService } from '../repository.service';\n\n@Component({\n  selector: 'c8y-software-device-tab',\n  templateUrl: 'software-device-tab.component.html'\n})\nexport class SoftwareDeviceTabComponent implements OnInit {\n  deviceId: string | number = this.route.snapshot.parent.data.contextData.id;\n  device$ = new BehaviorSubject<IManagedObject>(this.route.snapshot.parent.data.contextData);\n  deviceTypeQuery$: Observable<object> = this.device$.pipe(\n    map(device => this.repository.getDeviceTypeQuery(RepositoryType.SOFTWARE, device))\n  );\n  list$: Observable<DeviceSoftware[]> = this.device$.pipe(\n    map(device => this.repository.getDeviceSoftwareList(device))\n  );\n  changes$ = new BehaviorSubject<DeviceSoftwareChange[]>([]);\n  changesOperation$ = new BehaviorSubject<IOperation>(null);\n  changesInProgress$: Observable<boolean> = this.changesOperation$.pipe(\n    map(operation => this.isInProgress(operation))\n  );\n  reloading: boolean = false;\n\n  constructor(\n    private route: ActivatedRoute,\n    private repository: RepositoryService,\n    private inventory: InventoryService\n  ) {}\n\n  async ngOnInit() {\n    await this.loadDevice();\n    await this.loadOperation();\n  }\n\n  addChanges(requestedChanges: DeviceSoftwareChange[]) {\n    let stagedChanges = [...this.changes$.value];\n    requestedChanges.forEach(requestedChange => {\n      const alreadyStaged = stagedChanges.some(stagedChange =>\n        this.areSameChanges(stagedChange, requestedChange));\n      if (!alreadyStaged) {\n        stagedChanges = [...stagedChanges, requestedChange];\n      }\n    });\n    this.changes$.next(stagedChanges);\n  }\n\n  dropChange(changeToBeDropped: DeviceSoftwareChange) {\n    let stagedChanges = [...this.changes$.value];\n    stagedChanges = stagedChanges.filter(stagedChange => !this.areSameChanges(stagedChange, changeToBeDropped));\n    this.changes$.next(stagedChanges);\n  }\n\n  areSameChanges(change1: DeviceSoftwareChange, change2: DeviceSoftwareChange) {\n    return change1.name === change2.name &&\n      change1.version === change2.version &&\n      change1.action === change2.action;\n  }\n\n  clearChanges() {\n    this.changes$.next([]);\n  }\n\n  async loadDevice() {\n    this.reloading = true;\n    const device = (await this.inventory.detail(this.deviceId, { withChildren: false })).data;\n    this.device$.next(device);\n    this.reloading = false;\n  }\n\n  async applyChanges() {\n    const operation = await this.repository.createSoftwareUpdateOperation(\n      this.device$.value,\n      this.changes$.value\n    );\n    this.trackOperation(operation);\n  }\n\n  private async loadOperation() {\n    const operation = await this.repository.getLastSoftwareUpdateOperation(this.deviceId);\n    this.trackOperation(operation);\n  }\n\n  private trackOperation(operation: IOperation) {\n    this.changesOperation$.next(operation);\n\n    if (this.isInProgress(operation)) {\n      this.displayChangesFromOperation(operation);\n      this.repository.observeOperation(operation).subscribe(\n        operationUpdate => {\n          this.changesOperation$.next(operationUpdate);\n          if (operationUpdate.status === OperationStatus.SUCCESSFUL) {\n            this.clearChanges();\n            this.loadDevice();\n          }\n        },\n        operationUpdate => {\n          this.changesOperation$.next(operationUpdate);\n        }\n      );\n    }\n  }\n\n  private displayChangesFromOperation(operation: IOperation) {\n    const changes = this.repository.getDeviceSoftwareChangesFromOperation(\n      operation,\n      this.device$.value\n    );\n    this.changes$.next(changes);\n  }\n\n  private isInProgress(operation: IOperation) {\n    return (\n      operation && [OperationStatus.PENDING, OperationStatus.EXECUTING].includes(operation.status)\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CanActivate, ActivatedRouteSnapshot } from '@angular/router';\n\n@Injectable()\nexport class SoftwareDeviceTabGuard implements CanActivate {\n  private readonly operations = ['c8y_SoftwareUpdate', 'c8y_SoftwareList', 'c8y_Software'];\n\n  canActivate(route: ActivatedRouteSnapshot) {\n    return this.isAnyOperationSupported(route);\n  }\n\n  private isAnyOperationSupported(route: ActivatedRouteSnapshot) {\n    const device = route.data.contextData || route.parent.data.contextData;\n    const supportedOperations = (device && device.c8y_SupportedOperations) || [];\n    return this.operations.some(operation => supportedOperations.indexOf(operation) >= 0);\n  }\n}\n","import { Component, Output, Input, EventEmitter } from '@angular/core';\nimport { from, of, BehaviorSubject } from 'rxjs';\nimport { shareReplay, map, switchMap, distinctUntilChanged } from 'rxjs/operators';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { IManagedObject, InventoryService, IOperation } from '@c8y/client';\nimport { gettext, ModalSelectionMode } from '@c8y/ngx-components';\nimport { RepositoryService } from '../repository.service';\nimport { DeviceSoftware, DeviceSoftwareChange, RepositoryType } from './../repository.model';\nimport { RepositorySelectModalComponent } from '../select-modal/repository-select-modal.component';\n\n@Component({\n  selector: 'c8y-installed-software',\n  templateUrl: 'installed-software.component.html'\n})\nexport class InstalledSoftwareComponent {\n  @Input() softwareList: DeviceSoftware[];\n  @Input() deviceSoftwareChanges: DeviceSoftwareChange[];\n  @Input() deviceSoftwareChangesOperation: IOperation;\n  @Input() deviceSoftwareChangesInProgress: boolean;\n  @Input() deviceTypeQuery: object;\n  @Output() changes = new EventEmitter<DeviceSoftwareChange[]>();\n\n  constructor(\n    private repository: RepositoryService,\n    private inventory: InventoryService,\n    private bsModal: BsModalService\n  ) {\n  }\n\n  installSoftware() {\n    this.displaySoftwareSelectModal({\n      title: gettext('Install software'),\n      labels: { ok: gettext('Install') },\n      repositoryEntriesWithVersions$: of([]),\n      repositoryEntriesWithVersionsFn$: modal =>\n        this.getInstallableSoftwareListWithVersions$(modal.content.searchTerm)\n    }).subscribe(softwareToInstall => {\n      this.emitSoftwareInstall(softwareToInstall);\n    });\n  }\n\n  updateSoftware(softwareToRemove) {\n    this.displaySoftwareSelectModal({\n      title: gettext('Update software'),\n      labels: { ok: gettext('Update') },\n      showFilter: false,\n      repositoryEntriesWithVersions$: this.getSingleSoftwareWithVersions$(softwareToRemove)\n    }).subscribe(softwareToInstall => {\n      this.emitSoftwareInstall(softwareToInstall);\n    });\n  }\n\n  removeSoftware(softwareToRemove) {\n    this.emitSoftwareRemoval([softwareToRemove]);\n  }\n\n  getInstallableSoftwareListWithVersions$(searchTerm$: BehaviorSubject<string>) {\n    const installedSoftwareNames = this.softwareList.map(s => s.name);\n    return searchTerm$.pipe(\n      distinctUntilChanged(),\n      switchMap(searchTerm =>\n        this.repository.listRepositoryEntries(RepositoryType.SOFTWARE, {\n          query: this.deviceTypeQuery,\n          partialName: searchTerm,\n          params: { pageSize: 100 }\n        })\n      ),\n      map(({ data }) => data),\n      map(softwareList => {\n        return softwareList.filter(software => {\n          return !installedSoftwareNames.includes(software.name);\n        });\n      }),\n      map(softwareList => this.attachVersions(softwareList)),\n      shareReplay(1)\n    );\n  }\n\n  getSingleSoftwareWithVersions$(software: DeviceSoftware) {\n    return from(\n      this.repository.listRepositoryEntries(RepositoryType.SOFTWARE, {\n        query: { name: software.name }\n      })\n    ).pipe(\n      map(({ data }) => data),\n      map(softwareList => this.attachVersions(softwareList)),\n      shareReplay(1)\n    );\n  }\n\n  attachVersions(softwareList: IManagedObject[]) {\n    softwareList.forEach(software => {\n      software.versions = this.repository.listBaseVersions(software);\n    });\n    return softwareList;\n  }\n\n  displaySoftwareSelectModal(initialStateOverrides) {\n    const initialState = {\n      repositoryType: RepositoryType.SOFTWARE,\n      subTitle: gettext('Available softwares matching the device type'),\n      mode: ModalSelectionMode.MULTI,\n      icon: 'c8y-tools',\n      disableSelected: false,\n      selected: this.softwareList,\n      ...initialStateOverrides\n    };\n    const modal = this.bsModal.show(RepositorySelectModalComponent, {\n      ignoreBackdropClick: true,\n      class: 'modal-sm',\n      initialState\n    });\n\n    if (initialStateOverrides.repositoryEntriesWithVersionsFn$) {\n      modal.content.repositoryEntriesWithVersions$ = initialStateOverrides.repositoryEntriesWithVersionsFn$(\n        modal\n      );\n    }\n\n    modal.content.load.next();\n    return modal.content.resultEmitter;\n  }\n\n  emitSoftwareInstall(items: DeviceSoftwareChange[]) {\n    this.changes.emit(items.map(item => {\n      return { ...item, action: 'install' };\n    }));\n  }\n\n  emitSoftwareRemoval(items: DeviceSoftwareChange[]) {\n    this.changes.emit(items.map(item => {\n      return { ...item, action: 'delete' };\n    }));\n  }\n}\n","import { Component, Output, Input, EventEmitter } from '@angular/core';\nimport { filter } from 'lodash-es';\nimport { OperationStatus } from '@c8y/client';\nimport { DeviceSoftware, DeviceSoftwareChange } from '../repository.model';\n\n@Component({\n  selector: 'c8y-device-software-list',\n  templateUrl: 'device-software-list.component.html'\n})\nexport class DeviceSoftwareListComponent {\n  @Input() softwareList: DeviceSoftware[];\n  @Input() deviceSoftwareChanges: DeviceSoftwareChange[];\n  @Output() update = new EventEmitter<DeviceSoftware>();\n  @Output() remove = new EventEmitter<DeviceSoftware>();\n  showUpdate: boolean;\n  showRemove: boolean;\n\n  ngAfterContentInit() {\n    this.showUpdate = this.update.observers.length > 0;\n    this.showRemove = this.remove.observers.length > 0;\n  }\n\n  isSoftwareGoingToBeChanged(software: DeviceSoftware): boolean {\n    const relevantChanges = filter(this.deviceSoftwareChanges, software);\n    return relevantChanges.length > 0;\n  }\n}\n","import { Component, Output, Input, EventEmitter, OnChanges, SimpleChanges } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { DeviceSoftwareChange } from '../repository.model';\n\n@Component({\n  selector: 'c8y-device-software-changes',\n  templateUrl: 'device-software-changes.component.html'\n})\nexport class DeviceSoftwareChangesComponent implements OnChanges {\n  @Input() changes: DeviceSoftwareChange[];\n  @Input() changesInProgress: boolean;\n  @Output() clear: EventEmitter<void> = new EventEmitter();\n  @Output() drop: EventEmitter<DeviceSoftwareChange> = new EventEmitter();\n  @Output() apply: EventEmitter<void> = new EventEmitter();\n\n  changes$ = new BehaviorSubject<DeviceSoftwareChange[]>([]);\n  installations$ = this.changes$.pipe(\n    map(changes => {\n      return changes.filter(change => change.action === 'install');\n    })\n  );\n\n  removals$ = this.changes$.pipe(\n    map(changes => {\n      return changes.filter(change => change.action === 'delete');\n    })\n  );\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.changes) {\n      this.changes$.next(changes.changes.currentValue);\n    }\n  }\n}\n","import { EventEmitter, Injectable } from '@angular/core';\nimport { DeviceConfigurationOperation } from '../repository.model';\nimport { IManagedObject } from '@c8y/client';\n\n@Injectable()\nexport class DeviceConfigurationService {\n  configurationsUpdated = new EventEmitter<any>();\n\n  updateConfigurations(repositorySnapsOnly?: boolean) {\n    this.configurationsUpdated.emit(repositorySnapsOnly);\n  }\n\n  hasAnySupportedOperation(\n    mo: IManagedObject,\n    operation: DeviceConfigurationOperation | DeviceConfigurationOperation[]\n  ) {\n    const supported = mo.c8y_SupportedOperations as [];\n    if (!supported) {\n      return false;\n    }\n    if (!Array.isArray(operation)) {\n      operation = [operation];\n    }\n    return supported.some(supportedOperation => operation.includes(supportedOperation));\n  }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { IManagedObject, Realtime } from '@c8y/client';\nimport { DeviceConfigurationService } from './device-configuration.service';\nimport {\n  DeviceConfigurationListEmptyState,\n  ConfigurationSnapshot,\n  SupportedConfigurationItem,\n  RepositoryType,\n  DeviceConfigurationOperation\n} from '../repository.model';\nimport { gettext } from '@c8y/ngx-components';\nimport { RepositoryService } from '../repository.service';\n\n@Component({\n  selector: 'c8y-device-configuration',\n  templateUrl: './device-configuration.component.html'\n})\nexport class DeviceConfigurationComponent implements OnInit {\n  supportedConfigurations: SupportedConfigurationItem[] = [];\n  showBinaryBasedConfig = false;\n  configurationType: string;\n  configSnapshot: Partial<ConfigurationSnapshot> = {};\n  repositorySnapshots: IManagedObject[];\n  repositorySnapshot: ConfigurationSnapshot;\n  repositorySnapshotsEmptyState: DeviceConfigurationListEmptyState;\n  device: IManagedObject;\n  isLegacy: boolean;\n  showTextBasedConfig: boolean;\n  reloading: boolean = false;\n\n  constructor(\n    private route: ActivatedRoute,\n    private deviceConfigurationService: DeviceConfigurationService,\n    private realtime: Realtime,\n    private repositoryService: RepositoryService\n  ) {\n    this.deviceConfigurationService.configurationsUpdated.subscribe(repositorySnapsOnly => {\n      this.updateSnapshots(repositorySnapsOnly);\n    });\n  }\n\n  ngOnInit() {\n    this.device = this.route.snapshot.parent.data.contextData;\n    if (this.device.c8y_SupportedConfigurations) {\n      this.supportedConfigurations = this.device.c8y_SupportedConfigurations.map(item => ({\n        name: item\n      }));\n    }\n\n    if (\n      this.deviceConfigurationService.hasAnySupportedOperation(this.device, [\n        DeviceConfigurationOperation.DOWNLOAD_CONFIG,\n        DeviceConfigurationOperation.UPLOAD_CONFIG\n      ])\n    ) {\n      this.supportedConfigurations.push({\n        name: gettext('Legacy configuration snapshot'),\n        isLegacy: true\n      });\n    }\n    if (this.supportedConfigurations.length > 0) {\n      this.showBinaryBasedConfig = true;\n    }\n\n    this.repositorySnapshotsEmptyState = {\n      icon: 'gears',\n      title: gettext('No configurations available.'),\n      text: gettext('Add configuration to configuration repository')\n    };\n\n    this.showTextBasedConfig = this.deviceConfigurationService.hasAnySupportedOperation(\n      this.device,\n      [DeviceConfigurationOperation.CONFIG, DeviceConfigurationOperation.SEND_CONFIG]\n    );\n  }\n\n  async onConfigTypeSelected(config) {\n    this.configurationType = config.name;\n    this.isLegacy = config.isLegacy;\n    this.updateSnapshots();\n  }\n\n  async onRepositoryConfigSelected(config) {\n    this.repositorySnapshot = {\n      id: config.id,\n      time: config.creationTime,\n      name: config.name,\n      binaryUrl: config.url,\n      deviceType: config.deviceType,\n      configurationType: config.configurationType\n    };\n    if (config.url) {\n      try {\n        const binary = await this.repositoryService.getBinaryFile(config.url, {\n          allowExternal: false\n        });\n        if (binary) {\n          this.repositorySnapshot.binary = await (binary as any).text();\n        }\n      } catch (ex) {\n        // do nothing\n      }\n    }\n  }\n\n  async updateSnapshots(repositorySnapsOnly?: boolean) {\n    this.reloading = false;\n    this.repositorySnapshot = undefined;\n    this.repositorySnapshots = await this.repositoryService.getSnapshotsFromRepository(\n      this.device,\n      this.configurationType\n    );\n    if (!repositorySnapsOnly) {\n      this.configSnapshot = this.isLegacy\n        ? await this.repositoryService.getLegacyConfigSnapshot(this.device)\n        : await this.repositoryService.getConfigSnapshot(this.device, this.configurationType);\n    }\n    this.reloading = false;\n  }\n}\n","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'c8y-source-code-preview',\n  templateUrl: './source-code-preview.component.html'\n})\nexport class SourceCodePreviewComponent {\n  @Input() isDisabled: boolean;\n  @Input() text: string;\n}\n","import { Component } from '@angular/core';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { ConfigurationSnapshot, RepositoryType } from '../repository.model';\nimport { AlertService, gettext } from '@c8y/ngx-components';\nimport { RepositoryService } from '../repository.service';\n\n@Component({\n  selector: 'c8y-save-config-to-configuration-repository',\n  templateUrl: 'save-to-repository.component.html'\n})\nexport class SaveToRepositoryComponent {\n  configSnapshot: ConfigurationSnapshot;\n  result: Promise<any> = new Promise((resolve, reject) => {\n    this._save = resolve;\n    this._cancel = reject;\n  });\n  private _save;\n  private _cancel;\n\n  constructor(\n    private modal: BsModalRef,\n    private alertService: AlertService,\n    private repositoryService: RepositoryService\n  ) {}\n\n  async save() {\n    {\n      try {\n        const configSnapshotData = {\n          selected: {\n            configurationType: this.configSnapshot.configurationType\n          },\n          version: this.configSnapshot.name,\n          deviceType: this.configSnapshot.deviceType,\n          description: this.configSnapshot.description,\n          binary: {\n            file: new File([this.configSnapshot.binary], this.configSnapshot.name)\n          }\n        };\n        await this.repositoryService.save(configSnapshotData, RepositoryType.CONFIGURATION);\n        this.alertService.success(gettext('Configuration saved.'));\n        this._save();\n      } catch (ex) {\n        this.alertService.addServerFailure(ex);\n      }\n    }\n  }\n\n  close() {\n    this._cancel();\n    this.modal.hide();\n  }\n}\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { ConfigurationSnapshot, DeviceConfigurationOperation } from '../repository.model';\nimport {\n  IManagedObject,\n  IOperation,\n  OperationService,\n  OperationStatus,\n  Realtime,\n  UserService\n} from '@c8y/client';\nimport { DeviceConfigurationService } from './device-configuration.service';\nimport { Subscription } from 'rxjs';\nimport { saveAs } from 'file-saver/FileSaver';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { SaveToRepositoryComponent } from './save-to-repository.component';\nimport { cloneDeep } from 'lodash-es';\nimport { AlertService, AppStateService } from '@c8y/ngx-components';\nimport { RepositoryService } from '../repository.service';\n\n@Component({\n  selector: 'c8y-device-configuration-preview',\n  templateUrl: './configuration-preview.component.html'\n})\nexport class ConfigurationPreviewComponent implements OnInit, OnDestroy {\n  @Input() device: IManagedObject;\n  @Input() set configurationType(type: string) {\n    this._configurationType = type;\n    this.setOperation(type);\n  }\n  get configurationType(): string {\n    return this._configurationType;\n  }\n  @Input() configSnapshot: ConfigurationSnapshot;\n  @Input() canSaveSnapshot: boolean;\n  @Input() actionButtonText: string;\n  @Input() actionButtonIcon: string;\n  @Input() isLegacy: boolean = false;\n  @Input() operationToTrigger:\n    | DeviceConfigurationOperation.UPLOAD_CONFIG\n    | DeviceConfigurationOperation.DOWNLOAD_CONFIG;\n\n  operation: IOperation;\n  canCallAction = true;\n  deviceConfigurationOperation = DeviceConfigurationOperation;\n  private _configurationType: string;\n  private operationsSubscription: Subscription;\n\n  constructor(\n    private deviceConfigurationService: DeviceConfigurationService,\n    private realtime: Realtime,\n    private bsModal: BsModalService,\n    private user: UserService,\n    private appState: AppStateService,\n    private repositoryService: RepositoryService,\n    private operationService: OperationService,\n    private alertService: AlertService\n  ) {}\n\n  async ngOnInit() {\n    this.setOperation(this._configurationType);\n    const operationsChannel = `/operations/${this.device.id}`;\n    this.operationsSubscription = this.realtime\n      .observable(operationsChannel)\n      .subscribe(({ data }) => {\n        this.updatePreview(data);\n      });\n    if (this.isLegacy) {\n      this.canCallAction = this.deviceConfigurationService.hasAnySupportedOperation(\n        this.device,\n        this.operationToTrigger\n      );\n    }\n  }\n\n  async setOperation(configType): Promise<void> {\n    const operationList = await this.repositoryService.getConfigFileOperationList(\n      this.device.id,\n      this.operationToTrigger\n    );\n\n    const operation = this.isLegacy\n      ? operationList.find(op => op[this.operationToTrigger] && !op[this.operationToTrigger].type)\n      : operationList.find(op => op[this.operationToTrigger].type === configType);\n\n    this.operation =\n      operation && operation.status !== OperationStatus.SUCCESSFUL ? operation : undefined;\n  }\n\n  async createDeviceOperation() {\n    let operationCfg;\n    if (this.operationToTrigger === DeviceConfigurationOperation.DOWNLOAD_CONFIG) {\n      operationCfg = this.repositoryService.getDownloadConfigurationFileOperation(\n        this.device,\n        this._configurationType,\n        this.configSnapshot,\n        this.isLegacy\n      );\n    }\n    if (this.operationToTrigger === DeviceConfigurationOperation.UPLOAD_CONFIG) {\n      operationCfg = this.repositoryService.getUploadConfigurationFileOperation(\n        this.device,\n        this._configurationType,\n        this.isLegacy\n      );\n    }\n    try {\n      this.operation = (await this.operationService.create(operationCfg)).data;\n    } catch (ex) {\n      this.alertService.addServerFailure(ex);\n    }\n  }\n\n  showOperation(): boolean {\n    if (this.operationToTrigger === DeviceConfigurationOperation.DOWNLOAD_CONFIG) {\n      return !!this.operation;\n    }\n    return (\n      this.operation &&\n      [OperationStatus.PENDING, OperationStatus.EXECUTING, OperationStatus.FAILED].includes(\n        this.operation.status\n      )\n    );\n  }\n\n  showBinary(): boolean {\n    if (this.operationToTrigger === DeviceConfigurationOperation.DOWNLOAD_CONFIG) {\n      return true;\n    }\n    return !this.showOperation();\n  }\n\n  isCreateOperationDisabled(): boolean {\n    return (\n      this.operation &&\n      [OperationStatus.PENDING, OperationStatus.EXECUTING].includes(this.operation.status)\n    );\n  }\n\n  updatePreview(operation: IOperation) {\n    if (\n      operation &&\n      operation[this.operationToTrigger] &&\n      (this.isLegacy ||\n        (operation[this.operationToTrigger].type &&\n          operation[this.operationToTrigger].type === this.configurationType))\n    ) {\n      this.operation = operation;\n      this.updateSnapshotsOnConfigUpload(operation);\n    }\n  }\n\n  download() {\n    const blob = new Blob([this.configSnapshot.binary], { type: this.configSnapshot.binaryType });\n    let fileName = this.configSnapshot.name;\n    switch (this.configSnapshot.binaryType) {\n      case 'text/csv':\n      case 'application/csv':\n        fileName = fileName.concat('.csv');\n        break;\n      case 'text/yaml':\n      case 'application/x-yaml':\n        fileName = fileName.concat('.yaml');\n        break;\n      case 'application/json':\n        fileName = fileName.concat('.json');\n        break;\n    }\n    saveAs(blob, fileName);\n  }\n\n  async saveToRepository() {\n    const initialState = {\n      configSnapshot: cloneDeep(this.configSnapshot)\n    };\n    const modal = this.bsModal.show(SaveToRepositoryComponent, {\n      class: 'modal-sm',\n      initialState,\n      ignoreBackdropClick: true\n    }).content as SaveToRepositoryComponent;\n    try {\n      await modal.result;\n      this.deviceConfigurationService.updateConfigurations(true);\n      modal.close();\n    } catch (ex) {\n      // do nothing\n    }\n  }\n\n  hasPermission(): boolean {\n    return this.user.hasAnyRole(this.appState.currentUser.value, [\n      'ROLE_INVENTORY_ADMIN',\n      'ROLE_INVENTORY_CREATE'\n    ]);\n  }\n\n  ngOnDestroy() {\n    if (this.operationsSubscription) {\n      this.operationsSubscription.unsubscribe();\n    }\n  }\n\n  private async updateSnapshotsOnConfigUpload(operation) {\n    if (\n      operation[DeviceConfigurationOperation.UPLOAD_CONFIG] &&\n      operation.status === OperationStatus.SUCCESSFUL\n    ) {\n      this.deviceConfigurationService.updateConfigurations();\n    }\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { SupportedConfigurationItem } from '../repository.model';\n\n@Pipe({\n  name: 'configurationFilterPipe'\n})\nexport class ConfigurationFilterPipe implements PipeTransform {\n  transform(items: any[], filterTerm: string): any {\n    return filterTerm.trim().length === 0\n      ? items\n      : items.filter(\n          (item: SupportedConfigurationItem) =>\n            this.filterContainString(item.name, filterTerm) ||\n            this.filterContainString(item.deviceType, filterTerm)\n        );\n  }\n\n  private filterContainString(name: string, filterTerm: string) {\n    const term = filterTerm.toLowerCase().trim();\n    return name && name.toLowerCase().indexOf(term) > -1;\n  }\n}\n","import { ActivatedRouteSnapshot, CanActivate, RouterStateSnapshot } from '@angular/router';\nimport { Injectable } from '@angular/core';\nimport { DeviceConfigurationService } from './device-configuration.service';\nimport { DeviceConfigurationOperation } from '../repository.model';\n\n@Injectable()\nexport class DeviceConfigurationGuard implements CanActivate {\n  constructor(private deviceConfigurationService: DeviceConfigurationService) {}\n\n  canActivate(route: ActivatedRouteSnapshot, state: RouterStateSnapshot) {\n    const contextData = route.data.contextData || route.parent.data.contextData;\n    if (!contextData) {\n      return false;\n    }\n    return (\n      (contextData.c8y_SupportedConfigurations &&\n        contextData.c8y_SupportedConfigurations.length > 0) ||\n      this.deviceConfigurationService.hasAnySupportedOperation(contextData, [\n        DeviceConfigurationOperation.DOWNLOAD_CONFIG,\n        DeviceConfigurationOperation.UPLOAD_CONFIG,\n        DeviceConfigurationOperation.CONFIG,\n        DeviceConfigurationOperation.SEND_CONFIG\n      ])\n    );\n  }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { DeviceConfigurationListEmptyState, SupportedConfigurationItem } from '../repository.model';\n\n@Component({\n  selector: 'c8y-device-configuration-list',\n  templateUrl: './device-configuration-list.component.html'\n})\nexport class DeviceConfigurationListComponent {\n  @Input() items: SupportedConfigurationItem[];\n  @Input() itemIcon: string;\n  @Input() emptyState: DeviceConfigurationListEmptyState;\n  @Input() isFilterEnabled: boolean;\n  @Output() configSelected = new EventEmitter<string>();\n  selectedConfig;\n  filterTerm: string = '';\n\n  showConfigurationTypePreview(config): void {\n    this.selectedConfig = config;\n    this.configSelected.emit(config);\n  }\n\n  updatePipe(filterTerm: string) {\n    this.filterTerm = filterTerm;\n  }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { InventoryService, IManagedObject, OperationStatus, IOperation } from '@c8y/client';\nimport { gettext } from '@c8y/ngx-components';\nimport { RepositoryService } from '../repository.service';\nimport { AlertService } from '@c8y/ngx-components';\nimport { DeviceConfigurationOperation } from '../repository.model';\nimport { DeviceConfigurationService } from './device-configuration.service';\n\n@Component({\n  selector: 'c8y-text-based-configuration',\n  templateUrl: './text-based-configuration.component.html'\n})\nexport class TextBasedConfigurationComponent implements OnInit {\n  device: IManagedObject;\n  latestOperation: IOperation;\n  showTextBasedConfigReload: boolean;\n  showTextBasedConfigSave: boolean;\n  reloadingConfig = false;\n  savingConfig = false;\n  config: string;\n\n  constructor(\n    private route: ActivatedRoute,\n    private alertService: AlertService,\n    private repositoryService: RepositoryService,\n    private deviceConfigurationService: DeviceConfigurationService,\n    private inventoryService: InventoryService\n  ) {}\n\n  async ngOnInit() {\n    this.device = this.route.snapshot.parent.data.contextData;\n    await this.loadOperation();\n    this.showTextBasedConfigReload = this.deviceConfigurationService.hasAnySupportedOperation(\n      this.device,\n      [DeviceConfigurationOperation.SEND_CONFIG]\n    );\n    this.showTextBasedConfigSave = this.deviceConfigurationService.hasAnySupportedOperation(\n      this.device,\n      [DeviceConfigurationOperation.CONFIG]\n    );\n    if (this.device.c8y_Configuration && this.device.c8y_Configuration.config) {\n      this.config = this.device.c8y_Configuration.config;\n    }\n  }\n\n  async loadOperation() {\n    const operation = await this.repositoryService.getLastConfigUpdateOperation(this.device.id);\n    if (operation !== null) {\n      this.repositoryService.observeOperation(operation).subscribe(operationUpdate => {\n        this.latestOperation = operationUpdate;\n      });\n    }\n  }\n\n  async reloadConfiguration() {\n    this.reloadingConfig = true;\n    const operationCfg = await this.repositoryService.createTextBasedConfigurationReloadOperation(\n      this.device\n    );\n    try {\n      this.repositoryService\n        .createObservedOperation(operationCfg)\n        .subscribe(\n          operationUpdate => this.onOperationReloadSuccess(operationUpdate),\n          operationUpdate => this.onOperationReloadError(operationUpdate),\n          () => this.onOperationReloadComplete()\n        );\n    } catch (ex) {\n      this.alertService.addServerFailure(ex);\n    }\n  }\n\n  async updateConfiguration(config) {\n    this.savingConfig = true;\n    const operationCfg = await this.repositoryService.createTextBasedConfigurationUpdateOperation(\n      this.device,\n      config\n    );\n    try {\n      this.repositoryService\n        .createObservedOperation(operationCfg)\n        .subscribe(\n          operationUpdate => this.onOperationUpdateSuccess(operationUpdate),\n          operationUpdate => this.onOperationUpdateError(operationUpdate),\n          () => this.onOperationUpdateComplete()\n        );\n    } catch (ex) {\n      this.alertService.addServerFailure(ex);\n    }\n  }\n\n  private onOperationReloadSuccess(operationUpdate) {\n    this.latestOperation = operationUpdate;\n    if (operationUpdate.status === OperationStatus.PENDING) {\n      this.alertService.success(gettext('Configuration will be reloaded.'));\n    }\n  }\n\n  private onOperationReloadError(operationUpdate) {\n    this.latestOperation = operationUpdate;\n    this.reloadingConfig = false;\n  }\n\n  private async onOperationReloadComplete() {\n    await this.loadDevice();\n    this.config = this.device.c8y_Configuration.config;\n    this.reloadingConfig = false;\n  }\n\n  private onOperationUpdateSuccess(operationUpdate) {\n    this.latestOperation = operationUpdate;\n    if (operationUpdate.status === OperationStatus.PENDING) {\n      this.alertService.success(gettext('Configuration will be updated.'));\n    }\n  }\n\n  private onOperationUpdateError(operationUpdate) {\n    this.latestOperation = operationUpdate;\n    this.savingConfig = false;\n  }\n\n  private onOperationUpdateComplete() {\n    this.device.c8y_Configuration.config = this.config;\n    this.savingConfig = false;\n  }\n\n  private async loadDevice() {\n    this.device = (await this.inventoryService.detail(this.device.id, { withChildren: false })).data;\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { RepositoryService } from './../repository.service';\nimport { memoize } from '@c8y/ngx-components';\nimport { saveAs } from 'file-saver';\nimport { InventoryBinaryService } from '@c8y/client';\nimport { LinkRenderType } from './link-render-type.enum';\n\n@Component({\n  selector: 'c8y-file-download',\n  templateUrl: './file-download.component.html'\n})\nexport class FileDownloadComponent {\n  @Input() url: string;\n  linkRenderType = LinkRenderType;\n  constructor(\n    private repositoryService: RepositoryService,\n    private inventoryBinaryService: InventoryBinaryService\n  ) {}\n\n  @memoize()\n  getBinaryName$(binaryUrl) {\n    return this.repositoryService.getBinaryName$(binaryUrl);\n  }\n\n  @memoize()\n  determineBehavior(): LinkRenderType {\n    let result: LinkRenderType;\n    if (this.inventoryBinaryService.getIdFromUrl(this.url)) {\n      result = LinkRenderType.DOWNLOAD;\n    } else if (this.url.match(/\\/\\//g)) {\n      result = LinkRenderType.LINK;\n    } else {\n      result = LinkRenderType.TEXTONLY;\n    }\n    return result;\n  }\n\n  async downloadFile() {\n    const binary: File = await this.repositoryService.getBinaryFile(this.url, {\n      allowExternal: false\n    });\n    saveAs(binary);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport {\n  CoreModule,\n  FormsModule,\n  HOOK_NAVIGATOR_NODES,\n  HOOK_ONCE_ROUTE,\n  Route,\n  ViewContext,\n  gettext\n} from '@c8y/ngx-components';\nimport { BsDropdownModule } from 'ngx-bootstrap/dropdown';\nimport { TabsModule } from 'ngx-bootstrap/tabs';\nimport { TooltipModule } from 'ngx-bootstrap/tooltip';\nimport { PopoverModule } from 'ngx-bootstrap/popover';\nimport { SingleOperationDetailsModule } from '@c8y/ngx-components/operations/single-operation-details';\nimport { RepositoryService } from './repository.service';\nimport { FirmwareListComponent } from './firmware/firmware-list.component';\nimport { FirmwareDetailsComponent } from './firmware/firmware-details.component';\nimport { AddFirmwareModalComponent } from './firmware/add-firmware-modal.component';\nimport { AddFirmwarePatchModalComponent } from './firmware/add-firmware-patch-modal.component';\nimport { SoftwareListComponent } from './software/software-list.component';\nimport { SoftwareDetailsComponent } from './software/software-details.component';\nimport { AddSoftwareModalComponent } from './software/add-software-modal.component';\nimport { ConfigurationListComponent } from './configuration/configuration-list.component';\nimport { ConfigurationDetailComponent } from './configuration/configuration-detail.component';\nimport { RepositoryNavigationFactory } from './repository-navigation-factory';\nimport { FirmwareDeviceTabComponent } from './firmware-device-tab/firmware-device-tab.component';\nimport { FirmwareDeviceTabGuard } from './firmware-device-tab/firmware-device-tab.guard';\nimport { SoftwareDeviceTabComponent } from './software-device-tab/software-device-tab.component';\nimport { SoftwareDeviceTabGuard } from './software-device-tab/software-device-tab.guard';\nimport { InstalledSoftwareComponent } from './software-device-tab/installed-software.component';\nimport { RepositorySelectModalComponent } from './select-modal/repository-select-modal.component';\nimport { DeviceSoftwareListComponent } from './software-device-tab/device-software-list.component';\nimport { DeviceSoftwareChangesComponent } from './software-device-tab/device-software-changes.component';\nimport { DeviceConfigurationComponent } from './configuration-device-tab/device-configuration.component';\nimport { SourceCodePreviewComponent } from './configuration-device-tab/source-code-preview.component';\nimport { ConfigurationPreviewComponent } from './configuration-device-tab/configuration-preview.component';\nimport { ConfigurationFilterPipe } from './configuration-device-tab/configuration-filter.pipe';\nimport { SaveToRepositoryComponent } from './configuration-device-tab/save-to-repository.component';\nimport { DeviceConfigurationService } from './configuration-device-tab/device-configuration.service';\nimport { DeviceConfigurationGuard } from './configuration-device-tab/device-configuration.guard';\nimport { DeviceConfigurationListComponent } from './configuration-device-tab/device-configuration-list.component';\nimport { TextBasedConfigurationComponent } from './configuration-device-tab/text-based-configuration.component';\nimport { FileDownloadComponent } from './file-download/file-download.component';\n\n@NgModule({\n  imports: [\n    CoreModule,\n    FormsModule,\n    SingleOperationDetailsModule,\n    BsDropdownModule.forRoot(),\n    TooltipModule,\n    PopoverModule,\n    TabsModule.forRoot()\n  ],\n  exports: [],\n  declarations: [\n    FirmwareListComponent,\n    FirmwareDetailsComponent,\n    AddFirmwareModalComponent,\n    AddFirmwarePatchModalComponent,\n    SoftwareListComponent,\n    SoftwareDetailsComponent,\n    AddSoftwareModalComponent,\n    FirmwareDeviceTabComponent,\n    SoftwareDeviceTabComponent,\n    InstalledSoftwareComponent,\n    RepositorySelectModalComponent,\n    DeviceSoftwareListComponent,\n    DeviceSoftwareChangesComponent,\n    ConfigurationListComponent,\n    ConfigurationDetailComponent,\n    DeviceConfigurationComponent,\n    DeviceConfigurationListComponent,\n    SourceCodePreviewComponent,\n    ConfigurationPreviewComponent,\n    ConfigurationFilterPipe,\n    SaveToRepositoryComponent,\n    TextBasedConfigurationComponent,\n    FileDownloadComponent\n  ],\n  entryComponents: [\n    FirmwareListComponent,\n    FirmwareDetailsComponent,\n    AddFirmwareModalComponent,\n    AddFirmwarePatchModalComponent,\n    SoftwareListComponent,\n    SoftwareDetailsComponent,\n    AddSoftwareModalComponent,\n    FirmwareDeviceTabComponent,\n    SoftwareDeviceTabComponent,\n    DeviceSoftwareListComponent,\n    RepositorySelectModalComponent,\n    DeviceSoftwareChangesComponent,\n    ConfigurationListComponent,\n    ConfigurationDetailComponent,\n    DeviceConfigurationComponent,\n    SaveToRepositoryComponent,\n    TextBasedConfigurationComponent\n  ],\n  providers: [\n    RepositoryService,\n    DeviceConfigurationService,\n    FirmwareDeviceTabGuard,\n    SoftwareDeviceTabGuard,\n    DeviceConfigurationGuard,\n    {\n      provide: HOOK_NAVIGATOR_NODES,\n      useClass: RepositoryNavigationFactory,\n      multi: true\n    },\n    {\n      provide: HOOK_ONCE_ROUTE,\n      useValue: [\n        {\n          path: 'firmware',\n          component: FirmwareListComponent\n        },\n        {\n          path: 'firmware/:id',\n          component: FirmwareDetailsComponent\n        },\n        {\n          context: ViewContext.Device,\n          path: 'firmware',\n          component: FirmwareDeviceTabComponent,\n          label: gettext('Firmware'),\n          icon: 'c8y-firmware',\n          priority: 500,\n          canActivate: [FirmwareDeviceTabGuard]\n        },\n        {\n          path: 'software',\n          component: SoftwareListComponent\n        },\n        {\n          path: 'software/:id',\n          component: SoftwareDetailsComponent\n        },\n        {\n          context: ViewContext.Device,\n          path: 'software',\n          component: SoftwareDeviceTabComponent,\n          label: gettext('Software'),\n          icon: 'c8y-tools',\n          priority: 499,\n          canActivate: [SoftwareDeviceTabGuard]\n        },\n        {\n          path: 'configuration',\n          component: ConfigurationListComponent\n        },\n        {\n          context: ViewContext.Device,\n          path: 'device-configuration',\n          component: DeviceConfigurationComponent,\n          label: gettext('Configuration'),\n          icon: 'gears',\n          priority: 600,\n          canActivate: [DeviceConfigurationGuard]\n        }\n      ] as Route[],\n      multi: true\n    }\n  ]\n})\nexport class RepositoryModule {}\n"]}