!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/forms"),require("ngx-bootstrap/datepicker"),require("ngx-bootstrap/timepicker"),require("@c8y/ngx-components"),require("lodash-es"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@c8y/ngx-components/operations/bulk-operation-scheduler",["exports","@angular/core","@angular/forms","ngx-bootstrap/datepicker","ngx-bootstrap/timepicker","@c8y/ngx-components","lodash-es","rxjs/operators"],t):t(((e=e||self).c8y=e.c8y||{},e.c8y["ngx-components"]=e.c8y["ngx-components"]||{},e.c8y["ngx-components"].operations=e.c8y["ngx-components"].operations||{},e.c8y["ngx-components"].operations["bulk-operation-scheduler"]={}),e.ng.core,e.ng.forms,e.datepicker,e.timepicker,e.c8y["ngx-components"],e.lodashEs,e.rxjs.operators)}(this,(function(e,t,r,n,i,o,s,a){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var l=function(){return(l=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function c(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}var d=function(){function e(e){this.formBuilder=e,this.placeholder=o.gettext("Start date"),this.delayErrors=null,this.pickerErrors=null,this.DELAY_SECONDS_DEFAULT=1,this.DELAY_MILLISECONDS_DEFAULT=1,this.MINUTES_AHEAD_DEFAULT=5,this.delaySeconds=this.DELAY_SECONDS_DEFAULT,this.delayMilliseconds=this.DELAY_MILLISECONDS_DEFAULT,this.minutesAhead=this.MINUTES_AHEAD_DEFAULT,this.currentUnit="seconds"}var n;return n=e,Object.defineProperty(e.prototype,"_minutesAhead",{set:function(e){e&&e>this.MINUTES_AHEAD_DEFAULT&&(this.minutesAhead=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_delayConfig",{set:function(e){e&&(e.seconds>this.DELAY_SECONDS_DEFAULT&&(this.delaySeconds=e.seconds),e.milliseconds>this.DELAY_MILLISECONDS_DEFAULT&&(this.delayMilliseconds=e.milliseconds))},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.minDate=new Date,this.initialDate=new Date(this.minDate.setMinutes(this.minDate.getMinutes()+this.minutesAhead)),this.minDelay=this.delaySeconds,this.fgOperationScheduler=this.formBuilder.group({picker:["",[r.Validators.required,this.dateValidation]],time:["",[r.Validators.required,this.timeValidation]],delay:["",[r.Validators.required,r.Validators.min(this.minDelay)]],unit:["seconds"]}),this.fgOperationScheduler.patchValue({picker:this.initialDate,time:this.initialDate,delay:this.minDelay});var t=this.fgOperationScheduler.valueChanges.pipe(a.throttleTime(100));this.subscription=t.subscribe((function(t){e.delayErrors=e.fgOperationScheduler.controls.delay.errors,e.pickerErrors=e.fgOperationScheduler.controls.picker.errors,e.convertDelayHandler(t.unit),e.emitData(t)}))},e.prototype.ngOnDestroy=function(){this.subscription&&!this.subscription.closed&&this.subscription.unsubscribe()},e.prototype.writeValue=function(e){e&&this.fgOperationScheduler.patchValue({picker:e.scheduledDate,time:e.scheduledDate,delay:e.delayInSeconds>1?e.delayInSeconds:1e3*e.delayInSeconds,unit:e.delayInSeconds>1?"seconds":"milliseconds"})},e.prototype.registerOnChange=function(e){this.onChange=e},e.prototype.registerOnTouched=function(e){this.onTouched=e},e.prototype.setDisabledState=function(e){e?this.fgOperationScheduler.disable():this.fgOperationScheduler.enable()},e.prototype.validate=function(){if(this.fgOperationScheduler.invalid)return l({},this.fgOperationScheduler.controls.picker.errors,this.fgOperationScheduler.controls.time.errors,this.fgOperationScheduler.controls.delay.errors)},e.prototype.registerOnValidatorChange=function(e){this.onValidatorChanged=e},e.prototype.markAsTouched=function(){this.onTouched&&this.onTouched()},e.prototype.convertDelayHandler=function(e){this.currentUnit!==e&&(this.currentUnit=e,this.convertDelay(this.currentUnit),this.fgOperationScheduler.controls.delay.setValidators([r.Validators.required]),this.fgOperationScheduler.controls.delay.updateValueAndValidity())},e.prototype.emitData=function(e){this.onValidatorChanged&&this.onValidatorChanged(),e.picker&&e.time&&(e.picker=this.combineDateAndTime(e.picker,e.time)),this.convertDelay(this.currentUnit),e.delayInSeconds=this.delayInSeconds,this.onChange&&this.onChange({delayInSeconds:e.delayInSeconds,scheduledDate:e.picker})},e.prototype.convertDelay=function(e){e&&this.fgOperationScheduler.controls.delay.value&&(this.delayMilliseconds=this.fgOperationScheduler.controls.delay.value,"milliseconds"===e?(this.minDelay=this.delayMilliseconds>this.DELAY_MILLISECONDS_DEFAULT?this.delayMilliseconds:this.DELAY_MILLISECONDS_DEFAULT,this.delayInSeconds=this.fgOperationScheduler.controls.delay.value/1e3):(this.delaySeconds=this.fgOperationScheduler.controls.delay.value,this.minDelay=this.delaySeconds>this.DELAY_SECONDS_DEFAULT?this.delaySeconds:this.DELAY_SECONDS_DEFAULT,this.delayInSeconds=this.fgOperationScheduler.controls.delay.value))},e.prototype.combineDateAndTime=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes())},e.prototype.dateValidation=function(e){if(e.value){var t=e.value;return e.parent.get("time").setValue(t),t>=new Date?null:{dateValidation:!0}}return{dateValidation:!0}},e.prototype.timeValidation=function(e){if(e.value){var t=e.value>=new Date?null:{dateValidation:!0},r=e.parent.get("picker");if(t)return r.setErrors(t),r.markAsTouched(),t;if(r&&r.errors&&r.errors.dateValidation){if(delete r.errors.dateValidation,s.isEmpty(r.errors))return r.setErrors(null),t;r.setErrors(r.errors)}return t}return{dateValidation:!0}},e.ctorParameters=function(){return[{type:r.FormBuilder}]},c([t.Input("minutesAhead")],e.prototype,"_minutesAhead",null),c([t.Input("delayConfig")],e.prototype,"_delayConfig",null),e=n=c([t.Component({selector:"c8y-operation-scheduler",template:'<div [formGroup]="fgOperationScheduler">\n  <div class="form-group m-0">\n    <label translate>Start date</label>\n    <div class="datetime-picker">\n      <c8y-form-group class="datepicker">\n        <input\n          formControlName="picker"\n          class="form-control"\n          placeholder="{{ placeholder | translate }}"\n          [bsConfig]="{ customTodayClass: \'today\' }"\n          [minDate]="minDate"\n          bsDatepicker\n          required\n          (blur)="markAsTouched()"\n        />\n        <c8y-messages *ngIf="pickerErrors">\n          <c8y-message *ngIf="pickerErrors.required" translate>\n            This field is required.\n          </c8y-message>\n          <c8y-message *ngIf="pickerErrors.dateValidation && !pickerErrors.required" translate>\n            Select time in the future.\n          </c8y-message>\n        </c8y-messages>\n      </c8y-form-group>\n      <timepicker\n        class="form-group"\n        [showSpinners]="false"\n        [showMeridian]="false"\n        formControlName="time"\n        (blur)="markAsTouched()"\n      ></timepicker>\n    </div>\n  </div>\n  <div class="form-group m-0">\n    <c8y-form-group [hasError]="delayErrors">\n      <label translate>Delay</label>\n      <div class="input-group">\n        <input\n          formControlName="delay"\n          type="number"\n          class="form-control"\n          placeholder="{{ \'e.g.\' | translate }} 15"\n          required\n          (blur)="markAsTouched()"\n        />\n        <div class="input-group-btn">\n          <div class="c8y-select-wrapper">\n            <select formControlName="unit" class="form-control" (blur)="markAsTouched()">\n              <option value="seconds" translate>Seconds</option>\n              <option value="milliseconds" translate>Milliseconds</option>\n            </select>\n            <span></span>\n          </div>\n        </div>\n      </div>\n      <c8y-messages *ngIf="delayErrors">\n        <c8y-message *ngIf="delayErrors.required" translate>\n          This field is required.\n        </c8y-message>\n        <c8y-message\n          *ngIf="delayErrors.min && !delayErrors.required"\n          translate\n          ngNonBindable\n          [translateParams]="{ delay: minDelay }"\n        >\n          Minimum value is {{ delay }}.\n        </c8y-message>\n      </c8y-messages>\n    </c8y-form-group>\n  </div>\n</div>\n',providers:[{provide:r.NG_VALUE_ACCESSOR,multi:!0,useExisting:t.forwardRef((function(){return n}))},{provide:r.NG_VALIDATORS,multi:!0,useExisting:t.forwardRef((function(){return n}))}]})],e)}(),u=function(){function e(){}return e=c([t.NgModule({imports:[o.CoreModule,r.ReactiveFormsModule,n.BsDatepickerModule,i.TimepickerModule],providers:[],declarations:[d],entryComponents:[d],exports:[d]})],e)}();e.BulkOperationSchedulerModule=u,e.OperationSchedulerComponent=d,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=c8y-ngx-components-operations-bulk-operation-scheduler.umd.min.js.map