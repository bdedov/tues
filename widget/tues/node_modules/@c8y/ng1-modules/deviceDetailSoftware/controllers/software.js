"use strict";!function(){function e(o,t,e,a,n,r,i){var c,s,l,f="c8y_Software",u="c8y_SoftwareList";function v(e){o.softwares=e}function d(e){s=_.cloneDeep(e),o.installedSoftware=e,o.hasChanges=!1,function(){l&&l();var e=0;l=o.$watch("installedSoftware",function(){1<=e&&(o.hasChanges=!0),e++},!0)}()}function p(e){return _.map(e[f]||{},function(e,t){return{name:t,version:e}})}function w(e){return e[u]}function h(){n.success(i("Device software will be updated.")),o.hasChanges=!1}function S(){var e={deviceId:c.id,description:i("Update device software.")};!function(e){var t,n;a.supportsOperation(c,f)&&(t=f,n=function(){var t={};return _.forEach(o.installedSoftware,function(e){t[e.name]=e.version}),t}());a.supportsOperation(c,u)&&(t=u,n=_.map(o.installedSoftware,_.partialRight(_.pick,["name","url","version"])));t&&(e[t]=n)}(e),o.activeInstallSoftware=!1,t.create(e).then(h)}function y(){o.activeInstallSoftware=!o.activeInstallSoftware}function g(){return a.supportsOperation(o.device,f)||a.supportsOperation(o.device,u)}o.newSoftware={selected:null},o.installSoftware=function(t){_.find(o.installedSoftware,function(e){return e.name===t.name&&e.version===t.version})||o.installedSoftware.push(_.cloneDeep(t)),y()},o.removeSoftware=function(e){var t=o.installedSoftware.indexOf(e);-1<t&&o.installedSoftware.splice(t,1)},o.toggleSoftware=y,o.visible=function(){return o.$eval("device.".concat(f))||o.$eval("device.".concat(u))||g()},o.actionable=g,o.sendOperation=function(){r({title:i("Process`verb` software changes"),body:i("You are about to start processing software changes. Note that this operation is asynchronous. Do you want to proceed?"),labels:{ok:i("Apply")}}).then(S)},o.resetChanges=function(){d(s)},o.$watch("device",function(e){e&&e.id&&d(function(e){var t;return e[f]?t=p:e[u]&&(t=w),t?t(e):[]}(c=e))}),e.list({type:f}).then(v)}e.$inject=["$scope","c8yDeviceControl","c8yInventory","c8yDevices","c8yAlert","c8yModal","gettext"],angular.module("c8y.deviceDetailSoftware").controller("deviceDetailSoftwareVPCtrl",e)}();