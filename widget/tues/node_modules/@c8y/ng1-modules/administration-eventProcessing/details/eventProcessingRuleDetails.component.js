"use strict";!function(){function e(n,t,e,o,l,a,s,r,i,c,u){var d,g,m,h=this,f=e.moduleId,p={left:{"col-lg-12":!1,"col-lg-6":!0,hidden:!1},right:{"col-lg-12":!1,"col-lg-6":!0,hidden:!1}},v={mode:"sql",useWrapMode:!0,showGutter:!0,onLoad:function(e){(g=e).$blockScrolling=1/0}};function E(){f?l.detail(f).then(D):D({name:u.getString("newmodule`KEEP_ORIGINAL`"),status:"DEPLOYED"})}function D(e){h.module=e,h.moduleDeployed="DEPLOYED"===h.module.status,d=_.cloneDeep(e),m||(m=n.$on("$locationChangeStart",$))}function P(e){var n=h.module.body;n=n?"".concat(n,"\n\n"):"",h.module.body=n+e.value}function y(){h.moduleForm.aceEditor.$setDirty()}function w(e){var n=_.get(e,"data",e),t=_.get(n,"message",""),o=_.get(t.match(/\[((\s|\S)+)\]/),1);if(o){var l=g.find(o,{wrap:!0,preventScroll:!0}),a=t.match(/at line (\d+) column (\d+)/),s=_.toNumber(_.get(a,1,1))-1,i=_.toNumber(_.get(a,2,0)),c={row:_.get(l,"start.row",0)+s,column:_.get(l,"start.column",0)+i};g&&(g.gotoLine(c.row+1,c.column,!0),function(e,n,t,o){var l=g.session.getAnnotations();l.push({row:e,column:n,text:t,type:o||"error"}),g.session.setAnnotations(l)}(c.row,c.column,u.getString(t),"error"))}else r.danger(u.getString(t),n)}function S(e){f?E():t.path("eventprocessing/".concat(e.id))}function $(e,n){var t;return d.id&&!_.isEqual(d,h.module)&&(e.preventDefault(),t=a({title:c("Discard changes"),body:c("You are about to leave this page and discard the changes made. Do you want to proceed?"),status:"warning",labels:{ok:c("Discard")}}).then(function(){d=_.cloneDeep(h.module),o.location.href=n})),t}_.assign(h,{panelClasses:p,aceEditorStyles:{height:"700px",width:"100%"},aceEditorOptions:v,isSmartRuleModule:l.isSmartRuleModule,$onInit:function(){i.redirectToRootIfPluginDisabled().then(E),i.getPermissions().then(function(e){return _.assign(h,{permissions:e})})},onModuleDeployedChanged:function(e){h.module.status=e?"DEPLOYED":"NOT_DEPLOYED"},expand:function(e){_.forEach(p,function(e){e["col-lg-12"]=!1,e["col-lg-6"]=!1,e.hidden=!0}),p[e]["col-lg-12"]=!0,p[e].hidden=!1},collapse:function(){_.forEach(p,function(e){e["col-lg-12"]=!1,e["col-lg-6"]=!0,e.hidden=!1})},isExpanded:function(e){return!0===p[e]["col-lg-12"]},browseExamples:function(){return s.open({component:"c8yEventProcessingRulesExamples"}).result.then(P).then(y)},save:function(e,n){g.session.clearAnnotations(),l.save(e,{silentError:!0}).then(S).then(function(){r.success(u.getString('Module "{{name}}" saved.',e)),n.$setPristine()}).catch(w)},saveName:function(e){f?l.changeName(f,e).then(function(){r.success(u.getString('Module "{{name}}" renamed.',{name:e})),h.module.name=e,d.name=e}):(h.module.name=e,d.name=e)}})}e.$inject=["$scope","$location","$routeParams","$window","c8yCepModule","c8yModal","$uibModal","c8yAlert","eventProcessingSvc","gettext","gettextCatalog"],angular.module("c8y.eventProcessing").component("c8yEventProcessingRuleDetails",{templateUrl:":::PLUGIN_PATH:::/details/eventProcessingRuleDetails.html",controller:e,controllerAs:"vm"})}();