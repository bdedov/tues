"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,n){if(t){if("string"==typeof t)return _arrayLikeToArray(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(t,n):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}!function(){function t(n,e,r,o,a,i,u,s,t,c,l){var d=this,f=20,p=a.createEnum([{name:"ACTIVE",label:c("ACTIVE`tenant`")},{name:"SUSPENDED",label:c("SUSPENDED`tenant`")}]),y=[];function g(){y=[],m(),s.list({withApps:!1}).then(h)}function m(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];n.tenants=t,d.tenants=t,T(d.tenants.length)}function h(t){y=_.sortBy([].concat(_toConsumableArray(y),_toConsumableArray(t)),function(t){return t.company.toLowerCase()}),n.paging=t.paging,m(y.filter(v(d.searchString))),T(n.tenants.length),n.listClass=9<t.length?"interact-list":"interact-grid"}function T(t){var n=l.getPlural(t,"1 tenant","{{$count}} tenants",{});i.changeTitle({title:c("Tenants"),subtitle:_.isUndefined(t)?"":n})}function b(t,n){t.status=n.value,s.save(t).then(function(){return u.success(c("Tenant updated."))}).then(g)}function v(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",r=new RegExp(t.trim(),"i");return t.trim()?function(t){if(r.test(t.company)||r.test(t.contactName)||r.test(t.id)||r.test(t.domain)||r.test(t.parent))return!0;for(var n=Object.keys(t.customProperties),e=0;e<n.length;e++)if(r.test(t.customProperties[n[e]]))return!0;return!1}:function(){return!0}}function A(){!A.promise&&window.scrollY>=.8*(window.document.body.offsetHeight-window.window.innerHeight)&&(A.promise=r(function(){d.limitTo+=f,delete A.promise}))}_.assign(d,{currentTenant:void 0,limitTo:f}),window.addEventListener("scroll",A,{passive:!0}),n.$on("$destroy",function(){window.removeEventListener("scroll",A)}),n.$watch(function(){return d.searchString},function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";r.cancel(t.promise),t.promise=r(function(){d.limitTo=f,m(y.filter(v(n.trim())))},300)}),n.TENANT_STATUS=p,n.detail=function(t){e.path("/tenants/".concat(t.id))},n.add=function(){e.path("/tenants/new")},n.onClickDelete=function(t){o({title:c("Delete tenant"),body:l.getString('You are about to delete tenant "{{company}}" (ID "{{id}}"). Do you want to proceed?',t),status:"danger",labels:{ok:c("Delete")}}).then(angular.bind(s,s.remove,t)).then(angular.bind(a,a.removeFromList,n.tenants,t)).then(function(){return u.success(c("Tenant deleted."))})},n.loadNext=function(){n.paging.loading=!0,n.paging.next().then(h).finally(function(){n.paging.loading=!1})},n.refresh=function(){y=[],n.refreshLoading=!0,n.paging.refresh().then(h).finally(function(){n.refreshLoading=!1}),n.paging=null},n.suspendTenant=_.wrap(function(t){return b(t,p.SUSPENDED)},function(n,e){return o({title:c("Suspend tenant"),body:l.getString('You are about to suspend tenant "{{company}}" (ID "{{id}}"). Do you want to proceed?',e),status:"danger",labels:{ok:c("Suspend`tenant`")}}).then(t.askForPassword).then(function(t){t&&n(e)})}),n.activateTenant=function(t){return b(t,p.ACTIVE)},s.isCurrentUserTopTenant().then(function(t){return n.isTopTenant=t,n.isTopTenant}).then(function(t){return function(t){t||s.current().then(function(t){var n=t.name;d.currentTenant=n})}(t)}),g()}t.$inject=["$scope","$location","$timeout","c8yModal","c8yBase","c8yTitle","c8yAlert","c8yTenant","c8yUserUtil","gettext","gettextCatalog"],angular.module("c8y.tenants").controller("tenantListCtrl",t)}();