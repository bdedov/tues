{"version":3,"file":"c8y-ngx-components-operations-single-operation-details.js","sources":["ng://@c8y/ngx-components/operations/single-operation-details/single-operation-modal.component.ts","ng://@c8y/ngx-components/operations/single-operation-details/single-operation-details.service.ts","ng://@c8y/ngx-components/operations/single-operation-details/single-operation.component.ts","ng://@c8y/ngx-components/operations/single-operation-details/single-operation-list-item.component.ts","ng://@c8y/ngx-components/operations/single-operation-details/single-operation-details.component.ts","ng://@c8y/ngx-components/operations/single-operation-details/single-operation-details.module.ts","ng://@c8y/ngx-components/operations/single-operation-details/c8y-ngx-components-operations-single-operation-details.ts"],"sourcesContent":["import { Component, Input } from '@angular/core';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { IOperation } from '@c8y/client';\n\n@Component({\n  selector: 'c8y-single-operation-modal',\n  templateUrl: './single-operation-modal.component.html'\n})\nexport class SingleOperationModalComponent {\n  @Input() operation: Partial<IOperation>;\n  @Input() collapsed: boolean = false;\n  @Input() readOnly: boolean = false;\n\n  constructor(public modalRef: BsModalRef) {}\n}\n","import { Injectable } from '@angular/core';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { IOperation, OperationService } from '@c8y/client';\nimport { SingleOperationModalComponent } from './single-operation-modal.component';\n\n@Injectable()\nexport class SingleOperationDetailsService {\n  constructor(private operationService: OperationService, private modalService: BsModalService) {}\n\n  /**\n   * Opens a modal window with the details of given single operation.\n   * @param operationOrOperationId Operation's object or id.\n   * @param options Additional options:\n   * - `collapsed`: boolean - whether the details pane should be initially collapsed\n   * - `readOnly`: boolean - whether the details should be displayed in read-only mode\n   */\n  async openDetails(\n    operationOrOperationId: IOperation | string | number,\n    options?: { collapsed?: boolean; readOnly?: boolean }\n  ) {\n    const operation: IOperation = (operationOrOperationId as IOperation).id\n      ? (operationOrOperationId as IOperation)\n      : (await this.operationService.detail(operationOrOperationId)).data;\n    const initialState = { operation, ...options };\n\n    this.modalService.show(SingleOperationModalComponent, {\n      initialState,\n      class: 'modal-lg'\n    });\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { IOperation } from '@c8y/client';\nimport { operationStatusClasses, operationStatusIcons } from '@c8y/ngx-components';\nimport { SingleOperationDetailsService } from './single-operation-details.service';\n\n/**\n * Single operation component displays a single operation's status, description and creationTime.\n *\n * Example:\n *\n * ```html\n * <c8y-single-operation [operation]=\"operation\"></c8y-single-operation>\n * ```\n */\n@Component({\n  selector: 'c8y-single-operation',\n  templateUrl: './single-operation.component.html'\n})\nexport class SingleOperationComponent {\n  @Input() operation: IOperation;\n\n  statusIcons: object;\n  statusClasses: object;\n\n  constructor(private singleOperationDetailsService: SingleOperationDetailsService) {}\n\n  ngOnInit() {\n    this.statusIcons = operationStatusIcons;\n    this.statusClasses = operationStatusClasses;\n  }\n\n  openDetails() {\n    this.singleOperationDetailsService.openDetails(this.operation);\n  }\n}\n","import { Component, Input, OnInit, ViewChild } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { assign, get } from 'lodash-es';\nimport { IOperation, OperationService, OperationStatus } from '@c8y/client';\nimport {\n  AlertService,\n  ListItemComponent,\n  Tab,\n  gettext,\n  operationStatusClasses,\n  operationStatusIcons\n} from '@c8y/ngx-components';\n\n@Component({\n  selector: 'c8y-single-operation-list-item',\n  templateUrl: './single-operation-list-item.component.html'\n})\nexport class SingleOperationListItemComponent implements OnInit {\n  @Input() operation: Partial<IOperation>;\n  @Input() collapsed: boolean = true;\n  @Input() readOnly: boolean = false;\n\n  @ViewChild('listItem', { static: true }) listItem: ListItemComponent;\n  @ViewChild('details', { static: true }) detailsTabTemplate: any;\n  @ViewChild('historyOfChanges', { static: true }) historyOfChangesTabTemplate: any;\n\n  tabs: Tab[] = [];\n  selectedTab: Tab;\n  statusIcons = operationStatusIcons;\n  statusClasses = operationStatusClasses;\n  OperationStatus = OperationStatus;\n\n  get displayedDescription() {\n    const commandText = get(this.operation, 'c8y_Command.text');\n    const opDescription = get(this.operation, 'description');\n    return commandText || opDescription || gettext('(no command text or description available)');\n  }\n\n  constructor(\n    private router: Router,\n    private operationService: OperationService,\n    private alertService: AlertService\n  ) {}\n\n  ngOnInit() {\n    this.statusIcons = operationStatusIcons;\n    this.statusClasses = operationStatusClasses;\n\n    this.tabs = [\n      {\n        label: gettext('Details'),\n        icon: 'asterisk',\n        template: this.detailsTabTemplate\n      } as Tab,\n      {\n        label: gettext('History of changes'),\n        icon: 'archive',\n        template: this.historyOfChangesTabTemplate\n      } as Tab\n    ];\n    this.selectedTab = this.tabs[0];\n  }\n\n  scheduleAsBulkOperation() {\n    this.router.navigateByUrl(`/devicecontrol/single/create-bulk/${this.operation.id}`);\n  }\n\n  async cancel() {\n    try {\n      const operationAfterUpdate = (await this.operationService.update({\n        id: this.operation.id,\n        status: OperationStatus.FAILED,\n        failureReason: gettext('Operation cancelled by user.')\n      })).data;\n      assign(this.operation, operationAfterUpdate);\n      this.alertService.success(gettext('Operation cancelled.'));\n    } catch (ex) {\n      this.alertService.addServerFailure(ex);\n    }\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { IOperation } from '@c8y/client';\nimport { BulkOperationDetailsService } from '@c8y/ngx-components/operations/bulk-operations-list';\n\n@Component({\n  selector: 'c8y-single-operation-details',\n  templateUrl: './single-operation-details.component.html'\n})\nexport class SingleOperationDetailsComponent {\n  @Input() operation: Partial<IOperation>;\n  @Input() readOnly: boolean = false;\n\n  constructor(private bulkOperationDetailsService: BulkOperationDetailsService) {}\n\n  openBulkOperationDetails() {\n    this.bulkOperationDetailsService.openDetails(this.operation.bulkOperationId);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CollapseModule } from 'ngx-bootstrap/collapse';\nimport { PopoverModule } from 'ngx-bootstrap/popover';\nimport { TooltipModule } from 'ngx-bootstrap/tooltip';\n\nimport { CoreModule } from '@c8y/ngx-components';\nimport { BulkOperationsListModule } from '@c8y/ngx-components/operations/bulk-operations-list';\nimport { BulkOperationsServiceModule } from '@c8y/ngx-components/operations/bulk-operations-service';\n\nimport { SingleOperationDetailsService } from './single-operation-details.service';\nimport { SingleOperationComponent } from './single-operation.component';\nimport { SingleOperationModalComponent } from './single-operation-modal.component';\nimport { SingleOperationListItemComponent } from './single-operation-list-item.component';\nimport { SingleOperationDetailsComponent } from './single-operation-details.component';\n\n/**\n * This module allows to display details of a single operation in a modal.\n */\n@NgModule({\n  imports: [\n    CoreModule,\n    PopoverModule,\n    TooltipModule,\n    CollapseModule,\n    BulkOperationsListModule,\n    BulkOperationsServiceModule\n  ],\n  providers: [SingleOperationDetailsService],\n  declarations: [\n    SingleOperationComponent,\n    SingleOperationModalComponent,\n    SingleOperationListItemComponent,\n    SingleOperationDetailsComponent\n  ],\n  entryComponents: [\n    SingleOperationComponent,\n    SingleOperationModalComponent,\n    SingleOperationListItemComponent,\n    SingleOperationDetailsComponent\n  ],\n  exports: [SingleOperationComponent]\n})\nexport class SingleOperationDetailsModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["tslib_1.__decorate"],"mappings":"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"}