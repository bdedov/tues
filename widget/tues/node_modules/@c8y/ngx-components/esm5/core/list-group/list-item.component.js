import * as tslib_1 from "tslib";
import { Component, ContentChild, ElementRef, ContentChildren, HostBinding, Input, Output, EventEmitter, QueryList } from '@angular/core';
import { Subject } from 'rxjs';
import { takeUntil, filter, tap, delay } from 'rxjs/operators';
import { ListItemActionComponent } from './list-item-action.component';
import { ListItemCollapseComponent } from './list-item-collapse.component';
import { ListItemFooterComponent } from './list-item-footer.component';
/**
 * A list item is a representation of an item inside a list and
 * can be used to compose different styles in a list (mainly in a
 * <c8y-group-list>-component but also in others like the
 * <c8y-typeahead>-component):
 *  - a list with a footer
 *  - a list with one or multiple actions
 *  - an icon
 *  - a checkbox or radio input
 *
 * The item can be composed via content projection. The following
 * example shows a radio list with an icon, two actions
 * and a footer:
 * ```html
 * <c8y-list-group>
 *   <c8y-li
 *     *c8yFor="
 *       let device of devices;
 *       let i = index;
 *     "
 *   >
 *     <c8y-li-radio (onSelect)="updateSelected($event, device)"></c8y-li-radio>
 *     <c8y-li-icon [icon]="'rocket'"></c8y-li-icon>
 *     {{ i + 1 }}. {{ device.name || '-' }}
 *     <c8y-li-footer>
 *       Device id: <a [routerLink]="['/device', device.id]">{{ device.id }}</a>
 *     </c8y-li-footer>
 *     <c8y-li-action (click)="deleteDevice(device.id)" icon="times">
 *       Delete
 *     </c8y-li-action>
 *     <c8y-li-action (click)="(false)" icon="rocket">
 *       Launch to space
 *     </c8y-li-action>
 *   </c8y-li>
 * </c8y-list-group>
 * ```
 */
var ListItemComponent = /** @class */ (function () {
    /**
     * @ignore
     */
    function ListItemComponent(element) {
        this.element = element;
        /**
         * If set to true, the class "active" is added which
         * indicates that the current row is active.
         */
        this.active = false;
        /**
         * Indicates if the current list item is collapsed. You can trigger the collapsing from
         * any element event by toggling this value.
         *
         * @example
         * ```html
         * <c8y-li #li (click)="li.collapsed = !li.collapsed">
         *  Toggle
         *  <c8y-li-collapse>
         *    I can be toggled by clicking on the row.
         *  </c8y-li-collapse
         * </c8y-li>
         * ``
         */
        this.collapsed = true;
        /**
         * An event emitter which is triggered when the user collapses the content
         * via the chevron on the right.
         */
        this.collapsedChange = new EventEmitter();
        /**
         * @ignore
         */
        this.showFooter = false;
        /**
         * @ignore
         */
        this.showActions = false;
        /**
         * @ignore
         */
        this.showCollapse = false;
        /**
         * @ignore
         */
        this.dropdownUp = false;
        this.pulse$ = new Subject();
        this.destroy$ = new Subject();
        this.ACTION_ITEM_HEIGHT = 40;
    }
    /**
     * @ignore
     */
    ListItemComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.pulse$
            .pipe(filter(function (apply) { return !!apply; }), tap(function () { return _this.element.nativeElement.classList.remove('c8y-list--pulse'); }), delay(100), tap(function () { return _this.element.nativeElement.classList.add('c8y-list--pulse'); }), takeUntil(this.destroy$))
            .subscribe();
    };
    /**
     * @ignore
     */
    ListItemComponent.prototype.ngAfterContentChecked = function () {
        this.actions = this.itemActions.toArray();
        this.showFooter = this.itemFooter != null;
        this.showActions = this.itemActions.length > 0;
        this.showCollapse = this.itemCollapse != null;
    };
    /**
     * @ignore
     */
    ListItemComponent.prototype.ngOnDestroy = function () {
        this.destroy$.next();
        this.destroy$.complete();
    };
    /**
     * A helper function which helps to determine if the dropdown
     * should toggle up.
     */
    ListItemComponent.prototype.showDropdownUp = function () {
        var listItemRect = this.element.nativeElement.getBoundingClientRect();
        var dropdownTop = listItemRect.top;
        var dropdownHeightWithToggle = (1 + this.itemActions.length) * this.ACTION_ITEM_HEIGHT;
        var availableHeight = window.innerHeight;
        var dropdownDownFits = dropdownTop + dropdownHeightWithToggle <= availableHeight;
        this.dropdownUp = !dropdownDownFits;
    };
    /**
     * Toggles the collapse state and emits this state as
     * collapsedChange output as boolean.
     * @param $event Pass optional an event to stop propagation.
     */
    ListItemComponent.prototype.toggleCollapsed = function ($event) {
        if ($event) {
            $event.stopPropagation();
        }
        this.collapsed = !this.collapsed;
        this.collapsedChange.emit(this.collapsed);
    };
    /**
     * Highlights the list-item. This method should be used to show the
     * user that something within this item was changed.
     */
    ListItemComponent.prototype.pulse = function () {
        this.pulse$.next(true);
    };
    ListItemComponent.ctorParameters = function () { return [
        { type: ElementRef }
    ]; };
    tslib_1.__decorate([
        Input(),
        HostBinding('class.active')
    ], ListItemComponent.prototype, "active", void 0);
    tslib_1.__decorate([
        Input()
    ], ListItemComponent.prototype, "collapsed", void 0);
    tslib_1.__decorate([
        Output()
    ], ListItemComponent.prototype, "collapsedChange", void 0);
    tslib_1.__decorate([
        ContentChild(ListItemFooterComponent, { static: false })
    ], ListItemComponent.prototype, "itemFooter", void 0);
    tslib_1.__decorate([
        ContentChildren(ListItemActionComponent)
    ], ListItemComponent.prototype, "itemActions", void 0);
    tslib_1.__decorate([
        ContentChild(ListItemCollapseComponent, { static: false })
    ], ListItemComponent.prototype, "itemCollapse", void 0);
    ListItemComponent = tslib_1.__decorate([
        Component({
            selector: 'c8y-list-item, c8y-li',
            template: "<div [ngClass]=\"{ 'expanded': !collapsed, interact: (itemCollapse && itemCollapse.collapseWay === 'row')}\">\n  <div class=\"c8y-list__item__block\">\n    <ng-content select=\"c8y-list-item-radio, c8y-li-radio\"></ng-content>\n    <ng-content select=\"c8y-list-item-checkbox, c8y-li-checkbox\"></ng-content>\n\n    <ng-content select=\"c8y-list-item-icon, c8y-li-icon\"></ng-content>\n\n    <div class=\"c8y-list__item__body text-truncate-wrap\" (click)=\"(itemCollapse && itemCollapse.collapseWay === 'row') && toggleCollapsed()\">\n      <ng-content select=\"c8y-list-item-body, c8y-li-body\"></ng-content>\n      <ng-content></ng-content>\n      <div class=\"c8y-list__item__footer\" *ngIf=\"showFooter\">\n        <ng-content select=\"c8y-list-item-footer, c8y-li-footer\"></ng-content>\n      </div>\n    </div>\n\n    <div class=\"c8y-list__item__actions\" *ngIf=\"(showCollapse && (itemCollapse && itemCollapse.collapseWay === 'button')) || showActions\">\n      <button\n        class=\"collapse-btn\"\n        title=\"{{ 'Expand' | translate }}\"\n        type=\"button\"\n        (click)=\"toggleCollapsed($event)\"\n        [attr.aria-expanded]=\"!collapsed\"\n        *ngIf=\"showCollapse && itemCollapse.collapseWay === 'button'\"\n      >\n        <i [c8yIcon]=\"'chevron-down'\"></i>\n      </button>\n      <div\n        class=\"dropdown\"\n        dropdown\n        [dropup]=\"dropdownUp\"\n        *ngIf=\"showActions\"\n        (onShown)=\"showDropdownUp()\"\n      >\n        <button\n          class=\"dropdown-toggle c8y-dropdown\"\n          dropdownToggle\n          title=\"{{ 'Actions' | translate }}\"\n          type=\"button\"\n          aria-haspopup=\"true\"\n        >\n          <i [c8yIcon]=\"'ellipsis-v'\"></i>\n        </button>\n        <ul class=\"dropdown-menu dropdown-menu-right\" *dropdownMenu>\n          <ng-content select=\"c8y-list-item-action, c8y-li-action\"></ng-content>\n          <ng-container *ngFor=\"let action of actions\">\n            <ng-container *ngTemplateOutlet=\"action.template\"></ng-container>\n          </ng-container>\n        </ul>\n      </div>\n\n      <ng-content select=\"c8y-list-item-action, c8y-li-action\" *ngIf=\"showActions\"></ng-content>\n    </div>\n  </div>\n\n  <div *ngIf=\"showCollapse\" [collapse]=\"collapsed\" [isAnimated]=\"true\">\n    <div class=\"c8y-list__item__collapse--container\">\n      <ng-content select=\"c8y-list-item-collapse, c8y-li-collapse\"></ng-content>\n    </div>\n  </div>\n</div>\n",
            host: {
                class: 'c8y-list__item'
            }
        })
    ], ListItemComponent);
    return ListItemComponent;
}());
export { ListItemComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC1pdGVtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJjb3JlL2xpc3QtZ3JvdXAvbGlzdC1pdGVtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxZQUFZLEVBQ1osVUFBVSxFQUNWLGVBQWUsRUFDZixXQUFXLEVBQ1gsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBQ1osU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQy9ELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQzNFLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBRXZFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FvQ0c7QUFRSDtJQTRHRTs7T0FFRztJQUNILDJCQUFtQixPQUFtQjtRQUFuQixZQUFPLEdBQVAsT0FBTyxDQUFZO1FBOUd0Qzs7O1dBR0c7UUFHSCxXQUFNLEdBQVksS0FBSyxDQUFDO1FBRXhCOzs7Ozs7Ozs7Ozs7O1dBYUc7UUFFSCxjQUFTLEdBQVksSUFBSSxDQUFDO1FBRTFCOzs7V0FHRztRQUVILG9CQUFlLEdBQUcsSUFBSSxZQUFZLEVBQVcsQ0FBQztRQW9EOUM7O1dBRUc7UUFDSCxlQUFVLEdBQVksS0FBSyxDQUFDO1FBQzVCOztXQUVHO1FBQ0gsZ0JBQVcsR0FBWSxLQUFLLENBQUM7UUFDN0I7O1dBRUc7UUFDSCxpQkFBWSxHQUFZLEtBQUssQ0FBQztRQUs5Qjs7V0FF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REMsWUFBWSxDQUFDLHVCQUF1QixFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDO3lEQUNyQjtJQW9CcEM7UUFEQyxlQUFlLENBQUMsdUJBQXVCLENBQUM7MERBQ087SUFlaEQ7UUFEQyxZQUFZLENBQUMseUJBQXlCLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUM7MkRBQ25CO0lBakY3QixpQkFBaUI7UUFQN0IsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLHVCQUF1QjtZQUNqQyw4OEVBQXlDO1lBQ3pDLElBQUksRUFBRTtnQkFDSixLQUFLLEVBQUUsZ0JBQWdCO2FBQ3hCO1NBQ0YsQ0FBQztPQUNXLGlCQUFpQixDQW1MN0I7SUFBRCx3QkFBQztDQUFBLEFBbkxELElBbUxDO1NBbkxZLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkLFxuICBFbGVtZW50UmVmLFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIEhvc3RCaW5kaW5nLFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBFdmVudEVtaXR0ZXIsXG4gIFF1ZXJ5TGlzdFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbCwgZmlsdGVyLCB0YXAsIGRlbGF5IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgTGlzdEl0ZW1BY3Rpb25Db21wb25lbnQgfSBmcm9tICcuL2xpc3QtaXRlbS1hY3Rpb24uY29tcG9uZW50JztcbmltcG9ydCB7IExpc3RJdGVtQ29sbGFwc2VDb21wb25lbnQgfSBmcm9tICcuL2xpc3QtaXRlbS1jb2xsYXBzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgTGlzdEl0ZW1Gb290ZXJDb21wb25lbnQgfSBmcm9tICcuL2xpc3QtaXRlbS1mb290ZXIuY29tcG9uZW50JztcblxuLyoqXG4gKiBBIGxpc3QgaXRlbSBpcyBhIHJlcHJlc2VudGF0aW9uIG9mIGFuIGl0ZW0gaW5zaWRlIGEgbGlzdCBhbmRcbiAqIGNhbiBiZSB1c2VkIHRvIGNvbXBvc2UgZGlmZmVyZW50IHN0eWxlcyBpbiBhIGxpc3QgKG1haW5seSBpbiBhXG4gKiA8Yzh5LWdyb3VwLWxpc3Q+LWNvbXBvbmVudCBidXQgYWxzbyBpbiBvdGhlcnMgbGlrZSB0aGVcbiAqIDxjOHktdHlwZWFoZWFkPi1jb21wb25lbnQpOlxuICogIC0gYSBsaXN0IHdpdGggYSBmb290ZXJcbiAqICAtIGEgbGlzdCB3aXRoIG9uZSBvciBtdWx0aXBsZSBhY3Rpb25zXG4gKiAgLSBhbiBpY29uXG4gKiAgLSBhIGNoZWNrYm94IG9yIHJhZGlvIGlucHV0XG4gKlxuICogVGhlIGl0ZW0gY2FuIGJlIGNvbXBvc2VkIHZpYSBjb250ZW50IHByb2plY3Rpb24uIFRoZSBmb2xsb3dpbmdcbiAqIGV4YW1wbGUgc2hvd3MgYSByYWRpbyBsaXN0IHdpdGggYW4gaWNvbiwgdHdvIGFjdGlvbnNcbiAqIGFuZCBhIGZvb3RlcjpcbiAqIGBgYGh0bWxcbiAqIDxjOHktbGlzdC1ncm91cD5cbiAqICAgPGM4eS1saVxuICogICAgICpjOHlGb3I9XCJcbiAqICAgICAgIGxldCBkZXZpY2Ugb2YgZGV2aWNlcztcbiAqICAgICAgIGxldCBpID0gaW5kZXg7XG4gKiAgICAgXCJcbiAqICAgPlxuICogICAgIDxjOHktbGktcmFkaW8gKG9uU2VsZWN0KT1cInVwZGF0ZVNlbGVjdGVkKCRldmVudCwgZGV2aWNlKVwiPjwvYzh5LWxpLXJhZGlvPlxuICogICAgIDxjOHktbGktaWNvbiBbaWNvbl09XCIncm9ja2V0J1wiPjwvYzh5LWxpLWljb24+XG4gKiAgICAge3sgaSArIDEgfX0uIHt7IGRldmljZS5uYW1lIHx8ICctJyB9fVxuICogICAgIDxjOHktbGktZm9vdGVyPlxuICogICAgICAgRGV2aWNlIGlkOiA8YSBbcm91dGVyTGlua109XCJbJy9kZXZpY2UnLCBkZXZpY2UuaWRdXCI+e3sgZGV2aWNlLmlkIH19PC9hPlxuICogICAgIDwvYzh5LWxpLWZvb3Rlcj5cbiAqICAgICA8Yzh5LWxpLWFjdGlvbiAoY2xpY2spPVwiZGVsZXRlRGV2aWNlKGRldmljZS5pZClcIiBpY29uPVwidGltZXNcIj5cbiAqICAgICAgIERlbGV0ZVxuICogICAgIDwvYzh5LWxpLWFjdGlvbj5cbiAqICAgICA8Yzh5LWxpLWFjdGlvbiAoY2xpY2spPVwiKGZhbHNlKVwiIGljb249XCJyb2NrZXRcIj5cbiAqICAgICAgIExhdW5jaCB0byBzcGFjZVxuICogICAgIDwvYzh5LWxpLWFjdGlvbj5cbiAqICAgPC9jOHktbGk+XG4gKiA8L2M4eS1saXN0LWdyb3VwPlxuICogYGBgXG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1saXN0LWl0ZW0sIGM4eS1saScsXG4gIHRlbXBsYXRlVXJsOiAnLi9saXN0LWl0ZW0uY29tcG9uZW50Lmh0bWwnLFxuICBob3N0OiB7XG4gICAgY2xhc3M6ICdjOHktbGlzdF9faXRlbSdcbiAgfVxufSlcbmV4cG9ydCBjbGFzcyBMaXN0SXRlbUNvbXBvbmVudCB7XG4gIC8qKlxuICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGNsYXNzIFwiYWN0aXZlXCIgaXMgYWRkZWQgd2hpY2hcbiAgICogaW5kaWNhdGVzIHRoYXQgdGhlIGN1cnJlbnQgcm93IGlzIGFjdGl2ZS5cbiAgICovXG4gIEBJbnB1dCgpXG4gIEBIb3N0QmluZGluZygnY2xhc3MuYWN0aXZlJylcbiAgYWN0aXZlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEluZGljYXRlcyBpZiB0aGUgY3VycmVudCBsaXN0IGl0ZW0gaXMgY29sbGFwc2VkLiBZb3UgY2FuIHRyaWdnZXIgdGhlIGNvbGxhcHNpbmcgZnJvbVxuICAgKiBhbnkgZWxlbWVudCBldmVudCBieSB0b2dnbGluZyB0aGlzIHZhbHVlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBodG1sXG4gICAqIDxjOHktbGkgI2xpIChjbGljayk9XCJsaS5jb2xsYXBzZWQgPSAhbGkuY29sbGFwc2VkXCI+XG4gICAqICBUb2dnbGVcbiAgICogIDxjOHktbGktY29sbGFwc2U+XG4gICAqICAgIEkgY2FuIGJlIHRvZ2dsZWQgYnkgY2xpY2tpbmcgb24gdGhlIHJvdy5cbiAgICogIDwvYzh5LWxpLWNvbGxhcHNlXG4gICAqIDwvYzh5LWxpPlxuICAgKiBgYFxuICAgKi9cbiAgQElucHV0KClcbiAgY29sbGFwc2VkOiBib29sZWFuID0gdHJ1ZTtcblxuICAvKipcbiAgICogQW4gZXZlbnQgZW1pdHRlciB3aGljaCBpcyB0cmlnZ2VyZWQgd2hlbiB0aGUgdXNlciBjb2xsYXBzZXMgdGhlIGNvbnRlbnRcbiAgICogdmlhIHRoZSBjaGV2cm9uIG9uIHRoZSByaWdodC5cbiAgICovXG4gIEBPdXRwdXQoKVxuICBjb2xsYXBzZWRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cbiAgLyoqXG4gICAqIEEgW1tMaXN0SXRlbUZvb3RlckNvbXBvbmVudF1dIGVsZW1lbnQgd2hpY2ggY2FuIGJlIHVzZWQgdG8gc2hvdyBhIGZvb3Rlci5cbiAgICogQGV4YW1wbGVcbiAgICogYGBgaHRtbFxuICAgKiA8Yzh5LWxpPlxuICAgKiAgSSBhbSB0aGUgbWFpbiBjb250ZW50XG4gICAqICA8Yzh5LWxpLWZvb3Rlcj5cbiAgICogICAgSSBhbSB0aGUgZm9vdGVyIGNvbnRlbnRcbiAgICogIDwvYzh5LWxpLWZvb3Rlcj5cbiAgICogPC9jOHktbGk+XG4gICAqIGBgYFxuICAgKi9cbiAgQENvbnRlbnRDaGlsZChMaXN0SXRlbUZvb3RlckNvbXBvbmVudCwgeyBzdGF0aWM6IGZhbHNlIH0pXG4gIGl0ZW1Gb290ZXI6IExpc3RJdGVtRm9vdGVyQ29tcG9uZW50O1xuXG4gIC8qKlxuICAgKiBbW0xpc3RJdGVtQWN0aW9uQ29tcG9uZW50XV0gZWxlbWVudHMgd2hpY2ggY2FuIGJlIHVzZWQgdG8gc2hvdyBhbiBhY3Rpb24uXG4gICAqIEFuIGFjdGlvbiBpcyBkaXNwbGF5ZWQgb24gdGhlIHJpZ2h0IGluIHRoZSBkcm9wZG93biBhbmQgdXN1YWxseSBjb25zaXN0cyBvZiBhblxuICAgKiBpY29uIGFuZCBhIGxhYmVsLlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBodG1sXG4gICAqIDxjOHktbGk+XG4gICAqICBJIGFtIHRoZSBtYWluIGNvbnRlbnRcbiAgICogIDxjOHktbGktYWN0aW9uIChjbGljayk9XCJsYXVuY2hUb1NwYWNlKGRldmljZS5pZClcIiBpY29uPVwicm9ja2V0XCI+XG4gICAqICAgIExhdW5jaFxuICAgKiAgPC9jOHktbGktYWN0aW9uPlxuICAgKiAgPGM4eS1saS1hY3Rpb24gKGNsaWNrKT1cImRlbGV0ZURldmljZShkZXZpY2UuaWQpXCIgaWNvbj1cInRpbWVzXCI+XG4gICAqICAgIERlbGV0ZVxuICAgKiAgPC9jOHktbGktYWN0aW9uPlxuICAgKiA8L2M4eS1saT5cbiAgICogYGBgXG4gICAqL1xuICBAQ29udGVudENoaWxkcmVuKExpc3RJdGVtQWN0aW9uQ29tcG9uZW50KVxuICBpdGVtQWN0aW9uczogUXVlcnlMaXN0PExpc3RJdGVtQWN0aW9uQ29tcG9uZW50PjtcblxuICAvKipcbiAgICogW1tMaXN0SXRlbUNvbGxhcHNlQ29tcG9uZW50XV0gZWxlbWVudHMgd2hpY2ggY2FuIGJlIHVzZWQgdG8gc2hvdyBkZXRhaWwgdmlld3MuXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGh0bWxcbiAgICogPGM4eS1saT5cbiAgICogIEkgYW0gdGhlIG1haW4gY29udGVudFxuICAgKiAgPGM4eS1saS1jb2xsYXBzZT5cbiAgICogICAgSSBhbSBkZXRhaWxlZCBjb250ZW50XG4gICAqICA8L2M4eS1saS1jb2xsYXBzZT5cbiAgICogPC9jOHktbGk+XG4gICAqIGBgYFxuICAgKi9cbiAgQENvbnRlbnRDaGlsZChMaXN0SXRlbUNvbGxhcHNlQ29tcG9uZW50LCB7IHN0YXRpYzogZmFsc2UgfSlcbiAgaXRlbUNvbGxhcHNlOiBMaXN0SXRlbUNvbGxhcHNlQ29tcG9uZW50O1xuXG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBzaG93Rm9vdGVyOiBib29sZWFuID0gZmFsc2U7XG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBzaG93QWN0aW9uczogYm9vbGVhbiA9IGZhbHNlO1xuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgc2hvd0NvbGxhcHNlOiBib29sZWFuID0gZmFsc2U7XG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBhY3Rpb25zOiBMaXN0SXRlbUFjdGlvbkNvbXBvbmVudFtdO1xuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgZHJvcGRvd25VcDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIHByaXZhdGUgcHVsc2UkOiBTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcbiAgcHJpdmF0ZSBkZXN0cm95JDogU3ViamVjdDxhbnk+ID0gbmV3IFN1YmplY3QoKTtcbiAgcHJpdmF0ZSByZWFkb25seSBBQ1RJT05fSVRFTV9IRUlHSFQgPSA0MDtcblxuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgY29uc3RydWN0b3IocHVibGljIGVsZW1lbnQ6IEVsZW1lbnRSZWYpIHt9XG5cbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMucHVsc2UkXG4gICAgICAucGlwZShcbiAgICAgICAgZmlsdGVyKGFwcGx5ID0+ICEhYXBwbHkpLFxuICAgICAgICB0YXAoKCkgPT4gdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnYzh5LWxpc3QtLXB1bHNlJykpLFxuICAgICAgICBkZWxheSgxMDApLFxuICAgICAgICB0YXAoKCkgPT4gdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYzh5LWxpc3QtLXB1bHNlJykpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95JClcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBuZ0FmdGVyQ29udGVudENoZWNrZWQoKTogdm9pZCB7XG4gICAgdGhpcy5hY3Rpb25zID0gdGhpcy5pdGVtQWN0aW9ucy50b0FycmF5KCk7XG4gICAgdGhpcy5zaG93Rm9vdGVyID0gdGhpcy5pdGVtRm9vdGVyICE9IG51bGw7XG4gICAgdGhpcy5zaG93QWN0aW9ucyA9IHRoaXMuaXRlbUFjdGlvbnMubGVuZ3RoID4gMDtcbiAgICB0aGlzLnNob3dDb2xsYXBzZSA9IHRoaXMuaXRlbUNvbGxhcHNlICE9IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5kZXN0cm95JC5uZXh0KCk7XG4gICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEEgaGVscGVyIGZ1bmN0aW9uIHdoaWNoIGhlbHBzIHRvIGRldGVybWluZSBpZiB0aGUgZHJvcGRvd25cbiAgICogc2hvdWxkIHRvZ2dsZSB1cC5cbiAgICovXG4gIHNob3dEcm9wZG93blVwKCkge1xuICAgIGNvbnN0IGxpc3RJdGVtUmVjdDogRE9NUmVjdCA9IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IGRyb3Bkb3duVG9wID0gbGlzdEl0ZW1SZWN0LnRvcDtcbiAgICBjb25zdCBkcm9wZG93bkhlaWdodFdpdGhUb2dnbGUgPSAoMSArIHRoaXMuaXRlbUFjdGlvbnMubGVuZ3RoKSAqIHRoaXMuQUNUSU9OX0lURU1fSEVJR0hUO1xuICAgIGNvbnN0IGF2YWlsYWJsZUhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICBjb25zdCBkcm9wZG93bkRvd25GaXRzID0gZHJvcGRvd25Ub3AgKyBkcm9wZG93bkhlaWdodFdpdGhUb2dnbGUgPD0gYXZhaWxhYmxlSGVpZ2h0O1xuICAgIHRoaXMuZHJvcGRvd25VcCA9ICFkcm9wZG93bkRvd25GaXRzO1xuICB9XG5cbiAgLyoqXG4gICAqIFRvZ2dsZXMgdGhlIGNvbGxhcHNlIHN0YXRlIGFuZCBlbWl0cyB0aGlzIHN0YXRlIGFzXG4gICAqIGNvbGxhcHNlZENoYW5nZSBvdXRwdXQgYXMgYm9vbGVhbi5cbiAgICogQHBhcmFtICRldmVudCBQYXNzIG9wdGlvbmFsIGFuIGV2ZW50IHRvIHN0b3AgcHJvcGFnYXRpb24uXG4gICAqL1xuICB0b2dnbGVDb2xsYXBzZWQoJGV2ZW50PzogRXZlbnQpIHtcbiAgICBpZiAoJGV2ZW50KSB7XG4gICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuICAgIHRoaXMuY29sbGFwc2VkID0gIXRoaXMuY29sbGFwc2VkO1xuICAgIHRoaXMuY29sbGFwc2VkQ2hhbmdlLmVtaXQodGhpcy5jb2xsYXBzZWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhpZ2hsaWdodHMgdGhlIGxpc3QtaXRlbS4gVGhpcyBtZXRob2Qgc2hvdWxkIGJlIHVzZWQgdG8gc2hvdyB0aGVcbiAgICogdXNlciB0aGF0IHNvbWV0aGluZyB3aXRoaW4gdGhpcyBpdGVtIHdhcyBjaGFuZ2VkLlxuICAgKi9cbiAgcHVsc2UoKSB7XG4gICAgdGhpcy5wdWxzZSQubmV4dCh0cnVlKTtcbiAgfVxufVxuIl19