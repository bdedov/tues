import * as tslib_1 from "tslib";
import { Component, ContentChildren, ElementRef, HostBinding, Input, AfterContentInit, QueryList, forwardRef, Output, EventEmitter, HostListener, ChangeDetectionStrategy } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { DashboardChildComponent } from './dashboard-child.component';
/**
 * Displays a CSS grid which is customizable by the customer. You can set
 * `c8y-dashboard-child`-components on it or position any element on it by
 * setting the grid CSS properties. On change (resize, or rearrange) the
 * component emits an change event.
 *
 * ## Example:
 *
 * ```html
 * <c8y-title>Hello from outlet</c8y-title>
 *
 * <c8y-action-bar-item [placement]="'right'">
 *   <button class="btn btn-link" (click)="addRandom()"><i class="fa fa-plus"></i> Add random</button>
 * </c8y-action-bar-item>
 * <c8y-action-bar-item [placement]="'right'">
 *   <button class="btn btn-link" (click)="isFrozen = !isFrozen">
 *     <i [c8yIcon]="isFrozen ? 'lock' : 'unlock'"></i> Toggle freeze
 *   </button>
 * </c8y-action-bar-item>
 *
 * <c8y-dashboard (dashboardChange)="dashboardChange($event)">
 *   <c8y-dashboard-child
 *     [isFrozen]="isFrozen"
 *     title="dynamic"
 *     *ngFor="let widget of widgets"
 *     #current
 *   >
 *     x: {{ current.x }}<br />
 *     y: {{ current.y }}<br />
 *     width: {{ current.width }}<br />
 *     height: {{ current.height }}<br />
 *   </c8y-dashboard-child>
 *   <c8y-dashboard-child
 *     #cpWidget
 *     [isFrozen]="isFrozen"
 *     [x]="0"
 *     [y]="1"
 *     [width]="3"
 *     [height]="2"
 *     [data]="widget"
 *     [class]="'card card-dashboard panel-title-regular panel-content-branded panel-title-overlay'"
 *   >
 *     <c8y-dashboard-child-title>
 *       <span>World!</span>
 *     </c8y-dashboard-child-title>
 *     x: {{ cpWidget.x }}<br />
 *     y: {{ cpWidget.y }}<br />
 *     width: {{ cpWidget.width }}<br />
 *     height: {{ cpWidget.height }}<br />
 *   </c8y-dashboard-child>
 *   <c8y-dashboard-child
 *     #cpWidget2
 *     [isFrozen]="isFrozen"
 *     [x]="8"
 *     [y]="1"
 *     [width]="4"
 *     [height]="4"
 *     [class]="'card card-dashboard panel-content-dark'"
 *   >
 *     <c8y-dashboard-child-title>
 *       <span>Hello!</span>
 *     </c8y-dashboard-child-title>
 *     <c8y-dashboard-child-action>
 *       <a href="" (click)="cpWidget2.isFrozen = !cpWidget2.isFrozen; (false)">
 *         <i [c8yIcon]="cpWidget2.isFrozen ? 'lock' : 'unlock'"></i> Toggle freeze
 *       </a>
 *     </c8y-dashboard-child-action>
 *     x: {{ cpWidget2.x }}<br />
 *     y: {{ cpWidget2.y }}<br />
 *     width: {{ cpWidget2.width }}<br />
 *     height: {{ cpWidget2.height }}<br />
 *   </c8y-dashboard-child>
 *
 *   <c8y-dashboard-child
 *     #cpWidget3
 *     [isFrozen]="isFrozen"
 *     [x]="0"
 *     [y]="3"
 *     [width]="4"
 *     [height]="4"
 *     [class]="'card-dashboard panel-content-transparent'"
 *   >
 *     <c8y-dashboard-child-title *ngIf="showTitle">
 *       <span>Transparent!</span>
 *     </c8y-dashboard-child-title>
 *     <c8y-dashboard-child-action>
 *       <a href="" (click)="showTitle = !showTitle; (false)">
 *         <i [c8yIcon]="'heading'"></i> Hide/show title
 *       </a>
 *     </c8y-dashboard-child-action>
 *     <c8y-dashboard-child-action>
 *       <a href="" (click)="cpWidget3.isFrozen = !cpWidget3.isFrozen; (false)">
 *         <i [c8yIcon]="cpWidget3.isFrozen ? 'lock' : 'unlock'"></i> Toggle freeze
 *       </a>
 *     </c8y-dashboard-child-action>
 *     x: {{ cpWidget3.x }}<br />
 *     y: {{ cpWidget3.y }}<br />
 *     width: {{ cpWidget3.width }}<br />
 *     height: {{ cpWidget3.height }}<br />
 *   </c8y-dashboard-child>
 * </c8y-dashboard>
 * ```
 */
var DashboardComponent = /** @class */ (function () {
    function DashboardComponent(element, sanitizer) {
        this.element = element;
        this.sanitizer = sanitizer;
        /**
         * The amount of columns on that dashboard.
         */
        this.columns = 12;
        /**
         * The spacing between each children in pixel.
         */
        this.gap = 12;
        /**
         * The amount of rows to dusplay. Set to auto to
         * auto extend the rows.
         */
        this.rows = 'auto';
        /**
         * An event fired if the dashboard was changed.
         */
        this.dashboardChange = new EventEmitter();
        this.lastRow = 1;
        this.DEFAULT_ROW_SIZE = 68;
    }
    Object.defineProperty(DashboardComponent.prototype, "columnSize", {
        /**
         * The current column size.
         */
        get: function () {
            return this.dashboardRect.width / this.columns;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DashboardComponent.prototype, "rowSize", {
        /**
         * The current row size.
         */
        get: function () {
            return this.rows === 'auto' ? this.DEFAULT_ROW_SIZE : this.calculateRowSize();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DashboardComponent.prototype, "inlineStyle", {
        /**
         * Returns all positioning styles. Nasty workaround for that issue:
         * https://github.com/angular/angular/issues/9343
         */
        get: function () {
            return this.sanitizer.bypassSecurityTrustStyle("\n        -ms-grid-columns: (1fr)[" + this.columns + "];\n        grid-template-columns: repeat(" + this.columns + ", 1fr);\n        " + (this.rows !== 'auto' ? "grid-template-rows: repeat(" + this.rows + ", 1fr);" : '') + "\n        grid-auto-rows: " + (this.rowSize + this.gap) + "px;\n        -ms-grid-rows: (" + (this.rowSize + this.gap) + "px)[" + (this.rows === 'auto' ? this.lastRow : this.rows) + "];\n        margin: -" + this.gap + "px;\n      ");
        },
        enumerable: true,
        configurable: true
    });
    DashboardComponent.prototype.ngAfterContentInit = function () {
        this.onResize();
        this.getLastRow();
    };
    DashboardComponent.prototype.onResize = function () {
        this.updateRectSize();
    };
    /**
     * Gets the last row
     * (mainly for IE11 which doesn't support grid-auto-rows CSS property)
     */
    DashboardComponent.prototype.getLastRow = function () {
        var lastRow = 1;
        this.children.forEach(function (widget) {
            if (lastRow < widget.y + widget.width) {
                lastRow = widget.y + widget.width;
            }
        });
        this.lastRow = lastRow + 1;
    };
    /**
     * Updates the current rect size of the dashboard.
     */
    DashboardComponent.prototype.updateRectSize = function () {
        var ele = this.element.nativeElement;
        this.dashboardRect = ele.getBoundingClientRect();
    };
    DashboardComponent.prototype.emitChange = function (widget) {
        this.dashboardChange.emit({ source: widget, children: this.children.toArray() });
    };
    DashboardComponent.prototype.calculateRowSize = function () {
        return this.dashboardRect.height / this.rows;
    };
    DashboardComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: DomSanitizer }
    ]; };
    tslib_1.__decorate([
        ContentChildren(forwardRef(function () { return DashboardChildComponent; }))
    ], DashboardComponent.prototype, "children", void 0);
    tslib_1.__decorate([
        Input()
    ], DashboardComponent.prototype, "columns", void 0);
    tslib_1.__decorate([
        Input()
    ], DashboardComponent.prototype, "gap", void 0);
    tslib_1.__decorate([
        Input()
    ], DashboardComponent.prototype, "rows", void 0);
    tslib_1.__decorate([
        Output()
    ], DashboardComponent.prototype, "dashboardChange", void 0);
    tslib_1.__decorate([
        HostBinding('attr.style')
    ], DashboardComponent.prototype, "inlineStyle", null);
    tslib_1.__decorate([
        HostListener('window:resize')
    ], DashboardComponent.prototype, "onResize", null);
    DashboardComponent = tslib_1.__decorate([
        Component({
            selector: 'c8y-dashboard',
            template: "<ng-content></ng-content>\n",
            host: {
                class: 'c8y-grid-dashboard dashboard-grid'
            },
            changeDetection: ChangeDetectionStrategy.OnPush
        })
    ], DashboardComponent);
    return DashboardComponent;
}());
export { DashboardComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGFzaGJvYXJkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJjb3JlL2Rhc2hib2FyZC9kYXNoYm9hcmQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULGVBQWUsRUFDZixVQUFVLEVBQ1YsV0FBVyxFQUNYLEtBQUssRUFDTCxnQkFBZ0IsRUFDaEIsU0FBUyxFQUNULFVBQVUsRUFDVixNQUFNLEVBQ04sWUFBWSxFQUNaLFlBQVksRUFDWix1QkFBdUIsRUFDeEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3pELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBR3RFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FzR0c7QUFTSDtJQW1FRSw0QkFBb0IsT0FBbUIsRUFBVSxTQUF1QjtRQUFwRCxZQUFPLEdBQVAsT0FBTyxDQUFZO1FBQVUsY0FBUyxHQUFULFNBQVMsQ0FBYztRQTNEeEU7O1dBRUc7UUFDTSxZQUFPLEdBQUcsRUFBRSxDQUFDO1FBRXRCOztXQUVHO1FBQ00sUUFBRyxHQUFHLEVBQUUsQ0FBQztRQUVsQjs7O1dBR0c7UUFDTSxTQUFJLEdBQW9CLE1BQU0sQ0FBQztRQUV4Qzs7V0FFRztRQUNPLG9CQUFlLEdBQUcsSUFBSSxZQUFZLEVBQW1CLENBQUM7UUFHeEQsWUFBTyxHQUFHLENBQUMsQ0FBQztRQUNILHFCQUFnQixHQUFHLEVBQUUsQ0FBQztJQW9Db0MsQ0FBQztJQS9CNUUsc0JBQUksMENBQVU7UUFIZDs7V0FFRzthQUNIO1lBQ0UsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLEtB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QUFDO1lBQ1QsUUFBUSxFQUFFLGVBQWU7WUFDekIsdUNBQXlDO1lBQ3pDLElBQUksRUFBRTtnQkFDSixLQUFLLEVBQUUsbUNBQW1DO2FBQzNDO1lBQ0QsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07U0FDaEQsQ0FBQztPQUNXLGtCQUFrQixDQTRHOUI7SUFBRCx5QkFBQztDQUFBLEFBNUdELElBNEdDO1NBNUdZLGtCQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBFbGVtZW50UmVmLFxuICBIb3N0QmluZGluZyxcbiAgSW5wdXQsXG4gIEFmdGVyQ29udGVudEluaXQsXG4gIFF1ZXJ5TGlzdCxcbiAgZm9yd2FyZFJlZixcbiAgT3V0cHV0LFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RMaXN0ZW5lcixcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3lcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBEb21TYW5pdGl6ZXIgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbmltcG9ydCB7IERhc2hib2FyZENoaWxkQ29tcG9uZW50IH0gZnJvbSAnLi9kYXNoYm9hcmQtY2hpbGQuY29tcG9uZW50JztcbmltcG9ydCB7IERhc2hib2FyZENoYW5nZSB9IGZyb20gJy4vZGFzaGJvYXJkLm1vZGVsJztcblxuLyoqXG4gKiBEaXNwbGF5cyBhIENTUyBncmlkIHdoaWNoIGlzIGN1c3RvbWl6YWJsZSBieSB0aGUgY3VzdG9tZXIuIFlvdSBjYW4gc2V0XG4gKiBgYzh5LWRhc2hib2FyZC1jaGlsZGAtY29tcG9uZW50cyBvbiBpdCBvciBwb3NpdGlvbiBhbnkgZWxlbWVudCBvbiBpdCBieVxuICogc2V0dGluZyB0aGUgZ3JpZCBDU1MgcHJvcGVydGllcy4gT24gY2hhbmdlIChyZXNpemUsIG9yIHJlYXJyYW5nZSkgdGhlXG4gKiBjb21wb25lbnQgZW1pdHMgYW4gY2hhbmdlIGV2ZW50LlxuICpcbiAqICMjIEV4YW1wbGU6XG4gKlxuICogYGBgaHRtbFxuICogPGM4eS10aXRsZT5IZWxsbyBmcm9tIG91dGxldDwvYzh5LXRpdGxlPlxuICpcbiAqIDxjOHktYWN0aW9uLWJhci1pdGVtIFtwbGFjZW1lbnRdPVwiJ3JpZ2h0J1wiPlxuICogICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1saW5rXCIgKGNsaWNrKT1cImFkZFJhbmRvbSgpXCI+PGkgY2xhc3M9XCJmYSBmYS1wbHVzXCI+PC9pPiBBZGQgcmFuZG9tPC9idXR0b24+XG4gKiA8L2M4eS1hY3Rpb24tYmFyLWl0ZW0+XG4gKiA8Yzh5LWFjdGlvbi1iYXItaXRlbSBbcGxhY2VtZW50XT1cIidyaWdodCdcIj5cbiAqICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tbGlua1wiIChjbGljayk9XCJpc0Zyb3plbiA9ICFpc0Zyb3plblwiPlxuICogICAgIDxpIFtjOHlJY29uXT1cImlzRnJvemVuID8gJ2xvY2snIDogJ3VubG9jaydcIj48L2k+IFRvZ2dsZSBmcmVlemVcbiAqICAgPC9idXR0b24+XG4gKiA8L2M4eS1hY3Rpb24tYmFyLWl0ZW0+XG4gKlxuICogPGM4eS1kYXNoYm9hcmQgKGRhc2hib2FyZENoYW5nZSk9XCJkYXNoYm9hcmRDaGFuZ2UoJGV2ZW50KVwiPlxuICogICA8Yzh5LWRhc2hib2FyZC1jaGlsZFxuICogICAgIFtpc0Zyb3plbl09XCJpc0Zyb3plblwiXG4gKiAgICAgdGl0bGU9XCJkeW5hbWljXCJcbiAqICAgICAqbmdGb3I9XCJsZXQgd2lkZ2V0IG9mIHdpZGdldHNcIlxuICogICAgICNjdXJyZW50XG4gKiAgID5cbiAqICAgICB4OiB7eyBjdXJyZW50LnggfX08YnIgLz5cbiAqICAgICB5OiB7eyBjdXJyZW50LnkgfX08YnIgLz5cbiAqICAgICB3aWR0aDoge3sgY3VycmVudC53aWR0aCB9fTxiciAvPlxuICogICAgIGhlaWdodDoge3sgY3VycmVudC5oZWlnaHQgfX08YnIgLz5cbiAqICAgPC9jOHktZGFzaGJvYXJkLWNoaWxkPlxuICogICA8Yzh5LWRhc2hib2FyZC1jaGlsZFxuICogICAgICNjcFdpZGdldFxuICogICAgIFtpc0Zyb3plbl09XCJpc0Zyb3plblwiXG4gKiAgICAgW3hdPVwiMFwiXG4gKiAgICAgW3ldPVwiMVwiXG4gKiAgICAgW3dpZHRoXT1cIjNcIlxuICogICAgIFtoZWlnaHRdPVwiMlwiXG4gKiAgICAgW2RhdGFdPVwid2lkZ2V0XCJcbiAqICAgICBbY2xhc3NdPVwiJ2NhcmQgY2FyZC1kYXNoYm9hcmQgcGFuZWwtdGl0bGUtcmVndWxhciBwYW5lbC1jb250ZW50LWJyYW5kZWQgcGFuZWwtdGl0bGUtb3ZlcmxheSdcIlxuICogICA+XG4gKiAgICAgPGM4eS1kYXNoYm9hcmQtY2hpbGQtdGl0bGU+XG4gKiAgICAgICA8c3Bhbj5Xb3JsZCE8L3NwYW4+XG4gKiAgICAgPC9jOHktZGFzaGJvYXJkLWNoaWxkLXRpdGxlPlxuICogICAgIHg6IHt7IGNwV2lkZ2V0LnggfX08YnIgLz5cbiAqICAgICB5OiB7eyBjcFdpZGdldC55IH19PGJyIC8+XG4gKiAgICAgd2lkdGg6IHt7IGNwV2lkZ2V0LndpZHRoIH19PGJyIC8+XG4gKiAgICAgaGVpZ2h0OiB7eyBjcFdpZGdldC5oZWlnaHQgfX08YnIgLz5cbiAqICAgPC9jOHktZGFzaGJvYXJkLWNoaWxkPlxuICogICA8Yzh5LWRhc2hib2FyZC1jaGlsZFxuICogICAgICNjcFdpZGdldDJcbiAqICAgICBbaXNGcm96ZW5dPVwiaXNGcm96ZW5cIlxuICogICAgIFt4XT1cIjhcIlxuICogICAgIFt5XT1cIjFcIlxuICogICAgIFt3aWR0aF09XCI0XCJcbiAqICAgICBbaGVpZ2h0XT1cIjRcIlxuICogICAgIFtjbGFzc109XCInY2FyZCBjYXJkLWRhc2hib2FyZCBwYW5lbC1jb250ZW50LWRhcmsnXCJcbiAqICAgPlxuICogICAgIDxjOHktZGFzaGJvYXJkLWNoaWxkLXRpdGxlPlxuICogICAgICAgPHNwYW4+SGVsbG8hPC9zcGFuPlxuICogICAgIDwvYzh5LWRhc2hib2FyZC1jaGlsZC10aXRsZT5cbiAqICAgICA8Yzh5LWRhc2hib2FyZC1jaGlsZC1hY3Rpb24+XG4gKiAgICAgICA8YSBocmVmPVwiXCIgKGNsaWNrKT1cImNwV2lkZ2V0Mi5pc0Zyb3plbiA9ICFjcFdpZGdldDIuaXNGcm96ZW47IChmYWxzZSlcIj5cbiAqICAgICAgICAgPGkgW2M4eUljb25dPVwiY3BXaWRnZXQyLmlzRnJvemVuID8gJ2xvY2snIDogJ3VubG9jaydcIj48L2k+IFRvZ2dsZSBmcmVlemVcbiAqICAgICAgIDwvYT5cbiAqICAgICA8L2M4eS1kYXNoYm9hcmQtY2hpbGQtYWN0aW9uPlxuICogICAgIHg6IHt7IGNwV2lkZ2V0Mi54IH19PGJyIC8+XG4gKiAgICAgeToge3sgY3BXaWRnZXQyLnkgfX08YnIgLz5cbiAqICAgICB3aWR0aDoge3sgY3BXaWRnZXQyLndpZHRoIH19PGJyIC8+XG4gKiAgICAgaGVpZ2h0OiB7eyBjcFdpZGdldDIuaGVpZ2h0IH19PGJyIC8+XG4gKiAgIDwvYzh5LWRhc2hib2FyZC1jaGlsZD5cbiAqXG4gKiAgIDxjOHktZGFzaGJvYXJkLWNoaWxkXG4gKiAgICAgI2NwV2lkZ2V0M1xuICogICAgIFtpc0Zyb3plbl09XCJpc0Zyb3plblwiXG4gKiAgICAgW3hdPVwiMFwiXG4gKiAgICAgW3ldPVwiM1wiXG4gKiAgICAgW3dpZHRoXT1cIjRcIlxuICogICAgIFtoZWlnaHRdPVwiNFwiXG4gKiAgICAgW2NsYXNzXT1cIidjYXJkLWRhc2hib2FyZCBwYW5lbC1jb250ZW50LXRyYW5zcGFyZW50J1wiXG4gKiAgID5cbiAqICAgICA8Yzh5LWRhc2hib2FyZC1jaGlsZC10aXRsZSAqbmdJZj1cInNob3dUaXRsZVwiPlxuICogICAgICAgPHNwYW4+VHJhbnNwYXJlbnQhPC9zcGFuPlxuICogICAgIDwvYzh5LWRhc2hib2FyZC1jaGlsZC10aXRsZT5cbiAqICAgICA8Yzh5LWRhc2hib2FyZC1jaGlsZC1hY3Rpb24+XG4gKiAgICAgICA8YSBocmVmPVwiXCIgKGNsaWNrKT1cInNob3dUaXRsZSA9ICFzaG93VGl0bGU7IChmYWxzZSlcIj5cbiAqICAgICAgICAgPGkgW2M4eUljb25dPVwiJ2hlYWRpbmcnXCI+PC9pPiBIaWRlL3Nob3cgdGl0bGVcbiAqICAgICAgIDwvYT5cbiAqICAgICA8L2M4eS1kYXNoYm9hcmQtY2hpbGQtYWN0aW9uPlxuICogICAgIDxjOHktZGFzaGJvYXJkLWNoaWxkLWFjdGlvbj5cbiAqICAgICAgIDxhIGhyZWY9XCJcIiAoY2xpY2spPVwiY3BXaWRnZXQzLmlzRnJvemVuID0gIWNwV2lkZ2V0My5pc0Zyb3plbjsgKGZhbHNlKVwiPlxuICogICAgICAgICA8aSBbYzh5SWNvbl09XCJjcFdpZGdldDMuaXNGcm96ZW4gPyAnbG9jaycgOiAndW5sb2NrJ1wiPjwvaT4gVG9nZ2xlIGZyZWV6ZVxuICogICAgICAgPC9hPlxuICogICAgIDwvYzh5LWRhc2hib2FyZC1jaGlsZC1hY3Rpb24+XG4gKiAgICAgeDoge3sgY3BXaWRnZXQzLnggfX08YnIgLz5cbiAqICAgICB5OiB7eyBjcFdpZGdldDMueSB9fTxiciAvPlxuICogICAgIHdpZHRoOiB7eyBjcFdpZGdldDMud2lkdGggfX08YnIgLz5cbiAqICAgICBoZWlnaHQ6IHt7IGNwV2lkZ2V0My5oZWlnaHQgfX08YnIgLz5cbiAqICAgPC9jOHktZGFzaGJvYXJkLWNoaWxkPlxuICogPC9jOHktZGFzaGJvYXJkPlxuICogYGBgXG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1kYXNoYm9hcmQnLFxuICB0ZW1wbGF0ZVVybDogJy4vZGFzaGJvYXJkLmNvbXBvbmVudC5odG1sJyxcbiAgaG9zdDoge1xuICAgIGNsYXNzOiAnYzh5LWdyaWQtZGFzaGJvYXJkIGRhc2hib2FyZC1ncmlkJ1xuICB9LFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBEYXNoYm9hcmRDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0IHtcbiAgLyoqXG4gICAqIEFsbCBjaGlsZHJlbiBpbiB0aGF0IGRhc2hib2FyZC5cbiAgICovXG4gIEBDb250ZW50Q2hpbGRyZW4oZm9yd2FyZFJlZigoKSA9PiBEYXNoYm9hcmRDaGlsZENvbXBvbmVudCkpIGNoaWxkcmVuOiBRdWVyeUxpc3Q8XG4gICAgRGFzaGJvYXJkQ2hpbGRDb21wb25lbnRcbiAgPjtcblxuICAvKipcbiAgICogVGhlIGFtb3VudCBvZiBjb2x1bW5zIG9uIHRoYXQgZGFzaGJvYXJkLlxuICAgKi9cbiAgQElucHV0KCkgY29sdW1ucyA9IDEyO1xuXG4gIC8qKlxuICAgKiBUaGUgc3BhY2luZyBiZXR3ZWVuIGVhY2ggY2hpbGRyZW4gaW4gcGl4ZWwuXG4gICAqL1xuICBASW5wdXQoKSBnYXAgPSAxMjtcblxuICAvKipcbiAgICogVGhlIGFtb3VudCBvZiByb3dzIHRvIGR1c3BsYXkuIFNldCB0byBhdXRvIHRvXG4gICAqIGF1dG8gZXh0ZW5kIHRoZSByb3dzLlxuICAgKi9cbiAgQElucHV0KCkgcm93czogbnVtYmVyIHwgJ2F1dG8nID0gJ2F1dG8nO1xuXG4gIC8qKlxuICAgKiBBbiBldmVudCBmaXJlZCBpZiB0aGUgZGFzaGJvYXJkIHdhcyBjaGFuZ2VkLlxuICAgKi9cbiAgQE91dHB1dCgpIGRhc2hib2FyZENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8RGFzaGJvYXJkQ2hhbmdlPigpO1xuXG4gIGRhc2hib2FyZFJlY3Q7XG4gIHByaXZhdGUgbGFzdFJvdyA9IDE7XG4gIHByaXZhdGUgcmVhZG9ubHkgREVGQVVMVF9ST1dfU0laRSA9IDY4O1xuXG4gIC8qKlxuICAgKiBUaGUgY3VycmVudCBjb2x1bW4gc2l6ZS5cbiAgICovXG4gIGdldCBjb2x1bW5TaXplKCkge1xuICAgIHJldHVybiB0aGlzLmRhc2hib2FyZFJlY3Qud2lkdGggLyB0aGlzLmNvbHVtbnM7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGN1cnJlbnQgcm93IHNpemUuXG4gICAqL1xuICBnZXQgcm93U2l6ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5yb3dzID09PSAnYXV0bycgPyB0aGlzLkRFRkFVTFRfUk9XX1NJWkUgOiB0aGlzLmNhbGN1bGF0ZVJvd1NpemUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFsbCBwb3NpdGlvbmluZyBzdHlsZXMuIE5hc3R5IHdvcmthcm91bmQgZm9yIHRoYXQgaXNzdWU6XG4gICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyL2FuZ3VsYXIvaXNzdWVzLzkzNDNcbiAgICovXG4gIEBIb3N0QmluZGluZygnYXR0ci5zdHlsZScpXG4gIGdldCBpbmxpbmVTdHlsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5zYW5pdGl6ZXIuYnlwYXNzU2VjdXJpdHlUcnVzdFN0eWxlKFxuICAgICAgYFxuICAgICAgICAtbXMtZ3JpZC1jb2x1bW5zOiAoMWZyKVske3RoaXMuY29sdW1uc31dO1xuICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCgke3RoaXMuY29sdW1uc30sIDFmcik7XG4gICAgICAgICR7dGhpcy5yb3dzICE9PSAnYXV0bycgPyBgZ3JpZC10ZW1wbGF0ZS1yb3dzOiByZXBlYXQoJHt0aGlzLnJvd3N9LCAxZnIpO2AgOiAnJ31cbiAgICAgICAgZ3JpZC1hdXRvLXJvd3M6ICR7dGhpcy5yb3dTaXplICsgdGhpcy5nYXB9cHg7XG4gICAgICAgIC1tcy1ncmlkLXJvd3M6ICgke3RoaXMucm93U2l6ZSArIHRoaXMuZ2FwfXB4KVske1xuICAgICAgICB0aGlzLnJvd3MgPT09ICdhdXRvJyA/IHRoaXMubGFzdFJvdyA6IHRoaXMucm93c1xuICAgICAgfV07XG4gICAgICAgIG1hcmdpbjogLSR7dGhpcy5nYXB9cHg7XG4gICAgICBgXG4gICAgKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZiwgcHJpdmF0ZSBzYW5pdGl6ZXI6IERvbVNhbml0aXplcikge31cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5vblJlc2l6ZSgpO1xuICAgIHRoaXMuZ2V0TGFzdFJvdygpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignd2luZG93OnJlc2l6ZScpXG4gIG9uUmVzaXplKCkge1xuICAgIHRoaXMudXBkYXRlUmVjdFNpemUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBsYXN0IHJvd1xuICAgKiAobWFpbmx5IGZvciBJRTExIHdoaWNoIGRvZXNuJ3Qgc3VwcG9ydCBncmlkLWF1dG8tcm93cyBDU1MgcHJvcGVydHkpXG4gICAqL1xuICBnZXRMYXN0Um93KCkge1xuICAgIGxldCBsYXN0Um93ID0gMTtcbiAgICB0aGlzLmNoaWxkcmVuLmZvckVhY2god2lkZ2V0ID0+IHtcbiAgICAgIGlmIChsYXN0Um93IDwgd2lkZ2V0LnkgKyB3aWRnZXQud2lkdGgpIHtcbiAgICAgICAgbGFzdFJvdyA9IHdpZGdldC55ICsgd2lkZ2V0LndpZHRoO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMubGFzdFJvdyA9IGxhc3RSb3cgKyAxO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIGN1cnJlbnQgcmVjdCBzaXplIG9mIHRoZSBkYXNoYm9hcmQuXG4gICAqL1xuICB1cGRhdGVSZWN0U2l6ZSgpIHtcbiAgICBjb25zdCBlbGUgPSB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCBhcyBIVE1MRWxlbWVudDtcbiAgICB0aGlzLmRhc2hib2FyZFJlY3QgPSAgZWxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICB9XG5cbiAgZW1pdENoYW5nZSh3aWRnZXQ6IERhc2hib2FyZENoaWxkQ29tcG9uZW50KSB7XG4gICAgdGhpcy5kYXNoYm9hcmRDaGFuZ2UuZW1pdCh7IHNvdXJjZTogd2lkZ2V0LCBjaGlsZHJlbjogdGhpcy5jaGlsZHJlbi50b0FycmF5KCkgfSk7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVJvd1NpemUoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGFzaGJvYXJkUmVjdC5oZWlnaHQgLyAodGhpcy5yb3dzIGFzIG51bWJlcik7XG4gIH1cbn1cbiJdfQ==