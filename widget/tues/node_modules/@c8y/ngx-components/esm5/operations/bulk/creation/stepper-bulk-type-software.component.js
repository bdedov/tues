import * as tslib_1 from "tslib";
import { Component, ViewChild } from '@angular/core';
import { C8yStepper, gettext, ModalService, Status } from '@c8y/ngx-components';
import { TranslateService } from '@ngx-translate/core';
import { uniq } from 'lodash-es';
import { BaseStepperComponent } from '../base-stepper.component';
import { SelectSoftwareStepComponent } from './software-update-stepper/select-software-step.component';
var StepperBulkTypeSoftware = /** @class */ (function (_super) {
    tslib_1.__extends(StepperBulkTypeSoftware, _super);
    function StepperBulkTypeSoftware(modal, translate) {
        var _this = _super.call(this) || this;
        _this.modal = modal;
        _this.translate = translate;
        _this.descriptionTemplateSingle = gettext('Update software to: {{ name }} (version {{ version }})');
        _this.descriptionTemplateOneOther = gettext('Update software to: {{ name }} (version {{ version }}) and one other');
        _this.descriptionTemplateMultiple = gettext('Update software to: {{ name }} (version {{ version }}) and {{ count }} others');
        _this.selectedSoftware = [];
        return _this;
    }
    StepperBulkTypeSoftware.prototype.onSoftwareSelected = function (selectedItem) {
        this.selectedSoftware = this.selectedSoftware.filter(function (item) { return item.software.id !== selectedItem.software.id; });
        this.selectedSoftware.push(selectedItem);
    };
    StepperBulkTypeSoftware.prototype.confirmSoftwareSelection = function ($event) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var deviceTypes, ex_1;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        deviceTypes = this.getUniqueDeviceTypes();
                        this.deviceTypes = deviceTypes;
                        if (!(deviceTypes.length > 1)) return [3 /*break*/, 5];
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.modal.confirm(gettext('Selected software for various device types'), gettext('Operation may fail due to unsupported software. Do you want to proceed?'), Status.WARNING, { ok: gettext('Confirm'), cancel: gettext('Cancel') })];
                    case 2:
                        _a.sent();
                        $event.stepper.next();
                        return [3 /*break*/, 4];
                    case 3:
                        ex_1 = _a.sent();
                        this.selectedSoftware = [];
                        this.selectSoftware.resetSelection();
                        return [3 /*break*/, 4];
                    case 4: return [3 /*break*/, 6];
                    case 5:
                        $event.stepper.next();
                        _a.label = 6;
                    case 6: return [2 /*return*/];
                }
            });
        });
    };
    StepperBulkTypeSoftware.prototype.retrieveOperationPrototype = function () {
        var softwareList = this.selectedSoftware.map(function (item) { return ({
            name: item.software.name,
            version: item.version.c8y_Software.version,
            url: item.version.c8y_Software.url,
            action: item.action
        }); });
        var interpolationParams = {
            name: softwareList[0].name,
            version: softwareList[0].version,
            count: softwareList.length - 1
        };
        var description;
        switch (softwareList.length) {
            case 1:
                description = this.translate.instant(this.descriptionTemplateSingle, interpolationParams);
                break;
            case 2:
                description = this.translate.instant(this.descriptionTemplateOneOther, interpolationParams);
                break;
            default:
                description = this.translate.instant(this.descriptionTemplateMultiple, interpolationParams);
        }
        return {
            name: gettext('Software update'),
            prototype: {
                description: description,
                c8y_SoftwareUpdate: softwareList
            }
        };
    };
    StepperBulkTypeSoftware.prototype.getUniqueDeviceTypes = function () {
        return uniq(this.selectedSoftware
            .map(function (item) { return item.software.c8y_Filter && item.software.c8y_Filter.type; })
            .filter(function (type) { return !!type; }));
    };
    StepperBulkTypeSoftware.ctorParameters = function () { return [
        { type: ModalService },
        { type: TranslateService }
    ]; };
    tslib_1.__decorate([
        ViewChild(SelectSoftwareStepComponent, { static: false })
    ], StepperBulkTypeSoftware.prototype, "selectSoftware", void 0);
    StepperBulkTypeSoftware = tslib_1.__decorate([
        Component({
            selector: 'c8y-stepper-bulk-type-software',
            template: "<c8y-bulk-operation-stepper>\n  <ng-container\n    *customStep=\"\n      'Select software' | translate; \n      completed: !!selectedSoftware.length;\n      buttonsDisabled: !selectedSoftware.length; \n      onNext: confirmSoftwareSelection.bind(this)\"\n  >\n    <c8y-select-software-step\n      (software)=\"onSoftwareSelected($event)\"\n      class=\"d-contents\"\n    ></c8y-select-software-step>\n  </ng-container>\n  <ng-container *customStep=\"'Confirm selected software' | translate\">\n    <c8y-confirm-software-selection-step\n      class=\"d-contents\"\n      [selectedItems]=\"selectedSoftware\"\n    ></c8y-confirm-software-selection-step>\n  </ng-container>\n</c8y-bulk-operation-stepper>\n"
        })
    ], StepperBulkTypeSoftware);
    return StepperBulkTypeSoftware;
}(BaseStepperComponent));
export { StepperBulkTypeSoftware };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RlcHBlci1idWxrLXR5cGUtc29mdHdhcmUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGM4eS9uZ3gtY29tcG9uZW50cy9vcGVyYXRpb25zLyIsInNvdXJjZXMiOlsiYnVsay9jcmVhdGlvbi9zdGVwcGVyLWJ1bGstdHlwZS1zb2Z0d2FyZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXJELE9BQU8sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNoRixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ2pDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRWpFLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLDBEQUEwRCxDQUFDO0FBVXZHO0lBQTZDLG1EQUFvQjtJQWUvRCxpQ0FBb0IsS0FBbUIsRUFBVSxTQUEyQjtRQUE1RSxZQUNFLGlCQUFPLFNBQ1I7UUFGbUIsV0FBSyxHQUFMLEtBQUssQ0FBYztRQUFVLGVBQVMsR0FBVCxTQUFTLENBQWtCO1FBZG5FLCtCQUF5QixHQUFXLE9BQU8sQ0FDbEQsd0RBQXdELENBQ3pELENBQUM7UUFDTyxpQ0FBMkIsR0FBVyxPQUFPLENBQ3BELHNFQUFzRSxDQUN2RSxDQUFDO1FBQ08saUNBQTJCLEdBQVcsT0FBTyxDQUNwRCwrRUFBK0UsQ0FDaEYsQ0FBQztRQUVGLHNCQUFnQixHQUF3QixFQUFFLENBQUM7O0lBTTNDLENBQUM7SUFFRCxvREFBa0IsR0FBbEIsVUFBbUIsWUFBWTtRQUM3QixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FDbEQsVUFB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SSxDQUFDLFFBQVEsQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUF6RCxDQUF5RCxDQUFDO2FBQ3RFLE1BQU0sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLEVBQU4sQ0FBTSxDQUFDLENBQzFCLENBQUM7SUFDSixDQUFDOztnQkF4RTBCLFlBQVk7Z0JBQXFCLGdCQUFnQjs7SUFGNUU7UUFEQyxTQUFTLENBQUMsMkJBQTJCLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUM7bUVBQ2Q7SUFiakMsdUJBQXVCO1FBSm5DLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxnQ0FBZ0M7WUFDMUMsNHNCQUF3RDtTQUN6RCxDQUFDO09BQ1csdUJBQXVCLENBd0ZuQztJQUFELDhCQUFDO0NBQUEsQUF4RkQsQ0FBNkMsb0JBQW9CLEdBd0ZoRTtTQXhGWSx1QkFBdUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDZGtTdGVwIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3N0ZXBwZXInO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IElPcGVyYXRpb24gfSBmcm9tICdAYzh5L2NsaWVudCc7XG5pbXBvcnQgeyBDOHlTdGVwcGVyLCBnZXR0ZXh0LCBNb2RhbFNlcnZpY2UsIFN0YXR1cyB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuaW1wb3J0IHsgdW5pcSB9IGZyb20gJ2xvZGFzaC1lcyc7XG5pbXBvcnQgeyBCYXNlU3RlcHBlckNvbXBvbmVudCB9IGZyb20gJy4uL2Jhc2Utc3RlcHBlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgT3BlcmF0aW9uRGV0YWlscyB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMvb3BlcmF0aW9ucy9idWxrLW9wZXJhdGlvbnMtc2VydmljZSc7XG5pbXBvcnQgeyBTZWxlY3RTb2Z0d2FyZVN0ZXBDb21wb25lbnQgfSBmcm9tICcuL3NvZnR3YXJlLXVwZGF0ZS1zdGVwcGVyL3NlbGVjdC1zb2Z0d2FyZS1zdGVwLmNvbXBvbmVudCc7XG5pbXBvcnQge1xuICBJU2VsZWN0ZWRTb2Z0d2FyZSxcbiAgSVNvZnR3YXJlVXBkYXRlT3BlcmF0aW9uUHJvdG90eXBlXG59IGZyb20gJy4vc29mdHdhcmUtdXBkYXRlLXN0ZXBwZXIvc2VsZWN0LXNvZnR3YXJlLm1vZGVsJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LXN0ZXBwZXItYnVsay10eXBlLXNvZnR3YXJlJyxcbiAgdGVtcGxhdGVVcmw6ICdzdGVwcGVyLWJ1bGstdHlwZS1zb2Z0d2FyZS5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgU3RlcHBlckJ1bGtUeXBlU29mdHdhcmUgZXh0ZW5kcyBCYXNlU3RlcHBlckNvbXBvbmVudCB7XG4gIHJlYWRvbmx5IGRlc2NyaXB0aW9uVGVtcGxhdGVTaW5nbGU6IHN0cmluZyA9IGdldHRleHQoXG4gICAgJ1VwZGF0ZSBzb2Z0d2FyZSB0bzoge3sgbmFtZSB9fSAodmVyc2lvbiB7eyB2ZXJzaW9uIH19KSdcbiAgKTtcbiAgcmVhZG9ubHkgZGVzY3JpcHRpb25UZW1wbGF0ZU9uZU90aGVyOiBzdHJpbmcgPSBnZXR0ZXh0KFxuICAgICdVcGRhdGUgc29mdHdhcmUgdG86IHt7IG5hbWUgfX0gKHZlcnNpb24ge3sgdmVyc2lvbiB9fSkgYW5kIG9uZSBvdGhlcidcbiAgKTtcbiAgcmVhZG9ubHkgZGVzY3JpcHRpb25UZW1wbGF0ZU11bHRpcGxlOiBzdHJpbmcgPSBnZXR0ZXh0KFxuICAgICdVcGRhdGUgc29mdHdhcmUgdG86IHt7IG5hbWUgfX0gKHZlcnNpb24ge3sgdmVyc2lvbiB9fSkgYW5kIHt7IGNvdW50IH19IG90aGVycydcbiAgKTtcblxuICBzZWxlY3RlZFNvZnR3YXJlOiBJU2VsZWN0ZWRTb2Z0d2FyZVtdID0gW107XG4gIEBWaWV3Q2hpbGQoU2VsZWN0U29mdHdhcmVTdGVwQ29tcG9uZW50LCB7IHN0YXRpYzogZmFsc2UgfSlcbiAgc2VsZWN0U29mdHdhcmU6IFNlbGVjdFNvZnR3YXJlU3RlcENvbXBvbmVudDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIG1vZGFsOiBNb2RhbFNlcnZpY2UsIHByaXZhdGUgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG9uU29mdHdhcmVTZWxlY3RlZChzZWxlY3RlZEl0ZW0pIHtcbiAgICB0aGlzLnNlbGVjdGVkU29mdHdhcmUgPSB0aGlzLnNlbGVjdGVkU29mdHdhcmUuZmlsdGVyKFxuICAgICAgaXRlbSA9PiBpdGVtLnNvZnR3YXJlLmlkICE9PSBzZWxlY3RlZEl0ZW0uc29mdHdhcmUuaWRcbiAgICApO1xuICAgIHRoaXMuc2VsZWN0ZWRTb2Z0d2FyZS5wdXNoKHNlbGVjdGVkSXRlbSk7XG4gIH1cblxuICBhc3luYyBjb25maXJtU29mdHdhcmVTZWxlY3Rpb24oJGV2ZW50OiB7IHN0ZXBwZXI6IEM4eVN0ZXBwZXI7IHN0ZXA6IENka1N0ZXAgfSkge1xuICAgIGNvbnN0IGRldmljZVR5cGVzOiBzdHJpbmdbXSA9IHRoaXMuZ2V0VW5pcXVlRGV2aWNlVHlwZXMoKTtcbiAgICB0aGlzLmRldmljZVR5cGVzID0gZGV2aWNlVHlwZXM7XG4gICAgaWYgKGRldmljZVR5cGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMubW9kYWwuY29uZmlybShcbiAgICAgICAgICBnZXR0ZXh0KCdTZWxlY3RlZCBzb2Z0d2FyZSBmb3IgdmFyaW91cyBkZXZpY2UgdHlwZXMnKSxcbiAgICAgICAgICBnZXR0ZXh0KCdPcGVyYXRpb24gbWF5IGZhaWwgZHVlIHRvIHVuc3VwcG9ydGVkIHNvZnR3YXJlLiBEbyB5b3Ugd2FudCB0byBwcm9jZWVkPycpLFxuICAgICAgICAgIFN0YXR1cy5XQVJOSU5HLFxuICAgICAgICAgIHsgb2s6IGdldHRleHQoJ0NvbmZpcm0nKSwgY2FuY2VsOiBnZXR0ZXh0KCdDYW5jZWwnKSB9XG4gICAgICAgICk7XG4gICAgICAgICRldmVudC5zdGVwcGVyLm5leHQoKTtcbiAgICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRTb2Z0d2FyZSA9IFtdO1xuICAgICAgICB0aGlzLnNlbGVjdFNvZnR3YXJlLnJlc2V0U2VsZWN0aW9uKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICRldmVudC5zdGVwcGVyLm5leHQoKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgcmV0cmlldmVPcGVyYXRpb25Qcm90b3R5cGUoKTogT3BlcmF0aW9uRGV0YWlscyB7XG4gICAgY29uc3Qgc29mdHdhcmVMaXN0OiBJU29mdHdhcmVVcGRhdGVPcGVyYXRpb25Qcm90b3R5cGVbXSA9IHRoaXMuc2VsZWN0ZWRTb2Z0d2FyZS5tYXAoaXRlbSA9PiAoe1xuICAgICAgbmFtZTogaXRlbS5zb2Z0d2FyZS5uYW1lLFxuICAgICAgdmVyc2lvbjogaXRlbS52ZXJzaW9uLmM4eV9Tb2Z0d2FyZS52ZXJzaW9uLFxuICAgICAgdXJsOiBpdGVtLnZlcnNpb24uYzh5X1NvZnR3YXJlLnVybCxcbiAgICAgIGFjdGlvbjogaXRlbS5hY3Rpb25cbiAgICB9KSk7XG5cbiAgICBjb25zdCBpbnRlcnBvbGF0aW9uUGFyYW1zOiBvYmplY3QgPSB7XG4gICAgICBuYW1lOiBzb2Z0d2FyZUxpc3RbMF0ubmFtZSxcbiAgICAgIHZlcnNpb246IHNvZnR3YXJlTGlzdFswXS52ZXJzaW9uLFxuICAgICAgY291bnQ6IHNvZnR3YXJlTGlzdC5sZW5ndGggLSAxXG4gICAgfTtcbiAgICBsZXQgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICBzd2l0Y2ggKHNvZnR3YXJlTGlzdC5sZW5ndGgpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgZGVzY3JpcHRpb24gPSB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KHRoaXMuZGVzY3JpcHRpb25UZW1wbGF0ZVNpbmdsZSwgaW50ZXJwb2xhdGlvblBhcmFtcyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBkZXNjcmlwdGlvbiA9IHRoaXMudHJhbnNsYXRlLmluc3RhbnQodGhpcy5kZXNjcmlwdGlvblRlbXBsYXRlT25lT3RoZXIsIGludGVycG9sYXRpb25QYXJhbXMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGRlc2NyaXB0aW9uID0gdGhpcy50cmFuc2xhdGUuaW5zdGFudCh0aGlzLmRlc2NyaXB0aW9uVGVtcGxhdGVNdWx0aXBsZSwgaW50ZXJwb2xhdGlvblBhcmFtcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IGdldHRleHQoJ1NvZnR3YXJlIHVwZGF0ZScpLFxuICAgICAgcHJvdG90eXBlOiAoe1xuICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgYzh5X1NvZnR3YXJlVXBkYXRlOiBzb2Z0d2FyZUxpc3RcbiAgICAgIH0gYXMgdW5rbm93bikgYXMgSU9wZXJhdGlvblxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdldFVuaXF1ZURldmljZVR5cGVzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gdW5pcShcbiAgICAgIHRoaXMuc2VsZWN0ZWRTb2Z0d2FyZVxuICAgICAgICAubWFwKGl0ZW0gPT4gaXRlbS5zb2Z0d2FyZS5jOHlfRmlsdGVyICYmIGl0ZW0uc29mdHdhcmUuYzh5X0ZpbHRlci50eXBlKVxuICAgICAgICAuZmlsdGVyKHR5cGUgPT4gISF0eXBlKVxuICAgICk7XG4gIH1cbn1cbiJdfQ==